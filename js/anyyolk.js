(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.CreditsScene = (function(_super) {
  __extends(CreditsScene, _super);

  function CreditsScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return CreditsScene.__super__.constructor.apply(this, arguments);
  }

  CreditsScene.prototype.className = "credits_scene";

  CreditsScene.prototype.template = _.template($("#_credits").html());

  CreditsScene.prototype.sceneName = "credits";

  CreditsScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  CreditsScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    return this.$el.on(Utils.clickUpOrTouch(), ".back_button", this.handleBackButton);
  };

  CreditsScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    this.model.set("scene", "menu");
    return false;
  };

  CreditsScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  CreditsScene.prototype.render = function() {
    this.$el.html(this.template());
    $("#stage").append(this.$el);
    return this;
  };

  CreditsScene.prototype.renderRemoveScene = function() {
    this.$(".credits").addClass("removal");
    this.$(".back_button").addClass("removal");
    this.$(".credits").css(Utils.bp() + "animation-name", "raiseMenu");
    return this.$(".back_button").css(Utils.bp() + "animation-name", "raiseMenu");
  };

  CreditsScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("credits")) {
      return this.$el.empty();
    }
  };

  return CreditsScene;

})(Backbone.View);

},{"../anyyolk":10}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.EggModel = (function(_super) {
  __extends(EggModel, _super);

  function EggModel() {
    this.eggHitGround = __bind(this.eggHitGround, this);
    this.isSafe = __bind(this.isSafe, this);
    this.nextSprite = __bind(this.nextSprite, this);
    return EggModel.__super__.constructor.apply(this, arguments);
  }

  EggModel.NumSprites = 5;

  EggModel.prototype.defaults = {
    spriteIndex: 1,
    collectionIndex: 0
  };

  EggModel.prototype.nextSprite = function() {
    this.set("spriteIndex", this.get("spriteIndex") + 1);
    if (this.isSafe()) {
      return this.trigger("fly", [this]);
    }
  };

  EggModel.prototype.isSafe = function() {
    return this.get("spriteIndex") >= EggModel.NumSprites;
  };

  EggModel.prototype.eggHitGround = function() {
    if (!this.isSafe()) {
      return this.trigger("break", [this]);
    }
  };

  return EggModel;

})(Backbone.Model);

},{"../anyyolk":10}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.EggView = (function(_super) {
  __extends(EggView, _super);

  function EggView() {
    this.handleTransitionEnded = __bind(this.handleTransitionEnded, this);
    this.renderRemove = __bind(this.renderRemove, this);
    this.renderFlying = __bind(this.renderFlying, this);
    this.renderHidding = __bind(this.renderHidding, this);
    this.renderBreaking = __bind(this.renderBreaking, this);
    this.renderSprites = __bind(this.renderSprites, this);
    this.render = __bind(this.render, this);
    this.nextSprite = __bind(this.nextSprite, this);
    this.initialize = __bind(this.initialize, this);
    return EggView.__super__.constructor.apply(this, arguments);
  }

  EggView.prototype.className = "egg";

  EggView.prototype.spriteClass = ".egg_sprite_";

  EggView.prototype.eggTemplate = _.template($("#_egg").html());

  EggView.prototype.scene = null;

  EggView.prototype.events = {
    webkitTransitionEnd: "handleTransitionEnded",
    mozTransitionEnd: "handleTransitionEnded",
    transitionend: "handleTransitionEnded"
  };

  EggView.prototype.initialize = function() {
    this.scene = this.options.scene;
    this.gameState = this.options.gameState;
    this.$el.on(Utils.clickDownOrTouch(), this.nextSprite);
    this.model.on("change:spriteIndex", this.renderSprites);
    this.model.on("fly", this.renderFlying);
    return this.model.on("break", this.renderBreaking);
  };

  EggView.prototype.nextSprite = function() {
    if (!this.model.isSafe()) {
      this.model.nextSprite();
      return false;
    }
  };

  EggView.prototype.render = function() {
    var delay, intermission, left, speed, top;
    this.renderSprites();
    intermission = 3.5;
    delay = void 0;
    if (this.model.get("collectionIndex") === 1) {
      delay = intermission;
    } else {
      delay = (Math.random() * 6 + 3) / this.gameState.get("speedX") + (2 * this.model.get("collectionIndex")) + intermission;
    }
    speed = 100 * this.gameState.get("speedX") + Math.random() * 100 - 50;
    left = Math.random() * ($(window).width() - 100) + 30;
    top = $("#stage").height() - 220;
    this.$el.css(Utils.bp() + "transition-delay", delay + "s");
    this.$el.css(Utils.bp() + "transition-duration", $(window).height() / speed + "s");
    this.$el.css(Utils.bp() + "transition-property", "top opacity");
    this.$el.css(Utils.bp() + "transition-timing-function", "linear");
    this.$el.css("left", left + "px");
    this.scene.append(this.$el);
    return Utils.nextTick((function(_this) {
      return function() {
        return _this.$el.css("top", top + "px");
      };
    })(this));
  };

  EggView.prototype.renderSprites = function() {
    return this.$el.html(this.eggTemplate({
      spriteIndex: this.model.get("spriteIndex")
    }));
  };

  EggView.prototype.renderBreaking = function() {
    this.$el.addClass("cracked").addClass("disabled");
    this.$el.css(Utils.bp() + "transition-delay", "0s");
    return this.$el.css(Utils.bp() + "transition-duration", "0.2s");
  };

  EggView.prototype.renderHidding = function() {
    this.$el.addClass("broken");
    this.$el.css(Utils.bp() + "transition-delay", "1s");
    this.$el.css(Utils.bp() + "transition-duration", "0.5s");
    this.$el.css(Utils.bp() + "transition-property", "opacity");
    this.$el.css(Utils.bp() + "transition-timing-function", "linear");
    return this.$el.css("opacity", 0);
  };

  EggView.prototype.renderFlying = function() {
    this.$el.addClass("flying");
    this.$el.css(Utils.bp() + "transition-delay", "0s");
    this.$el.css(Utils.bp() + "transition-duration", "1s");
    this.$el.css(Utils.bp() + "transition-property", "top");
    return this.$el.css(Utils.bp() + "transition-timing-function", "linear");
  };

  EggView.prototype.renderRemove = function() {
    return this.remove();
  };

  EggView.prototype.handleTransitionEnded = function(e) {
    if (e.originalEvent.propertyName === "opacity") {
      this.renderRemove();
    } else if (e.originalEvent.propertyName === "top") {
      this.model.eggHitGround();
    } else {
      if (e.originalEvent.propertyName === Utils.bp() + "transform" || "transform") {
        this.renderHidding();
      }
    }
    return false;
  };

  return EggView;

})(Backbone.View);

},{"../anyyolk":10}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameOverScene = (function(_super) {
  __extends(GameOverScene, _super);

  function GameOverScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.saveHighScore = __bind(this.saveHighScore, this);
    this.handleFacebookButton = __bind(this.handleFacebookButton, this);
    this.handleReplayButton = __bind(this.handleReplayButton, this);
    this.handleMenuButton = __bind(this.handleMenuButton, this);
    this.initialize = __bind(this.initialize, this);
    return GameOverScene.__super__.constructor.apply(this, arguments);
  }

  GameOverScene.Congrats = ["Not bad", "Good", "Great", "Fantastic", "Smashing!", "Amazing!", "Flying High", "Ridiculous!", "Extraordinary!", "Monstrous!!"];

  GameOverScene.prototype.className = "game_over_scene";

  GameOverScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  GameOverScene.prototype.template = _.template($("#_game_over").html());

  GameOverScene.prototype.sceneName = "game_over";

  GameOverScene.prototype.submitted = false;

  GameOverScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.$el.on(Utils.clickUpOrTouch(), ".menu_button", this.handleMenuButton);
    this.$el.on(Utils.clickUpOrTouch(), ".replay_button", this.handleReplayButton);
    return this.$el.on(Utils.clickUpOrTouch(), ".facebook_button", this.handleFacebookButton);
  };

  GameOverScene.prototype.handleMenuButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    return this.model.set("scene", "menu");
  };

  GameOverScene.prototype.handleReplayButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    return this.model.set("scene", "game");
  };

  GameOverScene.prototype.handleFacebookButton = function(e) {
    $(".fb_content").hide();
    $(".facebook_button").addClass("disabled").empty().spin({
      length: 5,
      radius: 5,
      lines: 8,
      width: 3,
      color: "#fff"
    });
    if (Parse.User.current()) {
      return this.saveHighScore();
    } else {
      return Parse.FacebookUtils.logIn(null, {
        success: (function(_this) {
          return function(user) {
            if (!user.existed()) {
              return FB.api("/me", function(response) {
                if (!response.error) {
                  user.set("displayName", response.name);
                  return user.save(null, {
                    success: function(user) {
                      return _this.saveHighScore();
                    },
                    error: function(user, error) {
                      return console.log("Oops, something went wrong saving your name.");
                    }
                  });
                } else {
                  return console.log("Oops something went wrong with facebook.");
                }
              });
            } else {
              return _this.saveHighScore();
            }
          };
        })(this),
        error: (function(_this) {
          return function(user, error) {
            return console.log("Oops, something went wrong.");
          };
        })(this)
      });
    }
  };

  GameOverScene.prototype.saveHighScore = function() {
    var submission;
    submission = {
      score: this.model.getScoreSubmission()
    };
    return Parse.Cloud.run("submitHighscore", submission, {
      success: (function(_this) {
        return function(result) {
          _this.submitted = true;
          return _this.$(".facebook_button").html("Submitted!");
        };
      })(this),
      error: (function(_this) {
        return function(error) {
          _this.submitted = true;
          return _this.$(".facebook_button").html(" X Try Again...").removeClass("disabled");
        };
      })(this)
    });
  };

  GameOverScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  GameOverScene.prototype.render = function() {
    var congratsIndex;
    congratsIndex = (this.model.get("level") > GameOverScene.Congrats.length ? GameOverScene.Congrats.length - 1 : this.model.get("level") - 1);
    this.$el.html(this.template({
      score: this.model.get("score"),
      congrats: GameOverScene.Congrats[congratsIndex]
    }));
    return $("#stage").append(this.$el);
  };

  GameOverScene.prototype.renderRemoveScene = function() {
    this.$(".menu_item").addClass("removal");
    this.$(".summary").addClass("removal");
    this.$(".menu_item").css(Utils.bp() + "animation-name", "raiseMenu");
    return this.$(".summary").css(Utils.bp() + "animation-name", "raiseScores");
  };

  GameOverScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("summary")) {
      return this.$el.empty();
    }
  };

  return GameOverScene;

})(Backbone.View);

},{"../anyyolk":10}],5:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameScene = (function(_super) {
  __extends(GameScene, _super);

  function GameScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.renderAddEgg = __bind(this.renderAddEgg, this);
    this.renderEggs = __bind(this.renderEggs, this);
    this.renderBackButton = __bind(this.renderBackButton, this);
    this.renderLives = __bind(this.renderLives, this);
    this.renderScore = __bind(this.renderScore, this);
    this.renderLevelLabel = __bind(this.renderLevelLabel, this);
    this.renderLevel = __bind(this.renderLevel, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return GameScene.__super__.constructor.apply(this, arguments);
  }

  GameScene.prototype.className = "game_scene";

  GameScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  GameScene.prototype.scoreTemplate = _.template($("#_game_score").html());

  GameScene.prototype.levelTemplate = _.template($("#_game_level").html());

  GameScene.prototype.livesTemplate = _.template($("#_game_lives").html());

  GameScene.prototype.sceneName = "game";

  GameScene.prototype.initialize = function() {
    this.eggViews = [];
    this.$el.on(Utils.clickUpOrTouch(), ".back_button", this.handleBackButton);
    this.model.on("change:scene", this.renderSceneChange);
    this.model.get("eggCollection").on("add", this.renderAddEgg);
    this.model.on("change:score", this.renderScore);
    this.model.on("change:lives", this.renderLives);
    this.model.on("change:level", this.renderLevel);
    return this.model.on("change:level", this.renderLevelLabel);
  };

  GameScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    return this.model.set("scene", "menu");
  };

  GameScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  GameScene.prototype.render = function() {
    this.model.resetGameData();
    this.$("#hud").remove();
    this.$el.append("<div id='hud'></div>");
    this.renderLevel();
    setTimeout(((function(_this) {
      return function() {
        return _this.renderLevelLabel();
      };
    })(this)), 1200);
    this.renderScore();
    this.renderLives();
    this.renderBackButton();
    this.renderEggs();
    if ($("#stage ." + this.className).length <= 0) {
      $("#stage").append(this.$el);
    }
    return this;
  };

  GameScene.prototype.renderLevel = function() {
    if (this.$("#game_level").length > 0) {
      this.$("#game_level").replaceWith(this.levelTemplate({
        level: this.model.get("level")
      }));
    } else {
      this.$("#hud").append(this.levelTemplate({
        level: this.model.get("level")
      }));
    }
    return this;
  };

  GameScene.prototype.renderLevelLabel = function() {
    this.$el.append("<p class='level_label'>LEVEL " + this.model.get("level") + "<br>GET READY!</p>");
    setTimeout(((function(_this) {
      return function() {
        return _this.$(".level_label").addClass("removal");
      };
    })(this)), 3000);
    setTimeout(((function(_this) {
      return function() {
        return _this.$(".level_label").remove();
      };
    })(this)), 3300);
    return this;
  };

  GameScene.prototype.renderScore = function() {
    if (this.$("#game_score").length > 0) {
      this.$("#game_score").replaceWith(this.scoreTemplate({
        score: this.model.get("score")
      }));
    } else {
      this.$("#hud").append(this.scoreTemplate({
        score: this.model.get("score")
      }));
    }
    return this;
  };

  GameScene.prototype.renderLives = function() {
    if (this.$("#game_lives").length > 0) {
      this.$("#game_lives").replaceWith(this.livesTemplate({
        lives: this.model.get("lives")
      }));
    } else {
      this.$("#hud").append(this.livesTemplate({
        lives: this.model.get("lives")
      }));
    }
    return this;
  };

  GameScene.prototype.renderBackButton = function() {
    if (this.$(".back_button").length > 0) {
      this.$(".back_button").replaceWith("<div class='back_button'>X</div>");
    } else {
      this.$el.append("<div class='back_button'>X</div>");
    }
    return this;
  };

  GameScene.prototype.renderEggs = function() {
    this.model.addEggs();
    return this;
  };

  GameScene.prototype.renderAddEgg = function(eggModel, collection, options) {
    var eggView;
    eggView = new anyyolk.EggView({
      model: eggModel,
      gameState: this.model,
      scene: this.$el
    });
    eggView.render();
    this.eggViews.push(eggView);
    return this;
  };

  GameScene.prototype.renderRemoveScene = function() {
    this.$(".back_button").css(Utils.bp() + "animation-name", "xRaise");
    this.$("#hud p").css(Utils.bp() + "animation-name", "removeHUD");
    this.$(".egg").css(Utils.bp() + "transition-duration", "0.3s");
    _.each(this.eggViews, (function(_this) {
      return function(eggView) {
        return eggView.renderRemove();
      };
    })(this));
    this.model.get("eggCollection").reset();
    return this;
  };

  GameScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("back_button")) {
      this.$el.empty();
    }
    return false;
  };

  return GameScene;

})(Backbone.View);

},{"../anyyolk":10}],6:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameState = (function(_super) {
  __extends(GameState, _super);

  function GameState() {
    this.getScoreSubmission = __bind(this.getScoreSubmission, this);
    this.resetGameData = __bind(this.resetGameData, this);
    this.cleanUpEgg = __bind(this.cleanUpEgg, this);
    this.addEggs = __bind(this.addEggs, this);
    this.validateAlive = __bind(this.validateAlive, this);
    this.incrementLevel = __bind(this.incrementLevel, this);
    this.decrementLife = __bind(this.decrementLife, this);
    this.incrementScore = __bind(this.incrementScore, this);
    this.initialize = __bind(this.initialize, this);
    return GameState.__super__.constructor.apply(this, arguments);
  }

  GameState.DefaultGameData = {
    score: 0,
    lives: 3,
    level: 1,
    speedX: 1
  };

  GameState.prototype.defaults = {
    scene: "",
    eggCollection: null,
    speedX: 1
  };

  GameState.prototype.initialize = function() {
    var query;
    this.set("eggCollection", new Backbone.Collection());
    query = new Parse.Query("HighScore");
    query.descending("score");
    query.include("player");
    query.limit(10);
    this.set("highscoreCollection", query.collection());
    this.resetGameData();
    this.get("eggCollection").on("fly", this.incrementScore);
    this.get("eggCollection").on("break", this.decrementLife);
    this.get("eggCollection").on("fly break", this.cleanUpEgg);
    return this.get("eggCollection").on("remove", this.incrementLevel);
  };

  GameState.prototype.incrementScore = function() {
    return this.set("score", this.get("score") + 1);
  };

  GameState.prototype.decrementLife = function() {
    this.set("lives", this.get("lives") - 1);
    return this.validateAlive();
  };

  GameState.prototype.incrementLevel = function() {
    if (this.get("eggCollection").length <= 0) {
      this.set("level", this.get("level") + 1);
      this.set("speedX", this.get("speedX") + 0.25);
      return this.addEggs();
    }
  };

  GameState.prototype.validateAlive = function() {
    if (this.get("lives") <= 0) {
      return this.set("scene", "game_over");
    }
  };

  GameState.prototype.addEggs = function() {
    var i, numEggs, _results;
    numEggs = 10;
    i = 0;
    _results = [];
    while (i < numEggs) {
      this.get("eggCollection").add(new anyyolk.EggModel({
        collectionIndex: i
      }));
      _results.push(i++);
    }
    return _results;
  };

  GameState.prototype.cleanUpEgg = function(eggModel) {
    return this.get("eggCollection").remove(eggModel);
  };

  GameState.prototype.resetGameData = function() {
    return this.set(anyyolk.GameState.DefaultGameData);
  };

  GameState.prototype.getScoreSubmission = function() {
    return ((this.get("level") * 362) << 5) + "." + ((this.get("score") * 672) << 4);
  };

  return GameState;

})(Backbone.Model);

},{"../anyyolk":10}],7:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.HighscoreScene = (function(_super) {
  __extends(HighscoreScene, _super);

  function HighscoreScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.renderScore = __bind(this.renderScore, this);
    this.renderScoreCollection = __bind(this.renderScoreCollection, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return HighscoreScene.__super__.constructor.apply(this, arguments);
  }

  HighscoreScene.prototype.className = "highscore_scene";

  HighscoreScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  HighscoreScene.prototype.template = _.template($("#_highscore").html());

  HighscoreScene.prototype.scoreTemplate = _.template($("#_score").html());

  HighscoreScene.prototype.sceneName = "highscore";

  HighscoreScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.model.get("highscoreCollection").on("reset", this.renderScoreCollection);
    this.$el.on(Utils.clickUpOrTouch(), ".back_button", this.handleBackButton);
    if (this.model.get("currentScene") === this.sceneName) {
      return this.render();
    }
  };

  HighscoreScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    this.model.set("scene", "menu");
    return false;
  };

  HighscoreScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  HighscoreScene.prototype.render = function() {
    this.$el.html(this.template());
    this.model.get("highscoreCollection").fetch();
    this.$(".highscore").spin({
      length: 9,
      radius: 10,
      lines: 12,
      width: 4,
      color: "#fff"
    });
    $("#stage").append(this.$el);
    return this;
  };

  HighscoreScene.prototype.renderScoreCollection = function() {
    this.model.get("highscoreCollection").each((function(_this) {
      return function(score, index) {
        return _this.renderScore(score, index);
      };
    })(this));
    $(".highscore .spinner").remove();
    return this;
  };

  HighscoreScene.prototype.renderScore = function(score, index) {
    return this.$("#score_table tbody").append(this.scoreTemplate({
      score: score,
      index: index
    }));
  };

  HighscoreScene.prototype.renderRemoveScene = function() {
    this.$(".menu_item").addClass("removal");
    this.$(".highscore").addClass("removal");
    this.$(".menu_item").css(Utils.bp() + "animation-name", "raiseMenu");
    return this.$(".highscore").css(Utils.bp() + "animation-name", "raiseScores");
  };

  HighscoreScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("highscore")) {
      return this.$el.empty();
    }
  };

  return HighscoreScene;

})(Backbone.View);

},{"../anyyolk":10}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.MenuScene = (function(_super) {
  __extends(MenuScene, _super);

  function MenuScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleCreditsButton = __bind(this.handleCreditsButton, this);
    this.handleHighscoreButton = __bind(this.handleHighscoreButton, this);
    this.handlePlayButton = __bind(this.handlePlayButton, this);
    this.initialize = __bind(this.initialize, this);
    return MenuScene.__super__.constructor.apply(this, arguments);
  }

  MenuScene.prototype.className = "menu_scene";

  MenuScene.prototype.events = {
    "animationend .title": "cleanUp",
    "webkitAnimationEnd .title": "cleanUp",
    "mozAnimationEnd .title": "cleanUp"
  };

  MenuScene.prototype.template = _.template($("#_menu").html());

  MenuScene.prototype.sceneName = "menu";

  MenuScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.$el.on(Utils.clickUpOrTouch(), "#play_button", this.handlePlayButton);
    this.$el.on(Utils.clickUpOrTouch(), "#highscore_button", this.handleHighscoreButton);
    this.$el.on(Utils.clickUpOrTouch(), "#credits_button", this.handleCreditsButton);
    return this;
  };

  MenuScene.prototype.handlePlayButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "game");
    return false;
  };

  MenuScene.prototype.handleHighscoreButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "highscore");
    return false;
  };

  MenuScene.prototype.handleCreditsButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "credits");
    return false;
  };

  MenuScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  MenuScene.prototype.render = function() {
    this.$el.html(this.template());
    $("#stage").append(this.$el);
    return this;
  };

  MenuScene.prototype.renderRemoveScene = function() {
    this.$(".title").removeClass("display").addClass("removal");
    this.$(".menu_item").addClass("removal");
    this.$(".title").css(Utils.bp() + "animation-name", "raiseTitle");
    this.$(".menu_item").css(Utils.bp() + "animation-name", "raiseMenu");
    return this;
  };

  MenuScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("title")) {
      this.$el.empty();
    }
    return false;
  };

  return MenuScene;

})(Backbone.View);

},{"../anyyolk":10}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.Stage = (function(_super) {
  __extends(Stage, _super);

  function Stage() {
    this.renderClouds = __bind(this.renderClouds, this);
    this.renderTrees = __bind(this.renderTrees, this);
    this.renderSun = __bind(this.renderSun, this);
    this.renderTiles = __bind(this.renderTiles, this);
    this.render = __bind(this.render, this);
    return Stage.__super__.constructor.apply(this, arguments);
  }

  Stage.prototype.el = "#stage";

  Stage.prototype.tileTemplate = _.template($("#_tile_pair").html());

  Stage.prototype.treeTemplate = _.template($("#_tree").html());

  Stage.prototype.sunTemplate = _.template($("#_sun").html());

  Stage.prototype.cloudTemplate = _.template($("#_cloud").html());

  Stage.prototype.render = function() {
    this.$el.css("height", $(window).height());
    this.renderSun();
    this.renderTrees();
    this.renderTiles();
    return this.renderClouds();
  };

  Stage.prototype.renderTiles = function() {
    this.$(".tile").remove();
    return this.$el.append(this.tileTemplate());
  };

  Stage.prototype.renderSun = function() {
    this.$(".sun").remove();
    return this.$el.append(this.sunTemplate());
  };

  Stage.prototype.renderTrees = function() {
    var i, left, numTrees, _results;
    numTrees = Math.ceil($(window).width() / 200);
    this.$(".tree").remove();
    if (numTrees <= 2) {
      this.$el.append(this.treeTemplate({
        treeNum: 3,
        leftValue: -100
      }));
      return this.$el.append(this.treeTemplate({
        treeNum: 1,
        leftValue: 120
      }));
    } else {
      i = 0;
      _results = [];
      while (i < numTrees) {
        left = Math.random() * 200. + i * 200;
        this.$el.append(this.treeTemplate({
          treeNum: -1,
          leftValue: left - 300
        }));
        _results.push(i++);
      }
      return _results;
    }
  };

  Stage.prototype.renderClouds = function() {
    var delay, dir, i, numClouds, speed, top, _results;
    numClouds = Math.ceil($(window).width() / 200);
    numClouds = (numClouds < 2 ? 2 : numClouds);
    i = 0;
    _results = [];
    while (i < numClouds) {
      top = Math.random() * 50;
      delay = Math.random() * 8 - 4 + (10 * i);
      speed = 20;
      dir = (Math.floor(Math.random() * 2) < 1 ? "left" : "right");
      this.$el.append(this.cloudTemplate({
        delay: delay,
        direction: dir,
        duration: $(window).width() / speed,
        topValue: top
      }));
      _results.push(i++);
    }
    return _results;
  };

  return Stage;

})(Backbone.View);

},{"../anyyolk":10}],10:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk;

module.exports = anyyolk = (function() {
  function anyyolk() {}

  return anyyolk;

})();

require('./GameState');

require('./EggModel');

require('./EggView');

require('./Stage');

require('./MenuScene');

require('./GameScene');

require('./GameOverScene');

require('./HighscoreScene');

require('./CreditsScene');

},{"./CreditsScene":1,"./EggModel":2,"./EggView":3,"./GameOverScene":4,"./GameScene":5,"./GameState":6,"./HighscoreScene":7,"./MenuScene":8,"./Stage":9}],11:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk;

anyyolk = require('./anyyolk');

$(function() {
  return (function() {
    var model;
    if (Utils.isSupported()) {
      model = new anyyolk.GameState();
      new anyyolk.Stage({
        model: model
      }).render();
      new anyyolk.MenuScene({
        model: model
      });
      new anyyolk.GameScene({
        model: model
      });
      new anyyolk.GameOverScene({
        model: model
      });
      new anyyolk.HighscoreScene({
        model: model
      });
      new anyyolk.CreditsScene({
        model: model
      });
      model.set("scene", "menu");
      $("#stage").on("dragstart selectstart", "*", function(event) {
        return false;
      });
      return document.ontouchmove = function(e) {
        return e.preventDefault();
      };
    } else {
      return $("#unsupported").show();
    }
  })();
});

window.Utils = {
  bp: function() {
    var bp;
    bp = "";
    if ($.browser.webkit) {
      bp = "-webkit-";
    } else {
      if ($.browser.mozilla) {
        bp = "-moz-";
      }
    }
    return bp;
  },
  isSupported: function() {
    return !($.browser.msie && parseInt($.browser.version) < 10);
  },
  nextTick: function(func) {
    return setTimeout(func, 0);
  },
  clickUpOrTouch: function(func) {
    if ("ontouchstart" in window) {
      return "touchstart";
    } else {
      return "mouseup";
    }
  },
  clickDownOrTouch: function(func) {
    if ("ontouchstart" in window) {
      return "touchstart";
    } else {
      return "mousedown";
    }
  }
};

$.fn.spin = function(opts) {
  this.each(function() {
    var $this, data;
    $this = $(this);
    data = $this.data();
    if (data.spinner) {
      data.spinner.stop();
      delete data.spinner;
    }
    if (opts !== false) {
      return data.spinner = new Spinner($.extend({
        color: $this.css("color")
      }, opts)).spin(this);
    }
  });
  return this;
};

Parse.initialize("0ZUn1TaDF9G3j6UhvoNFuIVSzF45vpSO9K0rlosM", "oU1ToZ9LNZoMslphpgxQNoVjJXEqoi59M018ZP08");

window.fbAsyncInit = function() {
  return Parse.FacebookUtils.init({
    appId: "1380103182250520",
    channelUrl: "/channel.html",
    status: true,
    cookie: true,
    xfbml: true
  });
};

(function(d, debug) {
  var id, js, ref;
  js = void 0;
  id = "facebook-jssdk";
  ref = d.getElementsByTagName("script")[0];
  if (d.getElementById(id)) {
    return;
  }
  js = d.createElement("script");
  js.id = id;
  js.async = true;
  js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
  return ref.parentNode.insertBefore(js, ref);
})(document, false);

},{"./anyyolk":10}]},{},[11])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3IvbG9jYWwvbGliL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9DcmVkaXRzU2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9FZ2dNb2RlbC5qcyIsIi9ob21lL2JydWNlL0dpdC9BbnlZb2xrL3RtcC9hbnl5b2xrL0VnZ1ZpZXcuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9HYW1lT3ZlclNjZW5lLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvR2FtZVNjZW5lLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvR2FtZVN0YXRlLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvSGlnaHNjb3JlU2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9NZW51U2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9TdGFnZS5qcyIsIi9ob21lL2JydWNlL0dpdC9BbnlZb2xrL3RtcC9hbnl5b2xrL2luZGV4LmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL21haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNyR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDM0JBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24gZSh0LG4scil7ZnVuY3Rpb24gcyhvLHUpe2lmKCFuW29dKXtpZighdFtvXSl7dmFyIGE9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtpZighdSYmYSlyZXR1cm4gYShvLCEwKTtpZihpKXJldHVybiBpKG8sITApO3ZhciBmPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIrbytcIidcIik7dGhyb3cgZi5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGZ9dmFyIGw9bltvXT17ZXhwb3J0czp7fX07dFtvXVswXS5jYWxsKGwuZXhwb3J0cyxmdW5jdGlvbihlKXt2YXIgbj10W29dWzFdW2VdO3JldHVybiBzKG4/bjplKX0sbCxsLmV4cG9ydHMsZSx0LG4scil9cmV0dXJuIG5bb10uZXhwb3J0c312YXIgaT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2Zvcih2YXIgbz0wO288ci5sZW5ndGg7bysrKXMocltvXSk7cmV0dXJuIHN9KSIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuQ3JlZGl0c1NjZW5lID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoQ3JlZGl0c1NjZW5lLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIENyZWRpdHNTY2VuZSgpIHtcbiAgICB0aGlzLmNsZWFuVXAgPSBfX2JpbmQodGhpcy5jbGVhblVwLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlID0gX19iaW5kKHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UsIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlQmFja0J1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZUJhY2tCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IF9fYmluZCh0aGlzLmluaXRpYWxpemUsIHRoaXMpO1xuICAgIHJldHVybiBDcmVkaXRzU2NlbmUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLmNsYXNzTmFtZSA9IFwiY3JlZGl0c19zY2VuZVwiO1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUudGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2NyZWRpdHNcIikuaHRtbCgpKTtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwiY3JlZGl0c1wiO1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgIGFuaW1hdGlvbmVuZDogXCJjbGVhblVwXCIsXG4gICAgd2Via2l0QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIixcbiAgICBtb3pBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiXG4gIH07XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzY2VuZVwiLCB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlKTtcbiAgICByZXR1cm4gdGhpcy4kZWwub24oVXRpbHMuY2xpY2tVcE9yVG91Y2goKSwgXCIuYmFja19idXR0b25cIiwgdGhpcy5oYW5kbGVCYWNrQnV0dG9uKTtcbiAgfTtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLmhhbmRsZUJhY2tCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcIm1lbnVcIik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICBpZiAobW9kZWwucHJldmlvdXMoXCJzY2VuZVwiKSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHNjZW5lID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSgpKTtcbiAgICAkKFwiI3N0YWdlXCIpLmFwcGVuZCh0aGlzLiRlbCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi5jcmVkaXRzXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIuYmFja19idXR0b25cIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi5jcmVkaXRzXCIpLmNzcyhVdGlscy5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlTWVudVwiKTtcbiAgICByZXR1cm4gdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmNzcyhVdGlscy5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlTWVudVwiKTtcbiAgfTtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwic2NlbmVcIikgIT09IHRoaXMuc2NlbmVOYW1lICYmICQoZS50YXJnZXQpLmhhc0NsYXNzKFwiY3JlZGl0c1wiKSkge1xuICAgICAgcmV0dXJuIHRoaXMuJGVsLmVtcHR5KCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDcmVkaXRzU2NlbmU7XG5cbn0pKEJhY2tib25lLlZpZXcpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5FZ2dNb2RlbCA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEVnZ01vZGVsLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIEVnZ01vZGVsKCkge1xuICAgIHRoaXMuZWdnSGl0R3JvdW5kID0gX19iaW5kKHRoaXMuZWdnSGl0R3JvdW5kLCB0aGlzKTtcbiAgICB0aGlzLmlzU2FmZSA9IF9fYmluZCh0aGlzLmlzU2FmZSwgdGhpcyk7XG4gICAgdGhpcy5uZXh0U3ByaXRlID0gX19iaW5kKHRoaXMubmV4dFNwcml0ZSwgdGhpcyk7XG4gICAgcmV0dXJuIEVnZ01vZGVsLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgRWdnTW9kZWwuTnVtU3ByaXRlcyA9IDU7XG5cbiAgRWdnTW9kZWwucHJvdG90eXBlLmRlZmF1bHRzID0ge1xuICAgIHNwcml0ZUluZGV4OiAxLFxuICAgIGNvbGxlY3Rpb25JbmRleDogMFxuICB9O1xuXG4gIEVnZ01vZGVsLnByb3RvdHlwZS5uZXh0U3ByaXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXQoXCJzcHJpdGVJbmRleFwiLCB0aGlzLmdldChcInNwcml0ZUluZGV4XCIpICsgMSk7XG4gICAgaWYgKHRoaXMuaXNTYWZlKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnRyaWdnZXIoXCJmbHlcIiwgW3RoaXNdKTtcbiAgICB9XG4gIH07XG5cbiAgRWdnTW9kZWwucHJvdG90eXBlLmlzU2FmZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldChcInNwcml0ZUluZGV4XCIpID49IEVnZ01vZGVsLk51bVNwcml0ZXM7XG4gIH07XG5cbiAgRWdnTW9kZWwucHJvdG90eXBlLmVnZ0hpdEdyb3VuZCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5pc1NhZmUoKSkge1xuICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcihcImJyZWFrXCIsIFt0aGlzXSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBFZ2dNb2RlbDtcblxufSkoQmFja2JvbmUuTW9kZWwpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5FZ2dWaWV3ID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoRWdnVmlldywgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBFZ2dWaWV3KCkge1xuICAgIHRoaXMuaGFuZGxlVHJhbnNpdGlvbkVuZGVkID0gX19iaW5kKHRoaXMuaGFuZGxlVHJhbnNpdGlvbkVuZGVkLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZSA9IF9fYmluZCh0aGlzLnJlbmRlclJlbW92ZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJGbHlpbmcgPSBfX2JpbmQodGhpcy5yZW5kZXJGbHlpbmcsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVySGlkZGluZyA9IF9fYmluZCh0aGlzLnJlbmRlckhpZGRpbmcsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyQnJlYWtpbmcgPSBfX2JpbmQodGhpcy5yZW5kZXJCcmVha2luZywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTcHJpdGVzID0gX19iaW5kKHRoaXMucmVuZGVyU3ByaXRlcywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMubmV4dFNwcml0ZSA9IF9fYmluZCh0aGlzLm5leHRTcHJpdGUsIHRoaXMpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IF9fYmluZCh0aGlzLmluaXRpYWxpemUsIHRoaXMpO1xuICAgIHJldHVybiBFZ2dWaWV3Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgRWdnVmlldy5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJlZ2dcIjtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5zcHJpdGVDbGFzcyA9IFwiLmVnZ19zcHJpdGVfXCI7XG5cbiAgRWdnVmlldy5wcm90b3R5cGUuZWdnVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2VnZ1wiKS5odG1sKCkpO1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnNjZW5lID0gbnVsbDtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5ldmVudHMgPSB7XG4gICAgd2Via2l0VHJhbnNpdGlvbkVuZDogXCJoYW5kbGVUcmFuc2l0aW9uRW5kZWRcIixcbiAgICBtb3pUcmFuc2l0aW9uRW5kOiBcImhhbmRsZVRyYW5zaXRpb25FbmRlZFwiLFxuICAgIHRyYW5zaXRpb25lbmQ6IFwiaGFuZGxlVHJhbnNpdGlvbkVuZGVkXCJcbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zY2VuZSA9IHRoaXMub3B0aW9ucy5zY2VuZTtcbiAgICB0aGlzLmdhbWVTdGF0ZSA9IHRoaXMub3B0aW9ucy5nYW1lU3RhdGU7XG4gICAgdGhpcy4kZWwub24oVXRpbHMuY2xpY2tEb3duT3JUb3VjaCgpLCB0aGlzLm5leHRTcHJpdGUpO1xuICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c3ByaXRlSW5kZXhcIiwgdGhpcy5yZW5kZXJTcHJpdGVzKTtcbiAgICB0aGlzLm1vZGVsLm9uKFwiZmx5XCIsIHRoaXMucmVuZGVyRmx5aW5nKTtcbiAgICByZXR1cm4gdGhpcy5tb2RlbC5vbihcImJyZWFrXCIsIHRoaXMucmVuZGVyQnJlYWtpbmcpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLm5leHRTcHJpdGUgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMubW9kZWwuaXNTYWZlKCkpIHtcbiAgICAgIHRoaXMubW9kZWwubmV4dFNwcml0ZSgpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgZGVsYXksIGludGVybWlzc2lvbiwgbGVmdCwgc3BlZWQsIHRvcDtcbiAgICB0aGlzLnJlbmRlclNwcml0ZXMoKTtcbiAgICBpbnRlcm1pc3Npb24gPSAzLjU7XG4gICAgZGVsYXkgPSB2b2lkIDA7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwiY29sbGVjdGlvbkluZGV4XCIpID09PSAxKSB7XG4gICAgICBkZWxheSA9IGludGVybWlzc2lvbjtcbiAgICB9IGVsc2Uge1xuICAgICAgZGVsYXkgPSAoTWF0aC5yYW5kb20oKSAqIDYgKyAzKSAvIHRoaXMuZ2FtZVN0YXRlLmdldChcInNwZWVkWFwiKSArICgyICogdGhpcy5tb2RlbC5nZXQoXCJjb2xsZWN0aW9uSW5kZXhcIikpICsgaW50ZXJtaXNzaW9uO1xuICAgIH1cbiAgICBzcGVlZCA9IDEwMCAqIHRoaXMuZ2FtZVN0YXRlLmdldChcInNwZWVkWFwiKSArIE1hdGgucmFuZG9tKCkgKiAxMDAgLSA1MDtcbiAgICBsZWZ0ID0gTWF0aC5yYW5kb20oKSAqICgkKHdpbmRvdykud2lkdGgoKSAtIDEwMCkgKyAzMDtcbiAgICB0b3AgPSAkKFwiI3N0YWdlXCIpLmhlaWdodCgpIC0gMjIwO1xuICAgIHRoaXMuJGVsLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIGRlbGF5ICsgXCJzXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLWR1cmF0aW9uXCIsICQod2luZG93KS5oZWlnaHQoKSAvIHNwZWVkICsgXCJzXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLXByb3BlcnR5XCIsIFwidG9wIG9wYWNpdHlcIik7XG4gICAgdGhpcy4kZWwuY3NzKFV0aWxzLmJwKCkgKyBcInRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uXCIsIFwibGluZWFyXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhcImxlZnRcIiwgbGVmdCArIFwicHhcIik7XG4gICAgdGhpcy5zY2VuZS5hcHBlbmQodGhpcy4kZWwpO1xuICAgIHJldHVybiBVdGlscy5uZXh0VGljaygoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLiRlbC5jc3MoXCJ0b3BcIiwgdG9wICsgXCJweFwiKTtcbiAgICAgIH07XG4gICAgfSkodGhpcykpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlclNwcml0ZXMgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy4kZWwuaHRtbCh0aGlzLmVnZ1RlbXBsYXRlKHtcbiAgICAgIHNwcml0ZUluZGV4OiB0aGlzLm1vZGVsLmdldChcInNwcml0ZUluZGV4XCIpXG4gICAgfSkpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlckJyZWFraW5nID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuYWRkQ2xhc3MoXCJjcmFja2VkXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgdGhpcy4kZWwuY3NzKFV0aWxzLmJwKCkgKyBcInRyYW5zaXRpb24tZGVsYXlcIiwgXCIwc1wiKTtcbiAgICByZXR1cm4gdGhpcy4kZWwuY3NzKFV0aWxzLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgXCIwLjJzXCIpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlckhpZGRpbmcgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImJyb2tlblwiKTtcbiAgICB0aGlzLiRlbC5jc3MoVXRpbHMuYnAoKSArIFwidHJhbnNpdGlvbi1kZWxheVwiLCBcIjFzXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLWR1cmF0aW9uXCIsIFwiMC41c1wiKTtcbiAgICB0aGlzLiRlbC5jc3MoVXRpbHMuYnAoKSArIFwidHJhbnNpdGlvbi1wcm9wZXJ0eVwiLCBcIm9wYWNpdHlcIik7XG4gICAgdGhpcy4kZWwuY3NzKFV0aWxzLmJwKCkgKyBcInRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uXCIsIFwibGluZWFyXCIpO1xuICAgIHJldHVybiB0aGlzLiRlbC5jc3MoXCJvcGFjaXR5XCIsIDApO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlckZseWluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmFkZENsYXNzKFwiZmx5aW5nXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIFwiMHNcIik7XG4gICAgdGhpcy4kZWwuY3NzKFV0aWxzLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgXCIxc1wiKTtcbiAgICB0aGlzLiRlbC5jc3MoVXRpbHMuYnAoKSArIFwidHJhbnNpdGlvbi1wcm9wZXJ0eVwiLCBcInRvcFwiKTtcbiAgICByZXR1cm4gdGhpcy4kZWwuY3NzKFV0aWxzLmJwKCkgKyBcInRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uXCIsIFwibGluZWFyXCIpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlclJlbW92ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnJlbW92ZSgpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLmhhbmRsZVRyYW5zaXRpb25FbmRlZCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZSA9PT0gXCJvcGFjaXR5XCIpIHtcbiAgICAgIHRoaXMucmVuZGVyUmVtb3ZlKCk7XG4gICAgfSBlbHNlIGlmIChlLm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lID09PSBcInRvcFwiKSB7XG4gICAgICB0aGlzLm1vZGVsLmVnZ0hpdEdyb3VuZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZSA9PT0gVXRpbHMuYnAoKSArIFwidHJhbnNmb3JtXCIgfHwgXCJ0cmFuc2Zvcm1cIikge1xuICAgICAgICB0aGlzLnJlbmRlckhpZGRpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIHJldHVybiBFZ2dWaWV3O1xuXG59KShCYWNrYm9uZS5WaWV3KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuR2FtZU92ZXJTY2VuZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEdhbWVPdmVyU2NlbmUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gR2FtZU92ZXJTY2VuZSgpIHtcbiAgICB0aGlzLmNsZWFuVXAgPSBfX2JpbmQodGhpcy5jbGVhblVwLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlID0gX19iaW5kKHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UsIHRoaXMpO1xuICAgIHRoaXMuc2F2ZUhpZ2hTY29yZSA9IF9fYmluZCh0aGlzLnNhdmVIaWdoU2NvcmUsIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlRmFjZWJvb2tCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVGYWNlYm9va0J1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVSZXBsYXlCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVSZXBsYXlCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlTWVudUJ1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZU1lbnVCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IF9fYmluZCh0aGlzLmluaXRpYWxpemUsIHRoaXMpO1xuICAgIHJldHVybiBHYW1lT3ZlclNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgR2FtZU92ZXJTY2VuZS5Db25ncmF0cyA9IFtcIk5vdCBiYWRcIiwgXCJHb29kXCIsIFwiR3JlYXRcIiwgXCJGYW50YXN0aWNcIiwgXCJTbWFzaGluZyFcIiwgXCJBbWF6aW5nIVwiLCBcIkZseWluZyBIaWdoXCIsIFwiUmlkaWN1bG91cyFcIiwgXCJFeHRyYW9yZGluYXJ5IVwiLCBcIk1vbnN0cm91cyEhXCJdO1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmNsYXNzTmFtZSA9IFwiZ2FtZV9vdmVyX3NjZW5lXCI7XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgIGFuaW1hdGlvbmVuZDogXCJjbGVhblVwXCIsXG4gICAgd2Via2l0QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIixcbiAgICBtb3pBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiXG4gIH07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUudGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2dhbWVfb3ZlclwiKS5odG1sKCkpO1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwiZ2FtZV9vdmVyXCI7XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuc3VibWl0dGVkID0gZmFsc2U7XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c2NlbmVcIiwgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSk7XG4gICAgdGhpcy4kZWwub24oVXRpbHMuY2xpY2tVcE9yVG91Y2goKSwgXCIubWVudV9idXR0b25cIiwgdGhpcy5oYW5kbGVNZW51QnV0dG9uKTtcbiAgICB0aGlzLiRlbC5vbihVdGlscy5jbGlja1VwT3JUb3VjaCgpLCBcIi5yZXBsYXlfYnV0dG9uXCIsIHRoaXMuaGFuZGxlUmVwbGF5QnV0dG9uKTtcbiAgICByZXR1cm4gdGhpcy4kZWwub24oVXRpbHMuY2xpY2tVcE9yVG91Y2goKSwgXCIuZmFjZWJvb2tfYnV0dG9uXCIsIHRoaXMuaGFuZGxlRmFjZWJvb2tCdXR0b24pO1xuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmhhbmRsZU1lbnVCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHJldHVybiB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwibWVudVwiKTtcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5oYW5kbGVSZXBsYXlCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHJldHVybiB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwiZ2FtZVwiKTtcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5oYW5kbGVGYWNlYm9va0J1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICAkKFwiLmZiX2NvbnRlbnRcIikuaGlkZSgpO1xuICAgICQoXCIuZmFjZWJvb2tfYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIikuZW1wdHkoKS5zcGluKHtcbiAgICAgIGxlbmd0aDogNSxcbiAgICAgIHJhZGl1czogNSxcbiAgICAgIGxpbmVzOiA4LFxuICAgICAgd2lkdGg6IDMsXG4gICAgICBjb2xvcjogXCIjZmZmXCJcbiAgICB9KTtcbiAgICBpZiAoUGFyc2UuVXNlci5jdXJyZW50KCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNhdmVIaWdoU2NvcmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFBhcnNlLkZhY2Vib29rVXRpbHMubG9nSW4obnVsbCwge1xuICAgICAgICBzdWNjZXNzOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgaWYgKCF1c2VyLmV4aXN0ZWQoKSkge1xuICAgICAgICAgICAgICByZXR1cm4gRkIuYXBpKFwiL21lXCIsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgdXNlci5zZXQoXCJkaXNwbGF5TmFtZVwiLCByZXNwb25zZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyLnNhdmUobnVsbCwge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnNhdmVIaWdoU2NvcmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHVzZXIsIGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKFwiT29wcywgc29tZXRoaW5nIHdlbnQgd3Jvbmcgc2F2aW5nIHlvdXIgbmFtZS5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gY29uc29sZS5sb2coXCJPb3BzIHNvbWV0aGluZyB3ZW50IHdyb25nIHdpdGggZmFjZWJvb2suXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc2F2ZUhpZ2hTY29yZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpLFxuICAgICAgICBlcnJvcjogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHVzZXIsIGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS5sb2coXCJPb3BzLCBzb21ldGhpbmcgd2VudCB3cm9uZy5cIik7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcylcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5zYXZlSGlnaFNjb3JlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN1Ym1pc3Npb247XG4gICAgc3VibWlzc2lvbiA9IHtcbiAgICAgIHNjb3JlOiB0aGlzLm1vZGVsLmdldFNjb3JlU3VibWlzc2lvbigpXG4gICAgfTtcbiAgICByZXR1cm4gUGFyc2UuQ2xvdWQucnVuKFwic3VibWl0SGlnaHNjb3JlXCIsIHN1Ym1pc3Npb24sIHtcbiAgICAgIHN1Y2Nlc3M6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgX3RoaXMuc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuJChcIi5mYWNlYm9va19idXR0b25cIikuaHRtbChcIlN1Ym1pdHRlZCFcIik7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSxcbiAgICAgIGVycm9yOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgX3RoaXMuc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuJChcIi5mYWNlYm9va19idXR0b25cIikuaHRtbChcIiBYIFRyeSBBZ2Fpbi4uLlwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcylcbiAgICB9KTtcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5yZW5kZXJTY2VuZUNoYW5nZSA9IGZ1bmN0aW9uKG1vZGVsLCBzY2VuZSkge1xuICAgIGlmIChtb2RlbC5wcmV2aW91cyhcInNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoc2NlbmUgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb25ncmF0c0luZGV4O1xuICAgIGNvbmdyYXRzSW5kZXggPSAodGhpcy5tb2RlbC5nZXQoXCJsZXZlbFwiKSA+IEdhbWVPdmVyU2NlbmUuQ29uZ3JhdHMubGVuZ3RoID8gR2FtZU92ZXJTY2VuZS5Db25ncmF0cy5sZW5ndGggLSAxIDogdGhpcy5tb2RlbC5nZXQoXCJsZXZlbFwiKSAtIDEpO1xuICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSh7XG4gICAgICBzY29yZTogdGhpcy5tb2RlbC5nZXQoXCJzY29yZVwiKSxcbiAgICAgIGNvbmdyYXRzOiBHYW1lT3ZlclNjZW5lLkNvbmdyYXRzW2NvbmdyYXRzSW5kZXhdXG4gICAgfSkpO1xuICAgIHJldHVybiAkKFwiI3N0YWdlXCIpLmFwcGVuZCh0aGlzLiRlbCk7XG4gIH07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUucmVuZGVyUmVtb3ZlU2NlbmUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIuc3VtbWFyeVwiKS5hZGRDbGFzcyhcInJlbW92YWxcIik7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5jc3MoVXRpbHMuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyYWlzZU1lbnVcIik7XG4gICAgcmV0dXJuIHRoaXMuJChcIi5zdW1tYXJ5XCIpLmNzcyhVdGlscy5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlU2NvcmVzXCIpO1xuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwic2NlbmVcIikgIT09IHRoaXMuc2NlbmVOYW1lICYmICQoZS50YXJnZXQpLmhhc0NsYXNzKFwic3VtbWFyeVwiKSkge1xuICAgICAgcmV0dXJuIHRoaXMuJGVsLmVtcHR5KCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBHYW1lT3ZlclNjZW5lO1xuXG59KShCYWNrYm9uZS5WaWV3KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuR2FtZVNjZW5lID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoR2FtZVNjZW5lLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIEdhbWVTY2VuZSgpIHtcbiAgICB0aGlzLmNsZWFuVXAgPSBfX2JpbmQodGhpcy5jbGVhblVwLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyQWRkRWdnID0gX19iaW5kKHRoaXMucmVuZGVyQWRkRWdnLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckVnZ3MgPSBfX2JpbmQodGhpcy5yZW5kZXJFZ2dzLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckJhY2tCdXR0b24gPSBfX2JpbmQodGhpcy5yZW5kZXJCYWNrQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckxpdmVzID0gX19iaW5kKHRoaXMucmVuZGVyTGl2ZXMsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NvcmUgPSBfX2JpbmQodGhpcy5yZW5kZXJTY29yZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJMZXZlbExhYmVsID0gX19iaW5kKHRoaXMucmVuZGVyTGV2ZWxMYWJlbCwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJMZXZlbCA9IF9fYmluZCh0aGlzLnJlbmRlckxldmVsLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlciA9IF9fYmluZCh0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjZW5lQ2hhbmdlLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUJhY2tCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVCYWNrQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gR2FtZVNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5jbGFzc05hbWUgPSBcImdhbWVfc2NlbmVcIjtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLmV2ZW50cyA9IHtcbiAgICBhbmltYXRpb25lbmQ6IFwiY2xlYW5VcFwiLFxuICAgIHdlYmtpdEFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCIsXG4gICAgbW96QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIlxuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUuc2NvcmVUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfZ2FtZV9zY29yZVwiKS5odG1sKCkpO1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUubGV2ZWxUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfZ2FtZV9sZXZlbFwiKS5odG1sKCkpO1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUubGl2ZXNUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfZ2FtZV9saXZlc1wiKS5odG1sKCkpO1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUuc2NlbmVOYW1lID0gXCJnYW1lXCI7XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lZ2dWaWV3cyA9IFtdO1xuICAgIHRoaXMuJGVsLm9uKFV0aWxzLmNsaWNrVXBPclRvdWNoKCksIFwiLmJhY2tfYnV0dG9uXCIsIHRoaXMuaGFuZGxlQmFja0J1dHRvbik7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzY2VuZVwiLCB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlKTtcbiAgICB0aGlzLm1vZGVsLmdldChcImVnZ0NvbGxlY3Rpb25cIikub24oXCJhZGRcIiwgdGhpcy5yZW5kZXJBZGRFZ2cpO1xuICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c2NvcmVcIiwgdGhpcy5yZW5kZXJTY29yZSk7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpsaXZlc1wiLCB0aGlzLnJlbmRlckxpdmVzKTtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOmxldmVsXCIsIHRoaXMucmVuZGVyTGV2ZWwpO1xuICAgIHJldHVybiB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOmxldmVsXCIsIHRoaXMucmVuZGVyTGV2ZWxMYWJlbCk7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5oYW5kbGVCYWNrQnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHJldHVybiB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwibWVudVwiKTtcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlclNjZW5lQ2hhbmdlID0gZnVuY3Rpb24obW9kZWwsIHNjZW5lKSB7XG4gICAgaWYgKG1vZGVsLnByZXZpb3VzKFwic2NlbmVcIikgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzY2VuZSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnJlc2V0R2FtZURhdGEoKTtcbiAgICB0aGlzLiQoXCIjaHVkXCIpLnJlbW92ZSgpO1xuICAgIHRoaXMuJGVsLmFwcGVuZChcIjxkaXYgaWQ9J2h1ZCc+PC9kaXY+XCIpO1xuICAgIHRoaXMucmVuZGVyTGV2ZWwoKTtcbiAgICBzZXRUaW1lb3V0KCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLnJlbmRlckxldmVsTGFiZWwoKTtcbiAgICAgIH07XG4gICAgfSkodGhpcykpLCAxMjAwKTtcbiAgICB0aGlzLnJlbmRlclNjb3JlKCk7XG4gICAgdGhpcy5yZW5kZXJMaXZlcygpO1xuICAgIHRoaXMucmVuZGVyQmFja0J1dHRvbigpO1xuICAgIHRoaXMucmVuZGVyRWdncygpO1xuICAgIGlmICgkKFwiI3N0YWdlIC5cIiArIHRoaXMuY2xhc3NOYW1lKS5sZW5ndGggPD0gMCkge1xuICAgICAgJChcIiNzdGFnZVwiKS5hcHBlbmQodGhpcy4kZWwpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckxldmVsID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuJChcIiNnYW1lX2xldmVsXCIpLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuJChcIiNnYW1lX2xldmVsXCIpLnJlcGxhY2VXaXRoKHRoaXMubGV2ZWxUZW1wbGF0ZSh7XG4gICAgICAgIGxldmVsOiB0aGlzLm1vZGVsLmdldChcImxldmVsXCIpXG4gICAgICB9KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuJChcIiNodWRcIikuYXBwZW5kKHRoaXMubGV2ZWxUZW1wbGF0ZSh7XG4gICAgICAgIGxldmVsOiB0aGlzLm1vZGVsLmdldChcImxldmVsXCIpXG4gICAgICB9KSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyTGV2ZWxMYWJlbCA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmFwcGVuZChcIjxwIGNsYXNzPSdsZXZlbF9sYWJlbCc+TEVWRUwgXCIgKyB0aGlzLm1vZGVsLmdldChcImxldmVsXCIpICsgXCI8YnI+R0VUIFJFQURZITwvcD5cIik7XG4gICAgc2V0VGltZW91dCgoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBfdGhpcy4kKFwiLmxldmVsX2xhYmVsXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICAgIH07XG4gICAgfSkodGhpcykpLCAzMDAwKTtcbiAgICBzZXRUaW1lb3V0KCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLiQoXCIubGV2ZWxfbGFiZWxcIikucmVtb3ZlKCk7XG4gICAgICB9O1xuICAgIH0pKHRoaXMpKSwgMzMwMCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJTY29yZSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLiQoXCIjZ2FtZV9zY29yZVwiKS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLiQoXCIjZ2FtZV9zY29yZVwiKS5yZXBsYWNlV2l0aCh0aGlzLnNjb3JlVGVtcGxhdGUoe1xuICAgICAgICBzY29yZTogdGhpcy5tb2RlbC5nZXQoXCJzY29yZVwiKVxuICAgICAgfSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLiQoXCIjaHVkXCIpLmFwcGVuZCh0aGlzLnNjb3JlVGVtcGxhdGUoe1xuICAgICAgICBzY29yZTogdGhpcy5tb2RlbC5nZXQoXCJzY29yZVwiKVxuICAgICAgfSkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckxpdmVzID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuJChcIiNnYW1lX2xpdmVzXCIpLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuJChcIiNnYW1lX2xpdmVzXCIpLnJlcGxhY2VXaXRoKHRoaXMubGl2ZXNUZW1wbGF0ZSh7XG4gICAgICAgIGxpdmVzOiB0aGlzLm1vZGVsLmdldChcImxpdmVzXCIpXG4gICAgICB9KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuJChcIiNodWRcIikuYXBwZW5kKHRoaXMubGl2ZXNUZW1wbGF0ZSh7XG4gICAgICAgIGxpdmVzOiB0aGlzLm1vZGVsLmdldChcImxpdmVzXCIpXG4gICAgICB9KSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyQmFja0J1dHRvbiA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLiQoXCIuYmFja19idXR0b25cIikubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLnJlcGxhY2VXaXRoKFwiPGRpdiBjbGFzcz0nYmFja19idXR0b24nPlg8L2Rpdj5cIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuJGVsLmFwcGVuZChcIjxkaXYgY2xhc3M9J2JhY2tfYnV0dG9uJz5YPC9kaXY+XCIpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckVnZ3MgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmFkZEVnZ3MoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckFkZEVnZyA9IGZ1bmN0aW9uKGVnZ01vZGVsLCBjb2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgdmFyIGVnZ1ZpZXc7XG4gICAgZWdnVmlldyA9IG5ldyBhbnl5b2xrLkVnZ1ZpZXcoe1xuICAgICAgbW9kZWw6IGVnZ01vZGVsLFxuICAgICAgZ2FtZVN0YXRlOiB0aGlzLm1vZGVsLFxuICAgICAgc2NlbmU6IHRoaXMuJGVsXG4gICAgfSk7XG4gICAgZWdnVmlldy5yZW5kZXIoKTtcbiAgICB0aGlzLmVnZ1ZpZXdzLnB1c2goZWdnVmlldyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5jc3MoVXRpbHMuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJ4UmFpc2VcIik7XG4gICAgdGhpcy4kKFwiI2h1ZCBwXCIpLmNzcyhVdGlscy5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJlbW92ZUhVRFwiKTtcbiAgICB0aGlzLiQoXCIuZWdnXCIpLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLWR1cmF0aW9uXCIsIFwiMC4zc1wiKTtcbiAgICBfLmVhY2godGhpcy5lZ2dWaWV3cywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oZWdnVmlldykge1xuICAgICAgICByZXR1cm4gZWdnVmlldy5yZW5kZXJSZW1vdmUoKTtcbiAgICAgIH07XG4gICAgfSkodGhpcykpO1xuICAgIHRoaXMubW9kZWwuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5yZXNldCgpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUuY2xlYW5VcCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJzY2VuZVwiKSAhPT0gdGhpcy5zY2VuZU5hbWUgJiYgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJiYWNrX2J1dHRvblwiKSkge1xuICAgICAgdGhpcy4kZWwuZW1wdHkoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIHJldHVybiBHYW1lU2NlbmU7XG5cbn0pKEJhY2tib25lLlZpZXcpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5HYW1lU3RhdGUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhHYW1lU3RhdGUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gR2FtZVN0YXRlKCkge1xuICAgIHRoaXMuZ2V0U2NvcmVTdWJtaXNzaW9uID0gX19iaW5kKHRoaXMuZ2V0U2NvcmVTdWJtaXNzaW9uLCB0aGlzKTtcbiAgICB0aGlzLnJlc2V0R2FtZURhdGEgPSBfX2JpbmQodGhpcy5yZXNldEdhbWVEYXRhLCB0aGlzKTtcbiAgICB0aGlzLmNsZWFuVXBFZ2cgPSBfX2JpbmQodGhpcy5jbGVhblVwRWdnLCB0aGlzKTtcbiAgICB0aGlzLmFkZEVnZ3MgPSBfX2JpbmQodGhpcy5hZGRFZ2dzLCB0aGlzKTtcbiAgICB0aGlzLnZhbGlkYXRlQWxpdmUgPSBfX2JpbmQodGhpcy52YWxpZGF0ZUFsaXZlLCB0aGlzKTtcbiAgICB0aGlzLmluY3JlbWVudExldmVsID0gX19iaW5kKHRoaXMuaW5jcmVtZW50TGV2ZWwsIHRoaXMpO1xuICAgIHRoaXMuZGVjcmVtZW50TGlmZSA9IF9fYmluZCh0aGlzLmRlY3JlbWVudExpZmUsIHRoaXMpO1xuICAgIHRoaXMuaW5jcmVtZW50U2NvcmUgPSBfX2JpbmQodGhpcy5pbmNyZW1lbnRTY29yZSwgdGhpcyk7XG4gICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgcmV0dXJuIEdhbWVTdGF0ZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIEdhbWVTdGF0ZS5EZWZhdWx0R2FtZURhdGEgPSB7XG4gICAgc2NvcmU6IDAsXG4gICAgbGl2ZXM6IDMsXG4gICAgbGV2ZWw6IDEsXG4gICAgc3BlZWRYOiAxXG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5kZWZhdWx0cyA9IHtcbiAgICBzY2VuZTogXCJcIixcbiAgICBlZ2dDb2xsZWN0aW9uOiBudWxsLFxuICAgIHNwZWVkWDogMVxuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBxdWVyeTtcbiAgICB0aGlzLnNldChcImVnZ0NvbGxlY3Rpb25cIiwgbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oKSk7XG4gICAgcXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoXCJIaWdoU2NvcmVcIik7XG4gICAgcXVlcnkuZGVzY2VuZGluZyhcInNjb3JlXCIpO1xuICAgIHF1ZXJ5LmluY2x1ZGUoXCJwbGF5ZXJcIik7XG4gICAgcXVlcnkubGltaXQoMTApO1xuICAgIHRoaXMuc2V0KFwiaGlnaHNjb3JlQ29sbGVjdGlvblwiLCBxdWVyeS5jb2xsZWN0aW9uKCkpO1xuICAgIHRoaXMucmVzZXRHYW1lRGF0YSgpO1xuICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcImZseVwiLCB0aGlzLmluY3JlbWVudFNjb3JlKTtcbiAgICB0aGlzLmdldChcImVnZ0NvbGxlY3Rpb25cIikub24oXCJicmVha1wiLCB0aGlzLmRlY3JlbWVudExpZmUpO1xuICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcImZseSBicmVha1wiLCB0aGlzLmNsZWFuVXBFZ2cpO1xuICAgIHJldHVybiB0aGlzLmdldChcImVnZ0NvbGxlY3Rpb25cIikub24oXCJyZW1vdmVcIiwgdGhpcy5pbmNyZW1lbnRMZXZlbCk7XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5pbmNyZW1lbnRTY29yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnNldChcInNjb3JlXCIsIHRoaXMuZ2V0KFwic2NvcmVcIikgKyAxKTtcbiAgfTtcblxuICBHYW1lU3RhdGUucHJvdG90eXBlLmRlY3JlbWVudExpZmUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldChcImxpdmVzXCIsIHRoaXMuZ2V0KFwibGl2ZXNcIikgLSAxKTtcbiAgICByZXR1cm4gdGhpcy52YWxpZGF0ZUFsaXZlKCk7XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5pbmNyZW1lbnRMZXZlbCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLmdldChcImVnZ0NvbGxlY3Rpb25cIikubGVuZ3RoIDw9IDApIHtcbiAgICAgIHRoaXMuc2V0KFwibGV2ZWxcIiwgdGhpcy5nZXQoXCJsZXZlbFwiKSArIDEpO1xuICAgICAgdGhpcy5zZXQoXCJzcGVlZFhcIiwgdGhpcy5nZXQoXCJzcGVlZFhcIikgKyAwLjI1KTtcbiAgICAgIHJldHVybiB0aGlzLmFkZEVnZ3MoKTtcbiAgICB9XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS52YWxpZGF0ZUFsaXZlID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuZ2V0KFwibGl2ZXNcIikgPD0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0KFwic2NlbmVcIiwgXCJnYW1lX292ZXJcIik7XG4gICAgfVxuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUuYWRkRWdncyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBpLCBudW1FZ2dzLCBfcmVzdWx0cztcbiAgICBudW1FZ2dzID0gMTA7XG4gICAgaSA9IDA7XG4gICAgX3Jlc3VsdHMgPSBbXTtcbiAgICB3aGlsZSAoaSA8IG51bUVnZ3MpIHtcbiAgICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5hZGQobmV3IGFueXlvbGsuRWdnTW9kZWwoe1xuICAgICAgICBjb2xsZWN0aW9uSW5kZXg6IGlcbiAgICAgIH0pKTtcbiAgICAgIF9yZXN1bHRzLnB1c2goaSsrKTtcbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUuY2xlYW5VcEVnZyA9IGZ1bmN0aW9uKGVnZ01vZGVsKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5yZW1vdmUoZWdnTW9kZWwpO1xuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUucmVzZXRHYW1lRGF0YSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnNldChhbnl5b2xrLkdhbWVTdGF0ZS5EZWZhdWx0R2FtZURhdGEpO1xuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUuZ2V0U2NvcmVTdWJtaXNzaW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICgodGhpcy5nZXQoXCJsZXZlbFwiKSAqIDM2MikgPDwgNSkgKyBcIi5cIiArICgodGhpcy5nZXQoXCJzY29yZVwiKSAqIDY3MikgPDwgNCk7XG4gIH07XG5cbiAgcmV0dXJuIEdhbWVTdGF0ZTtcblxufSkoQmFja2JvbmUuTW9kZWwpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5IaWdoc2NvcmVTY2VuZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEhpZ2hzY29yZVNjZW5lLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIEhpZ2hzY29yZVNjZW5lKCkge1xuICAgIHRoaXMuY2xlYW5VcCA9IF9fYmluZCh0aGlzLmNsZWFuVXAsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUgPSBfX2JpbmQodGhpcy5yZW5kZXJSZW1vdmVTY2VuZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTY29yZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjb3JlLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjb3JlQ29sbGVjdGlvbiA9IF9fYmluZCh0aGlzLnJlbmRlclNjb3JlQ29sbGVjdGlvbiwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UgPSBfX2JpbmQodGhpcy5yZW5kZXJTY2VuZUNoYW5nZSwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVCYWNrQnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlQmFja0J1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgcmV0dXJuIEhpZ2hzY29yZVNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmNsYXNzTmFtZSA9IFwiaGlnaHNjb3JlX3NjZW5lXCI7XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmV2ZW50cyA9IHtcbiAgICBhbmltYXRpb25lbmQ6IFwiY2xlYW5VcFwiLFxuICAgIHdlYmtpdEFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCIsXG4gICAgbW96QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIlxuICB9O1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS50ZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfaGlnaHNjb3JlXCIpLmh0bWwoKSk7XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLnNjb3JlVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX3Njb3JlXCIpLmh0bWwoKSk7XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwiaGlnaHNjb3JlXCI7XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNjZW5lXCIsIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UpO1xuICAgIHRoaXMubW9kZWwuZ2V0KFwiaGlnaHNjb3JlQ29sbGVjdGlvblwiKS5vbihcInJlc2V0XCIsIHRoaXMucmVuZGVyU2NvcmVDb2xsZWN0aW9uKTtcbiAgICB0aGlzLiRlbC5vbihVdGlscy5jbGlja1VwT3JUb3VjaCgpLCBcIi5iYWNrX2J1dHRvblwiLCB0aGlzLmhhbmRsZUJhY2tCdXR0b24pO1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcImN1cnJlbnRTY2VuZVwiKSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlbmRlcigpO1xuICAgIH1cbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUuaGFuZGxlQmFja0J1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLiQoXCIuYmFja19idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwibWVudVwiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLnJlbmRlclNjZW5lQ2hhbmdlID0gZnVuY3Rpb24obW9kZWwsIHNjZW5lKSB7XG4gICAgaWYgKG1vZGVsLnByZXZpb3VzKFwic2NlbmVcIikgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzY2VuZSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSgpKTtcbiAgICB0aGlzLm1vZGVsLmdldChcImhpZ2hzY29yZUNvbGxlY3Rpb25cIikuZmV0Y2goKTtcbiAgICB0aGlzLiQoXCIuaGlnaHNjb3JlXCIpLnNwaW4oe1xuICAgICAgbGVuZ3RoOiA5LFxuICAgICAgcmFkaXVzOiAxMCxcbiAgICAgIGxpbmVzOiAxMixcbiAgICAgIHdpZHRoOiA0LFxuICAgICAgY29sb3I6IFwiI2ZmZlwiXG4gICAgfSk7XG4gICAgJChcIiNzdGFnZVwiKS5hcHBlbmQodGhpcy4kZWwpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJTY29yZUNvbGxlY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmdldChcImhpZ2hzY29yZUNvbGxlY3Rpb25cIikuZWFjaCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbihzY29yZSwgaW5kZXgpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLnJlbmRlclNjb3JlKHNjb3JlLCBpbmRleCk7XG4gICAgICB9O1xuICAgIH0pKHRoaXMpKTtcbiAgICAkKFwiLmhpZ2hzY29yZSAuc3Bpbm5lclwiKS5yZW1vdmUoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NvcmUgPSBmdW5jdGlvbihzY29yZSwgaW5kZXgpIHtcbiAgICByZXR1cm4gdGhpcy4kKFwiI3Njb3JlX3RhYmxlIHRib2R5XCIpLmFwcGVuZCh0aGlzLnNjb3JlVGVtcGxhdGUoe1xuICAgICAgc2NvcmU6IHNjb3JlLFxuICAgICAgaW5kZXg6IGluZGV4XG4gICAgfSkpO1xuICB9O1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi5oaWdoc2NvcmVcIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuY3NzKFV0aWxzLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VNZW51XCIpO1xuICAgIHJldHVybiB0aGlzLiQoXCIuaGlnaHNjb3JlXCIpLmNzcyhVdGlscy5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlU2NvcmVzXCIpO1xuICB9O1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5jbGVhblVwID0gZnVuY3Rpb24oZSkge1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcInNjZW5lXCIpICE9PSB0aGlzLnNjZW5lTmFtZSAmJiAkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImhpZ2hzY29yZVwiKSkge1xuICAgICAgcmV0dXJuIHRoaXMuJGVsLmVtcHR5KCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBIaWdoc2NvcmVTY2VuZTtcblxufSkoQmFja2JvbmUuVmlldyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLk1lbnVTY2VuZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKE1lbnVTY2VuZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBNZW51U2NlbmUoKSB7XG4gICAgdGhpcy5jbGVhblVwID0gX19iaW5kKHRoaXMuY2xlYW5VcCwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSA9IF9fYmluZCh0aGlzLnJlbmRlclJlbW92ZVNjZW5lLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlciA9IF9fYmluZCh0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjZW5lQ2hhbmdlLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUNyZWRpdHNCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVDcmVkaXRzQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUhpZ2hzY29yZUJ1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZUhpZ2hzY29yZUJ1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVQbGF5QnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlUGxheUJ1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgcmV0dXJuIE1lbnVTY2VuZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJtZW51X3NjZW5lXCI7XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5ldmVudHMgPSB7XG4gICAgXCJhbmltYXRpb25lbmQgLnRpdGxlXCI6IFwiY2xlYW5VcFwiLFxuICAgIFwid2Via2l0QW5pbWF0aW9uRW5kIC50aXRsZVwiOiBcImNsZWFuVXBcIixcbiAgICBcIm1vekFuaW1hdGlvbkVuZCAudGl0bGVcIjogXCJjbGVhblVwXCJcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLnRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKFwiI19tZW51XCIpLmh0bWwoKSk7XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5zY2VuZU5hbWUgPSBcIm1lbnVcIjtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNjZW5lXCIsIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UpO1xuICAgIHRoaXMuJGVsLm9uKFV0aWxzLmNsaWNrVXBPclRvdWNoKCksIFwiI3BsYXlfYnV0dG9uXCIsIHRoaXMuaGFuZGxlUGxheUJ1dHRvbik7XG4gICAgdGhpcy4kZWwub24oVXRpbHMuY2xpY2tVcE9yVG91Y2goKSwgXCIjaGlnaHNjb3JlX2J1dHRvblwiLCB0aGlzLmhhbmRsZUhpZ2hzY29yZUJ1dHRvbik7XG4gICAgdGhpcy4kZWwub24oVXRpbHMuY2xpY2tVcE9yVG91Y2goKSwgXCIjY3JlZGl0c19idXR0b25cIiwgdGhpcy5oYW5kbGVDcmVkaXRzQnV0dG9uKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLmhhbmRsZVBsYXlCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJnYW1lXCIpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLmhhbmRsZUhpZ2hzY29yZUJ1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcImhpZ2hzY29yZVwiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5oYW5kbGVDcmVkaXRzQnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwiY3JlZGl0c1wiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5yZW5kZXJTY2VuZUNoYW5nZSA9IGZ1bmN0aW9uKG1vZGVsLCBzY2VuZSkge1xuICAgIGlmIChtb2RlbC5wcmV2aW91cyhcInNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoc2NlbmUgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKCkpO1xuICAgICQoXCIjc3RhZ2VcIikuYXBwZW5kKHRoaXMuJGVsKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLnJlbmRlclJlbW92ZVNjZW5lID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKFwiLnRpdGxlXCIpLnJlbW92ZUNsYXNzKFwiZGlzcGxheVwiKS5hZGRDbGFzcyhcInJlbW92YWxcIik7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcInJlbW92YWxcIik7XG4gICAgdGhpcy4kKFwiLnRpdGxlXCIpLmNzcyhVdGlscy5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlVGl0bGVcIik7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5jc3MoVXRpbHMuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyYWlzZU1lbnVcIik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5jbGVhblVwID0gZnVuY3Rpb24oZSkge1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcInNjZW5lXCIpICE9PSB0aGlzLnNjZW5lTmFtZSAmJiAkKGUudGFyZ2V0KS5oYXNDbGFzcyhcInRpdGxlXCIpKSB7XG4gICAgICB0aGlzLiRlbC5lbXB0eSgpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIE1lbnVTY2VuZTtcblxufSkoQmFja2JvbmUuVmlldyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLlN0YWdlID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoU3RhZ2UsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gU3RhZ2UoKSB7XG4gICAgdGhpcy5yZW5kZXJDbG91ZHMgPSBfX2JpbmQodGhpcy5yZW5kZXJDbG91ZHMsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyVHJlZXMgPSBfX2JpbmQodGhpcy5yZW5kZXJUcmVlcywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTdW4gPSBfX2JpbmQodGhpcy5yZW5kZXJTdW4sIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyVGlsZXMgPSBfX2JpbmQodGhpcy5yZW5kZXJUaWxlcywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHJldHVybiBTdGFnZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIFN0YWdlLnByb3RvdHlwZS5lbCA9IFwiI3N0YWdlXCI7XG5cbiAgU3RhZ2UucHJvdG90eXBlLnRpbGVUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfdGlsZV9wYWlyXCIpLmh0bWwoKSk7XG5cbiAgU3RhZ2UucHJvdG90eXBlLnRyZWVUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfdHJlZVwiKS5odG1sKCkpO1xuXG4gIFN0YWdlLnByb3RvdHlwZS5zdW5UZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfc3VuXCIpLmh0bWwoKSk7XG5cbiAgU3RhZ2UucHJvdG90eXBlLmNsb3VkVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2Nsb3VkXCIpLmh0bWwoKSk7XG5cbiAgU3RhZ2UucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmNzcyhcImhlaWdodFwiLCAkKHdpbmRvdykuaGVpZ2h0KCkpO1xuICAgIHRoaXMucmVuZGVyU3VuKCk7XG4gICAgdGhpcy5yZW5kZXJUcmVlcygpO1xuICAgIHRoaXMucmVuZGVyVGlsZXMoKTtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJDbG91ZHMoKTtcbiAgfTtcblxuICBTdGFnZS5wcm90b3R5cGUucmVuZGVyVGlsZXMgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIudGlsZVwiKS5yZW1vdmUoKTtcbiAgICByZXR1cm4gdGhpcy4kZWwuYXBwZW5kKHRoaXMudGlsZVRlbXBsYXRlKCkpO1xuICB9O1xuXG4gIFN0YWdlLnByb3RvdHlwZS5yZW5kZXJTdW4gPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIuc3VuXCIpLnJlbW92ZSgpO1xuICAgIHJldHVybiB0aGlzLiRlbC5hcHBlbmQodGhpcy5zdW5UZW1wbGF0ZSgpKTtcbiAgfTtcblxuICBTdGFnZS5wcm90b3R5cGUucmVuZGVyVHJlZXMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaSwgbGVmdCwgbnVtVHJlZXMsIF9yZXN1bHRzO1xuICAgIG51bVRyZWVzID0gTWF0aC5jZWlsKCQod2luZG93KS53aWR0aCgpIC8gMjAwKTtcbiAgICB0aGlzLiQoXCIudHJlZVwiKS5yZW1vdmUoKTtcbiAgICBpZiAobnVtVHJlZXMgPD0gMikge1xuICAgICAgdGhpcy4kZWwuYXBwZW5kKHRoaXMudHJlZVRlbXBsYXRlKHtcbiAgICAgICAgdHJlZU51bTogMyxcbiAgICAgICAgbGVmdFZhbHVlOiAtMTAwXG4gICAgICB9KSk7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuYXBwZW5kKHRoaXMudHJlZVRlbXBsYXRlKHtcbiAgICAgICAgdHJlZU51bTogMSxcbiAgICAgICAgbGVmdFZhbHVlOiAxMjBcbiAgICAgIH0pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaSA9IDA7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgd2hpbGUgKGkgPCBudW1UcmVlcykge1xuICAgICAgICBsZWZ0ID0gTWF0aC5yYW5kb20oKSAqIDIwMC4gKyBpICogMjAwO1xuICAgICAgICB0aGlzLiRlbC5hcHBlbmQodGhpcy50cmVlVGVtcGxhdGUoe1xuICAgICAgICAgIHRyZWVOdW06IC0xLFxuICAgICAgICAgIGxlZnRWYWx1ZTogbGVmdCAtIDMwMFxuICAgICAgICB9KSk7XG4gICAgICAgIF9yZXN1bHRzLnB1c2goaSsrKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9XG4gIH07XG5cbiAgU3RhZ2UucHJvdG90eXBlLnJlbmRlckNsb3VkcyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkZWxheSwgZGlyLCBpLCBudW1DbG91ZHMsIHNwZWVkLCB0b3AsIF9yZXN1bHRzO1xuICAgIG51bUNsb3VkcyA9IE1hdGguY2VpbCgkKHdpbmRvdykud2lkdGgoKSAvIDIwMCk7XG4gICAgbnVtQ2xvdWRzID0gKG51bUNsb3VkcyA8IDIgPyAyIDogbnVtQ2xvdWRzKTtcbiAgICBpID0gMDtcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIHdoaWxlIChpIDwgbnVtQ2xvdWRzKSB7XG4gICAgICB0b3AgPSBNYXRoLnJhbmRvbSgpICogNTA7XG4gICAgICBkZWxheSA9IE1hdGgucmFuZG9tKCkgKiA4IC0gNCArICgxMCAqIGkpO1xuICAgICAgc3BlZWQgPSAyMDtcbiAgICAgIGRpciA9IChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSA8IDEgPyBcImxlZnRcIiA6IFwicmlnaHRcIik7XG4gICAgICB0aGlzLiRlbC5hcHBlbmQodGhpcy5jbG91ZFRlbXBsYXRlKHtcbiAgICAgICAgZGVsYXk6IGRlbGF5LFxuICAgICAgICBkaXJlY3Rpb246IGRpcixcbiAgICAgICAgZHVyYXRpb246ICQod2luZG93KS53aWR0aCgpIC8gc3BlZWQsXG4gICAgICAgIHRvcFZhbHVlOiB0b3BcbiAgICAgIH0pKTtcbiAgICAgIF9yZXN1bHRzLnB1c2goaSsrKTtcbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9O1xuXG4gIHJldHVybiBTdGFnZTtcblxufSkoQmFja2JvbmUuVmlldyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9saztcblxubW9kdWxlLmV4cG9ydHMgPSBhbnl5b2xrID0gKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBhbnl5b2xrKCkge31cblxuICByZXR1cm4gYW55eW9saztcblxufSkoKTtcblxucmVxdWlyZSgnLi9HYW1lU3RhdGUnKTtcblxucmVxdWlyZSgnLi9FZ2dNb2RlbCcpO1xuXG5yZXF1aXJlKCcuL0VnZ1ZpZXcnKTtcblxucmVxdWlyZSgnLi9TdGFnZScpO1xuXG5yZXF1aXJlKCcuL01lbnVTY2VuZScpO1xuXG5yZXF1aXJlKCcuL0dhbWVTY2VuZScpO1xuXG5yZXF1aXJlKCcuL0dhbWVPdmVyU2NlbmUnKTtcblxucmVxdWlyZSgnLi9IaWdoc2NvcmVTY2VuZScpO1xuXG5yZXF1aXJlKCcuL0NyZWRpdHNTY2VuZScpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGs7XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuL2FueXlvbGsnKTtcblxuJChmdW5jdGlvbigpIHtcbiAgcmV0dXJuIChmdW5jdGlvbigpIHtcbiAgICB2YXIgbW9kZWw7XG4gICAgaWYgKFV0aWxzLmlzU3VwcG9ydGVkKCkpIHtcbiAgICAgIG1vZGVsID0gbmV3IGFueXlvbGsuR2FtZVN0YXRlKCk7XG4gICAgICBuZXcgYW55eW9say5TdGFnZSh7XG4gICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgfSkucmVuZGVyKCk7XG4gICAgICBuZXcgYW55eW9say5NZW51U2NlbmUoe1xuICAgICAgICBtb2RlbDogbW9kZWxcbiAgICAgIH0pO1xuICAgICAgbmV3IGFueXlvbGsuR2FtZVNjZW5lKHtcbiAgICAgICAgbW9kZWw6IG1vZGVsXG4gICAgICB9KTtcbiAgICAgIG5ldyBhbnl5b2xrLkdhbWVPdmVyU2NlbmUoe1xuICAgICAgICBtb2RlbDogbW9kZWxcbiAgICAgIH0pO1xuICAgICAgbmV3IGFueXlvbGsuSGlnaHNjb3JlU2NlbmUoe1xuICAgICAgICBtb2RlbDogbW9kZWxcbiAgICAgIH0pO1xuICAgICAgbmV3IGFueXlvbGsuQ3JlZGl0c1NjZW5lKHtcbiAgICAgICAgbW9kZWw6IG1vZGVsXG4gICAgICB9KTtcbiAgICAgIG1vZGVsLnNldChcInNjZW5lXCIsIFwibWVudVwiKTtcbiAgICAgICQoXCIjc3RhZ2VcIikub24oXCJkcmFnc3RhcnQgc2VsZWN0c3RhcnRcIiwgXCIqXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRvY3VtZW50Lm9udG91Y2htb3ZlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICByZXR1cm4gZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuICQoXCIjdW5zdXBwb3J0ZWRcIikuc2hvdygpO1xuICAgIH1cbiAgfSkoKTtcbn0pO1xuXG53aW5kb3cuVXRpbHMgPSB7XG4gIGJwOiBmdW5jdGlvbigpIHtcbiAgICB2YXIgYnA7XG4gICAgYnAgPSBcIlwiO1xuICAgIGlmICgkLmJyb3dzZXIud2Via2l0KSB7XG4gICAgICBicCA9IFwiLXdlYmtpdC1cIjtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCQuYnJvd3Nlci5tb3ppbGxhKSB7XG4gICAgICAgIGJwID0gXCItbW96LVwiO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYnA7XG4gIH0sXG4gIGlzU3VwcG9ydGVkOiBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gISgkLmJyb3dzZXIubXNpZSAmJiBwYXJzZUludCgkLmJyb3dzZXIudmVyc2lvbikgPCAxMCk7XG4gIH0sXG4gIG5leHRUaWNrOiBmdW5jdGlvbihmdW5jKSB7XG4gICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuYywgMCk7XG4gIH0sXG4gIGNsaWNrVXBPclRvdWNoOiBmdW5jdGlvbihmdW5jKSB7XG4gICAgaWYgKFwib250b3VjaHN0YXJ0XCIgaW4gd2luZG93KSB7XG4gICAgICByZXR1cm4gXCJ0b3VjaHN0YXJ0XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBcIm1vdXNldXBcIjtcbiAgICB9XG4gIH0sXG4gIGNsaWNrRG93bk9yVG91Y2g6IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICBpZiAoXCJvbnRvdWNoc3RhcnRcIiBpbiB3aW5kb3cpIHtcbiAgICAgIHJldHVybiBcInRvdWNoc3RhcnRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwibW91c2Vkb3duXCI7XG4gICAgfVxuICB9XG59O1xuXG4kLmZuLnNwaW4gPSBmdW5jdGlvbihvcHRzKSB7XG4gIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICB2YXIgJHRoaXMsIGRhdGE7XG4gICAgJHRoaXMgPSAkKHRoaXMpO1xuICAgIGRhdGEgPSAkdGhpcy5kYXRhKCk7XG4gICAgaWYgKGRhdGEuc3Bpbm5lcikge1xuICAgICAgZGF0YS5zcGlubmVyLnN0b3AoKTtcbiAgICAgIGRlbGV0ZSBkYXRhLnNwaW5uZXI7XG4gICAgfVxuICAgIGlmIChvcHRzICE9PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIGRhdGEuc3Bpbm5lciA9IG5ldyBTcGlubmVyKCQuZXh0ZW5kKHtcbiAgICAgICAgY29sb3I6ICR0aGlzLmNzcyhcImNvbG9yXCIpXG4gICAgICB9LCBvcHRzKSkuc3Bpbih0aGlzKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gdGhpcztcbn07XG5cblBhcnNlLmluaXRpYWxpemUoXCIwWlVuMVRhREY5RzNqNlVodm9ORnVJVlN6RjQ1dnBTTzlLMHJsb3NNXCIsIFwib1UxVG9aOUxOWm9Nc2xwaHBneFFOb1ZqSlhFcW9pNTlNMDE4WlAwOFwiKTtcblxud2luZG93LmZiQXN5bmNJbml0ID0gZnVuY3Rpb24oKSB7XG4gIHJldHVybiBQYXJzZS5GYWNlYm9va1V0aWxzLmluaXQoe1xuICAgIGFwcElkOiBcIjEzODAxMDMxODIyNTA1MjBcIixcbiAgICBjaGFubmVsVXJsOiBcIi9jaGFubmVsLmh0bWxcIixcbiAgICBzdGF0dXM6IHRydWUsXG4gICAgY29va2llOiB0cnVlLFxuICAgIHhmYm1sOiB0cnVlXG4gIH0pO1xufTtcblxuKGZ1bmN0aW9uKGQsIGRlYnVnKSB7XG4gIHZhciBpZCwganMsIHJlZjtcbiAganMgPSB2b2lkIDA7XG4gIGlkID0gXCJmYWNlYm9vay1qc3Nka1wiO1xuICByZWYgPSBkLmdldEVsZW1lbnRzQnlUYWdOYW1lKFwic2NyaXB0XCIpWzBdO1xuICBpZiAoZC5nZXRFbGVtZW50QnlJZChpZCkpIHtcbiAgICByZXR1cm47XG4gIH1cbiAganMgPSBkLmNyZWF0ZUVsZW1lbnQoXCJzY3JpcHRcIik7XG4gIGpzLmlkID0gaWQ7XG4gIGpzLmFzeW5jID0gdHJ1ZTtcbiAganMuc3JjID0gXCIvL2Nvbm5lY3QuZmFjZWJvb2submV0L2VuX1VTL2FsbFwiICsgKGRlYnVnID8gXCIvZGVidWdcIiA6IFwiXCIpICsgXCIuanNcIjtcbiAgcmV0dXJuIHJlZi5wYXJlbnROb2RlLmluc2VydEJlZm9yZShqcywgcmVmKTtcbn0pKGRvY3VtZW50LCBmYWxzZSk7XG4iXX0=
