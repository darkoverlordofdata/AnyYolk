(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.CreditsScene = (function(_super) {
  __extends(CreditsScene, _super);

  function CreditsScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return CreditsScene.__super__.constructor.apply(this, arguments);
  }

  CreditsScene.prototype.className = "credits_scene";

  CreditsScene.prototype.sceneName = "credits";

  CreditsScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  CreditsScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    return this.$el.on(anyyolk.clickUpOrTouch(), ".back_button", this.handleBackButton);
  };

  CreditsScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    this.model.set("scene", "menu");
    return false;
  };

  CreditsScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  CreditsScene.prototype.render = function() {
    this.$el.html(anyyolk.JST.credits());
    $("#stage").append(this.$el);
    return this;
  };

  CreditsScene.prototype.renderRemoveScene = function() {
    this.$(".credits").addClass("removal");
    this.$(".back_button").addClass("removal");
    this.$(".credits").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this.$(".back_button").css(anyyolk.bp() + "animation-name", "raiseMenu");
  };

  CreditsScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("credits")) {
      return this.$el.empty();
    }
  };

  return CreditsScene;

})(Backbone.View);

},{"../anyyolk":10}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.EggModel = (function(_super) {
  __extends(EggModel, _super);

  function EggModel() {
    this.eggHitGround = __bind(this.eggHitGround, this);
    this.isSafe = __bind(this.isSafe, this);
    this.nextSprite = __bind(this.nextSprite, this);
    return EggModel.__super__.constructor.apply(this, arguments);
  }

  EggModel.NumSprites = 5;

  EggModel.prototype.defaults = {
    spriteIndex: 1,
    collectionIndex: 0
  };

  EggModel.prototype.nextSprite = function() {
    this.set("spriteIndex", this.get("spriteIndex") + 1);
    if (this.isSafe()) {
      return this.trigger("fly", [this]);
    }
  };

  EggModel.prototype.isSafe = function() {
    return this.get("spriteIndex") >= EggModel.NumSprites;
  };

  EggModel.prototype.eggHitGround = function() {
    if (!this.isSafe()) {
      return this.trigger("break", [this]);
    }
  };

  return EggModel;

})(Backbone.Model);

},{"../anyyolk":10}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.EggView = (function(_super) {
  __extends(EggView, _super);

  function EggView() {
    this.handleTransitionEnded = __bind(this.handleTransitionEnded, this);
    this.renderRemove = __bind(this.renderRemove, this);
    this.renderFlying = __bind(this.renderFlying, this);
    this.renderHidding = __bind(this.renderHidding, this);
    this.renderBreaking = __bind(this.renderBreaking, this);
    this.renderSprites = __bind(this.renderSprites, this);
    this.render = __bind(this.render, this);
    this.nextSprite = __bind(this.nextSprite, this);
    this.initialize = __bind(this.initialize, this);
    return EggView.__super__.constructor.apply(this, arguments);
  }

  EggView.prototype.className = "egg";

  EggView.prototype.spriteClass = ".egg_sprite_";

  EggView.prototype.scene = null;

  EggView.prototype.events = {
    webkitTransitionEnd: "handleTransitionEnded",
    mozTransitionEnd: "handleTransitionEnded",
    transitionend: "handleTransitionEnded"
  };

  EggView.prototype.initialize = function() {
    this.scene = this.options.scene;
    this.gameState = this.options.gameState;
    this.$el.on(anyyolk.clickDownOrTouch(), this.nextSprite);
    this.model.on("change:spriteIndex", this.renderSprites);
    this.model.on("fly", this.renderFlying);
    return this.model.on("break", this.renderBreaking);
  };

  EggView.prototype.nextSprite = function() {
    if (!this.model.isSafe()) {
      this.model.nextSprite();
      return false;
    }
  };

  EggView.prototype.render = function() {
    var delay, intermission, left, speed, top;
    this.renderSprites();
    intermission = 3.5;
    delay = void 0;
    if (this.model.get("collectionIndex") === 1) {
      delay = intermission;
    } else {
      delay = (Math.random() * 6 + 3) / this.gameState.get("speedX") + (2 * this.model.get("collectionIndex")) + intermission;
    }
    speed = 100 * this.gameState.get("speedX") + Math.random() * 100 - 50;
    left = Math.random() * ($(window).width() - 100) + 30;
    top = $("#stage").height() - 220;
    this.$el.css(anyyolk.bp() + "transition-delay", delay + "s");
    this.$el.css(anyyolk.bp() + "transition-duration", $(window).height() / speed + "s");
    this.$el.css(anyyolk.bp() + "transition-property", "top opacity");
    this.$el.css(anyyolk.bp() + "transition-timing-function", "linear");
    this.$el.css("left", left + "px");
    this.scene.append(this.$el);
    return anyyolk.nextTick((function(_this) {
      return function() {
        return _this.$el.css("top", top + "px");
      };
    })(this));
  };

  EggView.prototype.renderSprites = function() {
    return this.$el.html(anyyolk.JST.egg({
      spriteIndex: this.model.get("spriteIndex")
    }));
  };

  EggView.prototype.renderBreaking = function() {
    this.$el.addClass("cracked").addClass("disabled");
    this.$el.css(anyyolk.bp() + "transition-delay", "0s");
    return this.$el.css(anyyolk.bp() + "transition-duration", "0.2s");
  };

  EggView.prototype.renderHidding = function() {
    this.$el.addClass("broken");
    this.$el.css(anyyolk.bp() + "transition-delay", "1s");
    this.$el.css(anyyolk.bp() + "transition-duration", "0.5s");
    this.$el.css(anyyolk.bp() + "transition-property", "opacity");
    this.$el.css(anyyolk.bp() + "transition-timing-function", "linear");
    return this.$el.css("opacity", 0);
  };

  EggView.prototype.renderFlying = function() {
    this.$el.addClass("flying");
    this.$el.css(anyyolk.bp() + "transition-delay", "0s");
    this.$el.css(anyyolk.bp() + "transition-duration", "1s");
    this.$el.css(anyyolk.bp() + "transition-property", "top");
    return this.$el.css(anyyolk.bp() + "transition-timing-function", "linear");
  };

  EggView.prototype.renderRemove = function() {
    return this.remove();
  };

  EggView.prototype.handleTransitionEnded = function(e) {
    if (e.originalEvent.propertyName === "opacity") {
      this.renderRemove();
    } else if (e.originalEvent.propertyName === "top") {
      this.model.eggHitGround();
    } else {
      if (e.originalEvent.propertyName === anyyolk.bp() + "transform" || "transform") {
        this.renderHidding();
      }
    }
    return false;
  };

  return EggView;

})(Backbone.View);

},{"../anyyolk":10}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameOverScene = (function(_super) {
  __extends(GameOverScene, _super);

  function GameOverScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.saveHighScore = __bind(this.saveHighScore, this);
    this.handleFacebookButton = __bind(this.handleFacebookButton, this);
    this.handleReplayButton = __bind(this.handleReplayButton, this);
    this.handleMenuButton = __bind(this.handleMenuButton, this);
    this.initialize = __bind(this.initialize, this);
    return GameOverScene.__super__.constructor.apply(this, arguments);
  }

  GameOverScene.Congrats = ["Not bad", "Good", "Great", "Fantastic", "Smashing!", "Amazing!", "Flying High", "Ridiculous!", "Extraordinary!", "Monstrous!!"];

  GameOverScene.prototype.className = "game_over_scene";

  GameOverScene.prototype.sceneName = "game_over";

  GameOverScene.prototype.submitted = false;

  GameOverScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  GameOverScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.$el.on(anyyolk.clickUpOrTouch(), ".menu_button", this.handleMenuButton);
    this.$el.on(anyyolk.clickUpOrTouch(), ".replay_button", this.handleReplayButton);
    return this.$el.on(anyyolk.clickUpOrTouch(), ".facebook_button", this.handleFacebookButton);
  };

  GameOverScene.prototype.handleMenuButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    return this.model.set("scene", "menu");
  };

  GameOverScene.prototype.handleReplayButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    return this.model.set("scene", "game");
  };

  GameOverScene.prototype.handleFacebookButton = function(e) {
    $(".fb_content").hide();
    $(".facebook_button").addClass("disabled").empty().spin({
      length: 5,
      radius: 5,
      lines: 8,
      width: 3,
      color: "#fff"
    });
    if (Parse.User.current()) {
      return this.saveHighScore();
    } else {
      return Parse.Facebookanyyolk.logIn(null, {
        success: (function(_this) {
          return function(user) {
            if (!user.existed()) {
              return FB.api("/me", function(response) {
                if (!response.error) {
                  user.set("displayName", response.name);
                  return user.save(null, {
                    success: function(user) {
                      return _this.saveHighScore();
                    },
                    error: function(user, error) {
                      return console.log("Oops, something went wrong saving your name.");
                    }
                  });
                } else {
                  return console.log("Oops something went wrong with facebook.");
                }
              });
            } else {
              return _this.saveHighScore();
            }
          };
        })(this),
        error: (function(_this) {
          return function(user, error) {
            return console.log("Oops, something went wrong.");
          };
        })(this)
      });
    }
  };

  GameOverScene.prototype.saveHighScore = function() {
    var submission;
    submission = {
      score: this.model.getScoreSubmission()
    };
    return Parse.Cloud.run("submitHighscore", submission, {
      success: (function(_this) {
        return function(result) {
          _this.submitted = true;
          return _this.$(".facebook_button").html("Submitted!");
        };
      })(this),
      error: (function(_this) {
        return function(error) {
          _this.submitted = true;
          return _this.$(".facebook_button").html(" X Try Again...").removeClass("disabled");
        };
      })(this)
    });
  };

  GameOverScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  GameOverScene.prototype.render = function() {
    var congratsIndex;
    congratsIndex = (this.model.get("level") > GameOverScene.Congrats.length ? GameOverScene.Congrats.length - 1 : this.model.get("level") - 1);
    this.$el.html(anyyolk.JST.game_over({
      score: this.model.get("score"),
      congrats: GameOverScene.Congrats[congratsIndex]
    }));
    return $("#stage").append(this.$el);
  };

  GameOverScene.prototype.renderRemoveScene = function() {
    this.$(".menu_item").addClass("removal");
    this.$(".summary").addClass("removal");
    this.$(".menu_item").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this.$(".summary").css(anyyolk.bp() + "animation-name", "raiseScores");
  };

  GameOverScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("summary")) {
      return this.$el.empty();
    }
  };

  return GameOverScene;

})(Backbone.View);

},{"../anyyolk":10}],5:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameScene = (function(_super) {
  __extends(GameScene, _super);

  function GameScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.renderAddEgg = __bind(this.renderAddEgg, this);
    this.renderEggs = __bind(this.renderEggs, this);
    this.renderBackButton = __bind(this.renderBackButton, this);
    this.renderLives = __bind(this.renderLives, this);
    this.renderScore = __bind(this.renderScore, this);
    this.renderLevelLabel = __bind(this.renderLevelLabel, this);
    this.renderLevel = __bind(this.renderLevel, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return GameScene.__super__.constructor.apply(this, arguments);
  }

  GameScene.prototype.className = "game_scene";

  GameScene.prototype.sceneName = "game";

  GameScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  GameScene.prototype.initialize = function() {
    this.eggViews = [];
    this.$el.on(anyyolk.clickUpOrTouch(), ".back_button", this.handleBackButton);
    this.model.on("change:scene", this.renderSceneChange);
    this.model.get("eggCollection").on("add", this.renderAddEgg);
    this.model.on("change:score", this.renderScore);
    this.model.on("change:lives", this.renderLives);
    this.model.on("change:level", this.renderLevel);
    return this.model.on("change:level", this.renderLevelLabel);
  };

  GameScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    return this.model.set("scene", "menu");
  };

  GameScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  GameScene.prototype.render = function() {
    this.model.resetGameData();
    this.$("#hud").remove();
    this.$el.append("<div id='hud'></div>");
    this.renderLevel();
    setTimeout(((function(_this) {
      return function() {
        return _this.renderLevelLabel();
      };
    })(this)), 1200);
    this.renderScore();
    this.renderLives();
    this.renderBackButton();
    this.renderEggs();
    if ($("#stage ." + this.className).length <= 0) {
      $("#stage").append(this.$el);
    }
    return this;
  };

  GameScene.prototype.renderLevel = function() {
    if (this.$("#game_level").length > 0) {
      this.$("#game_level").replaceWith(anyyolk.JST.game_level({
        level: this.model.get("level")
      }));
    } else {
      this.$("#hud").append(anyyolk.JST.game_level({
        level: this.model.get("level")
      }));
    }
    return this;
  };

  GameScene.prototype.renderLevelLabel = function() {
    this.$el.append("<p class='level_label'>LEVEL " + this.model.get("level") + "<br>GET READY!</p>");
    setTimeout(((function(_this) {
      return function() {
        return _this.$(".level_label").addClass("removal");
      };
    })(this)), 3000);
    setTimeout(((function(_this) {
      return function() {
        return _this.$(".level_label").remove();
      };
    })(this)), 3300);
    return this;
  };

  GameScene.prototype.renderScore = function() {
    if (this.$("#game_score").length > 0) {
      this.$("#game_score").replaceWith(anyyolk.JST.game_score({
        score: this.model.get("score")
      }));
    } else {
      this.$("#hud").append(anyyolk.JST.game_score({
        score: this.model.get("score")
      }));
    }
    return this;
  };

  GameScene.prototype.renderLives = function() {
    if (this.$("#game_lives").length > 0) {
      this.$("#game_lives").replaceWith(anyyolk.JST.game_lives({
        lives: this.model.get("lives")
      }));
    } else {
      this.$("#hud").append(anyyolk.JST.game_lives({
        lives: this.model.get("lives")
      }));
    }
    return this;
  };

  GameScene.prototype.renderBackButton = function() {
    if (this.$(".back_button").length > 0) {
      this.$(".back_button").replaceWith("<div class='back_button'>X</div>");
    } else {
      this.$el.append("<div class='back_button'>X</div>");
    }
    return this;
  };

  GameScene.prototype.renderEggs = function() {
    this.model.addEggs();
    return this;
  };

  GameScene.prototype.renderAddEgg = function(eggModel, collection, options) {
    var eggView;
    eggView = new anyyolk.EggView({
      model: eggModel,
      gameState: this.model,
      scene: this.$el
    });
    eggView.render();
    this.eggViews.push(eggView);
    return this;
  };

  GameScene.prototype.renderRemoveScene = function() {
    this.$(".back_button").css(anyyolk.bp() + "animation-name", "xRaise");
    this.$("#hud p").css(anyyolk.bp() + "animation-name", "removeHUD");
    this.$(".egg").css(anyyolk.bp() + "transition-duration", "0.3s");
    _.each(this.eggViews, (function(_this) {
      return function(eggView) {
        return eggView.renderRemove();
      };
    })(this));
    this.model.get("eggCollection").reset();
    return this;
  };

  GameScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("back_button")) {
      this.$el.empty();
    }
    return false;
  };

  return GameScene;

})(Backbone.View);

},{"../anyyolk":10}],6:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameState = (function(_super) {
  __extends(GameState, _super);

  function GameState() {
    this.getScoreSubmission = __bind(this.getScoreSubmission, this);
    this.resetGameData = __bind(this.resetGameData, this);
    this.cleanUpEgg = __bind(this.cleanUpEgg, this);
    this.addEggs = __bind(this.addEggs, this);
    this.validateAlive = __bind(this.validateAlive, this);
    this.incrementLevel = __bind(this.incrementLevel, this);
    this.decrementLife = __bind(this.decrementLife, this);
    this.incrementScore = __bind(this.incrementScore, this);
    this.initialize = __bind(this.initialize, this);
    return GameState.__super__.constructor.apply(this, arguments);
  }

  GameState.DefaultGameData = {
    score: 0,
    lives: 3,
    level: 1,
    speedX: 1
  };

  GameState.prototype.defaults = {
    scene: "",
    eggCollection: null,
    speedX: 1
  };

  GameState.prototype.initialize = function() {
    var query;
    this.set("eggCollection", new Backbone.Collection());
    query = new Parse.Query("HighScore");
    query.descending("score");
    query.include("player");
    query.limit(10);
    this.set("highscoreCollection", query.collection());
    this.resetGameData();
    this.get("eggCollection").on("fly", this.incrementScore);
    this.get("eggCollection").on("break", this.decrementLife);
    this.get("eggCollection").on("fly break", this.cleanUpEgg);
    return this.get("eggCollection").on("remove", this.incrementLevel);
  };

  GameState.prototype.incrementScore = function() {
    return this.set("score", this.get("score") + 1);
  };

  GameState.prototype.decrementLife = function() {
    this.set("lives", this.get("lives") - 1);
    return this.validateAlive();
  };

  GameState.prototype.incrementLevel = function() {
    if (this.get("eggCollection").length <= 0) {
      this.set("level", this.get("level") + 1);
      this.set("speedX", this.get("speedX") + 0.25);
      return this.addEggs();
    }
  };

  GameState.prototype.validateAlive = function() {
    if (this.get("lives") <= 0) {
      return this.set("scene", "game_over");
    }
  };

  GameState.prototype.addEggs = function() {
    var i, numEggs, _results;
    numEggs = 10;
    i = 0;
    _results = [];
    while (i < numEggs) {
      this.get("eggCollection").add(new anyyolk.EggModel({
        collectionIndex: i
      }));
      _results.push(i++);
    }
    return _results;
  };

  GameState.prototype.cleanUpEgg = function(eggModel) {
    return this.get("eggCollection").remove(eggModel);
  };

  GameState.prototype.resetGameData = function() {
    return this.set(anyyolk.GameState.DefaultGameData);
  };

  GameState.prototype.getScoreSubmission = function() {
    return ((this.get("level") * 362) << 5) + "." + ((this.get("score") * 672) << 4);
  };

  return GameState;

})(Backbone.Model);

},{"../anyyolk":10}],7:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.HighscoreScene = (function(_super) {
  __extends(HighscoreScene, _super);

  function HighscoreScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.renderScore = __bind(this.renderScore, this);
    this.renderScoreCollection = __bind(this.renderScoreCollection, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return HighscoreScene.__super__.constructor.apply(this, arguments);
  }

  HighscoreScene.prototype.className = "highscore_scene";

  HighscoreScene.prototype.sceneName = "highscore";

  HighscoreScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  HighscoreScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.model.get("highscoreCollection").on("reset", this.renderScoreCollection);
    this.$el.on(anyyolk.clickUpOrTouch(), ".back_button", this.handleBackButton);
    if (this.model.get("currentScene") === this.sceneName) {
      return this.render();
    }
  };

  HighscoreScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    this.model.set("scene", "menu");
    return false;
  };

  HighscoreScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  HighscoreScene.prototype.render = function() {
    this.$el.html(anyyolk.JST.highscore());
    this.model.get("highscoreCollection").fetch();
    this.$(".highscore").spin({
      length: 9,
      radius: 10,
      lines: 12,
      width: 4,
      color: "#fff"
    });
    $("#stage").append(this.$el);
    return this;
  };

  HighscoreScene.prototype.renderScoreCollection = function() {
    this.model.get("highscoreCollection").each((function(_this) {
      return function(score, index) {
        return _this.renderScore(score, index);
      };
    })(this));
    $(".highscore .spinner").remove();
    return this;
  };

  HighscoreScene.prototype.renderScore = function(score, index) {
    return this.$("#score_table tbody").append(anyyolk.JST.score({
      score: score,
      index: index
    }));
  };

  HighscoreScene.prototype.renderRemoveScene = function() {
    this.$(".menu_item").addClass("removal");
    this.$(".highscore").addClass("removal");
    this.$(".menu_item").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this.$(".highscore").css(anyyolk.bp() + "animation-name", "raiseScores");
  };

  HighscoreScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("highscore")) {
      return this.$el.empty();
    }
  };

  return HighscoreScene;

})(Backbone.View);

},{"../anyyolk":10}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.MenuScene = (function(_super) {
  __extends(MenuScene, _super);

  function MenuScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleCreditsButton = __bind(this.handleCreditsButton, this);
    this.handleHighscoreButton = __bind(this.handleHighscoreButton, this);
    this.handlePlayButton = __bind(this.handlePlayButton, this);
    this.initialize = __bind(this.initialize, this);
    return MenuScene.__super__.constructor.apply(this, arguments);
  }

  MenuScene.prototype.className = "menu_scene";

  MenuScene.prototype.sceneName = "menu";

  MenuScene.prototype.events = {
    "animationend .title": "cleanUp",
    "webkitAnimationEnd .title": "cleanUp",
    "mozAnimationEnd .title": "cleanUp"
  };

  MenuScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.$el.on(anyyolk.clickUpOrTouch(), "#play_button", this.handlePlayButton);
    this.$el.on(anyyolk.clickUpOrTouch(), "#highscore_button", this.handleHighscoreButton);
    this.$el.on(anyyolk.clickUpOrTouch(), "#credits_button", this.handleCreditsButton);
    return this;
  };

  MenuScene.prototype.handlePlayButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "game");
    return false;
  };

  MenuScene.prototype.handleHighscoreButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "highscore");
    return false;
  };

  MenuScene.prototype.handleCreditsButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "credits");
    return false;
  };

  MenuScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  MenuScene.prototype.render = function() {
    this.$el.html(anyyolk.JST.menu());
    $("#stage").append(this.$el);
    return this;
  };

  MenuScene.prototype.renderRemoveScene = function() {
    this.$(".title").removeClass("display").addClass("removal");
    this.$(".menu_item").addClass("removal");
    this.$(".title").css(anyyolk.bp() + "animation-name", "raiseTitle");
    this.$(".menu_item").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this;
  };

  MenuScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("title")) {
      this.$el.empty();
    }
    return false;
  };

  return MenuScene;

})(Backbone.View);

},{"../anyyolk":10}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.Stage = (function(_super) {
  __extends(Stage, _super);

  function Stage() {
    this.renderClouds = __bind(this.renderClouds, this);
    this.renderTrees = __bind(this.renderTrees, this);
    this.renderSun = __bind(this.renderSun, this);
    this.renderTiles = __bind(this.renderTiles, this);
    this.render = __bind(this.render, this);
    return Stage.__super__.constructor.apply(this, arguments);
  }

  Stage.prototype.el = "#stage";

  Stage.prototype.render = function() {
    this.$el.css("height", $(window).height());
    this.renderSun();
    this.renderTrees();
    this.renderTiles();
    return this.renderClouds();
  };

  Stage.prototype.renderTiles = function() {
    this.$(".tile").remove();
    return this.$el.append(anyyolk.JST.tile_pair());
  };

  Stage.prototype.renderSun = function() {
    this.$(".sun").remove();
    return this.$el.append(anyyolk.JST.sun());
  };

  Stage.prototype.renderTrees = function() {
    var i, left, numTrees, _results;
    numTrees = Math.ceil($(window).width() / 200);
    this.$(".tree").remove();
    if (numTrees <= 2) {
      this.$el.append(anyyolk.JST.tree({
        treeNum: 3,
        leftValue: -100
      }));
      return this.$el.append(anyyolk.JST.tree({
        treeNum: 1,
        leftValue: 120
      }));
    } else {
      i = 0;
      _results = [];
      while (i < numTrees) {
        left = Math.random() * 200. + i * 200;
        this.$el.append(anyyolk.JST.tree({
          treeNum: -1,
          leftValue: left - 300
        }));
        _results.push(i++);
      }
      return _results;
    }
  };

  Stage.prototype.renderClouds = function() {
    var i, numClouds, _results;
    numClouds = Math.ceil($(window).width() / 200);
    numClouds = (numClouds < 2 ? 2 : numClouds);
    i = 0;
    _results = [];
    while (i < numClouds) {
      this.$el.append(anyyolk.JST.cloud({
        bp: anyyolk.bp,
        delay: Math.random() * 8 - 4 + (10 * i),
        direction: Math.floor(Math.random() * 2) < 1 ? "left" : "right",
        duration: $(window).width() / 20,
        topValue: Math.random() * 50
      }));
      _results.push(i++);
    }
    return _results;
  };

  return Stage;

})(Backbone.View);

},{"../anyyolk":10}],10:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk;

module.exports = anyyolk = (function() {
  function anyyolk() {}

  anyyolk.JST = {};

  anyyolk.start = function(Q, id) {
    var gets;
    gets = [];
    ['cloud', 'credits', 'egg', 'game_level', 'game_lives', 'game_over', 'game_score', 'highscore', 'menu', 'score', 'sun', 'tile_pair', 'tree'].forEach(function(name) {
      return gets.push($.get("views/" + name + ".html", function(template) {
        return anyyolk.JST[name] = _.template(String(template));
      }));
    });
    return Q.all(gets).done(function() {
      var model;
      model = new anyyolk.GameState();
      new anyyolk.Stage({
        model: model
      }).render();
      new anyyolk.MenuScene({
        model: model
      });
      new anyyolk.GameScene({
        model: model
      });
      new anyyolk.GameOverScene({
        model: model
      });
      new anyyolk.HighscoreScene({
        model: model
      });
      new anyyolk.CreditsScene({
        model: model
      });
      model.set("scene", "menu");
      $(id).on("dragstart selectstart", "*", function(event) {
        return false;
      });
      return document.ontouchmove = function(e) {
        return e.preventDefault();
      };
    });
  };

  anyyolk.get = function(name) {
    return templates[name];
  };

  anyyolk.bp = function() {
    var bp;
    bp = "";
    bp = "-webkit-";
    if ($.browser != null) {
      if ($.browser.webkit) {
        bp = "-webkit-";
      } else {
        if ($.browser.mozilla) {
          bp = "-moz-";
        }
      }
    }
    return bp;
  };

  anyyolk.isSupported = function() {
    if ($.browser != null) {
      return !($.browser.msie && parseInt($.browser.version) < 10);
    } else {
      return true;
    }
  };

  anyyolk.nextTick = function(func) {
    return setTimeout(func, 0);
  };

  anyyolk.clickUpOrTouch = function(func) {
    if ("ontouchstart" in window) {
      return "touchstart";
    } else {
      return "mouseup";
    }
  };

  anyyolk.clickDownOrTouch = function(func) {
    if ("ontouchstart" in window) {
      return "touchstart";
    } else {
      return "mousedown";
    }
  };

  return anyyolk;

})();

require('./GameState');

require('./EggModel');

require('./EggView');

require('./Stage');

require('./MenuScene');

require('./GameScene');

require('./GameOverScene');

require('./HighscoreScene');

require('./CreditsScene');

$.prototype.spin = function(opts) {
  this.each(function() {
    var $this, data;
    $this = $(this);
    data = $this.data();
    if (data.spinner) {
      data.spinner.stop();
      delete data.spinner;
    }
    if (opts !== false) {
      return data.spinner = new Spinner($.extend({
        color: $this.css("color")
      }, opts)).spin(this);
    }
  });
  return this;
};

},{"./CreditsScene":1,"./EggModel":2,"./EggView":3,"./GameOverScene":4,"./GameScene":5,"./GameState":6,"./HighscoreScene":7,"./MenuScene":8,"./Stage":9}],11:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
Parse.initialize("0ZUn1TaDF9G3j6UhvoNFuIVSzF45vpSO9K0rlosM", "oU1ToZ9LNZoMslphpgxQNoVjJXEqoi59M018ZP08");

window.fbAsyncInit = function() {
  return Parse.FacebookUtils.init({
    appId: "1380103182250520",
    channelUrl: "/channel.html",
    status: true,
    cookie: true,
    xfbml: true
  });
};

(function(d, debug) {
  var id, js, ref;
  js = void 0;
  id = "facebook-jssdk";
  ref = d.getElementsByTagName("script")[0];
  if (d.getElementById(id)) {
    return;
  }
  js = d.createElement("script");
  js.id = id;
  js.async = true;
  js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
  return ref.parentNode.insertBefore(js, ref);
})(document, false);

$(function() {
  var anyyolk;
  anyyolk = require('./anyyolk');
  if (anyyolk.isSupported()) {
    return anyyolk.start(Q, "#stage");
  } else {
    return $("#unsupported").show();
  }
});

},{"./anyyolk":10}]},{},[11])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3IvbG9jYWwvbGliL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9DcmVkaXRzU2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9FZ2dNb2RlbC5qcyIsIi9ob21lL2JydWNlL0dpdC9BbnlZb2xrL3RtcC9hbnl5b2xrL0VnZ1ZpZXcuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9HYW1lT3ZlclNjZW5lLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvR2FtZVNjZW5lLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvR2FtZVN0YXRlLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvSGlnaHNjb3JlU2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9NZW51U2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9TdGFnZS5qcyIsIi9ob21lL2JydWNlL0dpdC9BbnlZb2xrL3RtcC9hbnl5b2xrL2luZGV4LmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL21haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdElBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5DcmVkaXRzU2NlbmUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhDcmVkaXRzU2NlbmUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gQ3JlZGl0c1NjZW5lKCkge1xuICAgIHRoaXMuY2xlYW5VcCA9IF9fYmluZCh0aGlzLmNsZWFuVXAsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUgPSBfX2JpbmQodGhpcy5yZW5kZXJSZW1vdmVTY2VuZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UgPSBfX2JpbmQodGhpcy5yZW5kZXJTY2VuZUNoYW5nZSwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVCYWNrQnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlQmFja0J1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgcmV0dXJuIENyZWRpdHNTY2VuZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJjcmVkaXRzX3NjZW5lXCI7XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5zY2VuZU5hbWUgPSBcImNyZWRpdHNcIjtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLmV2ZW50cyA9IHtcbiAgICBhbmltYXRpb25lbmQ6IFwiY2xlYW5VcFwiLFxuICAgIHdlYmtpdEFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCIsXG4gICAgbW96QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIlxuICB9O1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c2NlbmVcIiwgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSk7XG4gICAgcmV0dXJuIHRoaXMuJGVsLm9uKGFueXlvbGsuY2xpY2tVcE9yVG91Y2goKSwgXCIuYmFja19idXR0b25cIiwgdGhpcy5oYW5kbGVCYWNrQnV0dG9uKTtcbiAgfTtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLmhhbmRsZUJhY2tCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcIm1lbnVcIik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICBpZiAobW9kZWwucHJldmlvdXMoXCJzY2VuZVwiKSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHNjZW5lID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoYW55eW9say5KU1QuY3JlZGl0cygpKTtcbiAgICAkKFwiI3N0YWdlXCIpLmFwcGVuZCh0aGlzLiRlbCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi5jcmVkaXRzXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIuYmFja19idXR0b25cIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi5jcmVkaXRzXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VNZW51XCIpO1xuICAgIHJldHVybiB0aGlzLiQoXCIuYmFja19idXR0b25cIikuY3NzKGFueXlvbGsuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyYWlzZU1lbnVcIik7XG4gIH07XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5jbGVhblVwID0gZnVuY3Rpb24oZSkge1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcInNjZW5lXCIpICE9PSB0aGlzLnNjZW5lTmFtZSAmJiAkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImNyZWRpdHNcIikpIHtcbiAgICAgIHJldHVybiB0aGlzLiRlbC5lbXB0eSgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gQ3JlZGl0c1NjZW5lO1xuXG59KShCYWNrYm9uZS5WaWV3KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuRWdnTW9kZWwgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhFZ2dNb2RlbCwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBFZ2dNb2RlbCgpIHtcbiAgICB0aGlzLmVnZ0hpdEdyb3VuZCA9IF9fYmluZCh0aGlzLmVnZ0hpdEdyb3VuZCwgdGhpcyk7XG4gICAgdGhpcy5pc1NhZmUgPSBfX2JpbmQodGhpcy5pc1NhZmUsIHRoaXMpO1xuICAgIHRoaXMubmV4dFNwcml0ZSA9IF9fYmluZCh0aGlzLm5leHRTcHJpdGUsIHRoaXMpO1xuICAgIHJldHVybiBFZ2dNb2RlbC5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIEVnZ01vZGVsLk51bVNwcml0ZXMgPSA1O1xuXG4gIEVnZ01vZGVsLnByb3RvdHlwZS5kZWZhdWx0cyA9IHtcbiAgICBzcHJpdGVJbmRleDogMSxcbiAgICBjb2xsZWN0aW9uSW5kZXg6IDBcbiAgfTtcblxuICBFZ2dNb2RlbC5wcm90b3R5cGUubmV4dFNwcml0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0KFwic3ByaXRlSW5kZXhcIiwgdGhpcy5nZXQoXCJzcHJpdGVJbmRleFwiKSArIDEpO1xuICAgIGlmICh0aGlzLmlzU2FmZSgpKSB7XG4gICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKFwiZmx5XCIsIFt0aGlzXSk7XG4gICAgfVxuICB9O1xuXG4gIEVnZ01vZGVsLnByb3RvdHlwZS5pc1NhZmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoXCJzcHJpdGVJbmRleFwiKSA+PSBFZ2dNb2RlbC5OdW1TcHJpdGVzO1xuICB9O1xuXG4gIEVnZ01vZGVsLnByb3RvdHlwZS5lZ2dIaXRHcm91bmQgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAoIXRoaXMuaXNTYWZlKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnRyaWdnZXIoXCJicmVha1wiLCBbdGhpc10pO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gRWdnTW9kZWw7XG5cbn0pKEJhY2tib25lLk1vZGVsKTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuRWdnVmlldyA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEVnZ1ZpZXcsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gRWdnVmlldygpIHtcbiAgICB0aGlzLmhhbmRsZVRyYW5zaXRpb25FbmRlZCA9IF9fYmluZCh0aGlzLmhhbmRsZVRyYW5zaXRpb25FbmRlZCwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJSZW1vdmUgPSBfX2JpbmQodGhpcy5yZW5kZXJSZW1vdmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyRmx5aW5nID0gX19iaW5kKHRoaXMucmVuZGVyRmx5aW5nLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckhpZGRpbmcgPSBfX2JpbmQodGhpcy5yZW5kZXJIaWRkaW5nLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckJyZWFraW5nID0gX19iaW5kKHRoaXMucmVuZGVyQnJlYWtpbmcsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU3ByaXRlcyA9IF9fYmluZCh0aGlzLnJlbmRlclNwcml0ZXMsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLm5leHRTcHJpdGUgPSBfX2JpbmQodGhpcy5uZXh0U3ByaXRlLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gRWdnVmlldy5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLmNsYXNzTmFtZSA9IFwiZWdnXCI7XG5cbiAgRWdnVmlldy5wcm90b3R5cGUuc3ByaXRlQ2xhc3MgPSBcIi5lZ2dfc3ByaXRlX1wiO1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnNjZW5lID0gbnVsbDtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5ldmVudHMgPSB7XG4gICAgd2Via2l0VHJhbnNpdGlvbkVuZDogXCJoYW5kbGVUcmFuc2l0aW9uRW5kZWRcIixcbiAgICBtb3pUcmFuc2l0aW9uRW5kOiBcImhhbmRsZVRyYW5zaXRpb25FbmRlZFwiLFxuICAgIHRyYW5zaXRpb25lbmQ6IFwiaGFuZGxlVHJhbnNpdGlvbkVuZGVkXCJcbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zY2VuZSA9IHRoaXMub3B0aW9ucy5zY2VuZTtcbiAgICB0aGlzLmdhbWVTdGF0ZSA9IHRoaXMub3B0aW9ucy5nYW1lU3RhdGU7XG4gICAgdGhpcy4kZWwub24oYW55eW9say5jbGlja0Rvd25PclRvdWNoKCksIHRoaXMubmV4dFNwcml0ZSk7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzcHJpdGVJbmRleFwiLCB0aGlzLnJlbmRlclNwcml0ZXMpO1xuICAgIHRoaXMubW9kZWwub24oXCJmbHlcIiwgdGhpcy5yZW5kZXJGbHlpbmcpO1xuICAgIHJldHVybiB0aGlzLm1vZGVsLm9uKFwiYnJlYWtcIiwgdGhpcy5yZW5kZXJCcmVha2luZyk7XG4gIH07XG5cbiAgRWdnVmlldy5wcm90b3R5cGUubmV4dFNwcml0ZSA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5tb2RlbC5pc1NhZmUoKSkge1xuICAgICAgdGhpcy5tb2RlbC5uZXh0U3ByaXRlKCk7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkZWxheSwgaW50ZXJtaXNzaW9uLCBsZWZ0LCBzcGVlZCwgdG9wO1xuICAgIHRoaXMucmVuZGVyU3ByaXRlcygpO1xuICAgIGludGVybWlzc2lvbiA9IDMuNTtcbiAgICBkZWxheSA9IHZvaWQgMDtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJjb2xsZWN0aW9uSW5kZXhcIikgPT09IDEpIHtcbiAgICAgIGRlbGF5ID0gaW50ZXJtaXNzaW9uO1xuICAgIH0gZWxzZSB7XG4gICAgICBkZWxheSA9IChNYXRoLnJhbmRvbSgpICogNiArIDMpIC8gdGhpcy5nYW1lU3RhdGUuZ2V0KFwic3BlZWRYXCIpICsgKDIgKiB0aGlzLm1vZGVsLmdldChcImNvbGxlY3Rpb25JbmRleFwiKSkgKyBpbnRlcm1pc3Npb247XG4gICAgfVxuICAgIHNwZWVkID0gMTAwICogdGhpcy5nYW1lU3RhdGUuZ2V0KFwic3BlZWRYXCIpICsgTWF0aC5yYW5kb20oKSAqIDEwMCAtIDUwO1xuICAgIGxlZnQgPSBNYXRoLnJhbmRvbSgpICogKCQod2luZG93KS53aWR0aCgpIC0gMTAwKSArIDMwO1xuICAgIHRvcCA9ICQoXCIjc3RhZ2VcIikuaGVpZ2h0KCkgLSAyMjA7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1kZWxheVwiLCBkZWxheSArIFwic1wiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLWR1cmF0aW9uXCIsICQod2luZG93KS5oZWlnaHQoKSAvIHNwZWVkICsgXCJzXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tcHJvcGVydHlcIiwgXCJ0b3Agb3BhY2l0eVwiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvblwiLCBcImxpbmVhclwiKTtcbiAgICB0aGlzLiRlbC5jc3MoXCJsZWZ0XCIsIGxlZnQgKyBcInB4XCIpO1xuICAgIHRoaXMuc2NlbmUuYXBwZW5kKHRoaXMuJGVsKTtcbiAgICByZXR1cm4gYW55eW9say5uZXh0VGljaygoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLiRlbC5jc3MoXCJ0b3BcIiwgdG9wICsgXCJweFwiKTtcbiAgICAgIH07XG4gICAgfSkodGhpcykpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlclNwcml0ZXMgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy4kZWwuaHRtbChhbnl5b2xrLkpTVC5lZ2coe1xuICAgICAgc3ByaXRlSW5kZXg6IHRoaXMubW9kZWwuZ2V0KFwic3ByaXRlSW5kZXhcIilcbiAgICB9KSk7XG4gIH07XG5cbiAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVyQnJlYWtpbmcgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImNyYWNrZWRcIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIFwiMHNcIik7XG4gICAgcmV0dXJuIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgXCIwLjJzXCIpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlckhpZGRpbmcgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImJyb2tlblwiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIFwiMXNcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1kdXJhdGlvblwiLCBcIjAuNXNcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1wcm9wZXJ0eVwiLCBcIm9wYWNpdHlcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb25cIiwgXCJsaW5lYXJcIik7XG4gICAgcmV0dXJuIHRoaXMuJGVsLmNzcyhcIm9wYWNpdHlcIiwgMCk7XG4gIH07XG5cbiAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVyRmx5aW5nID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuYWRkQ2xhc3MoXCJmbHlpbmdcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1kZWxheVwiLCBcIjBzXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgXCIxc1wiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLXByb3BlcnR5XCIsIFwidG9wXCIpO1xuICAgIHJldHVybiB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvblwiLCBcImxpbmVhclwiKTtcbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5yZW5kZXJSZW1vdmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5yZW1vdmUoKTtcbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5oYW5kbGVUcmFuc2l0aW9uRW5kZWQgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWUgPT09IFwib3BhY2l0eVwiKSB7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZSgpO1xuICAgIH0gZWxzZSBpZiAoZS5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZSA9PT0gXCJ0b3BcIikge1xuICAgICAgdGhpcy5tb2RlbC5lZ2dIaXRHcm91bmQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGUub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWUgPT09IGFueXlvbGsuYnAoKSArIFwidHJhbnNmb3JtXCIgfHwgXCJ0cmFuc2Zvcm1cIikge1xuICAgICAgICB0aGlzLnJlbmRlckhpZGRpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIHJldHVybiBFZ2dWaWV3O1xuXG59KShCYWNrYm9uZS5WaWV3KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuR2FtZU92ZXJTY2VuZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEdhbWVPdmVyU2NlbmUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gR2FtZU92ZXJTY2VuZSgpIHtcbiAgICB0aGlzLmNsZWFuVXAgPSBfX2JpbmQodGhpcy5jbGVhblVwLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlID0gX19iaW5kKHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UsIHRoaXMpO1xuICAgIHRoaXMuc2F2ZUhpZ2hTY29yZSA9IF9fYmluZCh0aGlzLnNhdmVIaWdoU2NvcmUsIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlRmFjZWJvb2tCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVGYWNlYm9va0J1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVSZXBsYXlCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVSZXBsYXlCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlTWVudUJ1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZU1lbnVCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IF9fYmluZCh0aGlzLmluaXRpYWxpemUsIHRoaXMpO1xuICAgIHJldHVybiBHYW1lT3ZlclNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgR2FtZU92ZXJTY2VuZS5Db25ncmF0cyA9IFtcIk5vdCBiYWRcIiwgXCJHb29kXCIsIFwiR3JlYXRcIiwgXCJGYW50YXN0aWNcIiwgXCJTbWFzaGluZyFcIiwgXCJBbWF6aW5nIVwiLCBcIkZseWluZyBIaWdoXCIsIFwiUmlkaWN1bG91cyFcIiwgXCJFeHRyYW9yZGluYXJ5IVwiLCBcIk1vbnN0cm91cyEhXCJdO1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmNsYXNzTmFtZSA9IFwiZ2FtZV9vdmVyX3NjZW5lXCI7XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuc2NlbmVOYW1lID0gXCJnYW1lX292ZXJcIjtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5zdWJtaXR0ZWQgPSBmYWxzZTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5ldmVudHMgPSB7XG4gICAgYW5pbWF0aW9uZW5kOiBcImNsZWFuVXBcIixcbiAgICB3ZWJraXRBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiLFxuICAgIG1vekFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCJcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzY2VuZVwiLCB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlKTtcbiAgICB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrVXBPclRvdWNoKCksIFwiLm1lbnVfYnV0dG9uXCIsIHRoaXMuaGFuZGxlTWVudUJ1dHRvbik7XG4gICAgdGhpcy4kZWwub24oYW55eW9say5jbGlja1VwT3JUb3VjaCgpLCBcIi5yZXBsYXlfYnV0dG9uXCIsIHRoaXMuaGFuZGxlUmVwbGF5QnV0dG9uKTtcbiAgICByZXR1cm4gdGhpcy4kZWwub24oYW55eW9say5jbGlja1VwT3JUb3VjaCgpLCBcIi5mYWNlYm9va19idXR0b25cIiwgdGhpcy5oYW5kbGVGYWNlYm9va0J1dHRvbik7XG4gIH07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuaGFuZGxlTWVudUJ1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmhhbmRsZVJlcGxheUJ1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJnYW1lXCIpO1xuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmhhbmRsZUZhY2Vib29rQnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgICQoXCIuZmJfY29udGVudFwiKS5oaWRlKCk7XG4gICAgJChcIi5mYWNlYm9va19idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKS5lbXB0eSgpLnNwaW4oe1xuICAgICAgbGVuZ3RoOiA1LFxuICAgICAgcmFkaXVzOiA1LFxuICAgICAgbGluZXM6IDgsXG4gICAgICB3aWR0aDogMyxcbiAgICAgIGNvbG9yOiBcIiNmZmZcIlxuICAgIH0pO1xuICAgIGlmIChQYXJzZS5Vc2VyLmN1cnJlbnQoKSkge1xuICAgICAgcmV0dXJuIHRoaXMuc2F2ZUhpZ2hTY29yZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gUGFyc2UuRmFjZWJvb2thbnl5b2xrLmxvZ0luKG51bGwsIHtcbiAgICAgICAgc3VjY2VzczogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgIGlmICghdXNlci5leGlzdGVkKCkpIHtcbiAgICAgICAgICAgICAgcmV0dXJuIEZCLmFwaShcIi9tZVwiLCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgIGlmICghcmVzcG9uc2UuZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgIHVzZXIuc2V0KFwiZGlzcGxheU5hbWVcIiwgcmVzcG9uc2UubmFtZSk7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gdXNlci5zYXZlKG51bGwsIHtcbiAgICAgICAgICAgICAgICAgICAgc3VjY2VzczogZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zYXZlSGlnaFNjb3JlKCk7XG4gICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgIGVycm9yOiBmdW5jdGlvbih1c2VyLCBlcnJvcikge1xuICAgICAgICAgICAgICAgICAgICAgIHJldHVybiBjb25zb2xlLmxvZyhcIk9vcHMsIHNvbWV0aGluZyB3ZW50IHdyb25nIHNhdmluZyB5b3VyIG5hbWUuXCIpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKFwiT29wcyBzb21ldGhpbmcgd2VudCB3cm9uZyB3aXRoIGZhY2Vib29rLlwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnNhdmVIaWdoU2NvcmUoKTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKSxcbiAgICAgICAgZXJyb3I6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbih1c2VyLCBlcnJvcikge1xuICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKFwiT29wcywgc29tZXRoaW5nIHdlbnQgd3JvbmcuXCIpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpXG4gICAgICB9KTtcbiAgICB9XG4gIH07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuc2F2ZUhpZ2hTY29yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBzdWJtaXNzaW9uO1xuICAgIHN1Ym1pc3Npb24gPSB7XG4gICAgICBzY29yZTogdGhpcy5tb2RlbC5nZXRTY29yZVN1Ym1pc3Npb24oKVxuICAgIH07XG4gICAgcmV0dXJuIFBhcnNlLkNsb3VkLnJ1bihcInN1Ym1pdEhpZ2hzY29yZVwiLCBzdWJtaXNzaW9uLCB7XG4gICAgICBzdWNjZXNzOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHJlc3VsdCkge1xuICAgICAgICAgIF90aGlzLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLiQoXCIuZmFjZWJvb2tfYnV0dG9uXCIpLmh0bWwoXCJTdWJtaXR0ZWQhXCIpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcyksXG4gICAgICBlcnJvcjogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihlcnJvcikge1xuICAgICAgICAgIF90aGlzLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLiQoXCIuZmFjZWJvb2tfYnV0dG9uXCIpLmh0bWwoXCIgWCBUcnkgQWdhaW4uLi5cIikucmVtb3ZlQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpXG4gICAgfSk7XG4gIH07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICBpZiAobW9kZWwucHJldmlvdXMoXCJzY2VuZVwiKSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHNjZW5lID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgY29uZ3JhdHNJbmRleDtcbiAgICBjb25ncmF0c0luZGV4ID0gKHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIikgPiBHYW1lT3ZlclNjZW5lLkNvbmdyYXRzLmxlbmd0aCA/IEdhbWVPdmVyU2NlbmUuQ29uZ3JhdHMubGVuZ3RoIC0gMSA6IHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIikgLSAxKTtcbiAgICB0aGlzLiRlbC5odG1sKGFueXlvbGsuSlNULmdhbWVfb3Zlcih7XG4gICAgICBzY29yZTogdGhpcy5tb2RlbC5nZXQoXCJzY29yZVwiKSxcbiAgICAgIGNvbmdyYXRzOiBHYW1lT3ZlclNjZW5lLkNvbmdyYXRzW2NvbmdyYXRzSW5kZXhdXG4gICAgfSkpO1xuICAgIHJldHVybiAkKFwiI3N0YWdlXCIpLmFwcGVuZCh0aGlzLiRlbCk7XG4gIH07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUucmVuZGVyUmVtb3ZlU2NlbmUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIuc3VtbWFyeVwiKS5hZGRDbGFzcyhcInJlbW92YWxcIik7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5jc3MoYW55eW9say5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlTWVudVwiKTtcbiAgICByZXR1cm4gdGhpcy4kKFwiLnN1bW1hcnlcIikuY3NzKGFueXlvbGsuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyYWlzZVNjb3Jlc1wiKTtcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5jbGVhblVwID0gZnVuY3Rpb24oZSkge1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcInNjZW5lXCIpICE9PSB0aGlzLnNjZW5lTmFtZSAmJiAkKGUudGFyZ2V0KS5oYXNDbGFzcyhcInN1bW1hcnlcIikpIHtcbiAgICAgIHJldHVybiB0aGlzLiRlbC5lbXB0eSgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gR2FtZU92ZXJTY2VuZTtcblxufSkoQmFja2JvbmUuVmlldyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLkdhbWVTY2VuZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEdhbWVTY2VuZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBHYW1lU2NlbmUoKSB7XG4gICAgdGhpcy5jbGVhblVwID0gX19iaW5kKHRoaXMuY2xlYW5VcCwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSA9IF9fYmluZCh0aGlzLnJlbmRlclJlbW92ZVNjZW5lLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckFkZEVnZyA9IF9fYmluZCh0aGlzLnJlbmRlckFkZEVnZywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJFZ2dzID0gX19iaW5kKHRoaXMucmVuZGVyRWdncywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJCYWNrQnV0dG9uID0gX19iaW5kKHRoaXMucmVuZGVyQmFja0J1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJMaXZlcyA9IF9fYmluZCh0aGlzLnJlbmRlckxpdmVzLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjb3JlID0gX19iaW5kKHRoaXMucmVuZGVyU2NvcmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyTGV2ZWxMYWJlbCA9IF9fYmluZCh0aGlzLnJlbmRlckxldmVsTGFiZWwsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyTGV2ZWwgPSBfX2JpbmQodGhpcy5yZW5kZXJMZXZlbCwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UgPSBfX2JpbmQodGhpcy5yZW5kZXJTY2VuZUNoYW5nZSwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVCYWNrQnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlQmFja0J1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgcmV0dXJuIEdhbWVTY2VuZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJnYW1lX3NjZW5lXCI7XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5zY2VuZU5hbWUgPSBcImdhbWVcIjtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLmV2ZW50cyA9IHtcbiAgICBhbmltYXRpb25lbmQ6IFwiY2xlYW5VcFwiLFxuICAgIHdlYmtpdEFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCIsXG4gICAgbW96QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIlxuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuZWdnVmlld3MgPSBbXTtcbiAgICB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrVXBPclRvdWNoKCksIFwiLmJhY2tfYnV0dG9uXCIsIHRoaXMuaGFuZGxlQmFja0J1dHRvbik7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzY2VuZVwiLCB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlKTtcbiAgICB0aGlzLm1vZGVsLmdldChcImVnZ0NvbGxlY3Rpb25cIikub24oXCJhZGRcIiwgdGhpcy5yZW5kZXJBZGRFZ2cpO1xuICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c2NvcmVcIiwgdGhpcy5yZW5kZXJTY29yZSk7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpsaXZlc1wiLCB0aGlzLnJlbmRlckxpdmVzKTtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOmxldmVsXCIsIHRoaXMucmVuZGVyTGV2ZWwpO1xuICAgIHJldHVybiB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOmxldmVsXCIsIHRoaXMucmVuZGVyTGV2ZWxMYWJlbCk7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5oYW5kbGVCYWNrQnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHJldHVybiB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwibWVudVwiKTtcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlclNjZW5lQ2hhbmdlID0gZnVuY3Rpb24obW9kZWwsIHNjZW5lKSB7XG4gICAgaWYgKG1vZGVsLnByZXZpb3VzKFwic2NlbmVcIikgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzY2VuZSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLnJlc2V0R2FtZURhdGEoKTtcbiAgICB0aGlzLiQoXCIjaHVkXCIpLnJlbW92ZSgpO1xuICAgIHRoaXMuJGVsLmFwcGVuZChcIjxkaXYgaWQ9J2h1ZCc+PC9kaXY+XCIpO1xuICAgIHRoaXMucmVuZGVyTGV2ZWwoKTtcbiAgICBzZXRUaW1lb3V0KCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLnJlbmRlckxldmVsTGFiZWwoKTtcbiAgICAgIH07XG4gICAgfSkodGhpcykpLCAxMjAwKTtcbiAgICB0aGlzLnJlbmRlclNjb3JlKCk7XG4gICAgdGhpcy5yZW5kZXJMaXZlcygpO1xuICAgIHRoaXMucmVuZGVyQmFja0J1dHRvbigpO1xuICAgIHRoaXMucmVuZGVyRWdncygpO1xuICAgIGlmICgkKFwiI3N0YWdlIC5cIiArIHRoaXMuY2xhc3NOYW1lKS5sZW5ndGggPD0gMCkge1xuICAgICAgJChcIiNzdGFnZVwiKS5hcHBlbmQodGhpcy4kZWwpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckxldmVsID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuJChcIiNnYW1lX2xldmVsXCIpLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuJChcIiNnYW1lX2xldmVsXCIpLnJlcGxhY2VXaXRoKGFueXlvbGsuSlNULmdhbWVfbGV2ZWwoe1xuICAgICAgICBsZXZlbDogdGhpcy5tb2RlbC5nZXQoXCJsZXZlbFwiKVxuICAgICAgfSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLiQoXCIjaHVkXCIpLmFwcGVuZChhbnl5b2xrLkpTVC5nYW1lX2xldmVsKHtcbiAgICAgICAgbGV2ZWw6IHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIilcbiAgICAgIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJMZXZlbExhYmVsID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuYXBwZW5kKFwiPHAgY2xhc3M9J2xldmVsX2xhYmVsJz5MRVZFTCBcIiArIHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIikgKyBcIjxicj5HRVQgUkVBRFkhPC9wPlwiKTtcbiAgICBzZXRUaW1lb3V0KCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLiQoXCIubGV2ZWxfbGFiZWxcIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSksIDMwMDApO1xuICAgIHNldFRpbWVvdXQoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMuJChcIi5sZXZlbF9sYWJlbFwiKS5yZW1vdmUoKTtcbiAgICAgIH07XG4gICAgfSkodGhpcykpLCAzMzAwKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlclNjb3JlID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuJChcIiNnYW1lX3Njb3JlXCIpLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuJChcIiNnYW1lX3Njb3JlXCIpLnJlcGxhY2VXaXRoKGFueXlvbGsuSlNULmdhbWVfc2NvcmUoe1xuICAgICAgICBzY29yZTogdGhpcy5tb2RlbC5nZXQoXCJzY29yZVwiKVxuICAgICAgfSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLiQoXCIjaHVkXCIpLmFwcGVuZChhbnl5b2xrLkpTVC5nYW1lX3Njb3JlKHtcbiAgICAgICAgc2NvcmU6IHRoaXMubW9kZWwuZ2V0KFwic2NvcmVcIilcbiAgICAgIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJMaXZlcyA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLiQoXCIjZ2FtZV9saXZlc1wiKS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLiQoXCIjZ2FtZV9saXZlc1wiKS5yZXBsYWNlV2l0aChhbnl5b2xrLkpTVC5nYW1lX2xpdmVzKHtcbiAgICAgICAgbGl2ZXM6IHRoaXMubW9kZWwuZ2V0KFwibGl2ZXNcIilcbiAgICAgIH0pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4kKFwiI2h1ZFwiKS5hcHBlbmQoYW55eW9say5KU1QuZ2FtZV9saXZlcyh7XG4gICAgICAgIGxpdmVzOiB0aGlzLm1vZGVsLmdldChcImxpdmVzXCIpXG4gICAgICB9KSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyQmFja0J1dHRvbiA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLiQoXCIuYmFja19idXR0b25cIikubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLnJlcGxhY2VXaXRoKFwiPGRpdiBjbGFzcz0nYmFja19idXR0b24nPlg8L2Rpdj5cIik7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuJGVsLmFwcGVuZChcIjxkaXYgY2xhc3M9J2JhY2tfYnV0dG9uJz5YPC9kaXY+XCIpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckVnZ3MgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLmFkZEVnZ3MoKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckFkZEVnZyA9IGZ1bmN0aW9uKGVnZ01vZGVsLCBjb2xsZWN0aW9uLCBvcHRpb25zKSB7XG4gICAgdmFyIGVnZ1ZpZXc7XG4gICAgZWdnVmlldyA9IG5ldyBhbnl5b2xrLkVnZ1ZpZXcoe1xuICAgICAgbW9kZWw6IGVnZ01vZGVsLFxuICAgICAgZ2FtZVN0YXRlOiB0aGlzLm1vZGVsLFxuICAgICAgc2NlbmU6IHRoaXMuJGVsXG4gICAgfSk7XG4gICAgZWdnVmlldy5yZW5kZXIoKTtcbiAgICB0aGlzLmVnZ1ZpZXdzLnB1c2goZWdnVmlldyk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5jc3MoYW55eW9say5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInhSYWlzZVwiKTtcbiAgICB0aGlzLiQoXCIjaHVkIHBcIikuY3NzKGFueXlvbGsuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyZW1vdmVIVURcIik7XG4gICAgdGhpcy4kKFwiLmVnZ1wiKS5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLWR1cmF0aW9uXCIsIFwiMC4zc1wiKTtcbiAgICBfLmVhY2godGhpcy5lZ2dWaWV3cywgKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oZWdnVmlldykge1xuICAgICAgICByZXR1cm4gZWdnVmlldy5yZW5kZXJSZW1vdmUoKTtcbiAgICAgIH07XG4gICAgfSkodGhpcykpO1xuICAgIHRoaXMubW9kZWwuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5yZXNldCgpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUuY2xlYW5VcCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJzY2VuZVwiKSAhPT0gdGhpcy5zY2VuZU5hbWUgJiYgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJiYWNrX2J1dHRvblwiKSkge1xuICAgICAgdGhpcy4kZWwuZW1wdHkoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIHJldHVybiBHYW1lU2NlbmU7XG5cbn0pKEJhY2tib25lLlZpZXcpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5HYW1lU3RhdGUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhHYW1lU3RhdGUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gR2FtZVN0YXRlKCkge1xuICAgIHRoaXMuZ2V0U2NvcmVTdWJtaXNzaW9uID0gX19iaW5kKHRoaXMuZ2V0U2NvcmVTdWJtaXNzaW9uLCB0aGlzKTtcbiAgICB0aGlzLnJlc2V0R2FtZURhdGEgPSBfX2JpbmQodGhpcy5yZXNldEdhbWVEYXRhLCB0aGlzKTtcbiAgICB0aGlzLmNsZWFuVXBFZ2cgPSBfX2JpbmQodGhpcy5jbGVhblVwRWdnLCB0aGlzKTtcbiAgICB0aGlzLmFkZEVnZ3MgPSBfX2JpbmQodGhpcy5hZGRFZ2dzLCB0aGlzKTtcbiAgICB0aGlzLnZhbGlkYXRlQWxpdmUgPSBfX2JpbmQodGhpcy52YWxpZGF0ZUFsaXZlLCB0aGlzKTtcbiAgICB0aGlzLmluY3JlbWVudExldmVsID0gX19iaW5kKHRoaXMuaW5jcmVtZW50TGV2ZWwsIHRoaXMpO1xuICAgIHRoaXMuZGVjcmVtZW50TGlmZSA9IF9fYmluZCh0aGlzLmRlY3JlbWVudExpZmUsIHRoaXMpO1xuICAgIHRoaXMuaW5jcmVtZW50U2NvcmUgPSBfX2JpbmQodGhpcy5pbmNyZW1lbnRTY29yZSwgdGhpcyk7XG4gICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgcmV0dXJuIEdhbWVTdGF0ZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIEdhbWVTdGF0ZS5EZWZhdWx0R2FtZURhdGEgPSB7XG4gICAgc2NvcmU6IDAsXG4gICAgbGl2ZXM6IDMsXG4gICAgbGV2ZWw6IDEsXG4gICAgc3BlZWRYOiAxXG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5kZWZhdWx0cyA9IHtcbiAgICBzY2VuZTogXCJcIixcbiAgICBlZ2dDb2xsZWN0aW9uOiBudWxsLFxuICAgIHNwZWVkWDogMVxuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBxdWVyeTtcbiAgICB0aGlzLnNldChcImVnZ0NvbGxlY3Rpb25cIiwgbmV3IEJhY2tib25lLkNvbGxlY3Rpb24oKSk7XG4gICAgcXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoXCJIaWdoU2NvcmVcIik7XG4gICAgcXVlcnkuZGVzY2VuZGluZyhcInNjb3JlXCIpO1xuICAgIHF1ZXJ5LmluY2x1ZGUoXCJwbGF5ZXJcIik7XG4gICAgcXVlcnkubGltaXQoMTApO1xuICAgIHRoaXMuc2V0KFwiaGlnaHNjb3JlQ29sbGVjdGlvblwiLCBxdWVyeS5jb2xsZWN0aW9uKCkpO1xuICAgIHRoaXMucmVzZXRHYW1lRGF0YSgpO1xuICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcImZseVwiLCB0aGlzLmluY3JlbWVudFNjb3JlKTtcbiAgICB0aGlzLmdldChcImVnZ0NvbGxlY3Rpb25cIikub24oXCJicmVha1wiLCB0aGlzLmRlY3JlbWVudExpZmUpO1xuICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcImZseSBicmVha1wiLCB0aGlzLmNsZWFuVXBFZ2cpO1xuICAgIHJldHVybiB0aGlzLmdldChcImVnZ0NvbGxlY3Rpb25cIikub24oXCJyZW1vdmVcIiwgdGhpcy5pbmNyZW1lbnRMZXZlbCk7XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5pbmNyZW1lbnRTY29yZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnNldChcInNjb3JlXCIsIHRoaXMuZ2V0KFwic2NvcmVcIikgKyAxKTtcbiAgfTtcblxuICBHYW1lU3RhdGUucHJvdG90eXBlLmRlY3JlbWVudExpZmUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldChcImxpdmVzXCIsIHRoaXMuZ2V0KFwibGl2ZXNcIikgLSAxKTtcbiAgICByZXR1cm4gdGhpcy52YWxpZGF0ZUFsaXZlKCk7XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5pbmNyZW1lbnRMZXZlbCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICh0aGlzLmdldChcImVnZ0NvbGxlY3Rpb25cIikubGVuZ3RoIDw9IDApIHtcbiAgICAgIHRoaXMuc2V0KFwibGV2ZWxcIiwgdGhpcy5nZXQoXCJsZXZlbFwiKSArIDEpO1xuICAgICAgdGhpcy5zZXQoXCJzcGVlZFhcIiwgdGhpcy5nZXQoXCJzcGVlZFhcIikgKyAwLjI1KTtcbiAgICAgIHJldHVybiB0aGlzLmFkZEVnZ3MoKTtcbiAgICB9XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS52YWxpZGF0ZUFsaXZlID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuZ2V0KFwibGl2ZXNcIikgPD0gMCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0KFwic2NlbmVcIiwgXCJnYW1lX292ZXJcIik7XG4gICAgfVxuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUuYWRkRWdncyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBpLCBudW1FZ2dzLCBfcmVzdWx0cztcbiAgICBudW1FZ2dzID0gMTA7XG4gICAgaSA9IDA7XG4gICAgX3Jlc3VsdHMgPSBbXTtcbiAgICB3aGlsZSAoaSA8IG51bUVnZ3MpIHtcbiAgICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5hZGQobmV3IGFueXlvbGsuRWdnTW9kZWwoe1xuICAgICAgICBjb2xsZWN0aW9uSW5kZXg6IGlcbiAgICAgIH0pKTtcbiAgICAgIF9yZXN1bHRzLnB1c2goaSsrKTtcbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUuY2xlYW5VcEVnZyA9IGZ1bmN0aW9uKGVnZ01vZGVsKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5yZW1vdmUoZWdnTW9kZWwpO1xuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUucmVzZXRHYW1lRGF0YSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnNldChhbnl5b2xrLkdhbWVTdGF0ZS5EZWZhdWx0R2FtZURhdGEpO1xuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUuZ2V0U2NvcmVTdWJtaXNzaW9uID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICgodGhpcy5nZXQoXCJsZXZlbFwiKSAqIDM2MikgPDwgNSkgKyBcIi5cIiArICgodGhpcy5nZXQoXCJzY29yZVwiKSAqIDY3MikgPDwgNCk7XG4gIH07XG5cbiAgcmV0dXJuIEdhbWVTdGF0ZTtcblxufSkoQmFja2JvbmUuTW9kZWwpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5IaWdoc2NvcmVTY2VuZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEhpZ2hzY29yZVNjZW5lLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIEhpZ2hzY29yZVNjZW5lKCkge1xuICAgIHRoaXMuY2xlYW5VcCA9IF9fYmluZCh0aGlzLmNsZWFuVXAsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUgPSBfX2JpbmQodGhpcy5yZW5kZXJSZW1vdmVTY2VuZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTY29yZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjb3JlLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjb3JlQ29sbGVjdGlvbiA9IF9fYmluZCh0aGlzLnJlbmRlclNjb3JlQ29sbGVjdGlvbiwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UgPSBfX2JpbmQodGhpcy5yZW5kZXJTY2VuZUNoYW5nZSwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVCYWNrQnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlQmFja0J1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgcmV0dXJuIEhpZ2hzY29yZVNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmNsYXNzTmFtZSA9IFwiaGlnaHNjb3JlX3NjZW5lXCI7XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwiaGlnaHNjb3JlXCI7XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmV2ZW50cyA9IHtcbiAgICBhbmltYXRpb25lbmQ6IFwiY2xlYW5VcFwiLFxuICAgIHdlYmtpdEFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCIsXG4gICAgbW96QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIlxuICB9O1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzY2VuZVwiLCB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlKTtcbiAgICB0aGlzLm1vZGVsLmdldChcImhpZ2hzY29yZUNvbGxlY3Rpb25cIikub24oXCJyZXNldFwiLCB0aGlzLnJlbmRlclNjb3JlQ29sbGVjdGlvbik7XG4gICAgdGhpcy4kZWwub24oYW55eW9say5jbGlja1VwT3JUb3VjaCgpLCBcIi5iYWNrX2J1dHRvblwiLCB0aGlzLmhhbmRsZUJhY2tCdXR0b24pO1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcImN1cnJlbnRTY2VuZVwiKSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlbmRlcigpO1xuICAgIH1cbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUuaGFuZGxlQmFja0J1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLiQoXCIuYmFja19idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwibWVudVwiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLnJlbmRlclNjZW5lQ2hhbmdlID0gZnVuY3Rpb24obW9kZWwsIHNjZW5lKSB7XG4gICAgaWYgKG1vZGVsLnByZXZpb3VzKFwic2NlbmVcIikgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzY2VuZSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoYW55eW9say5KU1QuaGlnaHNjb3JlKCkpO1xuICAgIHRoaXMubW9kZWwuZ2V0KFwiaGlnaHNjb3JlQ29sbGVjdGlvblwiKS5mZXRjaCgpO1xuICAgIHRoaXMuJChcIi5oaWdoc2NvcmVcIikuc3Bpbih7XG4gICAgICBsZW5ndGg6IDksXG4gICAgICByYWRpdXM6IDEwLFxuICAgICAgbGluZXM6IDEyLFxuICAgICAgd2lkdGg6IDQsXG4gICAgICBjb2xvcjogXCIjZmZmXCJcbiAgICB9KTtcbiAgICAkKFwiI3N0YWdlXCIpLmFwcGVuZCh0aGlzLiRlbCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLnJlbmRlclNjb3JlQ29sbGVjdGlvbiA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuZ2V0KFwiaGlnaHNjb3JlQ29sbGVjdGlvblwiKS5lYWNoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKHNjb3JlLCBpbmRleCkge1xuICAgICAgICByZXR1cm4gX3RoaXMucmVuZGVyU2NvcmUoc2NvcmUsIGluZGV4KTtcbiAgICAgIH07XG4gICAgfSkodGhpcykpO1xuICAgICQoXCIuaGlnaHNjb3JlIC5zcGlubmVyXCIpLnJlbW92ZSgpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJTY29yZSA9IGZ1bmN0aW9uKHNjb3JlLCBpbmRleCkge1xuICAgIHJldHVybiB0aGlzLiQoXCIjc2NvcmVfdGFibGUgdGJvZHlcIikuYXBwZW5kKGFueXlvbGsuSlNULnNjb3JlKHtcbiAgICAgIHNjb3JlOiBzY29yZSxcbiAgICAgIGluZGV4OiBpbmRleFxuICAgIH0pKTtcbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUucmVuZGVyUmVtb3ZlU2NlbmUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIuaGlnaHNjb3JlXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VNZW51XCIpO1xuICAgIHJldHVybiB0aGlzLiQoXCIuaGlnaHNjb3JlXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VTY29yZXNcIik7XG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwic2NlbmVcIikgIT09IHRoaXMuc2NlbmVOYW1lICYmICQoZS50YXJnZXQpLmhhc0NsYXNzKFwiaGlnaHNjb3JlXCIpKSB7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuZW1wdHkoKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIEhpZ2hzY29yZVNjZW5lO1xuXG59KShCYWNrYm9uZS5WaWV3KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuTWVudVNjZW5lID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoTWVudVNjZW5lLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIE1lbnVTY2VuZSgpIHtcbiAgICB0aGlzLmNsZWFuVXAgPSBfX2JpbmQodGhpcy5jbGVhblVwLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlID0gX19iaW5kKHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UsIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlQ3JlZGl0c0J1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZUNyZWRpdHNCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlSGlnaHNjb3JlQnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlSGlnaHNjb3JlQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZVBsYXlCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVQbGF5QnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gTWVudVNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5jbGFzc05hbWUgPSBcIm1lbnVfc2NlbmVcIjtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwibWVudVwiO1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgIFwiYW5pbWF0aW9uZW5kIC50aXRsZVwiOiBcImNsZWFuVXBcIixcbiAgICBcIndlYmtpdEFuaW1hdGlvbkVuZCAudGl0bGVcIjogXCJjbGVhblVwXCIsXG4gICAgXCJtb3pBbmltYXRpb25FbmQgLnRpdGxlXCI6IFwiY2xlYW5VcFwiXG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzY2VuZVwiLCB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlKTtcbiAgICB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrVXBPclRvdWNoKCksIFwiI3BsYXlfYnV0dG9uXCIsIHRoaXMuaGFuZGxlUGxheUJ1dHRvbik7XG4gICAgdGhpcy4kZWwub24oYW55eW9say5jbGlja1VwT3JUb3VjaCgpLCBcIiNoaWdoc2NvcmVfYnV0dG9uXCIsIHRoaXMuaGFuZGxlSGlnaHNjb3JlQnV0dG9uKTtcbiAgICB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrVXBPclRvdWNoKCksIFwiI2NyZWRpdHNfYnV0dG9uXCIsIHRoaXMuaGFuZGxlQ3JlZGl0c0J1dHRvbik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5oYW5kbGVQbGF5QnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwiZ2FtZVwiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5oYW5kbGVIaWdoc2NvcmVCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJoaWdoc2NvcmVcIik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUuaGFuZGxlQ3JlZGl0c0J1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcImNyZWRpdHNcIik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICBpZiAobW9kZWwucHJldmlvdXMoXCJzY2VuZVwiKSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHNjZW5lID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmh0bWwoYW55eW9say5KU1QubWVudSgpKTtcbiAgICAkKFwiI3N0YWdlXCIpLmFwcGVuZCh0aGlzLiRlbCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi50aXRsZVwiKS5yZW1vdmVDbGFzcyhcImRpc3BsYXlcIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi50aXRsZVwiKS5jc3MoYW55eW9say5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlVGl0bGVcIik7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5jc3MoYW55eW9say5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlTWVudVwiKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwic2NlbmVcIikgIT09IHRoaXMuc2NlbmVOYW1lICYmICQoZS50YXJnZXQpLmhhc0NsYXNzKFwidGl0bGVcIikpIHtcbiAgICAgIHRoaXMuJGVsLmVtcHR5KCk7XG4gICAgfVxuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICByZXR1cm4gTWVudVNjZW5lO1xuXG59KShCYWNrYm9uZS5WaWV3KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuU3RhZ2UgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhTdGFnZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBTdGFnZSgpIHtcbiAgICB0aGlzLnJlbmRlckNsb3VkcyA9IF9fYmluZCh0aGlzLnJlbmRlckNsb3VkcywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJUcmVlcyA9IF9fYmluZCh0aGlzLnJlbmRlclRyZWVzLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclN1biA9IF9fYmluZCh0aGlzLnJlbmRlclN1biwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJUaWxlcyA9IF9fYmluZCh0aGlzLnJlbmRlclRpbGVzLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlciA9IF9fYmluZCh0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgcmV0dXJuIFN0YWdlLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgU3RhZ2UucHJvdG90eXBlLmVsID0gXCIjc3RhZ2VcIjtcblxuICBTdGFnZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuY3NzKFwiaGVpZ2h0XCIsICQod2luZG93KS5oZWlnaHQoKSk7XG4gICAgdGhpcy5yZW5kZXJTdW4oKTtcbiAgICB0aGlzLnJlbmRlclRyZWVzKCk7XG4gICAgdGhpcy5yZW5kZXJUaWxlcygpO1xuICAgIHJldHVybiB0aGlzLnJlbmRlckNsb3VkcygpO1xuICB9O1xuXG4gIFN0YWdlLnByb3RvdHlwZS5yZW5kZXJUaWxlcyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi50aWxlXCIpLnJlbW92ZSgpO1xuICAgIHJldHVybiB0aGlzLiRlbC5hcHBlbmQoYW55eW9say5KU1QudGlsZV9wYWlyKCkpO1xuICB9O1xuXG4gIFN0YWdlLnByb3RvdHlwZS5yZW5kZXJTdW4gPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIuc3VuXCIpLnJlbW92ZSgpO1xuICAgIHJldHVybiB0aGlzLiRlbC5hcHBlbmQoYW55eW9say5KU1Quc3VuKCkpO1xuICB9O1xuXG4gIFN0YWdlLnByb3RvdHlwZS5yZW5kZXJUcmVlcyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBpLCBsZWZ0LCBudW1UcmVlcywgX3Jlc3VsdHM7XG4gICAgbnVtVHJlZXMgPSBNYXRoLmNlaWwoJCh3aW5kb3cpLndpZHRoKCkgLyAyMDApO1xuICAgIHRoaXMuJChcIi50cmVlXCIpLnJlbW92ZSgpO1xuICAgIGlmIChudW1UcmVlcyA8PSAyKSB7XG4gICAgICB0aGlzLiRlbC5hcHBlbmQoYW55eW9say5KU1QudHJlZSh7XG4gICAgICAgIHRyZWVOdW06IDMsXG4gICAgICAgIGxlZnRWYWx1ZTogLTEwMFxuICAgICAgfSkpO1xuICAgICAgcmV0dXJuIHRoaXMuJGVsLmFwcGVuZChhbnl5b2xrLkpTVC50cmVlKHtcbiAgICAgICAgdHJlZU51bTogMSxcbiAgICAgICAgbGVmdFZhbHVlOiAxMjBcbiAgICAgIH0pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaSA9IDA7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgd2hpbGUgKGkgPCBudW1UcmVlcykge1xuICAgICAgICBsZWZ0ID0gTWF0aC5yYW5kb20oKSAqIDIwMC4gKyBpICogMjAwO1xuICAgICAgICB0aGlzLiRlbC5hcHBlbmQoYW55eW9say5KU1QudHJlZSh7XG4gICAgICAgICAgdHJlZU51bTogLTEsXG4gICAgICAgICAgbGVmdFZhbHVlOiBsZWZ0IC0gMzAwXG4gICAgICAgIH0pKTtcbiAgICAgICAgX3Jlc3VsdHMucHVzaChpKyspO1xuICAgICAgfVxuICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgIH1cbiAgfTtcblxuICBTdGFnZS5wcm90b3R5cGUucmVuZGVyQ2xvdWRzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGksIG51bUNsb3VkcywgX3Jlc3VsdHM7XG4gICAgbnVtQ2xvdWRzID0gTWF0aC5jZWlsKCQod2luZG93KS53aWR0aCgpIC8gMjAwKTtcbiAgICBudW1DbG91ZHMgPSAobnVtQ2xvdWRzIDwgMiA/IDIgOiBudW1DbG91ZHMpO1xuICAgIGkgPSAwO1xuICAgIF9yZXN1bHRzID0gW107XG4gICAgd2hpbGUgKGkgPCBudW1DbG91ZHMpIHtcbiAgICAgIHRoaXMuJGVsLmFwcGVuZChhbnl5b2xrLkpTVC5jbG91ZCh7XG4gICAgICAgIGJwOiBhbnl5b2xrLmJwLFxuICAgICAgICBkZWxheTogTWF0aC5yYW5kb20oKSAqIDggLSA0ICsgKDEwICogaSksXG4gICAgICAgIGRpcmVjdGlvbjogTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgPCAxID8gXCJsZWZ0XCIgOiBcInJpZ2h0XCIsXG4gICAgICAgIGR1cmF0aW9uOiAkKHdpbmRvdykud2lkdGgoKSAvIDIwLFxuICAgICAgICB0b3BWYWx1ZTogTWF0aC5yYW5kb20oKSAqIDUwXG4gICAgICB9KSk7XG4gICAgICBfcmVzdWx0cy5wdXNoKGkrKyk7XG4gICAgfVxuICAgIHJldHVybiBfcmVzdWx0cztcbiAgfTtcblxuICByZXR1cm4gU3RhZ2U7XG5cbn0pKEJhY2tib25lLlZpZXcpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGs7XG5cbm1vZHVsZS5leHBvcnRzID0gYW55eW9sayA9IChmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gYW55eW9saygpIHt9XG5cbiAgYW55eW9say5KU1QgPSB7fTtcblxuICBhbnl5b2xrLnN0YXJ0ID0gZnVuY3Rpb24oUSwgaWQpIHtcbiAgICB2YXIgZ2V0cztcbiAgICBnZXRzID0gW107XG4gICAgWydjbG91ZCcsICdjcmVkaXRzJywgJ2VnZycsICdnYW1lX2xldmVsJywgJ2dhbWVfbGl2ZXMnLCAnZ2FtZV9vdmVyJywgJ2dhbWVfc2NvcmUnLCAnaGlnaHNjb3JlJywgJ21lbnUnLCAnc2NvcmUnLCAnc3VuJywgJ3RpbGVfcGFpcicsICd0cmVlJ10uZm9yRWFjaChmdW5jdGlvbihuYW1lKSB7XG4gICAgICByZXR1cm4gZ2V0cy5wdXNoKCQuZ2V0KFwidmlld3MvXCIgKyBuYW1lICsgXCIuaHRtbFwiLCBmdW5jdGlvbih0ZW1wbGF0ZSkge1xuICAgICAgICByZXR1cm4gYW55eW9say5KU1RbbmFtZV0gPSBfLnRlbXBsYXRlKFN0cmluZyh0ZW1wbGF0ZSkpO1xuICAgICAgfSkpO1xuICAgIH0pO1xuICAgIHJldHVybiBRLmFsbChnZXRzKS5kb25lKGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG1vZGVsO1xuICAgICAgbW9kZWwgPSBuZXcgYW55eW9say5HYW1lU3RhdGUoKTtcbiAgICAgIG5ldyBhbnl5b2xrLlN0YWdlKHtcbiAgICAgICAgbW9kZWw6IG1vZGVsXG4gICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIG5ldyBhbnl5b2xrLk1lbnVTY2VuZSh7XG4gICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgfSk7XG4gICAgICBuZXcgYW55eW9say5HYW1lU2NlbmUoe1xuICAgICAgICBtb2RlbDogbW9kZWxcbiAgICAgIH0pO1xuICAgICAgbmV3IGFueXlvbGsuR2FtZU92ZXJTY2VuZSh7XG4gICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgfSk7XG4gICAgICBuZXcgYW55eW9say5IaWdoc2NvcmVTY2VuZSh7XG4gICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgfSk7XG4gICAgICBuZXcgYW55eW9say5DcmVkaXRzU2NlbmUoe1xuICAgICAgICBtb2RlbDogbW9kZWxcbiAgICAgIH0pO1xuICAgICAgbW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICAgICAgJChpZCkub24oXCJkcmFnc3RhcnQgc2VsZWN0c3RhcnRcIiwgXCIqXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGRvY3VtZW50Lm9udG91Y2htb3ZlID0gZnVuY3Rpb24oZSkge1xuICAgICAgICByZXR1cm4gZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgfTtcbiAgICB9KTtcbiAgfTtcblxuICBhbnl5b2xrLmdldCA9IGZ1bmN0aW9uKG5hbWUpIHtcbiAgICByZXR1cm4gdGVtcGxhdGVzW25hbWVdO1xuICB9O1xuXG4gIGFueXlvbGsuYnAgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgYnA7XG4gICAgYnAgPSBcIlwiO1xuICAgIGJwID0gXCItd2Via2l0LVwiO1xuICAgIGlmICgkLmJyb3dzZXIgIT0gbnVsbCkge1xuICAgICAgaWYgKCQuYnJvd3Nlci53ZWJraXQpIHtcbiAgICAgICAgYnAgPSBcIi13ZWJraXQtXCI7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoJC5icm93c2VyLm1vemlsbGEpIHtcbiAgICAgICAgICBicCA9IFwiLW1vei1cIjtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gYnA7XG4gIH07XG5cbiAgYW55eW9say5pc1N1cHBvcnRlZCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICgkLmJyb3dzZXIgIT0gbnVsbCkge1xuICAgICAgcmV0dXJuICEoJC5icm93c2VyLm1zaWUgJiYgcGFyc2VJbnQoJC5icm93c2VyLnZlcnNpb24pIDwgMTApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdHJ1ZTtcbiAgICB9XG4gIH07XG5cbiAgYW55eW9say5uZXh0VGljayA9IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICByZXR1cm4gc2V0VGltZW91dChmdW5jLCAwKTtcbiAgfTtcblxuICBhbnl5b2xrLmNsaWNrVXBPclRvdWNoID0gZnVuY3Rpb24oZnVuYykge1xuICAgIGlmIChcIm9udG91Y2hzdGFydFwiIGluIHdpbmRvdykge1xuICAgICAgcmV0dXJuIFwidG91Y2hzdGFydFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gXCJtb3VzZXVwXCI7XG4gICAgfVxuICB9O1xuXG4gIGFueXlvbGsuY2xpY2tEb3duT3JUb3VjaCA9IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICBpZiAoXCJvbnRvdWNoc3RhcnRcIiBpbiB3aW5kb3cpIHtcbiAgICAgIHJldHVybiBcInRvdWNoc3RhcnRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwibW91c2Vkb3duXCI7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBhbnl5b2xrO1xuXG59KSgpO1xuXG5yZXF1aXJlKCcuL0dhbWVTdGF0ZScpO1xuXG5yZXF1aXJlKCcuL0VnZ01vZGVsJyk7XG5cbnJlcXVpcmUoJy4vRWdnVmlldycpO1xuXG5yZXF1aXJlKCcuL1N0YWdlJyk7XG5cbnJlcXVpcmUoJy4vTWVudVNjZW5lJyk7XG5cbnJlcXVpcmUoJy4vR2FtZVNjZW5lJyk7XG5cbnJlcXVpcmUoJy4vR2FtZU92ZXJTY2VuZScpO1xuXG5yZXF1aXJlKCcuL0hpZ2hzY29yZVNjZW5lJyk7XG5cbnJlcXVpcmUoJy4vQ3JlZGl0c1NjZW5lJyk7XG5cbiQucHJvdG90eXBlLnNwaW4gPSBmdW5jdGlvbihvcHRzKSB7XG4gIHRoaXMuZWFjaChmdW5jdGlvbigpIHtcbiAgICB2YXIgJHRoaXMsIGRhdGE7XG4gICAgJHRoaXMgPSAkKHRoaXMpO1xuICAgIGRhdGEgPSAkdGhpcy5kYXRhKCk7XG4gICAgaWYgKGRhdGEuc3Bpbm5lcikge1xuICAgICAgZGF0YS5zcGlubmVyLnN0b3AoKTtcbiAgICAgIGRlbGV0ZSBkYXRhLnNwaW5uZXI7XG4gICAgfVxuICAgIGlmIChvcHRzICE9PSBmYWxzZSkge1xuICAgICAgcmV0dXJuIGRhdGEuc3Bpbm5lciA9IG5ldyBTcGlubmVyKCQuZXh0ZW5kKHtcbiAgICAgICAgY29sb3I6ICR0aGlzLmNzcyhcImNvbG9yXCIpXG4gICAgICB9LCBvcHRzKSkuc3Bpbih0aGlzKTtcbiAgICB9XG4gIH0pO1xuICByZXR1cm4gdGhpcztcbn07XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG5QYXJzZS5pbml0aWFsaXplKFwiMFpVbjFUYURGOUczajZVaHZvTkZ1SVZTekY0NXZwU085SzBybG9zTVwiLCBcIm9VMVRvWjlMTlpvTXNscGhwZ3hRTm9WakpYRXFvaTU5TTAxOFpQMDhcIik7XG5cbndpbmRvdy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gUGFyc2UuRmFjZWJvb2tVdGlscy5pbml0KHtcbiAgICBhcHBJZDogXCIxMzgwMTAzMTgyMjUwNTIwXCIsXG4gICAgY2hhbm5lbFVybDogXCIvY2hhbm5lbC5odG1sXCIsXG4gICAgc3RhdHVzOiB0cnVlLFxuICAgIGNvb2tpZTogdHJ1ZSxcbiAgICB4ZmJtbDogdHJ1ZVxuICB9KTtcbn07XG5cbihmdW5jdGlvbihkLCBkZWJ1Zykge1xuICB2YXIgaWQsIGpzLCByZWY7XG4gIGpzID0gdm9pZCAwO1xuICBpZCA9IFwiZmFjZWJvb2stanNzZGtcIjtcbiAgcmVmID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKVswXTtcbiAgaWYgKGQuZ2V0RWxlbWVudEJ5SWQoaWQpKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGpzID0gZC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICBqcy5pZCA9IGlkO1xuICBqcy5hc3luYyA9IHRydWU7XG4gIGpzLnNyYyA9IFwiLy9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9hbGxcIiArIChkZWJ1ZyA/IFwiL2RlYnVnXCIgOiBcIlwiKSArIFwiLmpzXCI7XG4gIHJldHVybiByZWYucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoanMsIHJlZik7XG59KShkb2N1bWVudCwgZmFsc2UpO1xuXG4kKGZ1bmN0aW9uKCkge1xuICB2YXIgYW55eW9saztcbiAgYW55eW9sayA9IHJlcXVpcmUoJy4vYW55eW9saycpO1xuICBpZiAoYW55eW9say5pc1N1cHBvcnRlZCgpKSB7XG4gICAgcmV0dXJuIGFueXlvbGsuc3RhcnQoUSwgXCIjc3RhZ2VcIik7XG4gIH0gZWxzZSB7XG4gICAgcmV0dXJuICQoXCIjdW5zdXBwb3J0ZWRcIikuc2hvdygpO1xuICB9XG59KTtcbiJdfQ==
