(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.CreditsScene = (function(_super) {
  __extends(CreditsScene, _super);

  function CreditsScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return CreditsScene.__super__.constructor.apply(this, arguments);
  }

  CreditsScene.prototype.className = "credits_scene";

  CreditsScene.prototype.sceneName = "credits";

  CreditsScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  CreditsScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    return this.$el.on(anyyolk.clickUpOrTouch(), ".back_button", this.handleBackButton);
  };

  CreditsScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    this.model.set("scene", "menu");
    return false;
  };

  CreditsScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  CreditsScene.prototype.render = function() {
    this.$el.html(anyyolk.JST.credits());
    $("#stage").append(this.$el);
    return this;
  };

  CreditsScene.prototype.renderRemoveScene = function() {
    this.$(".credits").addClass("removal");
    this.$(".back_button").addClass("removal");
    this.$(".credits").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this.$(".back_button").css(anyyolk.bp() + "animation-name", "raiseMenu");
  };

  CreditsScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("credits")) {
      return this.$el.empty();
    }
  };

  return CreditsScene;

})(Backbone.View);

},{"../anyyolk":10}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.EggModel = (function(_super) {
  __extends(EggModel, _super);

  function EggModel() {
    this.eggHitGround = __bind(this.eggHitGround, this);
    this.isSafe = __bind(this.isSafe, this);
    this.nextSprite = __bind(this.nextSprite, this);
    return EggModel.__super__.constructor.apply(this, arguments);
  }

  EggModel.NumSprites = 5;

  EggModel.prototype.defaults = {
    spriteIndex: 1,
    collectionIndex: 0
  };

  EggModel.prototype.nextSprite = function() {
    this.set("spriteIndex", this.get("spriteIndex") + 1);
    if (this.isSafe()) {
      return this.trigger("fly", [this]);
    }
  };

  EggModel.prototype.isSafe = function() {
    return this.get("spriteIndex") >= EggModel.NumSprites;
  };

  EggModel.prototype.eggHitGround = function() {
    if (!this.isSafe()) {
      return this.trigger("break", [this]);
    }
  };

  return EggModel;

})(Backbone.Model);

},{"../anyyolk":10}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.EggView = (function(_super) {
  __extends(EggView, _super);

  function EggView() {
    this.handleTransitionEnded = __bind(this.handleTransitionEnded, this);
    this.renderRemove = __bind(this.renderRemove, this);
    this.renderFlying = __bind(this.renderFlying, this);
    this.renderHidding = __bind(this.renderHidding, this);
    this.renderBreaking = __bind(this.renderBreaking, this);
    this.renderSprites = __bind(this.renderSprites, this);
    this.render = __bind(this.render, this);
    this.nextSprite = __bind(this.nextSprite, this);
    this.initialize = __bind(this.initialize, this);
    return EggView.__super__.constructor.apply(this, arguments);
  }

  EggView.prototype.className = "egg";

  EggView.prototype.spriteClass = ".egg_sprite_";

  EggView.prototype.scene = null;

  EggView.prototype.events = {
    webkitTransitionEnd: "handleTransitionEnded",
    mozTransitionEnd: "handleTransitionEnded",
    transitionend: "handleTransitionEnded"
  };

  EggView.prototype.initialize = function() {
    this.scene = this.options.scene;
    this.gameState = this.options.gameState;
    this.$el.on(anyyolk.clickDownOrTouch(), this.nextSprite);
    this.model.on("change:spriteIndex", this.renderSprites);
    this.model.on("fly", this.renderFlying);
    return this.model.on("break", this.renderBreaking);
  };

  EggView.prototype.nextSprite = function() {
    if (!this.model.isSafe()) {
      this.model.nextSprite();
      return false;
    }
  };

  EggView.prototype.render = function() {
    var delay, intermission, left, speed, top;
    this.renderSprites();
    intermission = 3.5;
    delay = void 0;
    if (this.model.get("collectionIndex") === 1) {
      delay = intermission;
    } else {
      delay = (Math.random() * 6 + 3) / this.gameState.get("speedX") + (2 * this.model.get("collectionIndex")) + intermission;
    }
    speed = 100 * this.gameState.get("speedX") + Math.random() * 100 - 50;
    left = Math.random() * ($(window).width() - 100) + 30;
    top = $("#stage").height() - 220;
    this.$el.css(anyyolk.bp() + "transition-delay", delay + "s");
    this.$el.css(anyyolk.bp() + "transition-duration", $(window).height() / speed + "s");
    this.$el.css(anyyolk.bp() + "transition-property", "top opacity");
    this.$el.css(anyyolk.bp() + "transition-timing-function", "linear");
    this.$el.css("left", left + "px");
    this.scene.append(this.$el);
    return anyyolk.nextTick((function(_this) {
      return function() {
        return _this.$el.css("top", top + "px");
      };
    })(this));
  };

  EggView.prototype.renderSprites = function() {
    return this.$el.html(anyyolk.JST.egg({
      spriteIndex: this.model.get("spriteIndex")
    }));
  };

  EggView.prototype.renderBreaking = function() {
    this.$el.addClass("cracked").addClass("disabled");
    this.$el.css(anyyolk.bp() + "transition-delay", "0s");
    return this.$el.css(anyyolk.bp() + "transition-duration", "0.2s");
  };

  EggView.prototype.renderHidding = function() {
    this.$el.addClass("broken");
    this.$el.css(anyyolk.bp() + "transition-delay", "1s");
    this.$el.css(anyyolk.bp() + "transition-duration", "0.5s");
    this.$el.css(anyyolk.bp() + "transition-property", "opacity");
    this.$el.css(anyyolk.bp() + "transition-timing-function", "linear");
    return this.$el.css("opacity", 0);
  };

  EggView.prototype.renderFlying = function() {
    this.$el.addClass("flying");
    this.$el.css(anyyolk.bp() + "transition-delay", "0s");
    this.$el.css(anyyolk.bp() + "transition-duration", "1s");
    this.$el.css(anyyolk.bp() + "transition-property", "top");
    return this.$el.css(anyyolk.bp() + "transition-timing-function", "linear");
  };

  EggView.prototype.renderRemove = function() {
    return this.remove();
  };

  EggView.prototype.handleTransitionEnded = function(e) {
    if (e.originalEvent.propertyName === "opacity") {
      this.renderRemove();
    } else if (e.originalEvent.propertyName === "top") {
      this.model.eggHitGround();
    } else {
      if (e.originalEvent.propertyName === anyyolk.bp() + "transform" || "transform") {
        this.renderHidding();
      }
    }
    return false;
  };

  return EggView;

})(Backbone.View);

},{"../anyyolk":10}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameOverScene = (function(_super) {
  __extends(GameOverScene, _super);

  function GameOverScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.saveHighScore = __bind(this.saveHighScore, this);
    this.handleFacebookButton = __bind(this.handleFacebookButton, this);
    this.handleReplayButton = __bind(this.handleReplayButton, this);
    this.handleMenuButton = __bind(this.handleMenuButton, this);
    this.initialize = __bind(this.initialize, this);
    return GameOverScene.__super__.constructor.apply(this, arguments);
  }

  GameOverScene.Congrats = ["Not bad", "Good", "Great", "Fantastic", "Smashing!", "Amazing!", "Flying High", "Ridiculous!", "Extraordinary!", "Monstrous!!"];

  GameOverScene.prototype.className = "game_over_scene";

  GameOverScene.prototype.sceneName = "game_over";

  GameOverScene.prototype.submitted = false;

  GameOverScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  GameOverScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.$el.on(anyyolk.clickUpOrTouch(), ".menu_button", this.handleMenuButton);
    this.$el.on(anyyolk.clickUpOrTouch(), ".replay_button", this.handleReplayButton);
    return this.$el.on(anyyolk.clickUpOrTouch(), ".facebook_button", this.handleFacebookButton);
  };

  GameOverScene.prototype.handleMenuButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    return this.model.set("scene", "menu");
  };

  GameOverScene.prototype.handleReplayButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    return this.model.set("scene", "game");
  };

  GameOverScene.prototype.handleFacebookButton = function(e) {
    $(".fb_content").hide();
    $(".facebook_button").addClass("disabled").empty().spin({
      length: 5,
      radius: 5,
      lines: 8,
      width: 3,
      color: "#fff"
    });
    if (Parse.User.current()) {
      return this.saveHighScore();
    } else {
      return Parse.Facebookanyyolk.logIn(null, {
        success: (function(_this) {
          return function(user) {
            if (!user.existed()) {
              return FB.api("/me", function(response) {
                if (!response.error) {
                  user.set("displayName", response.name);
                  return user.save(null, {
                    success: function(user) {
                      return _this.saveHighScore();
                    },
                    error: function(user, error) {
                      return console.log("Oops, something went wrong saving your name.");
                    }
                  });
                } else {
                  return console.log("Oops something went wrong with facebook.");
                }
              });
            } else {
              return _this.saveHighScore();
            }
          };
        })(this),
        error: (function(_this) {
          return function(user, error) {
            return console.log("Oops, something went wrong.");
          };
        })(this)
      });
    }
  };

  GameOverScene.prototype.saveHighScore = function() {
    var submission;
    submission = {
      score: this.model.getScoreSubmission()
    };
    return Parse.Cloud.run("submitHighscore", submission, {
      success: (function(_this) {
        return function(result) {
          _this.submitted = true;
          return _this.$(".facebook_button").html("Submitted!");
        };
      })(this),
      error: (function(_this) {
        return function(error) {
          _this.submitted = true;
          return _this.$(".facebook_button").html(" X Try Again...").removeClass("disabled");
        };
      })(this)
    });
  };

  GameOverScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  GameOverScene.prototype.render = function() {
    var congratsIndex;
    congratsIndex = (this.model.get("level") > GameOverScene.Congrats.length ? GameOverScene.Congrats.length - 1 : this.model.get("level") - 1);
    this.$el.html(anyyolk.JST.game_over({
      score: this.model.get("score"),
      congrats: GameOverScene.Congrats[congratsIndex]
    }));
    return $("#stage").append(this.$el);
  };

  GameOverScene.prototype.renderRemoveScene = function() {
    this.$(".menu_item").addClass("removal");
    this.$(".summary").addClass("removal");
    this.$(".menu_item").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this.$(".summary").css(anyyolk.bp() + "animation-name", "raiseScores");
  };

  GameOverScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("summary")) {
      return this.$el.empty();
    }
  };

  return GameOverScene;

})(Backbone.View);

},{"../anyyolk":10}],5:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameScene = (function(_super) {
  __extends(GameScene, _super);

  function GameScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.renderAddEgg = __bind(this.renderAddEgg, this);
    this.renderEggs = __bind(this.renderEggs, this);
    this.renderBackButton = __bind(this.renderBackButton, this);
    this.renderLives = __bind(this.renderLives, this);
    this.renderScore = __bind(this.renderScore, this);
    this.renderLevelLabel = __bind(this.renderLevelLabel, this);
    this.renderLevel = __bind(this.renderLevel, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return GameScene.__super__.constructor.apply(this, arguments);
  }

  GameScene.prototype.className = "game_scene";

  GameScene.prototype.sceneName = "game";

  GameScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  GameScene.prototype.initialize = function() {
    this.eggViews = [];
    this.$el.on(anyyolk.clickUpOrTouch(), ".back_button", this.handleBackButton);
    this.model.on("change:scene", this.renderSceneChange);
    this.model.get("eggCollection").on("add", this.renderAddEgg);
    this.model.on("change:score", this.renderScore);
    this.model.on("change:lives", this.renderLives);
    this.model.on("change:level", this.renderLevel);
    return this.model.on("change:level", this.renderLevelLabel);
  };

  GameScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    return this.model.set("scene", "menu");
  };

  GameScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  GameScene.prototype.render = function() {
    this.model.resetGameData();
    this.$("#hud").remove();
    this.$el.append("<div id='hud'></div>");
    this.renderLevel();
    setTimeout(((function(_this) {
      return function() {
        return _this.renderLevelLabel();
      };
    })(this)), 1200);
    this.renderScore();
    this.renderLives();
    this.renderBackButton();
    this.renderEggs();
    if ($("#stage ." + this.className).length <= 0) {
      $("#stage").append(this.$el);
    }
    return this;
  };

  GameScene.prototype.renderLevel = function() {
    if (this.$("#game_level").length > 0) {
      this.$("#game_level").replaceWith(anyyolk.JST.game_level({
        level: this.model.get("level")
      }));
    } else {
      this.$("#hud").append(anyyolk.JST.game_level({
        level: this.model.get("level")
      }));
    }
    return this;
  };

  GameScene.prototype.renderLevelLabel = function() {
    this.$el.append("<p class='level_label'>LEVEL " + this.model.get("level") + "<br>GET READY!</p>");
    setTimeout(((function(_this) {
      return function() {
        return _this.$(".level_label").addClass("removal");
      };
    })(this)), 3000);
    setTimeout(((function(_this) {
      return function() {
        return _this.$(".level_label").remove();
      };
    })(this)), 3300);
    return this;
  };

  GameScene.prototype.renderScore = function() {
    if (this.$("#game_score").length > 0) {
      this.$("#game_score").replaceWith(anyyolk.JST.game_score({
        score: this.model.get("score")
      }));
    } else {
      this.$("#hud").append(anyyolk.JST.game_score({
        score: this.model.get("score")
      }));
    }
    return this;
  };

  GameScene.prototype.renderLives = function() {
    if (this.$("#game_lives").length > 0) {
      this.$("#game_lives").replaceWith(anyyolk.JST.game_lives({
        lives: this.model.get("lives")
      }));
    } else {
      this.$("#hud").append(anyyolk.JST.game_lives({
        lives: this.model.get("lives")
      }));
    }
    return this;
  };

  GameScene.prototype.renderBackButton = function() {
    if (this.$(".back_button").length > 0) {
      this.$(".back_button").replaceWith("<div class='back_button'>X</div>");
    } else {
      this.$el.append("<div class='back_button'>X</div>");
    }
    return this;
  };

  GameScene.prototype.renderEggs = function() {
    this.model.addEggs();
    return this;
  };

  GameScene.prototype.renderAddEgg = function(eggModel, collection, options) {
    var eggView;
    eggView = new anyyolk.EggView({
      model: eggModel,
      gameState: this.model,
      scene: this.$el
    });
    eggView.render();
    this.eggViews.push(eggView);
    return this;
  };

  GameScene.prototype.renderRemoveScene = function() {
    this.$(".back_button").css(anyyolk.bp() + "animation-name", "xRaise");
    this.$("#hud p").css(anyyolk.bp() + "animation-name", "removeHUD");
    this.$(".egg").css(anyyolk.bp() + "transition-duration", "0.3s");
    _.each(this.eggViews, (function(_this) {
      return function(eggView) {
        return eggView.renderRemove();
      };
    })(this));
    this.model.get("eggCollection").reset();
    return this;
  };

  GameScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("back_button")) {
      this.$el.empty();
    }
    return false;
  };

  return GameScene;

})(Backbone.View);

},{"../anyyolk":10}],6:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameState = (function(_super) {
  __extends(GameState, _super);

  function GameState() {
    this.getScoreSubmission = __bind(this.getScoreSubmission, this);
    this.resetGameData = __bind(this.resetGameData, this);
    this.cleanUpEgg = __bind(this.cleanUpEgg, this);
    this.addEggs = __bind(this.addEggs, this);
    this.validateAlive = __bind(this.validateAlive, this);
    this.incrementLevel = __bind(this.incrementLevel, this);
    this.decrementLife = __bind(this.decrementLife, this);
    this.incrementScore = __bind(this.incrementScore, this);
    this.initialize = __bind(this.initialize, this);
    return GameState.__super__.constructor.apply(this, arguments);
  }

  GameState.DefaultGameData = {
    score: 0,
    lives: 3,
    level: 1,
    speedX: 1
  };

  GameState.prototype.defaults = {
    scene: "",
    eggCollection: null,
    speedX: 1
  };

  GameState.prototype.initialize = function() {
    var query;
    this.set("eggCollection", new Backbone.Collection());
    query = new Parse.Query("HighScore");
    query.descending("score");
    query.include("player");
    query.limit(10);
    this.set("highscoreCollection", query.collection());
    this.resetGameData();
    this.get("eggCollection").on("fly", this.incrementScore);
    this.get("eggCollection").on("break", this.decrementLife);
    this.get("eggCollection").on("fly break", this.cleanUpEgg);
    return this.get("eggCollection").on("remove", this.incrementLevel);
  };

  GameState.prototype.incrementScore = function() {
    return this.set("score", this.get("score") + 1);
  };

  GameState.prototype.decrementLife = function() {
    this.set("lives", this.get("lives") - 1);
    return this.validateAlive();
  };

  GameState.prototype.incrementLevel = function() {
    if (this.get("eggCollection").length <= 0) {
      this.set("level", this.get("level") + 1);
      this.set("speedX", this.get("speedX") + 0.25);
      return this.addEggs();
    }
  };

  GameState.prototype.validateAlive = function() {
    if (this.get("lives") <= 0) {
      return this.set("scene", "game_over");
    }
  };

  GameState.prototype.addEggs = function() {
    var i, numEggs, _results;
    numEggs = 10;
    i = 0;
    _results = [];
    while (i < numEggs) {
      this.get("eggCollection").add(new anyyolk.EggModel({
        collectionIndex: i
      }));
      _results.push(i++);
    }
    return _results;
  };

  GameState.prototype.cleanUpEgg = function(eggModel) {
    return this.get("eggCollection").remove(eggModel);
  };

  GameState.prototype.resetGameData = function() {
    return this.set(anyyolk.GameState.DefaultGameData);
  };

  GameState.prototype.getScoreSubmission = function() {
    return ((this.get("level") * 362) << 5) + "." + ((this.get("score") * 672) << 4);
  };

  return GameState;

})(Backbone.Model);

},{"../anyyolk":10}],7:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.HighscoreScene = (function(_super) {
  __extends(HighscoreScene, _super);

  function HighscoreScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.renderScore = __bind(this.renderScore, this);
    this.renderScoreCollection = __bind(this.renderScoreCollection, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return HighscoreScene.__super__.constructor.apply(this, arguments);
  }

  HighscoreScene.prototype.className = "highscore_scene";

  HighscoreScene.prototype.sceneName = "highscore";

  HighscoreScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  HighscoreScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.model.get("highscoreCollection").on("reset", this.renderScoreCollection);
    this.$el.on(anyyolk.clickUpOrTouch(), ".back_button", this.handleBackButton);
    if (this.model.get("currentScene") === this.sceneName) {
      return this.render();
    }
  };

  HighscoreScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    this.model.set("scene", "menu");
    return false;
  };

  HighscoreScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  HighscoreScene.prototype.render = function() {
    this.$el.html(anyyolk.JST.highscore());
    this.model.get("highscoreCollection").fetch();
    this.$(".highscore").spin({
      length: 9,
      radius: 10,
      lines: 12,
      width: 4,
      color: "#fff"
    });
    $("#stage").append(this.$el);
    return this;
  };

  HighscoreScene.prototype.renderScoreCollection = function() {
    this.model.get("highscoreCollection").each((function(_this) {
      return function(score, index) {
        return _this.renderScore(score, index);
      };
    })(this));
    $(".highscore .spinner").remove();
    return this;
  };

  HighscoreScene.prototype.renderScore = function(score, index) {
    return this.$("#score_table tbody").append(anyyolk.JST.score({
      score: score,
      index: index
    }));
  };

  HighscoreScene.prototype.renderRemoveScene = function() {
    this.$(".menu_item").addClass("removal");
    this.$(".highscore").addClass("removal");
    this.$(".menu_item").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this.$(".highscore").css(anyyolk.bp() + "animation-name", "raiseScores");
  };

  HighscoreScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("highscore")) {
      return this.$el.empty();
    }
  };

  return HighscoreScene;

})(Backbone.View);

},{"../anyyolk":10}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.MenuScene = (function(_super) {
  __extends(MenuScene, _super);

  function MenuScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleCreditsButton = __bind(this.handleCreditsButton, this);
    this.handleHighscoreButton = __bind(this.handleHighscoreButton, this);
    this.handlePlayButton = __bind(this.handlePlayButton, this);
    this.initialize = __bind(this.initialize, this);
    return MenuScene.__super__.constructor.apply(this, arguments);
  }

  MenuScene.prototype.className = "menu_scene";

  MenuScene.prototype.sceneName = "menu";

  MenuScene.prototype.events = {
    "animationend .title": "cleanUp",
    "webkitAnimationEnd .title": "cleanUp",
    "mozAnimationEnd .title": "cleanUp"
  };

  MenuScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.$el.on(anyyolk.clickUpOrTouch(), "#play_button", this.handlePlayButton);
    this.$el.on(anyyolk.clickUpOrTouch(), "#highscore_button", this.handleHighscoreButton);
    this.$el.on(anyyolk.clickUpOrTouch(), "#credits_button", this.handleCreditsButton);
    return this;
  };

  MenuScene.prototype.handlePlayButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "game");
    return false;
  };

  MenuScene.prototype.handleHighscoreButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "highscore");
    return false;
  };

  MenuScene.prototype.handleCreditsButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "credits");
    return false;
  };

  MenuScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  MenuScene.prototype.render = function() {
    this.$el.html(anyyolk.JST.menu());
    $("#stage").append(this.$el);
    return this;
  };

  MenuScene.prototype.renderRemoveScene = function() {
    this.$(".title").removeClass("display").addClass("removal");
    this.$(".menu_item").addClass("removal");
    this.$(".title").css(anyyolk.bp() + "animation-name", "raiseTitle");
    this.$(".menu_item").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this;
  };

  MenuScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("title")) {
      this.$el.empty();
    }
    return false;
  };

  return MenuScene;

})(Backbone.View);

},{"../anyyolk":10}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.Stage = (function(_super) {
  __extends(Stage, _super);

  function Stage() {
    this.renderClouds = __bind(this.renderClouds, this);
    this.renderTrees = __bind(this.renderTrees, this);
    this.renderSun = __bind(this.renderSun, this);
    this.renderTiles = __bind(this.renderTiles, this);
    this.render = __bind(this.render, this);
    return Stage.__super__.constructor.apply(this, arguments);
  }

  Stage.prototype.el = "#stage";

  Stage.prototype.render = function() {
    this.$el.css("height", $(window).height());
    this.renderSun();
    this.renderTrees();
    this.renderTiles();
    return this.renderClouds();
  };

  Stage.prototype.renderTiles = function() {
    this.$(".tile").remove();
    return this.$el.append(anyyolk.JST.tile_pair());
  };

  Stage.prototype.renderSun = function() {
    this.$(".sun").remove();
    return this.$el.append(anyyolk.JST.sun());
  };

  Stage.prototype.renderTrees = function() {
    var i, left, numTrees, _results;
    numTrees = Math.ceil($(window).width() / 200);
    this.$(".tree").remove();
    if (numTrees <= 2) {
      this.$el.append(anyyolk.JST.tree({
        treeNum: 3,
        leftValue: -100
      }));
      return this.$el.append(anyyolk.JST.tree({
        treeNum: 1,
        leftValue: 120
      }));
    } else {
      i = 0;
      _results = [];
      while (i < numTrees) {
        left = Math.random() * 200. + i * 200;
        this.$el.append(anyyolk.JST.tree({
          treeNum: -1,
          leftValue: left - 300
        }));
        _results.push(i++);
      }
      return _results;
    }
  };

  Stage.prototype.renderClouds = function() {
    var i, numClouds, _results;
    numClouds = Math.ceil($(window).width() / 200);
    numClouds = (numClouds < 2 ? 2 : numClouds);
    i = 0;
    _results = [];
    while (i < numClouds) {
      this.$el.append(anyyolk.JST.cloud({
        bp: anyyolk.bp,
        delay: Math.random() * 8 - 4 + (10 * i),
        direction: Math.floor(Math.random() * 2) < 1 ? "left" : "right",
        duration: $(window).width() / 20,
        topValue: Math.random() * 50
      }));
      _results.push(i++);
    }
    return _results;
  };

  return Stage;

})(Backbone.View);

},{"../anyyolk":10}],10:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk;

module.exports = anyyolk = (function() {
  function anyyolk() {}

  anyyolk.start = function($next) {
    var deferreds, views;
    anyyolk.JST = {};
    deferreds = [];
    views = ['cloud', 'credits', 'egg', 'game_level', 'game_lives', 'game_over', 'game_score', 'highscore', 'menu', 'score', 'sun', 'tile_pair', 'tree'];
    $.each(views, (function(_this) {
      return function(index, name) {
        return deferreds.push($.get("views/" + name + ".html", function(template) {
          return anyyolk.JST[name] = _.template(String(template));
        }));
      };
    })(this));
    return $.when.apply(null, deferreds).done($next);
  };

  anyyolk.get = function(name) {
    return templates[name];
  };

  anyyolk.bp = function() {
    var bp;
    bp = "";
    if ($.browser.webkit) {
      bp = "-webkit-";
    } else {
      if ($.browser.mozilla) {
        bp = "-moz-";
      }
    }
    return bp;
  };

  anyyolk.isSupported = function() {
    return !($.browser.msie && parseInt($.browser.version) < 10);
  };

  anyyolk.nextTick = function(func) {
    return setTimeout(func, 0);
  };

  anyyolk.clickUpOrTouch = function(func) {
    if ("ontouchstart" in window) {
      return "touchstart";
    } else {
      return "mouseup";
    }
  };

  anyyolk.clickDownOrTouch = function(func) {
    if ("ontouchstart" in window) {
      return "touchstart";
    } else {
      return "mousedown";
    }
  };

  return anyyolk;

})();

require('./GameState');

require('./EggModel');

require('./EggView');

require('./Stage');

require('./MenuScene');

require('./GameScene');

require('./GameOverScene');

require('./HighscoreScene');

require('./CreditsScene');

$.prototype.spin = function(opts) {
  this.each(function() {
    var $this, data;
    $this = $(this);
    data = $this.data();
    if (data.spinner) {
      data.spinner.stop();
      delete data.spinner;
    }
    if (opts !== false) {
      return data.spinner = new Spinner($.extend({
        color: $this.css("color")
      }, opts)).spin(this);
    }
  });
  return this;
};

},{"./CreditsScene":1,"./EggModel":2,"./EggView":3,"./GameOverScene":4,"./GameScene":5,"./GameState":6,"./HighscoreScene":7,"./MenuScene":8,"./Stage":9}],11:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
Parse.initialize("0ZUn1TaDF9G3j6UhvoNFuIVSzF45vpSO9K0rlosM", "oU1ToZ9LNZoMslphpgxQNoVjJXEqoi59M018ZP08");

window.fbAsyncInit = function() {
  return Parse.FacebookUtils.init({
    appId: "1380103182250520",
    channelUrl: "/channel.html",
    status: true,
    cookie: true,
    xfbml: true
  });
};

(function(d, debug) {
  var id, js, ref;
  js = void 0;
  id = "facebook-jssdk";
  ref = d.getElementsByTagName("script")[0];
  if (d.getElementById(id)) {
    return;
  }
  js = d.createElement("script");
  js.id = id;
  js.async = true;
  js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
  return ref.parentNode.insertBefore(js, ref);
})(document, false);

$(function() {
  var anyyolk;
  anyyolk = require('./anyyolk');
  if (anyyolk.isSupported()) {
    return anyyolk.start(function() {
      var model;
      model = new anyyolk.GameState();
      new anyyolk.Stage({
        model: model
      }).render();
      new anyyolk.MenuScene({
        model: model
      });
      new anyyolk.GameScene({
        model: model
      });
      new anyyolk.GameOverScene({
        model: model
      });
      new anyyolk.HighscoreScene({
        model: model
      });
      new anyyolk.CreditsScene({
        model: model
      });
      model.set("scene", "menu");
      $("#stage").on("dragstart selectstart", "*", function(event) {
        return false;
      });
      return document.ontouchmove = function(e) {
        return e.preventDefault();
      };
    });
  } else {
    return $("#unsupported").show();
  }
});

},{"./anyyolk":10}]},{},[11])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3IvbG9jYWwvbGliL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9DcmVkaXRzU2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9FZ2dNb2RlbC5qcyIsIi9ob21lL2JydWNlL0dpdC9BbnlZb2xrL3RtcC9hbnl5b2xrL0VnZ1ZpZXcuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9HYW1lT3ZlclNjZW5lLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvR2FtZVNjZW5lLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvR2FtZVN0YXRlLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvSGlnaHNjb3JlU2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9NZW51U2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9TdGFnZS5qcyIsIi9ob21lL2JydWNlL0dpdC9BbnlZb2xrL3RtcC9hbnl5b2xrL2luZGV4LmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL21haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUMzRUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0NBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDL0hBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5SkE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzVMQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDMUdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzFGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDckdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLkNyZWRpdHNTY2VuZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKENyZWRpdHNTY2VuZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBDcmVkaXRzU2NlbmUoKSB7XG4gICAgdGhpcy5jbGVhblVwID0gX19iaW5kKHRoaXMuY2xlYW5VcCwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSA9IF9fYmluZCh0aGlzLnJlbmRlclJlbW92ZVNjZW5lLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlciA9IF9fYmluZCh0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjZW5lQ2hhbmdlLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUJhY2tCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVCYWNrQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gQ3JlZGl0c1NjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5jbGFzc05hbWUgPSBcImNyZWRpdHNfc2NlbmVcIjtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwiY3JlZGl0c1wiO1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgIGFuaW1hdGlvbmVuZDogXCJjbGVhblVwXCIsXG4gICAgd2Via2l0QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIixcbiAgICBtb3pBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiXG4gIH07XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzY2VuZVwiLCB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlKTtcbiAgICByZXR1cm4gdGhpcy4kZWwub24oYW55eW9say5jbGlja1VwT3JUb3VjaCgpLCBcIi5iYWNrX2J1dHRvblwiLCB0aGlzLmhhbmRsZUJhY2tCdXR0b24pO1xuICB9O1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUuaGFuZGxlQmFja0J1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLiQoXCIuYmFja19idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwibWVudVwiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5yZW5kZXJTY2VuZUNoYW5nZSA9IGZ1bmN0aW9uKG1vZGVsLCBzY2VuZSkge1xuICAgIGlmIChtb2RlbC5wcmV2aW91cyhcInNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoc2NlbmUgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbChhbnl5b2xrLkpTVC5jcmVkaXRzKCkpO1xuICAgICQoXCIjc3RhZ2VcIikuYXBwZW5kKHRoaXMuJGVsKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLnJlbmRlclJlbW92ZVNjZW5lID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKFwiLmNyZWRpdHNcIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5hZGRDbGFzcyhcInJlbW92YWxcIik7XG4gICAgdGhpcy4kKFwiLmNyZWRpdHNcIikuY3NzKGFueXlvbGsuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyYWlzZU1lbnVcIik7XG4gICAgcmV0dXJuIHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5jc3MoYW55eW9say5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlTWVudVwiKTtcbiAgfTtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwic2NlbmVcIikgIT09IHRoaXMuc2NlbmVOYW1lICYmICQoZS50YXJnZXQpLmhhc0NsYXNzKFwiY3JlZGl0c1wiKSkge1xuICAgICAgcmV0dXJuIHRoaXMuJGVsLmVtcHR5KCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBDcmVkaXRzU2NlbmU7XG5cbn0pKEJhY2tib25lLlZpZXcpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5FZ2dNb2RlbCA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEVnZ01vZGVsLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIEVnZ01vZGVsKCkge1xuICAgIHRoaXMuZWdnSGl0R3JvdW5kID0gX19iaW5kKHRoaXMuZWdnSGl0R3JvdW5kLCB0aGlzKTtcbiAgICB0aGlzLmlzU2FmZSA9IF9fYmluZCh0aGlzLmlzU2FmZSwgdGhpcyk7XG4gICAgdGhpcy5uZXh0U3ByaXRlID0gX19iaW5kKHRoaXMubmV4dFNwcml0ZSwgdGhpcyk7XG4gICAgcmV0dXJuIEVnZ01vZGVsLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgRWdnTW9kZWwuTnVtU3ByaXRlcyA9IDU7XG5cbiAgRWdnTW9kZWwucHJvdG90eXBlLmRlZmF1bHRzID0ge1xuICAgIHNwcml0ZUluZGV4OiAxLFxuICAgIGNvbGxlY3Rpb25JbmRleDogMFxuICB9O1xuXG4gIEVnZ01vZGVsLnByb3RvdHlwZS5uZXh0U3ByaXRlID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5zZXQoXCJzcHJpdGVJbmRleFwiLCB0aGlzLmdldChcInNwcml0ZUluZGV4XCIpICsgMSk7XG4gICAgaWYgKHRoaXMuaXNTYWZlKCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnRyaWdnZXIoXCJmbHlcIiwgW3RoaXNdKTtcbiAgICB9XG4gIH07XG5cbiAgRWdnTW9kZWwucHJvdG90eXBlLmlzU2FmZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLmdldChcInNwcml0ZUluZGV4XCIpID49IEVnZ01vZGVsLk51bVNwcml0ZXM7XG4gIH07XG5cbiAgRWdnTW9kZWwucHJvdG90eXBlLmVnZ0hpdEdyb3VuZCA9IGZ1bmN0aW9uKCkge1xuICAgIGlmICghdGhpcy5pc1NhZmUoKSkge1xuICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcihcImJyZWFrXCIsIFt0aGlzXSk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBFZ2dNb2RlbDtcblxufSkoQmFja2JvbmUuTW9kZWwpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5FZ2dWaWV3ID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoRWdnVmlldywgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBFZ2dWaWV3KCkge1xuICAgIHRoaXMuaGFuZGxlVHJhbnNpdGlvbkVuZGVkID0gX19iaW5kKHRoaXMuaGFuZGxlVHJhbnNpdGlvbkVuZGVkLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZSA9IF9fYmluZCh0aGlzLnJlbmRlclJlbW92ZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJGbHlpbmcgPSBfX2JpbmQodGhpcy5yZW5kZXJGbHlpbmcsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVySGlkZGluZyA9IF9fYmluZCh0aGlzLnJlbmRlckhpZGRpbmcsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyQnJlYWtpbmcgPSBfX2JpbmQodGhpcy5yZW5kZXJCcmVha2luZywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTcHJpdGVzID0gX19iaW5kKHRoaXMucmVuZGVyU3ByaXRlcywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMubmV4dFNwcml0ZSA9IF9fYmluZCh0aGlzLm5leHRTcHJpdGUsIHRoaXMpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IF9fYmluZCh0aGlzLmluaXRpYWxpemUsIHRoaXMpO1xuICAgIHJldHVybiBFZ2dWaWV3Ll9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgRWdnVmlldy5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJlZ2dcIjtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5zcHJpdGVDbGFzcyA9IFwiLmVnZ19zcHJpdGVfXCI7XG5cbiAgRWdnVmlldy5wcm90b3R5cGUuc2NlbmUgPSBudWxsO1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLmV2ZW50cyA9IHtcbiAgICB3ZWJraXRUcmFuc2l0aW9uRW5kOiBcImhhbmRsZVRyYW5zaXRpb25FbmRlZFwiLFxuICAgIG1velRyYW5zaXRpb25FbmQ6IFwiaGFuZGxlVHJhbnNpdGlvbkVuZGVkXCIsXG4gICAgdHJhbnNpdGlvbmVuZDogXCJoYW5kbGVUcmFuc2l0aW9uRW5kZWRcIlxuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNjZW5lID0gdGhpcy5vcHRpb25zLnNjZW5lO1xuICAgIHRoaXMuZ2FtZVN0YXRlID0gdGhpcy5vcHRpb25zLmdhbWVTdGF0ZTtcbiAgICB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrRG93bk9yVG91Y2goKSwgdGhpcy5uZXh0U3ByaXRlKTtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNwcml0ZUluZGV4XCIsIHRoaXMucmVuZGVyU3ByaXRlcyk7XG4gICAgdGhpcy5tb2RlbC5vbihcImZseVwiLCB0aGlzLnJlbmRlckZseWluZyk7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwub24oXCJicmVha1wiLCB0aGlzLnJlbmRlckJyZWFraW5nKTtcbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5uZXh0U3ByaXRlID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLm1vZGVsLmlzU2FmZSgpKSB7XG4gICAgICB0aGlzLm1vZGVsLm5leHRTcHJpdGUoKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGRlbGF5LCBpbnRlcm1pc3Npb24sIGxlZnQsIHNwZWVkLCB0b3A7XG4gICAgdGhpcy5yZW5kZXJTcHJpdGVzKCk7XG4gICAgaW50ZXJtaXNzaW9uID0gMy41O1xuICAgIGRlbGF5ID0gdm9pZCAwO1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcImNvbGxlY3Rpb25JbmRleFwiKSA9PT0gMSkge1xuICAgICAgZGVsYXkgPSBpbnRlcm1pc3Npb247XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGF5ID0gKE1hdGgucmFuZG9tKCkgKiA2ICsgMykgLyB0aGlzLmdhbWVTdGF0ZS5nZXQoXCJzcGVlZFhcIikgKyAoMiAqIHRoaXMubW9kZWwuZ2V0KFwiY29sbGVjdGlvbkluZGV4XCIpKSArIGludGVybWlzc2lvbjtcbiAgICB9XG4gICAgc3BlZWQgPSAxMDAgKiB0aGlzLmdhbWVTdGF0ZS5nZXQoXCJzcGVlZFhcIikgKyBNYXRoLnJhbmRvbSgpICogMTAwIC0gNTA7XG4gICAgbGVmdCA9IE1hdGgucmFuZG9tKCkgKiAoJCh3aW5kb3cpLndpZHRoKCkgLSAxMDApICsgMzA7XG4gICAgdG9wID0gJChcIiNzdGFnZVwiKS5oZWlnaHQoKSAtIDIyMDtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIGRlbGF5ICsgXCJzXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgJCh3aW5kb3cpLmhlaWdodCgpIC8gc3BlZWQgKyBcInNcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1wcm9wZXJ0eVwiLCBcInRvcCBvcGFjaXR5XCIpO1xuICAgIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uXCIsIFwibGluZWFyXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhcImxlZnRcIiwgbGVmdCArIFwicHhcIik7XG4gICAgdGhpcy5zY2VuZS5hcHBlbmQodGhpcy4kZWwpO1xuICAgIHJldHVybiBhbnl5b2xrLm5leHRUaWNrKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMuJGVsLmNzcyhcInRvcFwiLCB0b3AgKyBcInB4XCIpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gIH07XG5cbiAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVyU3ByaXRlcyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLiRlbC5odG1sKGFueXlvbGsuSlNULmVnZyh7XG4gICAgICBzcHJpdGVJbmRleDogdGhpcy5tb2RlbC5nZXQoXCJzcHJpdGVJbmRleFwiKVxuICAgIH0pKTtcbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5yZW5kZXJCcmVha2luZyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmFkZENsYXNzKFwiY3JhY2tlZFwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tZGVsYXlcIiwgXCIwc1wiKTtcbiAgICByZXR1cm4gdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1kdXJhdGlvblwiLCBcIjAuMnNcIik7XG4gIH07XG5cbiAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVySGlkZGluZyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmFkZENsYXNzKFwiYnJva2VuXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tZGVsYXlcIiwgXCIxc1wiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLWR1cmF0aW9uXCIsIFwiMC41c1wiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLXByb3BlcnR5XCIsIFwib3BhY2l0eVwiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvblwiLCBcImxpbmVhclwiKTtcbiAgICByZXR1cm4gdGhpcy4kZWwuY3NzKFwib3BhY2l0eVwiLCAwKTtcbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5yZW5kZXJGbHlpbmcgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImZseWluZ1wiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIFwiMHNcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1kdXJhdGlvblwiLCBcIjFzXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tcHJvcGVydHlcIiwgXCJ0b3BcIik7XG4gICAgcmV0dXJuIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uXCIsIFwibGluZWFyXCIpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlclJlbW92ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLnJlbW92ZSgpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLmhhbmRsZVRyYW5zaXRpb25FbmRlZCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAoZS5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZSA9PT0gXCJvcGFjaXR5XCIpIHtcbiAgICAgIHRoaXMucmVuZGVyUmVtb3ZlKCk7XG4gICAgfSBlbHNlIGlmIChlLm9yaWdpbmFsRXZlbnQucHJvcGVydHlOYW1lID09PSBcInRvcFwiKSB7XG4gICAgICB0aGlzLm1vZGVsLmVnZ0hpdEdyb3VuZCgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZSA9PT0gYW55eW9say5icCgpICsgXCJ0cmFuc2Zvcm1cIiB8fCBcInRyYW5zZm9ybVwiKSB7XG4gICAgICAgIHRoaXMucmVuZGVySGlkZGluZygpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIEVnZ1ZpZXc7XG5cbn0pKEJhY2tib25lLlZpZXcpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5HYW1lT3ZlclNjZW5lID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoR2FtZU92ZXJTY2VuZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBHYW1lT3ZlclNjZW5lKCkge1xuICAgIHRoaXMuY2xlYW5VcCA9IF9fYmluZCh0aGlzLmNsZWFuVXAsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUgPSBfX2JpbmQodGhpcy5yZW5kZXJSZW1vdmVTY2VuZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UgPSBfX2JpbmQodGhpcy5yZW5kZXJTY2VuZUNoYW5nZSwgdGhpcyk7XG4gICAgdGhpcy5zYXZlSGlnaFNjb3JlID0gX19iaW5kKHRoaXMuc2F2ZUhpZ2hTY29yZSwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVGYWNlYm9va0J1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZUZhY2Vib29rQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZVJlcGxheUJ1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZVJlcGxheUJ1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVNZW51QnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlTWVudUJ1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgcmV0dXJuIEdhbWVPdmVyU2NlbmUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICBHYW1lT3ZlclNjZW5lLkNvbmdyYXRzID0gW1wiTm90IGJhZFwiLCBcIkdvb2RcIiwgXCJHcmVhdFwiLCBcIkZhbnRhc3RpY1wiLCBcIlNtYXNoaW5nIVwiLCBcIkFtYXppbmchXCIsIFwiRmx5aW5nIEhpZ2hcIiwgXCJSaWRpY3Vsb3VzIVwiLCBcIkV4dHJhb3JkaW5hcnkhXCIsIFwiTW9uc3Ryb3VzISFcIl07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJnYW1lX292ZXJfc2NlbmVcIjtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5zY2VuZU5hbWUgPSBcImdhbWVfb3ZlclwiO1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLnN1Ym1pdHRlZCA9IGZhbHNlO1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmV2ZW50cyA9IHtcbiAgICBhbmltYXRpb25lbmQ6IFwiY2xlYW5VcFwiLFxuICAgIHdlYmtpdEFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCIsXG4gICAgbW96QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIlxuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNjZW5lXCIsIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UpO1xuICAgIHRoaXMuJGVsLm9uKGFueXlvbGsuY2xpY2tVcE9yVG91Y2goKSwgXCIubWVudV9idXR0b25cIiwgdGhpcy5oYW5kbGVNZW51QnV0dG9uKTtcbiAgICB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrVXBPclRvdWNoKCksIFwiLnJlcGxheV9idXR0b25cIiwgdGhpcy5oYW5kbGVSZXBsYXlCdXR0b24pO1xuICAgIHJldHVybiB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrVXBPclRvdWNoKCksIFwiLmZhY2Vib29rX2J1dHRvblwiLCB0aGlzLmhhbmRsZUZhY2Vib29rQnV0dG9uKTtcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5oYW5kbGVNZW51QnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICByZXR1cm4gdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcIm1lbnVcIik7XG4gIH07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuaGFuZGxlUmVwbGF5QnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICByZXR1cm4gdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcImdhbWVcIik7XG4gIH07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuaGFuZGxlRmFjZWJvb2tCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgJChcIi5mYl9jb250ZW50XCIpLmhpZGUoKTtcbiAgICAkKFwiLmZhY2Vib29rX2J1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpLmVtcHR5KCkuc3Bpbih7XG4gICAgICBsZW5ndGg6IDUsXG4gICAgICByYWRpdXM6IDUsXG4gICAgICBsaW5lczogOCxcbiAgICAgIHdpZHRoOiAzLFxuICAgICAgY29sb3I6IFwiI2ZmZlwiXG4gICAgfSk7XG4gICAgaWYgKFBhcnNlLlVzZXIuY3VycmVudCgpKSB7XG4gICAgICByZXR1cm4gdGhpcy5zYXZlSGlnaFNjb3JlKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBQYXJzZS5GYWNlYm9va2FueXlvbGsubG9nSW4obnVsbCwge1xuICAgICAgICBzdWNjZXNzOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgaWYgKCF1c2VyLmV4aXN0ZWQoKSkge1xuICAgICAgICAgICAgICByZXR1cm4gRkIuYXBpKFwiL21lXCIsIGZ1bmN0aW9uKHJlc3BvbnNlKSB7XG4gICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgdXNlci5zZXQoXCJkaXNwbGF5TmFtZVwiLCByZXNwb25zZS5uYW1lKTtcbiAgICAgICAgICAgICAgICAgIHJldHVybiB1c2VyLnNhdmUobnVsbCwge1xuICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIF90aGlzLnNhdmVIaWdoU2NvcmUoKTtcbiAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHVzZXIsIGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKFwiT29wcywgc29tZXRoaW5nIHdlbnQgd3Jvbmcgc2F2aW5nIHlvdXIgbmFtZS5cIik7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgICAgICByZXR1cm4gY29uc29sZS5sb2coXCJPb3BzIHNvbWV0aGluZyB3ZW50IHdyb25nIHdpdGggZmFjZWJvb2suXCIpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc2F2ZUhpZ2hTY29yZSgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpLFxuICAgICAgICBlcnJvcjogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKHVzZXIsIGVycm9yKSB7XG4gICAgICAgICAgICByZXR1cm4gY29uc29sZS5sb2coXCJPb3BzLCBzb21ldGhpbmcgd2VudCB3cm9uZy5cIik7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcylcbiAgICAgIH0pO1xuICAgIH1cbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5zYXZlSGlnaFNjb3JlID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHN1Ym1pc3Npb247XG4gICAgc3VibWlzc2lvbiA9IHtcbiAgICAgIHNjb3JlOiB0aGlzLm1vZGVsLmdldFNjb3JlU3VibWlzc2lvbigpXG4gICAgfTtcbiAgICByZXR1cm4gUGFyc2UuQ2xvdWQucnVuKFwic3VibWl0SGlnaHNjb3JlXCIsIHN1Ym1pc3Npb24sIHtcbiAgICAgIHN1Y2Nlc3M6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24ocmVzdWx0KSB7XG4gICAgICAgICAgX3RoaXMuc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuJChcIi5mYWNlYm9va19idXR0b25cIikuaHRtbChcIlN1Ym1pdHRlZCFcIik7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSxcbiAgICAgIGVycm9yOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVycm9yKSB7XG4gICAgICAgICAgX3RoaXMuc3VibWl0dGVkID0gdHJ1ZTtcbiAgICAgICAgICByZXR1cm4gX3RoaXMuJChcIi5mYWNlYm9va19idXR0b25cIikuaHRtbChcIiBYIFRyeSBBZ2Fpbi4uLlwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcylcbiAgICB9KTtcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5yZW5kZXJTY2VuZUNoYW5nZSA9IGZ1bmN0aW9uKG1vZGVsLCBzY2VuZSkge1xuICAgIGlmIChtb2RlbC5wcmV2aW91cyhcInNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoc2NlbmUgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBjb25ncmF0c0luZGV4O1xuICAgIGNvbmdyYXRzSW5kZXggPSAodGhpcy5tb2RlbC5nZXQoXCJsZXZlbFwiKSA+IEdhbWVPdmVyU2NlbmUuQ29uZ3JhdHMubGVuZ3RoID8gR2FtZU92ZXJTY2VuZS5Db25ncmF0cy5sZW5ndGggLSAxIDogdGhpcy5tb2RlbC5nZXQoXCJsZXZlbFwiKSAtIDEpO1xuICAgIHRoaXMuJGVsLmh0bWwoYW55eW9say5KU1QuZ2FtZV9vdmVyKHtcbiAgICAgIHNjb3JlOiB0aGlzLm1vZGVsLmdldChcInNjb3JlXCIpLFxuICAgICAgY29uZ3JhdHM6IEdhbWVPdmVyU2NlbmUuQ29uZ3JhdHNbY29uZ3JhdHNJbmRleF1cbiAgICB9KSk7XG4gICAgcmV0dXJuICQoXCIjc3RhZ2VcIikuYXBwZW5kKHRoaXMuJGVsKTtcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi5zdW1tYXJ5XCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VNZW51XCIpO1xuICAgIHJldHVybiB0aGlzLiQoXCIuc3VtbWFyeVwiKS5jc3MoYW55eW9say5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlU2NvcmVzXCIpO1xuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwic2NlbmVcIikgIT09IHRoaXMuc2NlbmVOYW1lICYmICQoZS50YXJnZXQpLmhhc0NsYXNzKFwic3VtbWFyeVwiKSkge1xuICAgICAgcmV0dXJuIHRoaXMuJGVsLmVtcHR5KCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBHYW1lT3ZlclNjZW5lO1xuXG59KShCYWNrYm9uZS5WaWV3KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuR2FtZVNjZW5lID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoR2FtZVNjZW5lLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIEdhbWVTY2VuZSgpIHtcbiAgICB0aGlzLmNsZWFuVXAgPSBfX2JpbmQodGhpcy5jbGVhblVwLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyQWRkRWdnID0gX19iaW5kKHRoaXMucmVuZGVyQWRkRWdnLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckVnZ3MgPSBfX2JpbmQodGhpcy5yZW5kZXJFZ2dzLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckJhY2tCdXR0b24gPSBfX2JpbmQodGhpcy5yZW5kZXJCYWNrQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckxpdmVzID0gX19iaW5kKHRoaXMucmVuZGVyTGl2ZXMsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NvcmUgPSBfX2JpbmQodGhpcy5yZW5kZXJTY29yZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJMZXZlbExhYmVsID0gX19iaW5kKHRoaXMucmVuZGVyTGV2ZWxMYWJlbCwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJMZXZlbCA9IF9fYmluZCh0aGlzLnJlbmRlckxldmVsLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlciA9IF9fYmluZCh0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjZW5lQ2hhbmdlLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUJhY2tCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVCYWNrQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gR2FtZVNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5jbGFzc05hbWUgPSBcImdhbWVfc2NlbmVcIjtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwiZ2FtZVwiO1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgIGFuaW1hdGlvbmVuZDogXCJjbGVhblVwXCIsXG4gICAgd2Via2l0QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIixcbiAgICBtb3pBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiXG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lZ2dWaWV3cyA9IFtdO1xuICAgIHRoaXMuJGVsLm9uKGFueXlvbGsuY2xpY2tVcE9yVG91Y2goKSwgXCIuYmFja19idXR0b25cIiwgdGhpcy5oYW5kbGVCYWNrQnV0dG9uKTtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNjZW5lXCIsIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UpO1xuICAgIHRoaXMubW9kZWwuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcImFkZFwiLCB0aGlzLnJlbmRlckFkZEVnZyk7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzY29yZVwiLCB0aGlzLnJlbmRlclNjb3JlKTtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOmxpdmVzXCIsIHRoaXMucmVuZGVyTGl2ZXMpO1xuICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6bGV2ZWxcIiwgdGhpcy5yZW5kZXJMZXZlbCk7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6bGV2ZWxcIiwgdGhpcy5yZW5kZXJMZXZlbExhYmVsKTtcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLmhhbmRsZUJhY2tCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICBpZiAobW9kZWwucHJldmlvdXMoXCJzY2VuZVwiKSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHNjZW5lID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwucmVzZXRHYW1lRGF0YSgpO1xuICAgIHRoaXMuJChcIiNodWRcIikucmVtb3ZlKCk7XG4gICAgdGhpcy4kZWwuYXBwZW5kKFwiPGRpdiBpZD0naHVkJz48L2Rpdj5cIik7XG4gICAgdGhpcy5yZW5kZXJMZXZlbCgpO1xuICAgIHNldFRpbWVvdXQoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMucmVuZGVyTGV2ZWxMYWJlbCgpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSksIDEyMDApO1xuICAgIHRoaXMucmVuZGVyU2NvcmUoKTtcbiAgICB0aGlzLnJlbmRlckxpdmVzKCk7XG4gICAgdGhpcy5yZW5kZXJCYWNrQnV0dG9uKCk7XG4gICAgdGhpcy5yZW5kZXJFZ2dzKCk7XG4gICAgaWYgKCQoXCIjc3RhZ2UgLlwiICsgdGhpcy5jbGFzc05hbWUpLmxlbmd0aCA8PSAwKSB7XG4gICAgICAkKFwiI3N0YWdlXCIpLmFwcGVuZCh0aGlzLiRlbCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyTGV2ZWwgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy4kKFwiI2dhbWVfbGV2ZWxcIikubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy4kKFwiI2dhbWVfbGV2ZWxcIikucmVwbGFjZVdpdGgoYW55eW9say5KU1QuZ2FtZV9sZXZlbCh7XG4gICAgICAgIGxldmVsOiB0aGlzLm1vZGVsLmdldChcImxldmVsXCIpXG4gICAgICB9KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuJChcIiNodWRcIikuYXBwZW5kKGFueXlvbGsuSlNULmdhbWVfbGV2ZWwoe1xuICAgICAgICBsZXZlbDogdGhpcy5tb2RlbC5nZXQoXCJsZXZlbFwiKVxuICAgICAgfSkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckxldmVsTGFiZWwgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5hcHBlbmQoXCI8cCBjbGFzcz0nbGV2ZWxfbGFiZWwnPkxFVkVMIFwiICsgdGhpcy5tb2RlbC5nZXQoXCJsZXZlbFwiKSArIFwiPGJyPkdFVCBSRUFEWSE8L3A+XCIpO1xuICAgIHNldFRpbWVvdXQoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMuJChcIi5sZXZlbF9sYWJlbFwiKS5hZGRDbGFzcyhcInJlbW92YWxcIik7XG4gICAgICB9O1xuICAgIH0pKHRoaXMpKSwgMzAwMCk7XG4gICAgc2V0VGltZW91dCgoKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgIHJldHVybiBfdGhpcy4kKFwiLmxldmVsX2xhYmVsXCIpLnJlbW92ZSgpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSksIDMzMDApO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NvcmUgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy4kKFwiI2dhbWVfc2NvcmVcIikubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy4kKFwiI2dhbWVfc2NvcmVcIikucmVwbGFjZVdpdGgoYW55eW9say5KU1QuZ2FtZV9zY29yZSh7XG4gICAgICAgIHNjb3JlOiB0aGlzLm1vZGVsLmdldChcInNjb3JlXCIpXG4gICAgICB9KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuJChcIiNodWRcIikuYXBwZW5kKGFueXlvbGsuSlNULmdhbWVfc2NvcmUoe1xuICAgICAgICBzY29yZTogdGhpcy5tb2RlbC5nZXQoXCJzY29yZVwiKVxuICAgICAgfSkpO1xuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckxpdmVzID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuJChcIiNnYW1lX2xpdmVzXCIpLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuJChcIiNnYW1lX2xpdmVzXCIpLnJlcGxhY2VXaXRoKGFueXlvbGsuSlNULmdhbWVfbGl2ZXMoe1xuICAgICAgICBsaXZlczogdGhpcy5tb2RlbC5nZXQoXCJsaXZlc1wiKVxuICAgICAgfSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLiQoXCIjaHVkXCIpLmFwcGVuZChhbnl5b2xrLkpTVC5nYW1lX2xpdmVzKHtcbiAgICAgICAgbGl2ZXM6IHRoaXMubW9kZWwuZ2V0KFwibGl2ZXNcIilcbiAgICAgIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJCYWNrQnV0dG9uID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLiQoXCIuYmFja19idXR0b25cIikucmVwbGFjZVdpdGgoXCI8ZGl2IGNsYXNzPSdiYWNrX2J1dHRvbic+WDwvZGl2PlwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4kZWwuYXBwZW5kKFwiPGRpdiBjbGFzcz0nYmFja19idXR0b24nPlg8L2Rpdj5cIik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyRWdncyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYWRkRWdncygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyQWRkRWdnID0gZnVuY3Rpb24oZWdnTW9kZWwsIGNvbGxlY3Rpb24sIG9wdGlvbnMpIHtcbiAgICB2YXIgZWdnVmlldztcbiAgICBlZ2dWaWV3ID0gbmV3IGFueXlvbGsuRWdnVmlldyh7XG4gICAgICBtb2RlbDogZWdnTW9kZWwsXG4gICAgICBnYW1lU3RhdGU6IHRoaXMubW9kZWwsXG4gICAgICBzY2VuZTogdGhpcy4kZWxcbiAgICB9KTtcbiAgICBlZ2dWaWV3LnJlbmRlcigpO1xuICAgIHRoaXMuZWdnVmlld3MucHVzaChlZ2dWaWV3KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlclJlbW92ZVNjZW5lID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwieFJhaXNlXCIpO1xuICAgIHRoaXMuJChcIiNodWQgcFwiKS5jc3MoYW55eW9say5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJlbW92ZUhVRFwiKTtcbiAgICB0aGlzLiQoXCIuZWdnXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgXCIwLjNzXCIpO1xuICAgIF8uZWFjaCh0aGlzLmVnZ1ZpZXdzLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbihlZ2dWaWV3KSB7XG4gICAgICAgIHJldHVybiBlZ2dWaWV3LnJlbmRlclJlbW92ZSgpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gICAgdGhpcy5tb2RlbC5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLnJlc2V0KCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5jbGVhblVwID0gZnVuY3Rpb24oZSkge1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcInNjZW5lXCIpICE9PSB0aGlzLnNjZW5lTmFtZSAmJiAkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImJhY2tfYnV0dG9uXCIpKSB7XG4gICAgICB0aGlzLiRlbC5lbXB0eSgpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIEdhbWVTY2VuZTtcblxufSkoQmFja2JvbmUuVmlldyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLkdhbWVTdGF0ZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEdhbWVTdGF0ZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBHYW1lU3RhdGUoKSB7XG4gICAgdGhpcy5nZXRTY29yZVN1Ym1pc3Npb24gPSBfX2JpbmQodGhpcy5nZXRTY29yZVN1Ym1pc3Npb24sIHRoaXMpO1xuICAgIHRoaXMucmVzZXRHYW1lRGF0YSA9IF9fYmluZCh0aGlzLnJlc2V0R2FtZURhdGEsIHRoaXMpO1xuICAgIHRoaXMuY2xlYW5VcEVnZyA9IF9fYmluZCh0aGlzLmNsZWFuVXBFZ2csIHRoaXMpO1xuICAgIHRoaXMuYWRkRWdncyA9IF9fYmluZCh0aGlzLmFkZEVnZ3MsIHRoaXMpO1xuICAgIHRoaXMudmFsaWRhdGVBbGl2ZSA9IF9fYmluZCh0aGlzLnZhbGlkYXRlQWxpdmUsIHRoaXMpO1xuICAgIHRoaXMuaW5jcmVtZW50TGV2ZWwgPSBfX2JpbmQodGhpcy5pbmNyZW1lbnRMZXZlbCwgdGhpcyk7XG4gICAgdGhpcy5kZWNyZW1lbnRMaWZlID0gX19iaW5kKHRoaXMuZGVjcmVtZW50TGlmZSwgdGhpcyk7XG4gICAgdGhpcy5pbmNyZW1lbnRTY29yZSA9IF9fYmluZCh0aGlzLmluY3JlbWVudFNjb3JlLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gR2FtZVN0YXRlLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgR2FtZVN0YXRlLkRlZmF1bHRHYW1lRGF0YSA9IHtcbiAgICBzY29yZTogMCxcbiAgICBsaXZlczogMyxcbiAgICBsZXZlbDogMSxcbiAgICBzcGVlZFg6IDFcbiAgfTtcblxuICBHYW1lU3RhdGUucHJvdG90eXBlLmRlZmF1bHRzID0ge1xuICAgIHNjZW5lOiBcIlwiLFxuICAgIGVnZ0NvbGxlY3Rpb246IG51bGwsXG4gICAgc3BlZWRYOiAxXG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHF1ZXJ5O1xuICAgIHRoaXMuc2V0KFwiZWdnQ29sbGVjdGlvblwiLCBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbigpKTtcbiAgICBxdWVyeSA9IG5ldyBQYXJzZS5RdWVyeShcIkhpZ2hTY29yZVwiKTtcbiAgICBxdWVyeS5kZXNjZW5kaW5nKFwic2NvcmVcIik7XG4gICAgcXVlcnkuaW5jbHVkZShcInBsYXllclwiKTtcbiAgICBxdWVyeS5saW1pdCgxMCk7XG4gICAgdGhpcy5zZXQoXCJoaWdoc2NvcmVDb2xsZWN0aW9uXCIsIHF1ZXJ5LmNvbGxlY3Rpb24oKSk7XG4gICAgdGhpcy5yZXNldEdhbWVEYXRhKCk7XG4gICAgdGhpcy5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLm9uKFwiZmx5XCIsIHRoaXMuaW5jcmVtZW50U2NvcmUpO1xuICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcImJyZWFrXCIsIHRoaXMuZGVjcmVtZW50TGlmZSk7XG4gICAgdGhpcy5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLm9uKFwiZmx5IGJyZWFrXCIsIHRoaXMuY2xlYW5VcEVnZyk7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcInJlbW92ZVwiLCB0aGlzLmluY3JlbWVudExldmVsKTtcbiAgfTtcblxuICBHYW1lU3RhdGUucHJvdG90eXBlLmluY3JlbWVudFNjb3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc2V0KFwic2NvcmVcIiwgdGhpcy5nZXQoXCJzY29yZVwiKSArIDEpO1xuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUuZGVjcmVtZW50TGlmZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0KFwibGl2ZXNcIiwgdGhpcy5nZXQoXCJsaXZlc1wiKSAtIDEpO1xuICAgIHJldHVybiB0aGlzLnZhbGlkYXRlQWxpdmUoKTtcbiAgfTtcblxuICBHYW1lU3RhdGUucHJvdG90eXBlLmluY3JlbWVudExldmVsID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5sZW5ndGggPD0gMCkge1xuICAgICAgdGhpcy5zZXQoXCJsZXZlbFwiLCB0aGlzLmdldChcImxldmVsXCIpICsgMSk7XG4gICAgICB0aGlzLnNldChcInNwZWVkWFwiLCB0aGlzLmdldChcInNwZWVkWFwiKSArIDAuMjUpO1xuICAgICAgcmV0dXJuIHRoaXMuYWRkRWdncygpO1xuICAgIH1cbiAgfTtcblxuICBHYW1lU3RhdGUucHJvdG90eXBlLnZhbGlkYXRlQWxpdmUgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5nZXQoXCJsaXZlc1wiKSA8PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXQoXCJzY2VuZVwiLCBcImdhbWVfb3ZlclwiKTtcbiAgICB9XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5hZGRFZ2dzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGksIG51bUVnZ3MsIF9yZXN1bHRzO1xuICAgIG51bUVnZ3MgPSAxMDtcbiAgICBpID0gMDtcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIHdoaWxlIChpIDwgbnVtRWdncykge1xuICAgICAgdGhpcy5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLmFkZChuZXcgYW55eW9say5FZ2dNb2RlbCh7XG4gICAgICAgIGNvbGxlY3Rpb25JbmRleDogaVxuICAgICAgfSkpO1xuICAgICAgX3Jlc3VsdHMucHVzaChpKyspO1xuICAgIH1cbiAgICByZXR1cm4gX3Jlc3VsdHM7XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5jbGVhblVwRWdnID0gZnVuY3Rpb24oZWdnTW9kZWwpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLnJlbW92ZShlZ2dNb2RlbCk7XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5yZXNldEdhbWVEYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc2V0KGFueXlvbGsuR2FtZVN0YXRlLkRlZmF1bHRHYW1lRGF0YSk7XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5nZXRTY29yZVN1Ym1pc3Npb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKCh0aGlzLmdldChcImxldmVsXCIpICogMzYyKSA8PCA1KSArIFwiLlwiICsgKCh0aGlzLmdldChcInNjb3JlXCIpICogNjcyKSA8PCA0KTtcbiAgfTtcblxuICByZXR1cm4gR2FtZVN0YXRlO1xuXG59KShCYWNrYm9uZS5Nb2RlbCk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLkhpZ2hzY29yZVNjZW5lID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoSGlnaHNjb3JlU2NlbmUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gSGlnaHNjb3JlU2NlbmUoKSB7XG4gICAgdGhpcy5jbGVhblVwID0gX19iaW5kKHRoaXMuY2xlYW5VcCwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSA9IF9fYmluZCh0aGlzLnJlbmRlclJlbW92ZVNjZW5lLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjb3JlID0gX19iaW5kKHRoaXMucmVuZGVyU2NvcmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NvcmVDb2xsZWN0aW9uID0gX19iaW5kKHRoaXMucmVuZGVyU2NvcmVDb2xsZWN0aW9uLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlciA9IF9fYmluZCh0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjZW5lQ2hhbmdlLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUJhY2tCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVCYWNrQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gSGlnaHNjb3JlU2NlbmUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJoaWdoc2NvcmVfc2NlbmVcIjtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUuc2NlbmVOYW1lID0gXCJoaWdoc2NvcmVcIjtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgIGFuaW1hdGlvbmVuZDogXCJjbGVhblVwXCIsXG4gICAgd2Via2l0QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIixcbiAgICBtb3pBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiXG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNjZW5lXCIsIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UpO1xuICAgIHRoaXMubW9kZWwuZ2V0KFwiaGlnaHNjb3JlQ29sbGVjdGlvblwiKS5vbihcInJlc2V0XCIsIHRoaXMucmVuZGVyU2NvcmVDb2xsZWN0aW9uKTtcbiAgICB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrVXBPclRvdWNoKCksIFwiLmJhY2tfYnV0dG9uXCIsIHRoaXMuaGFuZGxlQmFja0J1dHRvbik7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwiY3VycmVudFNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgcmV0dXJuIHRoaXMucmVuZGVyKCk7XG4gICAgfVxuICB9O1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5oYW5kbGVCYWNrQnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICBpZiAobW9kZWwucHJldmlvdXMoXCJzY2VuZVwiKSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHNjZW5lID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbChhbnl5b2xrLkpTVC5oaWdoc2NvcmUoKSk7XG4gICAgdGhpcy5tb2RlbC5nZXQoXCJoaWdoc2NvcmVDb2xsZWN0aW9uXCIpLmZldGNoKCk7XG4gICAgdGhpcy4kKFwiLmhpZ2hzY29yZVwiKS5zcGluKHtcbiAgICAgIGxlbmd0aDogOSxcbiAgICAgIHJhZGl1czogMTAsXG4gICAgICBsaW5lczogMTIsXG4gICAgICB3aWR0aDogNCxcbiAgICAgIGNvbG9yOiBcIiNmZmZcIlxuICAgIH0pO1xuICAgICQoXCIjc3RhZ2VcIikuYXBwZW5kKHRoaXMuJGVsKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NvcmVDb2xsZWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5nZXQoXCJoaWdoc2NvcmVDb2xsZWN0aW9uXCIpLmVhY2goKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcmUsIGluZGV4KSB7XG4gICAgICAgIHJldHVybiBfdGhpcy5yZW5kZXJTY29yZShzY29yZSwgaW5kZXgpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gICAgJChcIi5oaWdoc2NvcmUgLnNwaW5uZXJcIikucmVtb3ZlKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLnJlbmRlclNjb3JlID0gZnVuY3Rpb24oc2NvcmUsIGluZGV4KSB7XG4gICAgcmV0dXJuIHRoaXMuJChcIiNzY29yZV90YWJsZSB0Ym9keVwiKS5hcHBlbmQoYW55eW9say5KU1Quc2NvcmUoe1xuICAgICAgc2NvcmU6IHNjb3JlLFxuICAgICAgaW5kZXg6IGluZGV4XG4gICAgfSkpO1xuICB9O1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi5oaWdoc2NvcmVcIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuY3NzKGFueXlvbGsuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyYWlzZU1lbnVcIik7XG4gICAgcmV0dXJuIHRoaXMuJChcIi5oaWdoc2NvcmVcIikuY3NzKGFueXlvbGsuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyYWlzZVNjb3Jlc1wiKTtcbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUuY2xlYW5VcCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJzY2VuZVwiKSAhPT0gdGhpcy5zY2VuZU5hbWUgJiYgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJoaWdoc2NvcmVcIikpIHtcbiAgICAgIHJldHVybiB0aGlzLiRlbC5lbXB0eSgpO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gSGlnaHNjb3JlU2NlbmU7XG5cbn0pKEJhY2tib25lLlZpZXcpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5NZW51U2NlbmUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhNZW51U2NlbmUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gTWVudVNjZW5lKCkge1xuICAgIHRoaXMuY2xlYW5VcCA9IF9fYmluZCh0aGlzLmNsZWFuVXAsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUgPSBfX2JpbmQodGhpcy5yZW5kZXJSZW1vdmVTY2VuZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UgPSBfX2JpbmQodGhpcy5yZW5kZXJTY2VuZUNoYW5nZSwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVDcmVkaXRzQnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlQ3JlZGl0c0J1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVIaWdoc2NvcmVCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVIaWdoc2NvcmVCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlUGxheUJ1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZVBsYXlCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IF9fYmluZCh0aGlzLmluaXRpYWxpemUsIHRoaXMpO1xuICAgIHJldHVybiBNZW51U2NlbmUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICBNZW51U2NlbmUucHJvdG90eXBlLmNsYXNzTmFtZSA9IFwibWVudV9zY2VuZVwiO1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUuc2NlbmVOYW1lID0gXCJtZW51XCI7XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5ldmVudHMgPSB7XG4gICAgXCJhbmltYXRpb25lbmQgLnRpdGxlXCI6IFwiY2xlYW5VcFwiLFxuICAgIFwid2Via2l0QW5pbWF0aW9uRW5kIC50aXRsZVwiOiBcImNsZWFuVXBcIixcbiAgICBcIm1vekFuaW1hdGlvbkVuZCAudGl0bGVcIjogXCJjbGVhblVwXCJcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNjZW5lXCIsIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UpO1xuICAgIHRoaXMuJGVsLm9uKGFueXlvbGsuY2xpY2tVcE9yVG91Y2goKSwgXCIjcGxheV9idXR0b25cIiwgdGhpcy5oYW5kbGVQbGF5QnV0dG9uKTtcbiAgICB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrVXBPclRvdWNoKCksIFwiI2hpZ2hzY29yZV9idXR0b25cIiwgdGhpcy5oYW5kbGVIaWdoc2NvcmVCdXR0b24pO1xuICAgIHRoaXMuJGVsLm9uKGFueXlvbGsuY2xpY2tVcE9yVG91Y2goKSwgXCIjY3JlZGl0c19idXR0b25cIiwgdGhpcy5oYW5kbGVDcmVkaXRzQnV0dG9uKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLmhhbmRsZVBsYXlCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJnYW1lXCIpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLmhhbmRsZUhpZ2hzY29yZUJ1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcImhpZ2hzY29yZVwiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5oYW5kbGVDcmVkaXRzQnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwiY3JlZGl0c1wiKTtcbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5yZW5kZXJTY2VuZUNoYW5nZSA9IGZ1bmN0aW9uKG1vZGVsLCBzY2VuZSkge1xuICAgIGlmIChtb2RlbC5wcmV2aW91cyhcInNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoc2NlbmUgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuaHRtbChhbnl5b2xrLkpTVC5tZW51KCkpO1xuICAgICQoXCIjc3RhZ2VcIikuYXBwZW5kKHRoaXMuJGVsKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLnJlbmRlclJlbW92ZVNjZW5lID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKFwiLnRpdGxlXCIpLnJlbW92ZUNsYXNzKFwiZGlzcGxheVwiKS5hZGRDbGFzcyhcInJlbW92YWxcIik7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcInJlbW92YWxcIik7XG4gICAgdGhpcy4kKFwiLnRpdGxlXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VUaXRsZVwiKTtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VNZW51XCIpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUuY2xlYW5VcCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJzY2VuZVwiKSAhPT0gdGhpcy5zY2VuZU5hbWUgJiYgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJ0aXRsZVwiKSkge1xuICAgICAgdGhpcy4kZWwuZW1wdHkoKTtcbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIHJldHVybiBNZW51U2NlbmU7XG5cbn0pKEJhY2tib25lLlZpZXcpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5TdGFnZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKFN0YWdlLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIFN0YWdlKCkge1xuICAgIHRoaXMucmVuZGVyQ2xvdWRzID0gX19iaW5kKHRoaXMucmVuZGVyQ2xvdWRzLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclRyZWVzID0gX19iaW5kKHRoaXMucmVuZGVyVHJlZXMsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU3VuID0gX19iaW5kKHRoaXMucmVuZGVyU3VuLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclRpbGVzID0gX19iaW5kKHRoaXMucmVuZGVyVGlsZXMsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICByZXR1cm4gU3RhZ2UuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICBTdGFnZS5wcm90b3R5cGUuZWwgPSBcIiNzdGFnZVwiO1xuXG4gIFN0YWdlLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5jc3MoXCJoZWlnaHRcIiwgJCh3aW5kb3cpLmhlaWdodCgpKTtcbiAgICB0aGlzLnJlbmRlclN1bigpO1xuICAgIHRoaXMucmVuZGVyVHJlZXMoKTtcbiAgICB0aGlzLnJlbmRlclRpbGVzKCk7XG4gICAgcmV0dXJuIHRoaXMucmVuZGVyQ2xvdWRzKCk7XG4gIH07XG5cbiAgU3RhZ2UucHJvdG90eXBlLnJlbmRlclRpbGVzID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKFwiLnRpbGVcIikucmVtb3ZlKCk7XG4gICAgcmV0dXJuIHRoaXMuJGVsLmFwcGVuZChhbnl5b2xrLkpTVC50aWxlX3BhaXIoKSk7XG4gIH07XG5cbiAgU3RhZ2UucHJvdG90eXBlLnJlbmRlclN1biA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi5zdW5cIikucmVtb3ZlKCk7XG4gICAgcmV0dXJuIHRoaXMuJGVsLmFwcGVuZChhbnl5b2xrLkpTVC5zdW4oKSk7XG4gIH07XG5cbiAgU3RhZ2UucHJvdG90eXBlLnJlbmRlclRyZWVzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGksIGxlZnQsIG51bVRyZWVzLCBfcmVzdWx0cztcbiAgICBudW1UcmVlcyA9IE1hdGguY2VpbCgkKHdpbmRvdykud2lkdGgoKSAvIDIwMCk7XG4gICAgdGhpcy4kKFwiLnRyZWVcIikucmVtb3ZlKCk7XG4gICAgaWYgKG51bVRyZWVzIDw9IDIpIHtcbiAgICAgIHRoaXMuJGVsLmFwcGVuZChhbnl5b2xrLkpTVC50cmVlKHtcbiAgICAgICAgdHJlZU51bTogMyxcbiAgICAgICAgbGVmdFZhbHVlOiAtMTAwXG4gICAgICB9KSk7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuYXBwZW5kKGFueXlvbGsuSlNULnRyZWUoe1xuICAgICAgICB0cmVlTnVtOiAxLFxuICAgICAgICBsZWZ0VmFsdWU6IDEyMFxuICAgICAgfSkpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpID0gMDtcbiAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICB3aGlsZSAoaSA8IG51bVRyZWVzKSB7XG4gICAgICAgIGxlZnQgPSBNYXRoLnJhbmRvbSgpICogMjAwLiArIGkgKiAyMDA7XG4gICAgICAgIHRoaXMuJGVsLmFwcGVuZChhbnl5b2xrLkpTVC50cmVlKHtcbiAgICAgICAgICB0cmVlTnVtOiAtMSxcbiAgICAgICAgICBsZWZ0VmFsdWU6IGxlZnQgLSAzMDBcbiAgICAgICAgfSkpO1xuICAgICAgICBfcmVzdWx0cy5wdXNoKGkrKyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfVxuICB9O1xuXG4gIFN0YWdlLnByb3RvdHlwZS5yZW5kZXJDbG91ZHMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaSwgbnVtQ2xvdWRzLCBfcmVzdWx0cztcbiAgICBudW1DbG91ZHMgPSBNYXRoLmNlaWwoJCh3aW5kb3cpLndpZHRoKCkgLyAyMDApO1xuICAgIG51bUNsb3VkcyA9IChudW1DbG91ZHMgPCAyID8gMiA6IG51bUNsb3Vkcyk7XG4gICAgaSA9IDA7XG4gICAgX3Jlc3VsdHMgPSBbXTtcbiAgICB3aGlsZSAoaSA8IG51bUNsb3Vkcykge1xuICAgICAgdGhpcy4kZWwuYXBwZW5kKGFueXlvbGsuSlNULmNsb3VkKHtcbiAgICAgICAgYnA6IGFueXlvbGsuYnAsXG4gICAgICAgIGRlbGF5OiBNYXRoLnJhbmRvbSgpICogOCAtIDQgKyAoMTAgKiBpKSxcbiAgICAgICAgZGlyZWN0aW9uOiBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSA8IDEgPyBcImxlZnRcIiA6IFwicmlnaHRcIixcbiAgICAgICAgZHVyYXRpb246ICQod2luZG93KS53aWR0aCgpIC8gMjAsXG4gICAgICAgIHRvcFZhbHVlOiBNYXRoLnJhbmRvbSgpICogNTBcbiAgICAgIH0pKTtcbiAgICAgIF9yZXN1bHRzLnB1c2goaSsrKTtcbiAgICB9XG4gICAgcmV0dXJuIF9yZXN1bHRzO1xuICB9O1xuXG4gIHJldHVybiBTdGFnZTtcblxufSkoQmFja2JvbmUuVmlldyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9saztcblxubW9kdWxlLmV4cG9ydHMgPSBhbnl5b2xrID0gKGZ1bmN0aW9uKCkge1xuICBmdW5jdGlvbiBhbnl5b2xrKCkge31cblxuICBhbnl5b2xrLnN0YXJ0ID0gZnVuY3Rpb24oJG5leHQpIHtcbiAgICB2YXIgZGVmZXJyZWRzLCB2aWV3cztcbiAgICBhbnl5b2xrLkpTVCA9IHt9O1xuICAgIGRlZmVycmVkcyA9IFtdO1xuICAgIHZpZXdzID0gWydjbG91ZCcsICdjcmVkaXRzJywgJ2VnZycsICdnYW1lX2xldmVsJywgJ2dhbWVfbGl2ZXMnLCAnZ2FtZV9vdmVyJywgJ2dhbWVfc2NvcmUnLCAnaGlnaHNjb3JlJywgJ21lbnUnLCAnc2NvcmUnLCAnc3VuJywgJ3RpbGVfcGFpcicsICd0cmVlJ107XG4gICAgJC5lYWNoKHZpZXdzLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbihpbmRleCwgbmFtZSkge1xuICAgICAgICByZXR1cm4gZGVmZXJyZWRzLnB1c2goJC5nZXQoXCJ2aWV3cy9cIiArIG5hbWUgKyBcIi5odG1sXCIsIGZ1bmN0aW9uKHRlbXBsYXRlKSB7XG4gICAgICAgICAgcmV0dXJuIGFueXlvbGsuSlNUW25hbWVdID0gXy50ZW1wbGF0ZShTdHJpbmcodGVtcGxhdGUpKTtcbiAgICAgICAgfSkpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gICAgcmV0dXJuICQud2hlbi5hcHBseShudWxsLCBkZWZlcnJlZHMpLmRvbmUoJG5leHQpO1xuICB9O1xuXG4gIGFueXlvbGsuZ2V0ID0gZnVuY3Rpb24obmFtZSkge1xuICAgIHJldHVybiB0ZW1wbGF0ZXNbbmFtZV07XG4gIH07XG5cbiAgYW55eW9say5icCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBicDtcbiAgICBicCA9IFwiXCI7XG4gICAgaWYgKCQuYnJvd3Nlci53ZWJraXQpIHtcbiAgICAgIGJwID0gXCItd2Via2l0LVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoJC5icm93c2VyLm1vemlsbGEpIHtcbiAgICAgICAgYnAgPSBcIi1tb3otXCI7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBicDtcbiAgfTtcblxuICBhbnl5b2xrLmlzU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICEoJC5icm93c2VyLm1zaWUgJiYgcGFyc2VJbnQoJC5icm93c2VyLnZlcnNpb24pIDwgMTApO1xuICB9O1xuXG4gIGFueXlvbGsubmV4dFRpY2sgPSBmdW5jdGlvbihmdW5jKSB7XG4gICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuYywgMCk7XG4gIH07XG5cbiAgYW55eW9say5jbGlja1VwT3JUb3VjaCA9IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICBpZiAoXCJvbnRvdWNoc3RhcnRcIiBpbiB3aW5kb3cpIHtcbiAgICAgIHJldHVybiBcInRvdWNoc3RhcnRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwibW91c2V1cFwiO1xuICAgIH1cbiAgfTtcblxuICBhbnl5b2xrLmNsaWNrRG93bk9yVG91Y2ggPSBmdW5jdGlvbihmdW5jKSB7XG4gICAgaWYgKFwib250b3VjaHN0YXJ0XCIgaW4gd2luZG93KSB7XG4gICAgICByZXR1cm4gXCJ0b3VjaHN0YXJ0XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBcIm1vdXNlZG93blwiO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gYW55eW9saztcblxufSkoKTtcblxucmVxdWlyZSgnLi9HYW1lU3RhdGUnKTtcblxucmVxdWlyZSgnLi9FZ2dNb2RlbCcpO1xuXG5yZXF1aXJlKCcuL0VnZ1ZpZXcnKTtcblxucmVxdWlyZSgnLi9TdGFnZScpO1xuXG5yZXF1aXJlKCcuL01lbnVTY2VuZScpO1xuXG5yZXF1aXJlKCcuL0dhbWVTY2VuZScpO1xuXG5yZXF1aXJlKCcuL0dhbWVPdmVyU2NlbmUnKTtcblxucmVxdWlyZSgnLi9IaWdoc2NvcmVTY2VuZScpO1xuXG5yZXF1aXJlKCcuL0NyZWRpdHNTY2VuZScpO1xuXG4kLnByb3RvdHlwZS5zcGluID0gZnVuY3Rpb24ob3B0cykge1xuICB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgdmFyICR0aGlzLCBkYXRhO1xuICAgICR0aGlzID0gJCh0aGlzKTtcbiAgICBkYXRhID0gJHRoaXMuZGF0YSgpO1xuICAgIGlmIChkYXRhLnNwaW5uZXIpIHtcbiAgICAgIGRhdGEuc3Bpbm5lci5zdG9wKCk7XG4gICAgICBkZWxldGUgZGF0YS5zcGlubmVyO1xuICAgIH1cbiAgICBpZiAob3B0cyAhPT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBkYXRhLnNwaW5uZXIgPSBuZXcgU3Bpbm5lcigkLmV4dGVuZCh7XG4gICAgICAgIGNvbG9yOiAkdGhpcy5jc3MoXCJjb2xvclwiKVxuICAgICAgfSwgb3B0cykpLnNwaW4odGhpcyk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuUGFyc2UuaW5pdGlhbGl6ZShcIjBaVW4xVGFERjlHM2o2VWh2b05GdUlWU3pGNDV2cFNPOUswcmxvc01cIiwgXCJvVTFUb1o5TE5ab01zbHBocGd4UU5vVmpKWEVxb2k1OU0wMThaUDA4XCIpO1xuXG53aW5kb3cuZmJBc3luY0luaXQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIFBhcnNlLkZhY2Vib29rVXRpbHMuaW5pdCh7XG4gICAgYXBwSWQ6IFwiMTM4MDEwMzE4MjI1MDUyMFwiLFxuICAgIGNoYW5uZWxVcmw6IFwiL2NoYW5uZWwuaHRtbFwiLFxuICAgIHN0YXR1czogdHJ1ZSxcbiAgICBjb29raWU6IHRydWUsXG4gICAgeGZibWw6IHRydWVcbiAgfSk7XG59O1xuXG4oZnVuY3Rpb24oZCwgZGVidWcpIHtcbiAgdmFyIGlkLCBqcywgcmVmO1xuICBqcyA9IHZvaWQgMDtcbiAgaWQgPSBcImZhY2Vib29rLWpzc2RrXCI7XG4gIHJlZiA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIilbMF07XG4gIGlmIChkLmdldEVsZW1lbnRCeUlkKGlkKSkge1xuICAgIHJldHVybjtcbiAgfVxuICBqcyA9IGQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAganMuaWQgPSBpZDtcbiAganMuYXN5bmMgPSB0cnVlO1xuICBqcy5zcmMgPSBcIi8vY29ubmVjdC5mYWNlYm9vay5uZXQvZW5fVVMvYWxsXCIgKyAoZGVidWcgPyBcIi9kZWJ1Z1wiIDogXCJcIikgKyBcIi5qc1wiO1xuICByZXR1cm4gcmVmLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGpzLCByZWYpO1xufSkoZG9jdW1lbnQsIGZhbHNlKTtcblxuJChmdW5jdGlvbigpIHtcbiAgdmFyIGFueXlvbGs7XG4gIGFueXlvbGsgPSByZXF1aXJlKCcuL2FueXlvbGsnKTtcbiAgaWYgKGFueXlvbGsuaXNTdXBwb3J0ZWQoKSkge1xuICAgIHJldHVybiBhbnl5b2xrLnN0YXJ0KGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG1vZGVsO1xuICAgICAgbW9kZWwgPSBuZXcgYW55eW9say5HYW1lU3RhdGUoKTtcbiAgICAgIG5ldyBhbnl5b2xrLlN0YWdlKHtcbiAgICAgICAgbW9kZWw6IG1vZGVsXG4gICAgICB9KS5yZW5kZXIoKTtcbiAgICAgIG5ldyBhbnl5b2xrLk1lbnVTY2VuZSh7XG4gICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgfSk7XG4gICAgICBuZXcgYW55eW9say5HYW1lU2NlbmUoe1xuICAgICAgICBtb2RlbDogbW9kZWxcbiAgICAgIH0pO1xuICAgICAgbmV3IGFueXlvbGsuR2FtZU92ZXJTY2VuZSh7XG4gICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgfSk7XG4gICAgICBuZXcgYW55eW9say5IaWdoc2NvcmVTY2VuZSh7XG4gICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgfSk7XG4gICAgICBuZXcgYW55eW9say5DcmVkaXRzU2NlbmUoe1xuICAgICAgICBtb2RlbDogbW9kZWxcbiAgICAgIH0pO1xuICAgICAgbW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICAgICAgJChcIiNzdGFnZVwiKS5vbihcImRyYWdzdGFydCBzZWxlY3RzdGFydFwiLCBcIipcIiwgZnVuY3Rpb24oZXZlbnQpIHtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfSk7XG4gICAgICByZXR1cm4gZG9jdW1lbnQub250b3VjaG1vdmUgPSBmdW5jdGlvbihlKSB7XG4gICAgICAgIHJldHVybiBlLnByZXZlbnREZWZhdWx0KCk7XG4gICAgICB9O1xuICAgIH0pO1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAkKFwiI3Vuc3VwcG9ydGVkXCIpLnNob3coKTtcbiAgfVxufSk7XG4iXX0=
