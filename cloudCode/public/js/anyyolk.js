(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.CreditsScene = (function(_super) {
  __extends(CreditsScene, _super);

  function CreditsScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return CreditsScene.__super__.constructor.apply(this, arguments);
  }

  CreditsScene.prototype.className = "credits_scene";

  CreditsScene.prototype.template = _.template($("#_credits").html());

  CreditsScene.prototype.sceneName = "credits";

  CreditsScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  CreditsScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    return this.$el.on(anyyolk.clickUpOrTouch(), ".back_button", this.handleBackButton);
  };

  CreditsScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    this.model.set("scene", "menu");
    return false;
  };

  CreditsScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  CreditsScene.prototype.render = function() {
    this.$el.html(this.template());
    $("#stage").append(this.$el);
    return this;
  };

  CreditsScene.prototype.renderRemoveScene = function() {
    this.$(".credits").addClass("removal");
    this.$(".back_button").addClass("removal");
    this.$(".credits").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this.$(".back_button").css(anyyolk.bp() + "animation-name", "raiseMenu");
  };

  CreditsScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("credits")) {
      return this.$el.empty();
    }
  };

  return CreditsScene;

})(Backbone.View);

},{"../anyyolk":10}],2:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.EggModel = (function(_super) {
  __extends(EggModel, _super);

  function EggModel() {
    this.eggHitGround = __bind(this.eggHitGround, this);
    this.isSafe = __bind(this.isSafe, this);
    this.nextSprite = __bind(this.nextSprite, this);
    return EggModel.__super__.constructor.apply(this, arguments);
  }

  EggModel.NumSprites = 5;

  EggModel.prototype.defaults = {
    spriteIndex: 1,
    collectionIndex: 0
  };

  EggModel.prototype.nextSprite = function() {
    this.set("spriteIndex", this.get("spriteIndex") + 1);
    if (this.isSafe()) {
      return this.trigger("fly", [this]);
    }
  };

  EggModel.prototype.isSafe = function() {
    return this.get("spriteIndex") >= EggModel.NumSprites;
  };

  EggModel.prototype.eggHitGround = function() {
    if (!this.isSafe()) {
      return this.trigger("break", [this]);
    }
  };

  return EggModel;

})(Backbone.Model);

},{"../anyyolk":10}],3:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.EggView = (function(_super) {
  __extends(EggView, _super);

  function EggView() {
    this.handleTransitionEnded = __bind(this.handleTransitionEnded, this);
    this.renderRemove = __bind(this.renderRemove, this);
    this.renderFlying = __bind(this.renderFlying, this);
    this.renderHidding = __bind(this.renderHidding, this);
    this.renderBreaking = __bind(this.renderBreaking, this);
    this.renderSprites = __bind(this.renderSprites, this);
    this.render = __bind(this.render, this);
    this.nextSprite = __bind(this.nextSprite, this);
    this.initialize = __bind(this.initialize, this);
    return EggView.__super__.constructor.apply(this, arguments);
  }

  EggView.prototype.className = "egg";

  EggView.prototype.spriteClass = ".egg_sprite_";

  EggView.prototype.eggTemplate = _.template($("#_egg").html());

  EggView.prototype.scene = null;

  EggView.prototype.events = {
    webkitTransitionEnd: "handleTransitionEnded",
    mozTransitionEnd: "handleTransitionEnded",
    transitionend: "handleTransitionEnded"
  };

  EggView.prototype.initialize = function() {
    this.scene = this.options.scene;
    this.gameState = this.options.gameState;
    this.$el.on(anyyolk.clickDownOrTouch(), this.nextSprite);
    this.model.on("change:spriteIndex", this.renderSprites);
    this.model.on("fly", this.renderFlying);
    return this.model.on("break", this.renderBreaking);
  };

  EggView.prototype.nextSprite = function() {
    if (!this.model.isSafe()) {
      this.model.nextSprite();
      return false;
    }
  };

  EggView.prototype.render = function() {
    var delay, intermission, left, speed, top;
    this.renderSprites();
    intermission = 3.5;
    delay = void 0;
    if (this.model.get("collectionIndex") === 1) {
      delay = intermission;
    } else {
      delay = (Math.random() * 6 + 3) / this.gameState.get("speedX") + (2 * this.model.get("collectionIndex")) + intermission;
    }
    speed = 100 * this.gameState.get("speedX") + Math.random() * 100 - 50;
    left = Math.random() * ($(window).width() - 100) + 30;
    top = $("#stage").height() - 220;
    this.$el.css(anyyolk.bp() + "transition-delay", delay + "s");
    this.$el.css(anyyolk.bp() + "transition-duration", $(window).height() / speed + "s");
    this.$el.css(anyyolk.bp() + "transition-property", "top opacity");
    this.$el.css(anyyolk.bp() + "transition-timing-function", "linear");
    this.$el.css("left", left + "px");
    this.scene.append(this.$el);
    return anyyolk.nextTick((function(_this) {
      return function() {
        return _this.$el.css("top", top + "px");
      };
    })(this));
  };

  EggView.prototype.renderSprites = function() {
    return this.$el.html(this.eggTemplate({
      spriteIndex: this.model.get("spriteIndex")
    }));
  };

  EggView.prototype.renderBreaking = function() {
    this.$el.addClass("cracked").addClass("disabled");
    this.$el.css(anyyolk.bp() + "transition-delay", "0s");
    return this.$el.css(anyyolk.bp() + "transition-duration", "0.2s");
  };

  EggView.prototype.renderHidding = function() {
    this.$el.addClass("broken");
    this.$el.css(anyyolk.bp() + "transition-delay", "1s");
    this.$el.css(anyyolk.bp() + "transition-duration", "0.5s");
    this.$el.css(anyyolk.bp() + "transition-property", "opacity");
    this.$el.css(anyyolk.bp() + "transition-timing-function", "linear");
    return this.$el.css("opacity", 0);
  };

  EggView.prototype.renderFlying = function() {
    this.$el.addClass("flying");
    this.$el.css(anyyolk.bp() + "transition-delay", "0s");
    this.$el.css(anyyolk.bp() + "transition-duration", "1s");
    this.$el.css(anyyolk.bp() + "transition-property", "top");
    return this.$el.css(anyyolk.bp() + "transition-timing-function", "linear");
  };

  EggView.prototype.renderRemove = function() {
    return this.remove();
  };

  EggView.prototype.handleTransitionEnded = function(e) {
    if (e.originalEvent.propertyName === "opacity") {
      this.renderRemove();
    } else if (e.originalEvent.propertyName === "top") {
      this.model.eggHitGround();
    } else {
      if (e.originalEvent.propertyName === anyyolk.bp() + "transform" || "transform") {
        this.renderHidding();
      }
    }
    return false;
  };

  return EggView;

})(Backbone.View);

},{"../anyyolk":10}],4:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameOverScene = (function(_super) {
  __extends(GameOverScene, _super);

  function GameOverScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.saveHighScore = __bind(this.saveHighScore, this);
    this.handleFacebookButton = __bind(this.handleFacebookButton, this);
    this.handleReplayButton = __bind(this.handleReplayButton, this);
    this.handleMenuButton = __bind(this.handleMenuButton, this);
    this.initialize = __bind(this.initialize, this);
    return GameOverScene.__super__.constructor.apply(this, arguments);
  }

  GameOverScene.Congrats = ["Not bad", "Good", "Great", "Fantastic", "Smashing!", "Amazing!", "Flying High", "Ridiculous!", "Extraordinary!", "Monstrous!!"];

  GameOverScene.prototype.className = "game_over_scene";

  GameOverScene.prototype.template = _.template($("#_game_over").html());

  GameOverScene.prototype.sceneName = "game_over";

  GameOverScene.prototype.submitted = false;

  GameOverScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  GameOverScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.$el.on(anyyolk.clickUpOrTouch(), ".menu_button", this.handleMenuButton);
    this.$el.on(anyyolk.clickUpOrTouch(), ".replay_button", this.handleReplayButton);
    return this.$el.on(anyyolk.clickUpOrTouch(), ".facebook_button", this.handleFacebookButton);
  };

  GameOverScene.prototype.handleMenuButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    return this.model.set("scene", "menu");
  };

  GameOverScene.prototype.handleReplayButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    return this.model.set("scene", "game");
  };

  GameOverScene.prototype.handleFacebookButton = function(e) {
    $(".fb_content").hide();
    $(".facebook_button").addClass("disabled").empty().spin({
      length: 5,
      radius: 5,
      lines: 8,
      width: 3,
      color: "#fff"
    });
    if (Parse.User.current()) {
      return this.saveHighScore();
    } else {
      return Parse.Facebookanyyolk.logIn(null, {
        success: (function(_this) {
          return function(user) {
            if (!user.existed()) {
              return FB.api("/me", function(response) {
                if (!response.error) {
                  user.set("displayName", response.name);
                  return user.save(null, {
                    success: function(user) {
                      return _this.saveHighScore();
                    },
                    error: function(user, error) {
                      return console.log("Oops, something went wrong saving your name.");
                    }
                  });
                } else {
                  return console.log("Oops something went wrong with facebook.");
                }
              });
            } else {
              return _this.saveHighScore();
            }
          };
        })(this),
        error: (function(_this) {
          return function(user, error) {
            return console.log("Oops, something went wrong.");
          };
        })(this)
      });
    }
  };

  GameOverScene.prototype.saveHighScore = function() {
    var submission;
    submission = {
      score: this.model.getScoreSubmission()
    };
    return Parse.Cloud.run("submitHighscore", submission, {
      success: (function(_this) {
        return function(result) {
          _this.submitted = true;
          return _this.$(".facebook_button").html("Submitted!");
        };
      })(this),
      error: (function(_this) {
        return function(error) {
          _this.submitted = true;
          return _this.$(".facebook_button").html(" X Try Again...").removeClass("disabled");
        };
      })(this)
    });
  };

  GameOverScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  GameOverScene.prototype.render = function() {
    var congratsIndex;
    congratsIndex = (this.model.get("level") > GameOverScene.Congrats.length ? GameOverScene.Congrats.length - 1 : this.model.get("level") - 1);
    this.$el.html(this.template({
      score: this.model.get("score"),
      congrats: GameOverScene.Congrats[congratsIndex]
    }));
    return $("#stage").append(this.$el);
  };

  GameOverScene.prototype.renderRemoveScene = function() {
    this.$(".menu_item").addClass("removal");
    this.$(".summary").addClass("removal");
    this.$(".menu_item").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this.$(".summary").css(anyyolk.bp() + "animation-name", "raiseScores");
  };

  GameOverScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("summary")) {
      return this.$el.empty();
    }
  };

  return GameOverScene;

})(Backbone.View);

},{"../anyyolk":10}],5:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameScene = (function(_super) {
  __extends(GameScene, _super);

  function GameScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.renderAddEgg = __bind(this.renderAddEgg, this);
    this.renderEggs = __bind(this.renderEggs, this);
    this.renderBackButton = __bind(this.renderBackButton, this);
    this.renderLives = __bind(this.renderLives, this);
    this.renderScore = __bind(this.renderScore, this);
    this.renderLevelLabel = __bind(this.renderLevelLabel, this);
    this.renderLevel = __bind(this.renderLevel, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return GameScene.__super__.constructor.apply(this, arguments);
  }

  GameScene.prototype.className = "game_scene";

  GameScene.prototype.scoreTemplate = _.template($("#_game_score").html());

  GameScene.prototype.levelTemplate = _.template($("#_game_level").html());

  GameScene.prototype.livesTemplate = _.template($("#_game_lives").html());

  GameScene.prototype.sceneName = "game";

  GameScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  GameScene.prototype.initialize = function() {
    this.eggViews = [];
    this.$el.on(anyyolk.clickUpOrTouch(), ".back_button", this.handleBackButton);
    this.model.on("change:scene", this.renderSceneChange);
    this.model.get("eggCollection").on("add", this.renderAddEgg);
    this.model.on("change:score", this.renderScore);
    this.model.on("change:lives", this.renderLives);
    this.model.on("change:level", this.renderLevel);
    return this.model.on("change:level", this.renderLevelLabel);
  };

  GameScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    return this.model.set("scene", "menu");
  };

  GameScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  GameScene.prototype.render = function() {
    this.model.resetGameData();
    this.$("#hud").remove();
    this.$el.append("<div id='hud'></div>");
    this.renderLevel();
    setTimeout(((function(_this) {
      return function() {
        return _this.renderLevelLabel();
      };
    })(this)), 1200);
    this.renderScore();
    this.renderLives();
    this.renderBackButton();
    this.renderEggs();
    if ($("#stage ." + this.className).length <= 0) {
      $("#stage").append(this.$el);
    }
    return this;
  };

  GameScene.prototype.renderLevel = function() {
    if (this.$("#game_level").length > 0) {
      this.$("#game_level").replaceWith(this.levelTemplate({
        level: this.model.get("level")
      }));
    } else {
      this.$("#hud").append(this.levelTemplate({
        level: this.model.get("level")
      }));
    }
    return this;
  };

  GameScene.prototype.renderLevelLabel = function() {
    this.$el.append("<p class='level_label'>LEVEL " + this.model.get("level") + "<br>GET READY!</p>");
    setTimeout(((function(_this) {
      return function() {
        return _this.$(".level_label").addClass("removal");
      };
    })(this)), 3000);
    setTimeout(((function(_this) {
      return function() {
        return _this.$(".level_label").remove();
      };
    })(this)), 3300);
    return this;
  };

  GameScene.prototype.renderScore = function() {
    if (this.$("#game_score").length > 0) {
      this.$("#game_score").replaceWith(this.scoreTemplate({
        score: this.model.get("score")
      }));
    } else {
      this.$("#hud").append(this.scoreTemplate({
        score: this.model.get("score")
      }));
    }
    return this;
  };

  GameScene.prototype.renderLives = function() {
    if (this.$("#game_lives").length > 0) {
      this.$("#game_lives").replaceWith(this.livesTemplate({
        lives: this.model.get("lives")
      }));
    } else {
      this.$("#hud").append(this.livesTemplate({
        lives: this.model.get("lives")
      }));
    }
    return this;
  };

  GameScene.prototype.renderBackButton = function() {
    if (this.$(".back_button").length > 0) {
      this.$(".back_button").replaceWith("<div class='back_button'>X</div>");
    } else {
      this.$el.append("<div class='back_button'>X</div>");
    }
    return this;
  };

  GameScene.prototype.renderEggs = function() {
    this.model.addEggs();
    return this;
  };

  GameScene.prototype.renderAddEgg = function(eggModel, collection, options) {
    var eggView;
    eggView = new anyyolk.EggView({
      model: eggModel,
      gameState: this.model,
      scene: this.$el
    });
    eggView.render();
    this.eggViews.push(eggView);
    return this;
  };

  GameScene.prototype.renderRemoveScene = function() {
    this.$(".back_button").css(anyyolk.bp() + "animation-name", "xRaise");
    this.$("#hud p").css(anyyolk.bp() + "animation-name", "removeHUD");
    this.$(".egg").css(anyyolk.bp() + "transition-duration", "0.3s");
    _.each(this.eggViews, (function(_this) {
      return function(eggView) {
        return eggView.renderRemove();
      };
    })(this));
    this.model.get("eggCollection").reset();
    return this;
  };

  GameScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("back_button")) {
      this.$el.empty();
    }
    return false;
  };

  return GameScene;

})(Backbone.View);

},{"../anyyolk":10}],6:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.GameState = (function(_super) {
  __extends(GameState, _super);

  function GameState() {
    this.getScoreSubmission = __bind(this.getScoreSubmission, this);
    this.resetGameData = __bind(this.resetGameData, this);
    this.cleanUpEgg = __bind(this.cleanUpEgg, this);
    this.addEggs = __bind(this.addEggs, this);
    this.validateAlive = __bind(this.validateAlive, this);
    this.incrementLevel = __bind(this.incrementLevel, this);
    this.decrementLife = __bind(this.decrementLife, this);
    this.incrementScore = __bind(this.incrementScore, this);
    this.initialize = __bind(this.initialize, this);
    return GameState.__super__.constructor.apply(this, arguments);
  }

  GameState.DefaultGameData = {
    score: 0,
    lives: 3,
    level: 1,
    speedX: 1
  };

  GameState.prototype.defaults = {
    scene: "",
    eggCollection: null,
    speedX: 1
  };

  GameState.prototype.initialize = function() {
    var query;
    this.set("eggCollection", new Backbone.Collection());
    query = new Parse.Query("HighScore");
    query.descending("score");
    query.include("player");
    query.limit(10);
    this.set("highscoreCollection", query.collection());
    this.resetGameData();
    this.get("eggCollection").on("fly", this.incrementScore);
    this.get("eggCollection").on("break", this.decrementLife);
    this.get("eggCollection").on("fly break", this.cleanUpEgg);
    return this.get("eggCollection").on("remove", this.incrementLevel);
  };

  GameState.prototype.incrementScore = function() {
    return this.set("score", this.get("score") + 1);
  };

  GameState.prototype.decrementLife = function() {
    this.set("lives", this.get("lives") - 1);
    return this.validateAlive();
  };

  GameState.prototype.incrementLevel = function() {
    if (this.get("eggCollection").length <= 0) {
      this.set("level", this.get("level") + 1);
      this.set("speedX", this.get("speedX") + 0.25);
      return this.addEggs();
    }
  };

  GameState.prototype.validateAlive = function() {
    if (this.get("lives") <= 0) {
      return this.set("scene", "game_over");
    }
  };

  GameState.prototype.addEggs = function() {
    var i, numEggs, _results;
    numEggs = 10;
    i = 0;
    _results = [];
    while (i < numEggs) {
      this.get("eggCollection").add(new anyyolk.EggModel({
        collectionIndex: i
      }));
      _results.push(i++);
    }
    return _results;
  };

  GameState.prototype.cleanUpEgg = function(eggModel) {
    return this.get("eggCollection").remove(eggModel);
  };

  GameState.prototype.resetGameData = function() {
    return this.set(anyyolk.GameState.DefaultGameData);
  };

  GameState.prototype.getScoreSubmission = function() {
    return ((this.get("level") * 362) << 5) + "." + ((this.get("score") * 672) << 4);
  };

  return GameState;

})(Backbone.Model);

},{"../anyyolk":10}],7:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.HighscoreScene = (function(_super) {
  __extends(HighscoreScene, _super);

  function HighscoreScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.renderScore = __bind(this.renderScore, this);
    this.renderScoreCollection = __bind(this.renderScoreCollection, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleBackButton = __bind(this.handleBackButton, this);
    this.initialize = __bind(this.initialize, this);
    return HighscoreScene.__super__.constructor.apply(this, arguments);
  }

  HighscoreScene.prototype.className = "highscore_scene";

  HighscoreScene.prototype.template = _.template($("#_highscore").html());

  HighscoreScene.prototype.scoreTemplate = _.template($("#_score").html());

  HighscoreScene.prototype.sceneName = "highscore";

  HighscoreScene.prototype.events = {
    animationend: "cleanUp",
    webkitAnimationEnd: "cleanUp",
    mozAnimationEnd: "cleanUp"
  };

  HighscoreScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.model.get("highscoreCollection").on("reset", this.renderScoreCollection);
    this.$el.on(anyyolk.clickUpOrTouch(), ".back_button", this.handleBackButton);
    if (this.model.get("currentScene") === this.sceneName) {
      return this.render();
    }
  };

  HighscoreScene.prototype.handleBackButton = function(e) {
    this.$(".back_button").addClass("disabled");
    this.model.set("scene", "menu");
    return false;
  };

  HighscoreScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  HighscoreScene.prototype.render = function() {
    this.$el.html(this.template());
    this.model.get("highscoreCollection").fetch();
    this.$(".highscore").spin({
      length: 9,
      radius: 10,
      lines: 12,
      width: 4,
      color: "#fff"
    });
    $("#stage").append(this.$el);
    return this;
  };

  HighscoreScene.prototype.renderScoreCollection = function() {
    this.model.get("highscoreCollection").each((function(_this) {
      return function(score, index) {
        return _this.renderScore(score, index);
      };
    })(this));
    $(".highscore .spinner").remove();
    return this;
  };

  HighscoreScene.prototype.renderScore = function(score, index) {
    return this.$("#score_table tbody").append(this.scoreTemplate({
      score: score,
      index: index
    }));
  };

  HighscoreScene.prototype.renderRemoveScene = function() {
    this.$(".menu_item").addClass("removal");
    this.$(".highscore").addClass("removal");
    this.$(".menu_item").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this.$(".highscore").css(anyyolk.bp() + "animation-name", "raiseScores");
  };

  HighscoreScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("highscore")) {
      return this.$el.empty();
    }
  };

  return HighscoreScene;

})(Backbone.View);

},{"../anyyolk":10}],8:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.MenuScene = (function(_super) {
  __extends(MenuScene, _super);

  function MenuScene() {
    this.cleanUp = __bind(this.cleanUp, this);
    this.renderRemoveScene = __bind(this.renderRemoveScene, this);
    this.render = __bind(this.render, this);
    this.renderSceneChange = __bind(this.renderSceneChange, this);
    this.handleCreditsButton = __bind(this.handleCreditsButton, this);
    this.handleHighscoreButton = __bind(this.handleHighscoreButton, this);
    this.handlePlayButton = __bind(this.handlePlayButton, this);
    this.initialize = __bind(this.initialize, this);
    return MenuScene.__super__.constructor.apply(this, arguments);
  }

  MenuScene.prototype.className = "menu_scene";

  MenuScene.prototype.template = _.template($("#_menu").html());

  MenuScene.prototype.sceneName = "menu";

  MenuScene.prototype.events = {
    "animationend .title": "cleanUp",
    "webkitAnimationEnd .title": "cleanUp",
    "mozAnimationEnd .title": "cleanUp"
  };

  MenuScene.prototype.initialize = function() {
    this.model.on("change:scene", this.renderSceneChange);
    this.$el.on(anyyolk.clickUpOrTouch(), "#play_button", this.handlePlayButton);
    this.$el.on(anyyolk.clickUpOrTouch(), "#highscore_button", this.handleHighscoreButton);
    this.$el.on(anyyolk.clickUpOrTouch(), "#credits_button", this.handleCreditsButton);
    return this;
  };

  MenuScene.prototype.handlePlayButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "game");
    return false;
  };

  MenuScene.prototype.handleHighscoreButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "highscore");
    return false;
  };

  MenuScene.prototype.handleCreditsButton = function(e) {
    this.$(".menu_item").addClass("disabled");
    this.model.set("scene", "credits");
    return false;
  };

  MenuScene.prototype.renderSceneChange = function(model, scene) {
    if (model.previous("scene") === this.sceneName) {
      this.renderRemoveScene();
    } else {
      if (scene === this.sceneName) {
        this.render();
      }
    }
    return this;
  };

  MenuScene.prototype.render = function() {
    this.$el.html(this.template());
    $("#stage").append(this.$el);
    return this;
  };

  MenuScene.prototype.renderRemoveScene = function() {
    this.$(".title").removeClass("display").addClass("removal");
    this.$(".menu_item").addClass("removal");
    this.$(".title").css(anyyolk.bp() + "animation-name", "raiseTitle");
    this.$(".menu_item").css(anyyolk.bp() + "animation-name", "raiseMenu");
    return this;
  };

  MenuScene.prototype.cleanUp = function(e) {
    if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("title")) {
      this.$el.empty();
    }
    return false;
  };

  return MenuScene;

})(Backbone.View);

},{"../anyyolk":10}],9:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk,
  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

anyyolk = require('../anyyolk');

anyyolk.Stage = (function(_super) {
  __extends(Stage, _super);

  function Stage() {
    this.renderClouds = __bind(this.renderClouds, this);
    this.renderTrees = __bind(this.renderTrees, this);
    this.renderSun = __bind(this.renderSun, this);
    this.renderTiles = __bind(this.renderTiles, this);
    this.render = __bind(this.render, this);
    return Stage.__super__.constructor.apply(this, arguments);
  }

  Stage.prototype.el = "#stage";

  Stage.prototype.tileTemplate = _.template($("#_tile_pair").html());

  Stage.prototype.treeTemplate = _.template($("#_tree").html());

  Stage.prototype.sunTemplate = _.template($("#_sun").html());

  Stage.prototype.cloudTemplate = _.template($("#_cloud").html());

  Stage.prototype.render = function() {
    this.$el.css("height", $(window).height());
    this.renderSun();
    this.renderTrees();
    this.renderTiles();
    return this.renderClouds();
  };

  Stage.prototype.renderTiles = function() {
    this.$(".tile").remove();
    return this.$el.append(this.tileTemplate());
  };

  Stage.prototype.renderSun = function() {
    this.$(".sun").remove();
    return this.$el.append(this.sunTemplate());
  };

  Stage.prototype.renderTrees = function() {
    var i, left, numTrees, _results;
    numTrees = Math.ceil($(window).width() / 200);
    this.$(".tree").remove();
    if (numTrees <= 2) {
      this.$el.append(this.treeTemplate({
        treeNum: 3,
        leftValue: -100
      }));
      return this.$el.append(this.treeTemplate({
        treeNum: 1,
        leftValue: 120
      }));
    } else {
      i = 0;
      _results = [];
      while (i < numTrees) {
        left = Math.random() * 200. + i * 200;
        this.$el.append(this.treeTemplate({
          treeNum: -1,
          leftValue: left - 300
        }));
        _results.push(i++);
      }
      return _results;
    }
  };

  Stage.prototype.renderClouds = function() {
    var delay, dir, i, numClouds, speed, top, _results;
    numClouds = Math.ceil($(window).width() / 200);
    numClouds = (numClouds < 2 ? 2 : numClouds);
    i = 0;
    _results = [];
    while (i < numClouds) {
      top = Math.random() * 50;
      delay = Math.random() * 8 - 4 + (10 * i);
      speed = 20;
      dir = (Math.floor(Math.random() * 2) < 1 ? "left" : "right");
      this.$el.append(this.cloudTemplate({
        bp: anyyolk.bp,
        delay: delay,
        direction: dir,
        duration: $(window).width() / speed,
        topValue: top
      }));
      _results.push(i++);
    }
    return _results;
  };

  return Stage;

})(Backbone.View);

},{"../anyyolk":10}],10:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var anyyolk;

module.exports = anyyolk = (function() {
  function anyyolk() {}

  anyyolk.bp = function() {
    var bp;
    bp = "";
    if ($.browser.webkit) {
      bp = "-webkit-";
    } else {
      if ($.browser.mozilla) {
        bp = "-moz-";
      }
    }
    return bp;
  };

  anyyolk.isSupported = function() {
    return !($.browser.msie && parseInt($.browser.version) < 10);
  };

  anyyolk.nextTick = function(func) {
    return setTimeout(func, 0);
  };

  anyyolk.clickUpOrTouch = function(func) {
    if ("ontouchstart" in window) {
      return "touchstart";
    } else {
      return "mouseup";
    }
  };

  anyyolk.clickDownOrTouch = function(func) {
    if ("ontouchstart" in window) {
      return "touchstart";
    } else {
      return "mousedown";
    }
  };

  return anyyolk;

})();

require('./GameState');

require('./EggModel');

require('./EggView');

require('./Stage');

require('./MenuScene');

require('./GameScene');

require('./GameOverScene');

require('./HighscoreScene');

require('./CreditsScene');

$.prototype.spin = function(opts) {
  this.each(function() {
    var $this, data;
    $this = $(this);
    data = $this.data();
    if (data.spinner) {
      data.spinner.stop();
      delete data.spinner;
    }
    if (opts !== false) {
      return data.spinner = new Spinner($.extend({
        color: $this.css("color")
      }, opts)).spin(this);
    }
  });
  return this;
};

},{"./CreditsScene":1,"./EggModel":2,"./EggView":3,"./GameOverScene":4,"./GameScene":5,"./GameState":6,"./HighscoreScene":7,"./MenuScene":8,"./Stage":9}],11:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
Parse.initialize("0ZUn1TaDF9G3j6UhvoNFuIVSzF45vpSO9K0rlosM", "oU1ToZ9LNZoMslphpgxQNoVjJXEqoi59M018ZP08");

window.fbAsyncInit = function() {
  return Parse.FacebookUtils.init({
    appId: "1380103182250520",
    channelUrl: "/channel.html",
    status: true,
    cookie: true,
    xfbml: true
  });
};

(function(d, debug) {
  var id, js, ref;
  js = void 0;
  id = "facebook-jssdk";
  ref = d.getElementsByTagName("script")[0];
  if (d.getElementById(id)) {
    return;
  }
  js = d.createElement("script");
  js.id = id;
  js.async = true;
  js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
  return ref.parentNode.insertBefore(js, ref);
})(document, false);

$(function() {
  var anyyolk, model;
  anyyolk = require('./anyyolk');
  if (anyyolk.isSupported()) {
    model = new anyyolk.GameState();
    new anyyolk.Stage({
      model: model
    }).render();
    new anyyolk.MenuScene({
      model: model
    });
    new anyyolk.GameScene({
      model: model
    });
    new anyyolk.GameOverScene({
      model: model
    });
    new anyyolk.HighscoreScene({
      model: model
    });
    new anyyolk.CreditsScene({
      model: model
    });
    model.set("scene", "menu");
    $("#stage").on("dragstart selectstart", "*", function(event) {
      return false;
    });
    return document.ontouchmove = function(e) {
      return e.preventDefault();
    };
  } else {
    return $("#unsupported").show();
  }
});

},{"./anyyolk":10}]},{},[11])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3IvbG9jYWwvbGliL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9DcmVkaXRzU2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9FZ2dNb2RlbC5qcyIsIi9ob21lL2JydWNlL0dpdC9BbnlZb2xrL3RtcC9hbnl5b2xrL0VnZ1ZpZXcuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9HYW1lT3ZlclNjZW5lLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvR2FtZVNjZW5lLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvR2FtZVN0YXRlLmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL2FueXlvbGsvSGlnaHNjb3JlU2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9NZW51U2NlbmUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvYW55eW9say9TdGFnZS5qcyIsIi9ob21lL2JydWNlL0dpdC9BbnlZb2xrL3RtcC9hbnl5b2xrL2luZGV4LmpzIiwiL2hvbWUvYnJ1Y2UvR2l0L0FueVlvbGsvdG1wL21haW4uanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUE7QUNBQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0VBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzdDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNqSUE7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNoS0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xNQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDeEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUM5R0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEdBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3RHQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xGQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0EiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGssXG4gIF9fYmluZCA9IGZ1bmN0aW9uKGZuLCBtZSl7IHJldHVybiBmdW5jdGlvbigpeyByZXR1cm4gZm4uYXBwbHkobWUsIGFyZ3VtZW50cyk7IH07IH0sXG4gIF9faGFzUHJvcCA9IHt9Lmhhc093blByb3BlcnR5LFxuICBfX2V4dGVuZHMgPSBmdW5jdGlvbihjaGlsZCwgcGFyZW50KSB7IGZvciAodmFyIGtleSBpbiBwYXJlbnQpIHsgaWYgKF9faGFzUHJvcC5jYWxsKHBhcmVudCwga2V5KSkgY2hpbGRba2V5XSA9IHBhcmVudFtrZXldOyB9IGZ1bmN0aW9uIGN0b3IoKSB7IHRoaXMuY29uc3RydWN0b3IgPSBjaGlsZDsgfSBjdG9yLnByb3RvdHlwZSA9IHBhcmVudC5wcm90b3R5cGU7IGNoaWxkLnByb3RvdHlwZSA9IG5ldyBjdG9yKCk7IGNoaWxkLl9fc3VwZXJfXyA9IHBhcmVudC5wcm90b3R5cGU7IHJldHVybiBjaGlsZDsgfTtcblxuYW55eW9sayA9IHJlcXVpcmUoJy4uL2FueXlvbGsnKTtcblxuYW55eW9say5DcmVkaXRzU2NlbmUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhDcmVkaXRzU2NlbmUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gQ3JlZGl0c1NjZW5lKCkge1xuICAgIHRoaXMuY2xlYW5VcCA9IF9fYmluZCh0aGlzLmNsZWFuVXAsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUgPSBfX2JpbmQodGhpcy5yZW5kZXJSZW1vdmVTY2VuZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UgPSBfX2JpbmQodGhpcy5yZW5kZXJTY2VuZUNoYW5nZSwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVCYWNrQnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlQmFja0J1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgcmV0dXJuIENyZWRpdHNTY2VuZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJjcmVkaXRzX3NjZW5lXCI7XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS50ZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfY3JlZGl0c1wiKS5odG1sKCkpO1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUuc2NlbmVOYW1lID0gXCJjcmVkaXRzXCI7XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5ldmVudHMgPSB7XG4gICAgYW5pbWF0aW9uZW5kOiBcImNsZWFuVXBcIixcbiAgICB3ZWJraXRBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiLFxuICAgIG1vekFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCJcbiAgfTtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNjZW5lXCIsIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UpO1xuICAgIHJldHVybiB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrVXBPclRvdWNoKCksIFwiLmJhY2tfYnV0dG9uXCIsIHRoaXMuaGFuZGxlQmFja0J1dHRvbik7XG4gIH07XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5oYW5kbGVCYWNrQnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLnJlbmRlclNjZW5lQ2hhbmdlID0gZnVuY3Rpb24obW9kZWwsIHNjZW5lKSB7XG4gICAgaWYgKG1vZGVsLnByZXZpb3VzKFwic2NlbmVcIikgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzY2VuZSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUoKSk7XG4gICAgJChcIiNzdGFnZVwiKS5hcHBlbmQodGhpcy4kZWwpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUucmVuZGVyUmVtb3ZlU2NlbmUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIuY3JlZGl0c1wiKS5hZGRDbGFzcyhcInJlbW92YWxcIik7XG4gICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIuY3JlZGl0c1wiKS5jc3MoYW55eW9say5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlTWVudVwiKTtcbiAgICByZXR1cm4gdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VNZW51XCIpO1xuICB9O1xuXG4gIENyZWRpdHNTY2VuZS5wcm90b3R5cGUuY2xlYW5VcCA9IGZ1bmN0aW9uKGUpIHtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJzY2VuZVwiKSAhPT0gdGhpcy5zY2VuZU5hbWUgJiYgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJjcmVkaXRzXCIpKSB7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuZW1wdHkoKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIENyZWRpdHNTY2VuZTtcblxufSkoQmFja2JvbmUuVmlldyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLkVnZ01vZGVsID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoRWdnTW9kZWwsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gRWdnTW9kZWwoKSB7XG4gICAgdGhpcy5lZ2dIaXRHcm91bmQgPSBfX2JpbmQodGhpcy5lZ2dIaXRHcm91bmQsIHRoaXMpO1xuICAgIHRoaXMuaXNTYWZlID0gX19iaW5kKHRoaXMuaXNTYWZlLCB0aGlzKTtcbiAgICB0aGlzLm5leHRTcHJpdGUgPSBfX2JpbmQodGhpcy5uZXh0U3ByaXRlLCB0aGlzKTtcbiAgICByZXR1cm4gRWdnTW9kZWwuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICBFZ2dNb2RlbC5OdW1TcHJpdGVzID0gNTtcblxuICBFZ2dNb2RlbC5wcm90b3R5cGUuZGVmYXVsdHMgPSB7XG4gICAgc3ByaXRlSW5kZXg6IDEsXG4gICAgY29sbGVjdGlvbkluZGV4OiAwXG4gIH07XG5cbiAgRWdnTW9kZWwucHJvdG90eXBlLm5leHRTcHJpdGUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNldChcInNwcml0ZUluZGV4XCIsIHRoaXMuZ2V0KFwic3ByaXRlSW5kZXhcIikgKyAxKTtcbiAgICBpZiAodGhpcy5pc1NhZmUoKSkge1xuICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcihcImZseVwiLCBbdGhpc10pO1xuICAgIH1cbiAgfTtcblxuICBFZ2dNb2RlbC5wcm90b3R5cGUuaXNTYWZlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KFwic3ByaXRlSW5kZXhcIikgPj0gRWdnTW9kZWwuTnVtU3ByaXRlcztcbiAgfTtcblxuICBFZ2dNb2RlbC5wcm90b3R5cGUuZWdnSGl0R3JvdW5kID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLmlzU2FmZSgpKSB7XG4gICAgICByZXR1cm4gdGhpcy50cmlnZ2VyKFwiYnJlYWtcIiwgW3RoaXNdKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIEVnZ01vZGVsO1xuXG59KShCYWNrYm9uZS5Nb2RlbCk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLkVnZ1ZpZXcgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gIF9fZXh0ZW5kcyhFZ2dWaWV3LCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIEVnZ1ZpZXcoKSB7XG4gICAgdGhpcy5oYW5kbGVUcmFuc2l0aW9uRW5kZWQgPSBfX2JpbmQodGhpcy5oYW5kbGVUcmFuc2l0aW9uRW5kZWQsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyUmVtb3ZlID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckZseWluZyA9IF9fYmluZCh0aGlzLnJlbmRlckZseWluZywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJIaWRkaW5nID0gX19iaW5kKHRoaXMucmVuZGVySGlkZGluZywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJCcmVha2luZyA9IF9fYmluZCh0aGlzLnJlbmRlckJyZWFraW5nLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNwcml0ZXMgPSBfX2JpbmQodGhpcy5yZW5kZXJTcHJpdGVzLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlciA9IF9fYmluZCh0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5uZXh0U3ByaXRlID0gX19iaW5kKHRoaXMubmV4dFNwcml0ZSwgdGhpcyk7XG4gICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgcmV0dXJuIEVnZ1ZpZXcuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICBFZ2dWaWV3LnByb3RvdHlwZS5jbGFzc05hbWUgPSBcImVnZ1wiO1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnNwcml0ZUNsYXNzID0gXCIuZWdnX3Nwcml0ZV9cIjtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5lZ2dUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfZWdnXCIpLmh0bWwoKSk7XG5cbiAgRWdnVmlldy5wcm90b3R5cGUuc2NlbmUgPSBudWxsO1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLmV2ZW50cyA9IHtcbiAgICB3ZWJraXRUcmFuc2l0aW9uRW5kOiBcImhhbmRsZVRyYW5zaXRpb25FbmRlZFwiLFxuICAgIG1velRyYW5zaXRpb25FbmQ6IFwiaGFuZGxlVHJhbnNpdGlvbkVuZGVkXCIsXG4gICAgdHJhbnNpdGlvbmVuZDogXCJoYW5kbGVUcmFuc2l0aW9uRW5kZWRcIlxuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLnNjZW5lID0gdGhpcy5vcHRpb25zLnNjZW5lO1xuICAgIHRoaXMuZ2FtZVN0YXRlID0gdGhpcy5vcHRpb25zLmdhbWVTdGF0ZTtcbiAgICB0aGlzLiRlbC5vbihhbnl5b2xrLmNsaWNrRG93bk9yVG91Y2goKSwgdGhpcy5uZXh0U3ByaXRlKTtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNwcml0ZUluZGV4XCIsIHRoaXMucmVuZGVyU3ByaXRlcyk7XG4gICAgdGhpcy5tb2RlbC5vbihcImZseVwiLCB0aGlzLnJlbmRlckZseWluZyk7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwub24oXCJicmVha1wiLCB0aGlzLnJlbmRlckJyZWFraW5nKTtcbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5uZXh0U3ByaXRlID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKCF0aGlzLm1vZGVsLmlzU2FmZSgpKSB7XG4gICAgICB0aGlzLm1vZGVsLm5leHRTcHJpdGUoKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGRlbGF5LCBpbnRlcm1pc3Npb24sIGxlZnQsIHNwZWVkLCB0b3A7XG4gICAgdGhpcy5yZW5kZXJTcHJpdGVzKCk7XG4gICAgaW50ZXJtaXNzaW9uID0gMy41O1xuICAgIGRlbGF5ID0gdm9pZCAwO1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcImNvbGxlY3Rpb25JbmRleFwiKSA9PT0gMSkge1xuICAgICAgZGVsYXkgPSBpbnRlcm1pc3Npb247XG4gICAgfSBlbHNlIHtcbiAgICAgIGRlbGF5ID0gKE1hdGgucmFuZG9tKCkgKiA2ICsgMykgLyB0aGlzLmdhbWVTdGF0ZS5nZXQoXCJzcGVlZFhcIikgKyAoMiAqIHRoaXMubW9kZWwuZ2V0KFwiY29sbGVjdGlvbkluZGV4XCIpKSArIGludGVybWlzc2lvbjtcbiAgICB9XG4gICAgc3BlZWQgPSAxMDAgKiB0aGlzLmdhbWVTdGF0ZS5nZXQoXCJzcGVlZFhcIikgKyBNYXRoLnJhbmRvbSgpICogMTAwIC0gNTA7XG4gICAgbGVmdCA9IE1hdGgucmFuZG9tKCkgKiAoJCh3aW5kb3cpLndpZHRoKCkgLSAxMDApICsgMzA7XG4gICAgdG9wID0gJChcIiNzdGFnZVwiKS5oZWlnaHQoKSAtIDIyMDtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIGRlbGF5ICsgXCJzXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgJCh3aW5kb3cpLmhlaWdodCgpIC8gc3BlZWQgKyBcInNcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1wcm9wZXJ0eVwiLCBcInRvcCBvcGFjaXR5XCIpO1xuICAgIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uXCIsIFwibGluZWFyXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhcImxlZnRcIiwgbGVmdCArIFwicHhcIik7XG4gICAgdGhpcy5zY2VuZS5hcHBlbmQodGhpcy4kZWwpO1xuICAgIHJldHVybiBhbnl5b2xrLm5leHRUaWNrKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMuJGVsLmNzcyhcInRvcFwiLCB0b3AgKyBcInB4XCIpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gIH07XG5cbiAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVyU3ByaXRlcyA9IGZ1bmN0aW9uKCkge1xuICAgIHJldHVybiB0aGlzLiRlbC5odG1sKHRoaXMuZWdnVGVtcGxhdGUoe1xuICAgICAgc3ByaXRlSW5kZXg6IHRoaXMubW9kZWwuZ2V0KFwic3ByaXRlSW5kZXhcIilcbiAgICB9KSk7XG4gIH07XG5cbiAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVyQnJlYWtpbmcgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImNyYWNrZWRcIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIFwiMHNcIik7XG4gICAgcmV0dXJuIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgXCIwLjJzXCIpO1xuICB9O1xuXG4gIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlckhpZGRpbmcgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImJyb2tlblwiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIFwiMXNcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1kdXJhdGlvblwiLCBcIjAuNXNcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1wcm9wZXJ0eVwiLCBcIm9wYWNpdHlcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb25cIiwgXCJsaW5lYXJcIik7XG4gICAgcmV0dXJuIHRoaXMuJGVsLmNzcyhcIm9wYWNpdHlcIiwgMCk7XG4gIH07XG5cbiAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVyRmx5aW5nID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuYWRkQ2xhc3MoXCJmbHlpbmdcIik7XG4gICAgdGhpcy4kZWwuY3NzKGFueXlvbGsuYnAoKSArIFwidHJhbnNpdGlvbi1kZWxheVwiLCBcIjBzXCIpO1xuICAgIHRoaXMuJGVsLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgXCIxc1wiKTtcbiAgICB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLXByb3BlcnR5XCIsIFwidG9wXCIpO1xuICAgIHJldHVybiB0aGlzLiRlbC5jc3MoYW55eW9say5icCgpICsgXCJ0cmFuc2l0aW9uLXRpbWluZy1mdW5jdGlvblwiLCBcImxpbmVhclwiKTtcbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5yZW5kZXJSZW1vdmUgPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gdGhpcy5yZW1vdmUoKTtcbiAgfTtcblxuICBFZ2dWaWV3LnByb3RvdHlwZS5oYW5kbGVUcmFuc2l0aW9uRW5kZWQgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKGUub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWUgPT09IFwib3BhY2l0eVwiKSB7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZSgpO1xuICAgIH0gZWxzZSBpZiAoZS5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZSA9PT0gXCJ0b3BcIikge1xuICAgICAgdGhpcy5tb2RlbC5lZ2dIaXRHcm91bmQoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKGUub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWUgPT09IGFueXlvbGsuYnAoKSArIFwidHJhbnNmb3JtXCIgfHwgXCJ0cmFuc2Zvcm1cIikge1xuICAgICAgICB0aGlzLnJlbmRlckhpZGRpbmcoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIHJldHVybiBFZ2dWaWV3O1xuXG59KShCYWNrYm9uZS5WaWV3KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuR2FtZU92ZXJTY2VuZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEdhbWVPdmVyU2NlbmUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gR2FtZU92ZXJTY2VuZSgpIHtcbiAgICB0aGlzLmNsZWFuVXAgPSBfX2JpbmQodGhpcy5jbGVhblVwLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlID0gX19iaW5kKHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UsIHRoaXMpO1xuICAgIHRoaXMuc2F2ZUhpZ2hTY29yZSA9IF9fYmluZCh0aGlzLnNhdmVIaWdoU2NvcmUsIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlRmFjZWJvb2tCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVGYWNlYm9va0J1dHRvbiwgdGhpcyk7XG4gICAgdGhpcy5oYW5kbGVSZXBsYXlCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVSZXBsYXlCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlTWVudUJ1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZU1lbnVCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaW5pdGlhbGl6ZSA9IF9fYmluZCh0aGlzLmluaXRpYWxpemUsIHRoaXMpO1xuICAgIHJldHVybiBHYW1lT3ZlclNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgR2FtZU92ZXJTY2VuZS5Db25ncmF0cyA9IFtcIk5vdCBiYWRcIiwgXCJHb29kXCIsIFwiR3JlYXRcIiwgXCJGYW50YXN0aWNcIiwgXCJTbWFzaGluZyFcIiwgXCJBbWF6aW5nIVwiLCBcIkZseWluZyBIaWdoXCIsIFwiUmlkaWN1bG91cyFcIiwgXCJFeHRyYW9yZGluYXJ5IVwiLCBcIk1vbnN0cm91cyEhXCJdO1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmNsYXNzTmFtZSA9IFwiZ2FtZV9vdmVyX3NjZW5lXCI7XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUudGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2dhbWVfb3ZlclwiKS5odG1sKCkpO1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwiZ2FtZV9vdmVyXCI7XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuc3VibWl0dGVkID0gZmFsc2U7XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgIGFuaW1hdGlvbmVuZDogXCJjbGVhblVwXCIsXG4gICAgd2Via2l0QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIixcbiAgICBtb3pBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiXG4gIH07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c2NlbmVcIiwgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSk7XG4gICAgdGhpcy4kZWwub24oYW55eW9say5jbGlja1VwT3JUb3VjaCgpLCBcIi5tZW51X2J1dHRvblwiLCB0aGlzLmhhbmRsZU1lbnVCdXR0b24pO1xuICAgIHRoaXMuJGVsLm9uKGFueXlvbGsuY2xpY2tVcE9yVG91Y2goKSwgXCIucmVwbGF5X2J1dHRvblwiLCB0aGlzLmhhbmRsZVJlcGxheUJ1dHRvbik7XG4gICAgcmV0dXJuIHRoaXMuJGVsLm9uKGFueXlvbGsuY2xpY2tVcE9yVG91Y2goKSwgXCIuZmFjZWJvb2tfYnV0dG9uXCIsIHRoaXMuaGFuZGxlRmFjZWJvb2tCdXR0b24pO1xuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmhhbmRsZU1lbnVCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHJldHVybiB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwibWVudVwiKTtcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5oYW5kbGVSZXBsYXlCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHJldHVybiB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwiZ2FtZVwiKTtcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5oYW5kbGVGYWNlYm9va0J1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICAkKFwiLmZiX2NvbnRlbnRcIikuaGlkZSgpO1xuICAgICQoXCIuZmFjZWJvb2tfYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIikuZW1wdHkoKS5zcGluKHtcbiAgICAgIGxlbmd0aDogNSxcbiAgICAgIHJhZGl1czogNSxcbiAgICAgIGxpbmVzOiA4LFxuICAgICAgd2lkdGg6IDMsXG4gICAgICBjb2xvcjogXCIjZmZmXCJcbiAgICB9KTtcbiAgICBpZiAoUGFyc2UuVXNlci5jdXJyZW50KCkpIHtcbiAgICAgIHJldHVybiB0aGlzLnNhdmVIaWdoU2NvcmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFBhcnNlLkZhY2Vib29rYW55eW9say5sb2dJbihudWxsLCB7XG4gICAgICAgIHN1Y2Nlc3M6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICBpZiAoIXVzZXIuZXhpc3RlZCgpKSB7XG4gICAgICAgICAgICAgIHJldHVybiBGQi5hcGkoXCIvbWVcIiwgZnVuY3Rpb24ocmVzcG9uc2UpIHtcbiAgICAgICAgICAgICAgICBpZiAoIXJlc3BvbnNlLmVycm9yKSB7XG4gICAgICAgICAgICAgICAgICB1c2VyLnNldChcImRpc3BsYXlOYW1lXCIsIHJlc3BvbnNlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgcmV0dXJuIHVzZXIuc2F2ZShudWxsLCB7XG4gICAgICAgICAgICAgICAgICAgIHN1Y2Nlc3M6IGZ1bmN0aW9uKHVzZXIpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc2F2ZUhpZ2hTY29yZSgpO1xuICAgICAgICAgICAgICAgICAgICB9LFxuICAgICAgICAgICAgICAgICAgICBlcnJvcjogZnVuY3Rpb24odXNlciwgZXJyb3IpIHtcbiAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc29sZS5sb2coXCJPb3BzLCBzb21ldGhpbmcgd2VudCB3cm9uZyBzYXZpbmcgeW91ciBuYW1lLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgIHJldHVybiBjb25zb2xlLmxvZyhcIk9vcHMgc29tZXRoaW5nIHdlbnQgd3Jvbmcgd2l0aCBmYWNlYm9vay5cIik7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgICAgIHJldHVybiBfdGhpcy5zYXZlSGlnaFNjb3JlKCk7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcyksXG4gICAgICAgIGVycm9yOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odXNlciwgZXJyb3IpIHtcbiAgICAgICAgICAgIHJldHVybiBjb25zb2xlLmxvZyhcIk9vcHMsIHNvbWV0aGluZyB3ZW50IHdyb25nLlwiKTtcbiAgICAgICAgICB9O1xuICAgICAgICB9KSh0aGlzKVxuICAgICAgfSk7XG4gICAgfVxuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLnNhdmVIaWdoU2NvcmUgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgc3VibWlzc2lvbjtcbiAgICBzdWJtaXNzaW9uID0ge1xuICAgICAgc2NvcmU6IHRoaXMubW9kZWwuZ2V0U2NvcmVTdWJtaXNzaW9uKClcbiAgICB9O1xuICAgIHJldHVybiBQYXJzZS5DbG91ZC5ydW4oXCJzdWJtaXRIaWdoc2NvcmVcIiwgc3VibWlzc2lvbiwge1xuICAgICAgc3VjY2VzczogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgIHJldHVybiBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICBfdGhpcy5zdWJtaXR0ZWQgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiBfdGhpcy4kKFwiLmZhY2Vib29rX2J1dHRvblwiKS5odG1sKFwiU3VibWl0dGVkIVwiKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpLFxuICAgICAgZXJyb3I6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICBfdGhpcy5zdWJtaXR0ZWQgPSB0cnVlO1xuICAgICAgICAgIHJldHVybiBfdGhpcy4kKFwiLmZhY2Vib29rX2J1dHRvblwiKS5odG1sKFwiIFggVHJ5IEFnYWluLi4uXCIpLnJlbW92ZUNsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKVxuICAgIH0pO1xuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLnJlbmRlclNjZW5lQ2hhbmdlID0gZnVuY3Rpb24obW9kZWwsIHNjZW5lKSB7XG4gICAgaWYgKG1vZGVsLnByZXZpb3VzKFwic2NlbmVcIikgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzY2VuZSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGNvbmdyYXRzSW5kZXg7XG4gICAgY29uZ3JhdHNJbmRleCA9ICh0aGlzLm1vZGVsLmdldChcImxldmVsXCIpID4gR2FtZU92ZXJTY2VuZS5Db25ncmF0cy5sZW5ndGggPyBHYW1lT3ZlclNjZW5lLkNvbmdyYXRzLmxlbmd0aCAtIDEgOiB0aGlzLm1vZGVsLmdldChcImxldmVsXCIpIC0gMSk7XG4gICAgdGhpcy4kZWwuaHRtbCh0aGlzLnRlbXBsYXRlKHtcbiAgICAgIHNjb3JlOiB0aGlzLm1vZGVsLmdldChcInNjb3JlXCIpLFxuICAgICAgY29uZ3JhdHM6IEdhbWVPdmVyU2NlbmUuQ29uZ3JhdHNbY29uZ3JhdHNJbmRleF1cbiAgICB9KSk7XG4gICAgcmV0dXJuICQoXCIjc3RhZ2VcIikuYXBwZW5kKHRoaXMuJGVsKTtcbiAgfTtcblxuICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgIHRoaXMuJChcIi5zdW1tYXJ5XCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VNZW51XCIpO1xuICAgIHJldHVybiB0aGlzLiQoXCIuc3VtbWFyeVwiKS5jc3MoYW55eW9say5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlU2NvcmVzXCIpO1xuICB9O1xuXG4gIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwic2NlbmVcIikgIT09IHRoaXMuc2NlbmVOYW1lICYmICQoZS50YXJnZXQpLmhhc0NsYXNzKFwic3VtbWFyeVwiKSkge1xuICAgICAgcmV0dXJuIHRoaXMuJGVsLmVtcHR5KCk7XG4gICAgfVxuICB9O1xuXG4gIHJldHVybiBHYW1lT3ZlclNjZW5lO1xuXG59KShCYWNrYm9uZS5WaWV3KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuR2FtZVNjZW5lID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoR2FtZVNjZW5lLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIEdhbWVTY2VuZSgpIHtcbiAgICB0aGlzLmNsZWFuVXAgPSBfX2JpbmQodGhpcy5jbGVhblVwLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyQWRkRWdnID0gX19iaW5kKHRoaXMucmVuZGVyQWRkRWdnLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckVnZ3MgPSBfX2JpbmQodGhpcy5yZW5kZXJFZ2dzLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckJhY2tCdXR0b24gPSBfX2JpbmQodGhpcy5yZW5kZXJCYWNrQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlckxpdmVzID0gX19iaW5kKHRoaXMucmVuZGVyTGl2ZXMsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NvcmUgPSBfX2JpbmQodGhpcy5yZW5kZXJTY29yZSwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJMZXZlbExhYmVsID0gX19iaW5kKHRoaXMucmVuZGVyTGV2ZWxMYWJlbCwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJMZXZlbCA9IF9fYmluZCh0aGlzLnJlbmRlckxldmVsLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlciA9IF9fYmluZCh0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjZW5lQ2hhbmdlLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUJhY2tCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVCYWNrQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gR2FtZVNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5jbGFzc05hbWUgPSBcImdhbWVfc2NlbmVcIjtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnNjb3JlVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2dhbWVfc2NvcmVcIikuaHRtbCgpKTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLmxldmVsVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2dhbWVfbGV2ZWxcIikuaHRtbCgpKTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLmxpdmVzVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2dhbWVfbGl2ZXNcIikuaHRtbCgpKTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwiZ2FtZVwiO1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgIGFuaW1hdGlvbmVuZDogXCJjbGVhblVwXCIsXG4gICAgd2Via2l0QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIixcbiAgICBtb3pBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiXG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5lZ2dWaWV3cyA9IFtdO1xuICAgIHRoaXMuJGVsLm9uKGFueXlvbGsuY2xpY2tVcE9yVG91Y2goKSwgXCIuYmFja19idXR0b25cIiwgdGhpcy5oYW5kbGVCYWNrQnV0dG9uKTtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNjZW5lXCIsIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UpO1xuICAgIHRoaXMubW9kZWwuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcImFkZFwiLCB0aGlzLnJlbmRlckFkZEVnZyk7XG4gICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzY29yZVwiLCB0aGlzLnJlbmRlclNjb3JlKTtcbiAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOmxpdmVzXCIsIHRoaXMucmVuZGVyTGl2ZXMpO1xuICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6bGV2ZWxcIiwgdGhpcy5yZW5kZXJMZXZlbCk7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6bGV2ZWxcIiwgdGhpcy5yZW5kZXJMZXZlbExhYmVsKTtcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLmhhbmRsZUJhY2tCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgcmV0dXJuIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICBpZiAobW9kZWwucHJldmlvdXMoXCJzY2VuZVwiKSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUoKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHNjZW5lID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwucmVzZXRHYW1lRGF0YSgpO1xuICAgIHRoaXMuJChcIiNodWRcIikucmVtb3ZlKCk7XG4gICAgdGhpcy4kZWwuYXBwZW5kKFwiPGRpdiBpZD0naHVkJz48L2Rpdj5cIik7XG4gICAgdGhpcy5yZW5kZXJMZXZlbCgpO1xuICAgIHNldFRpbWVvdXQoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMucmVuZGVyTGV2ZWxMYWJlbCgpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSksIDEyMDApO1xuICAgIHRoaXMucmVuZGVyU2NvcmUoKTtcbiAgICB0aGlzLnJlbmRlckxpdmVzKCk7XG4gICAgdGhpcy5yZW5kZXJCYWNrQnV0dG9uKCk7XG4gICAgdGhpcy5yZW5kZXJFZ2dzKCk7XG4gICAgaWYgKCQoXCIjc3RhZ2UgLlwiICsgdGhpcy5jbGFzc05hbWUpLmxlbmd0aCA8PSAwKSB7XG4gICAgICAkKFwiI3N0YWdlXCIpLmFwcGVuZCh0aGlzLiRlbCk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyTGV2ZWwgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy4kKFwiI2dhbWVfbGV2ZWxcIikubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy4kKFwiI2dhbWVfbGV2ZWxcIikucmVwbGFjZVdpdGgodGhpcy5sZXZlbFRlbXBsYXRlKHtcbiAgICAgICAgbGV2ZWw6IHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIilcbiAgICAgIH0pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4kKFwiI2h1ZFwiKS5hcHBlbmQodGhpcy5sZXZlbFRlbXBsYXRlKHtcbiAgICAgICAgbGV2ZWw6IHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIilcbiAgICAgIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJMZXZlbExhYmVsID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kZWwuYXBwZW5kKFwiPHAgY2xhc3M9J2xldmVsX2xhYmVsJz5MRVZFTCBcIiArIHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIikgKyBcIjxicj5HRVQgUkVBRFkhPC9wPlwiKTtcbiAgICBzZXRUaW1lb3V0KCgoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbigpIHtcbiAgICAgICAgcmV0dXJuIF90aGlzLiQoXCIubGV2ZWxfbGFiZWxcIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSksIDMwMDApO1xuICAgIHNldFRpbWVvdXQoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgcmV0dXJuIGZ1bmN0aW9uKCkge1xuICAgICAgICByZXR1cm4gX3RoaXMuJChcIi5sZXZlbF9sYWJlbFwiKS5yZW1vdmUoKTtcbiAgICAgIH07XG4gICAgfSkodGhpcykpLCAzMzAwKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlclNjb3JlID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuJChcIiNnYW1lX3Njb3JlXCIpLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMuJChcIiNnYW1lX3Njb3JlXCIpLnJlcGxhY2VXaXRoKHRoaXMuc2NvcmVUZW1wbGF0ZSh7XG4gICAgICAgIHNjb3JlOiB0aGlzLm1vZGVsLmdldChcInNjb3JlXCIpXG4gICAgICB9KSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuJChcIiNodWRcIikuYXBwZW5kKHRoaXMuc2NvcmVUZW1wbGF0ZSh7XG4gICAgICAgIHNjb3JlOiB0aGlzLm1vZGVsLmdldChcInNjb3JlXCIpXG4gICAgICB9KSk7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyTGl2ZXMgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy4kKFwiI2dhbWVfbGl2ZXNcIikubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy4kKFwiI2dhbWVfbGl2ZXNcIikucmVwbGFjZVdpdGgodGhpcy5saXZlc1RlbXBsYXRlKHtcbiAgICAgICAgbGl2ZXM6IHRoaXMubW9kZWwuZ2V0KFwibGl2ZXNcIilcbiAgICAgIH0pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4kKFwiI2h1ZFwiKS5hcHBlbmQodGhpcy5saXZlc1RlbXBsYXRlKHtcbiAgICAgICAgbGl2ZXM6IHRoaXMubW9kZWwuZ2V0KFwibGl2ZXNcIilcbiAgICAgIH0pKTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJCYWNrQnV0dG9uID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5sZW5ndGggPiAwKSB7XG4gICAgICB0aGlzLiQoXCIuYmFja19idXR0b25cIikucmVwbGFjZVdpdGgoXCI8ZGl2IGNsYXNzPSdiYWNrX2J1dHRvbic+WDwvZGl2PlwiKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy4kZWwuYXBwZW5kKFwiPGRpdiBjbGFzcz0nYmFja19idXR0b24nPlg8L2Rpdj5cIik7XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyRWdncyA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwuYWRkRWdncygpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyQWRkRWdnID0gZnVuY3Rpb24oZWdnTW9kZWwsIGNvbGxlY3Rpb24sIG9wdGlvbnMpIHtcbiAgICB2YXIgZWdnVmlldztcbiAgICBlZ2dWaWV3ID0gbmV3IGFueXlvbGsuRWdnVmlldyh7XG4gICAgICBtb2RlbDogZWdnTW9kZWwsXG4gICAgICBnYW1lU3RhdGU6IHRoaXMubW9kZWwsXG4gICAgICBzY2VuZTogdGhpcy4kZWxcbiAgICB9KTtcbiAgICBlZ2dWaWV3LnJlbmRlcigpO1xuICAgIHRoaXMuZWdnVmlld3MucHVzaChlZ2dWaWV3KTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlclJlbW92ZVNjZW5lID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwieFJhaXNlXCIpO1xuICAgIHRoaXMuJChcIiNodWQgcFwiKS5jc3MoYW55eW9say5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJlbW92ZUhVRFwiKTtcbiAgICB0aGlzLiQoXCIuZWdnXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgXCIwLjNzXCIpO1xuICAgIF8uZWFjaCh0aGlzLmVnZ1ZpZXdzLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgIHJldHVybiBmdW5jdGlvbihlZ2dWaWV3KSB7XG4gICAgICAgIHJldHVybiBlZ2dWaWV3LnJlbmRlclJlbW92ZSgpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gICAgdGhpcy5tb2RlbC5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLnJlc2V0KCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgR2FtZVNjZW5lLnByb3RvdHlwZS5jbGVhblVwID0gZnVuY3Rpb24oZSkge1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcInNjZW5lXCIpICE9PSB0aGlzLnNjZW5lTmFtZSAmJiAkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImJhY2tfYnV0dG9uXCIpKSB7XG4gICAgICB0aGlzLiRlbC5lbXB0eSgpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIEdhbWVTY2VuZTtcblxufSkoQmFja2JvbmUuVmlldyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLkdhbWVTdGF0ZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgX19leHRlbmRzKEdhbWVTdGF0ZSwgX3N1cGVyKTtcblxuICBmdW5jdGlvbiBHYW1lU3RhdGUoKSB7XG4gICAgdGhpcy5nZXRTY29yZVN1Ym1pc3Npb24gPSBfX2JpbmQodGhpcy5nZXRTY29yZVN1Ym1pc3Npb24sIHRoaXMpO1xuICAgIHRoaXMucmVzZXRHYW1lRGF0YSA9IF9fYmluZCh0aGlzLnJlc2V0R2FtZURhdGEsIHRoaXMpO1xuICAgIHRoaXMuY2xlYW5VcEVnZyA9IF9fYmluZCh0aGlzLmNsZWFuVXBFZ2csIHRoaXMpO1xuICAgIHRoaXMuYWRkRWdncyA9IF9fYmluZCh0aGlzLmFkZEVnZ3MsIHRoaXMpO1xuICAgIHRoaXMudmFsaWRhdGVBbGl2ZSA9IF9fYmluZCh0aGlzLnZhbGlkYXRlQWxpdmUsIHRoaXMpO1xuICAgIHRoaXMuaW5jcmVtZW50TGV2ZWwgPSBfX2JpbmQodGhpcy5pbmNyZW1lbnRMZXZlbCwgdGhpcyk7XG4gICAgdGhpcy5kZWNyZW1lbnRMaWZlID0gX19iaW5kKHRoaXMuZGVjcmVtZW50TGlmZSwgdGhpcyk7XG4gICAgdGhpcy5pbmNyZW1lbnRTY29yZSA9IF9fYmluZCh0aGlzLmluY3JlbWVudFNjb3JlLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gR2FtZVN0YXRlLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgR2FtZVN0YXRlLkRlZmF1bHRHYW1lRGF0YSA9IHtcbiAgICBzY29yZTogMCxcbiAgICBsaXZlczogMyxcbiAgICBsZXZlbDogMSxcbiAgICBzcGVlZFg6IDFcbiAgfTtcblxuICBHYW1lU3RhdGUucHJvdG90eXBlLmRlZmF1bHRzID0ge1xuICAgIHNjZW5lOiBcIlwiLFxuICAgIGVnZ0NvbGxlY3Rpb246IG51bGwsXG4gICAgc3BlZWRYOiAxXG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIHF1ZXJ5O1xuICAgIHRoaXMuc2V0KFwiZWdnQ29sbGVjdGlvblwiLCBuZXcgQmFja2JvbmUuQ29sbGVjdGlvbigpKTtcbiAgICBxdWVyeSA9IG5ldyBQYXJzZS5RdWVyeShcIkhpZ2hTY29yZVwiKTtcbiAgICBxdWVyeS5kZXNjZW5kaW5nKFwic2NvcmVcIik7XG4gICAgcXVlcnkuaW5jbHVkZShcInBsYXllclwiKTtcbiAgICBxdWVyeS5saW1pdCgxMCk7XG4gICAgdGhpcy5zZXQoXCJoaWdoc2NvcmVDb2xsZWN0aW9uXCIsIHF1ZXJ5LmNvbGxlY3Rpb24oKSk7XG4gICAgdGhpcy5yZXNldEdhbWVEYXRhKCk7XG4gICAgdGhpcy5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLm9uKFwiZmx5XCIsIHRoaXMuaW5jcmVtZW50U2NvcmUpO1xuICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcImJyZWFrXCIsIHRoaXMuZGVjcmVtZW50TGlmZSk7XG4gICAgdGhpcy5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLm9uKFwiZmx5IGJyZWFrXCIsIHRoaXMuY2xlYW5VcEVnZyk7XG4gICAgcmV0dXJuIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcInJlbW92ZVwiLCB0aGlzLmluY3JlbWVudExldmVsKTtcbiAgfTtcblxuICBHYW1lU3RhdGUucHJvdG90eXBlLmluY3JlbWVudFNjb3JlID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc2V0KFwic2NvcmVcIiwgdGhpcy5nZXQoXCJzY29yZVwiKSArIDEpO1xuICB9O1xuXG4gIEdhbWVTdGF0ZS5wcm90b3R5cGUuZGVjcmVtZW50TGlmZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuc2V0KFwibGl2ZXNcIiwgdGhpcy5nZXQoXCJsaXZlc1wiKSAtIDEpO1xuICAgIHJldHVybiB0aGlzLnZhbGlkYXRlQWxpdmUoKTtcbiAgfTtcblxuICBHYW1lU3RhdGUucHJvdG90eXBlLmluY3JlbWVudExldmVsID0gZnVuY3Rpb24oKSB7XG4gICAgaWYgKHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5sZW5ndGggPD0gMCkge1xuICAgICAgdGhpcy5zZXQoXCJsZXZlbFwiLCB0aGlzLmdldChcImxldmVsXCIpICsgMSk7XG4gICAgICB0aGlzLnNldChcInNwZWVkWFwiLCB0aGlzLmdldChcInNwZWVkWFwiKSArIDAuMjUpO1xuICAgICAgcmV0dXJuIHRoaXMuYWRkRWdncygpO1xuICAgIH1cbiAgfTtcblxuICBHYW1lU3RhdGUucHJvdG90eXBlLnZhbGlkYXRlQWxpdmUgPSBmdW5jdGlvbigpIHtcbiAgICBpZiAodGhpcy5nZXQoXCJsaXZlc1wiKSA8PSAwKSB7XG4gICAgICByZXR1cm4gdGhpcy5zZXQoXCJzY2VuZVwiLCBcImdhbWVfb3ZlclwiKTtcbiAgICB9XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5hZGRFZ2dzID0gZnVuY3Rpb24oKSB7XG4gICAgdmFyIGksIG51bUVnZ3MsIF9yZXN1bHRzO1xuICAgIG51bUVnZ3MgPSAxMDtcbiAgICBpID0gMDtcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIHdoaWxlIChpIDwgbnVtRWdncykge1xuICAgICAgdGhpcy5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLmFkZChuZXcgYW55eW9say5FZ2dNb2RlbCh7XG4gICAgICAgIGNvbGxlY3Rpb25JbmRleDogaVxuICAgICAgfSkpO1xuICAgICAgX3Jlc3VsdHMucHVzaChpKyspO1xuICAgIH1cbiAgICByZXR1cm4gX3Jlc3VsdHM7XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5jbGVhblVwRWdnID0gZnVuY3Rpb24oZWdnTW9kZWwpIHtcbiAgICByZXR1cm4gdGhpcy5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLnJlbW92ZShlZ2dNb2RlbCk7XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5yZXNldEdhbWVEYXRhID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuIHRoaXMuc2V0KGFueXlvbGsuR2FtZVN0YXRlLkRlZmF1bHRHYW1lRGF0YSk7XG4gIH07XG5cbiAgR2FtZVN0YXRlLnByb3RvdHlwZS5nZXRTY29yZVN1Ym1pc3Npb24gPSBmdW5jdGlvbigpIHtcbiAgICByZXR1cm4gKCh0aGlzLmdldChcImxldmVsXCIpICogMzYyKSA8PCA1KSArIFwiLlwiICsgKCh0aGlzLmdldChcInNjb3JlXCIpICogNjcyKSA8PCA0KTtcbiAgfTtcblxuICByZXR1cm4gR2FtZVN0YXRlO1xuXG59KShCYWNrYm9uZS5Nb2RlbCk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLkhpZ2hzY29yZVNjZW5lID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoSGlnaHNjb3JlU2NlbmUsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gSGlnaHNjb3JlU2NlbmUoKSB7XG4gICAgdGhpcy5jbGVhblVwID0gX19iaW5kKHRoaXMuY2xlYW5VcCwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSA9IF9fYmluZCh0aGlzLnJlbmRlclJlbW92ZVNjZW5lLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjb3JlID0gX19iaW5kKHRoaXMucmVuZGVyU2NvcmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyU2NvcmVDb2xsZWN0aW9uID0gX19iaW5kKHRoaXMucmVuZGVyU2NvcmVDb2xsZWN0aW9uLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlciA9IF9fYmluZCh0aGlzLnJlbmRlciwgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjZW5lQ2hhbmdlLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZUJhY2tCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVCYWNrQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gSGlnaHNjb3JlU2NlbmUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gIH1cblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJoaWdoc2NvcmVfc2NlbmVcIjtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUudGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2hpZ2hzY29yZVwiKS5odG1sKCkpO1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5zY29yZVRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKFwiI19zY29yZVwiKS5odG1sKCkpO1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5zY2VuZU5hbWUgPSBcImhpZ2hzY29yZVwiO1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5ldmVudHMgPSB7XG4gICAgYW5pbWF0aW9uZW5kOiBcImNsZWFuVXBcIixcbiAgICB3ZWJraXRBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiLFxuICAgIG1vekFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCJcbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c2NlbmVcIiwgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSk7XG4gICAgdGhpcy5tb2RlbC5nZXQoXCJoaWdoc2NvcmVDb2xsZWN0aW9uXCIpLm9uKFwicmVzZXRcIiwgdGhpcy5yZW5kZXJTY29yZUNvbGxlY3Rpb24pO1xuICAgIHRoaXMuJGVsLm9uKGFueXlvbGsuY2xpY2tVcE9yVG91Y2goKSwgXCIuYmFja19idXR0b25cIiwgdGhpcy5oYW5kbGVCYWNrQnV0dG9uKTtcbiAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJjdXJyZW50U2NlbmVcIikgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXIoKTtcbiAgICB9XG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmhhbmRsZUJhY2tCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcIm1lbnVcIik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJTY2VuZUNoYW5nZSA9IGZ1bmN0aW9uKG1vZGVsLCBzY2VuZSkge1xuICAgIGlmIChtb2RlbC5wcmV2aW91cyhcInNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoc2NlbmUgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgIHRoaXMucmVuZGVyKCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUoKSk7XG4gICAgdGhpcy5tb2RlbC5nZXQoXCJoaWdoc2NvcmVDb2xsZWN0aW9uXCIpLmZldGNoKCk7XG4gICAgdGhpcy4kKFwiLmhpZ2hzY29yZVwiKS5zcGluKHtcbiAgICAgIGxlbmd0aDogOSxcbiAgICAgIHJhZGl1czogMTAsXG4gICAgICBsaW5lczogMTIsXG4gICAgICB3aWR0aDogNCxcbiAgICAgIGNvbG9yOiBcIiNmZmZcIlxuICAgIH0pO1xuICAgICQoXCIjc3RhZ2VcIikuYXBwZW5kKHRoaXMuJGVsKTtcbiAgICByZXR1cm4gdGhpcztcbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NvcmVDb2xsZWN0aW9uID0gZnVuY3Rpb24oKSB7XG4gICAgdGhpcy5tb2RlbC5nZXQoXCJoaWdoc2NvcmVDb2xsZWN0aW9uXCIpLmVhY2goKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcmUsIGluZGV4KSB7XG4gICAgICAgIHJldHVybiBfdGhpcy5yZW5kZXJTY29yZShzY29yZSwgaW5kZXgpO1xuICAgICAgfTtcbiAgICB9KSh0aGlzKSk7XG4gICAgJChcIi5oaWdoc2NvcmUgLnNwaW5uZXJcIikucmVtb3ZlKCk7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLnJlbmRlclNjb3JlID0gZnVuY3Rpb24oc2NvcmUsIGluZGV4KSB7XG4gICAgcmV0dXJuIHRoaXMuJChcIiNzY29yZV90YWJsZSB0Ym9keVwiKS5hcHBlbmQodGhpcy5zY29yZVRlbXBsYXRlKHtcbiAgICAgIHNjb3JlOiBzY29yZSxcbiAgICAgIGluZGV4OiBpbmRleFxuICAgIH0pKTtcbiAgfTtcblxuICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUucmVuZGVyUmVtb3ZlU2NlbmUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIuaGlnaHNjb3JlXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VNZW51XCIpO1xuICAgIHJldHVybiB0aGlzLiQoXCIuaGlnaHNjb3JlXCIpLmNzcyhhbnl5b2xrLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VTY29yZXNcIik7XG4gIH07XG5cbiAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwic2NlbmVcIikgIT09IHRoaXMuc2NlbmVOYW1lICYmICQoZS50YXJnZXQpLmhhc0NsYXNzKFwiaGlnaHNjb3JlXCIpKSB7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuZW1wdHkoKTtcbiAgICB9XG4gIH07XG5cbiAgcmV0dXJuIEhpZ2hzY29yZVNjZW5lO1xuXG59KShCYWNrYm9uZS5WaWV3KTtcbiIsIi8vIEdlbmVyYXRlZCBieSBDb2ZmZWVTY3JpcHQgMS43LjFcbnZhciBhbnl5b2xrLFxuICBfX2JpbmQgPSBmdW5jdGlvbihmbiwgbWUpeyByZXR1cm4gZnVuY3Rpb24oKXsgcmV0dXJuIGZuLmFwcGx5KG1lLCBhcmd1bWVudHMpOyB9OyB9LFxuICBfX2hhc1Byb3AgPSB7fS5oYXNPd25Qcm9wZXJ0eSxcbiAgX19leHRlbmRzID0gZnVuY3Rpb24oY2hpbGQsIHBhcmVudCkgeyBmb3IgKHZhciBrZXkgaW4gcGFyZW50KSB7IGlmIChfX2hhc1Byb3AuY2FsbChwYXJlbnQsIGtleSkpIGNoaWxkW2tleV0gPSBwYXJlbnRba2V5XTsgfSBmdW5jdGlvbiBjdG9yKCkgeyB0aGlzLmNvbnN0cnVjdG9yID0gY2hpbGQ7IH0gY3Rvci5wcm90b3R5cGUgPSBwYXJlbnQucHJvdG90eXBlOyBjaGlsZC5wcm90b3R5cGUgPSBuZXcgY3RvcigpOyBjaGlsZC5fX3N1cGVyX18gPSBwYXJlbnQucHJvdG90eXBlOyByZXR1cm4gY2hpbGQ7IH07XG5cbmFueXlvbGsgPSByZXF1aXJlKCcuLi9hbnl5b2xrJyk7XG5cbmFueXlvbGsuTWVudVNjZW5lID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoTWVudVNjZW5lLCBfc3VwZXIpO1xuXG4gIGZ1bmN0aW9uIE1lbnVTY2VuZSgpIHtcbiAgICB0aGlzLmNsZWFuVXAgPSBfX2JpbmQodGhpcy5jbGVhblVwLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICB0aGlzLnJlbmRlclNjZW5lQ2hhbmdlID0gX19iaW5kKHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UsIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlQ3JlZGl0c0J1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZUNyZWRpdHNCdXR0b24sIHRoaXMpO1xuICAgIHRoaXMuaGFuZGxlSGlnaHNjb3JlQnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlSGlnaHNjb3JlQnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmhhbmRsZVBsYXlCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVQbGF5QnV0dG9uLCB0aGlzKTtcbiAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICByZXR1cm4gTWVudVNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICB9XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5jbGFzc05hbWUgPSBcIm1lbnVfc2NlbmVcIjtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLnRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKFwiI19tZW51XCIpLmh0bWwoKSk7XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5zY2VuZU5hbWUgPSBcIm1lbnVcIjtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLmV2ZW50cyA9IHtcbiAgICBcImFuaW1hdGlvbmVuZCAudGl0bGVcIjogXCJjbGVhblVwXCIsXG4gICAgXCJ3ZWJraXRBbmltYXRpb25FbmQgLnRpdGxlXCI6IFwiY2xlYW5VcFwiLFxuICAgIFwibW96QW5pbWF0aW9uRW5kIC50aXRsZVwiOiBcImNsZWFuVXBcIlxuICB9O1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c2NlbmVcIiwgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSk7XG4gICAgdGhpcy4kZWwub24oYW55eW9say5jbGlja1VwT3JUb3VjaCgpLCBcIiNwbGF5X2J1dHRvblwiLCB0aGlzLmhhbmRsZVBsYXlCdXR0b24pO1xuICAgIHRoaXMuJGVsLm9uKGFueXlvbGsuY2xpY2tVcE9yVG91Y2goKSwgXCIjaGlnaHNjb3JlX2J1dHRvblwiLCB0aGlzLmhhbmRsZUhpZ2hzY29yZUJ1dHRvbik7XG4gICAgdGhpcy4kZWwub24oYW55eW9say5jbGlja1VwT3JUb3VjaCgpLCBcIiNjcmVkaXRzX2J1dHRvblwiLCB0aGlzLmhhbmRsZUNyZWRpdHNCdXR0b24pO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUuaGFuZGxlUGxheUJ1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcImdhbWVcIik7XG4gICAgcmV0dXJuIGZhbHNlO1xuICB9O1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUuaGFuZGxlSGlnaHNjb3JlQnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwiaGlnaHNjb3JlXCIpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLmhhbmRsZUNyZWRpdHNCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJjcmVkaXRzXCIpO1xuICAgIHJldHVybiBmYWxzZTtcbiAgfTtcblxuICBNZW51U2NlbmUucHJvdG90eXBlLnJlbmRlclNjZW5lQ2hhbmdlID0gZnVuY3Rpb24obW9kZWwsIHNjZW5lKSB7XG4gICAgaWYgKG1vZGVsLnByZXZpb3VzKFwic2NlbmVcIikgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmIChzY2VuZSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUoKSk7XG4gICAgJChcIiNzdGFnZVwiKS5hcHBlbmQodGhpcy4kZWwpO1xuICAgIHJldHVybiB0aGlzO1xuICB9O1xuXG4gIE1lbnVTY2VuZS5wcm90b3R5cGUucmVuZGVyUmVtb3ZlU2NlbmUgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIudGl0bGVcIikucmVtb3ZlQ2xhc3MoXCJkaXNwbGF5XCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICB0aGlzLiQoXCIudGl0bGVcIikuY3NzKGFueXlvbGsuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyYWlzZVRpdGxlXCIpO1xuICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuY3NzKGFueXlvbGsuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyYWlzZU1lbnVcIik7XG4gICAgcmV0dXJuIHRoaXM7XG4gIH07XG5cbiAgTWVudVNjZW5lLnByb3RvdHlwZS5jbGVhblVwID0gZnVuY3Rpb24oZSkge1xuICAgIGlmICh0aGlzLm1vZGVsLmdldChcInNjZW5lXCIpICE9PSB0aGlzLnNjZW5lTmFtZSAmJiAkKGUudGFyZ2V0KS5oYXNDbGFzcyhcInRpdGxlXCIpKSB7XG4gICAgICB0aGlzLiRlbC5lbXB0eSgpO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH07XG5cbiAgcmV0dXJuIE1lbnVTY2VuZTtcblxufSkoQmFja2JvbmUuVmlldyk7XG4iLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgYW55eW9sayxcbiAgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG5hbnl5b2xrID0gcmVxdWlyZSgnLi4vYW55eW9saycpO1xuXG5hbnl5b2xrLlN0YWdlID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICBfX2V4dGVuZHMoU3RhZ2UsIF9zdXBlcik7XG5cbiAgZnVuY3Rpb24gU3RhZ2UoKSB7XG4gICAgdGhpcy5yZW5kZXJDbG91ZHMgPSBfX2JpbmQodGhpcy5yZW5kZXJDbG91ZHMsIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyVHJlZXMgPSBfX2JpbmQodGhpcy5yZW5kZXJUcmVlcywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXJTdW4gPSBfX2JpbmQodGhpcy5yZW5kZXJTdW4sIHRoaXMpO1xuICAgIHRoaXMucmVuZGVyVGlsZXMgPSBfX2JpbmQodGhpcy5yZW5kZXJUaWxlcywgdGhpcyk7XG4gICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgIHJldHVybiBTdGFnZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgfVxuXG4gIFN0YWdlLnByb3RvdHlwZS5lbCA9IFwiI3N0YWdlXCI7XG5cbiAgU3RhZ2UucHJvdG90eXBlLnRpbGVUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfdGlsZV9wYWlyXCIpLmh0bWwoKSk7XG5cbiAgU3RhZ2UucHJvdG90eXBlLnRyZWVUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfdHJlZVwiKS5odG1sKCkpO1xuXG4gIFN0YWdlLnByb3RvdHlwZS5zdW5UZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfc3VuXCIpLmh0bWwoKSk7XG5cbiAgU3RhZ2UucHJvdG90eXBlLmNsb3VkVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2Nsb3VkXCIpLmh0bWwoKSk7XG5cbiAgU3RhZ2UucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgIHRoaXMuJGVsLmNzcyhcImhlaWdodFwiLCAkKHdpbmRvdykuaGVpZ2h0KCkpO1xuICAgIHRoaXMucmVuZGVyU3VuKCk7XG4gICAgdGhpcy5yZW5kZXJUcmVlcygpO1xuICAgIHRoaXMucmVuZGVyVGlsZXMoKTtcbiAgICByZXR1cm4gdGhpcy5yZW5kZXJDbG91ZHMoKTtcbiAgfTtcblxuICBTdGFnZS5wcm90b3R5cGUucmVuZGVyVGlsZXMgPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIudGlsZVwiKS5yZW1vdmUoKTtcbiAgICByZXR1cm4gdGhpcy4kZWwuYXBwZW5kKHRoaXMudGlsZVRlbXBsYXRlKCkpO1xuICB9O1xuXG4gIFN0YWdlLnByb3RvdHlwZS5yZW5kZXJTdW4gPSBmdW5jdGlvbigpIHtcbiAgICB0aGlzLiQoXCIuc3VuXCIpLnJlbW92ZSgpO1xuICAgIHJldHVybiB0aGlzLiRlbC5hcHBlbmQodGhpcy5zdW5UZW1wbGF0ZSgpKTtcbiAgfTtcblxuICBTdGFnZS5wcm90b3R5cGUucmVuZGVyVHJlZXMgPSBmdW5jdGlvbigpIHtcbiAgICB2YXIgaSwgbGVmdCwgbnVtVHJlZXMsIF9yZXN1bHRzO1xuICAgIG51bVRyZWVzID0gTWF0aC5jZWlsKCQod2luZG93KS53aWR0aCgpIC8gMjAwKTtcbiAgICB0aGlzLiQoXCIudHJlZVwiKS5yZW1vdmUoKTtcbiAgICBpZiAobnVtVHJlZXMgPD0gMikge1xuICAgICAgdGhpcy4kZWwuYXBwZW5kKHRoaXMudHJlZVRlbXBsYXRlKHtcbiAgICAgICAgdHJlZU51bTogMyxcbiAgICAgICAgbGVmdFZhbHVlOiAtMTAwXG4gICAgICB9KSk7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuYXBwZW5kKHRoaXMudHJlZVRlbXBsYXRlKHtcbiAgICAgICAgdHJlZU51bTogMSxcbiAgICAgICAgbGVmdFZhbHVlOiAxMjBcbiAgICAgIH0pKTtcbiAgICB9IGVsc2Uge1xuICAgICAgaSA9IDA7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgd2hpbGUgKGkgPCBudW1UcmVlcykge1xuICAgICAgICBsZWZ0ID0gTWF0aC5yYW5kb20oKSAqIDIwMC4gKyBpICogMjAwO1xuICAgICAgICB0aGlzLiRlbC5hcHBlbmQodGhpcy50cmVlVGVtcGxhdGUoe1xuICAgICAgICAgIHRyZWVOdW06IC0xLFxuICAgICAgICAgIGxlZnRWYWx1ZTogbGVmdCAtIDMwMFxuICAgICAgICB9KSk7XG4gICAgICAgIF9yZXN1bHRzLnB1c2goaSsrKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9XG4gIH07XG5cbiAgU3RhZ2UucHJvdG90eXBlLnJlbmRlckNsb3VkcyA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBkZWxheSwgZGlyLCBpLCBudW1DbG91ZHMsIHNwZWVkLCB0b3AsIF9yZXN1bHRzO1xuICAgIG51bUNsb3VkcyA9IE1hdGguY2VpbCgkKHdpbmRvdykud2lkdGgoKSAvIDIwMCk7XG4gICAgbnVtQ2xvdWRzID0gKG51bUNsb3VkcyA8IDIgPyAyIDogbnVtQ2xvdWRzKTtcbiAgICBpID0gMDtcbiAgICBfcmVzdWx0cyA9IFtdO1xuICAgIHdoaWxlIChpIDwgbnVtQ2xvdWRzKSB7XG4gICAgICB0b3AgPSBNYXRoLnJhbmRvbSgpICogNTA7XG4gICAgICBkZWxheSA9IE1hdGgucmFuZG9tKCkgKiA4IC0gNCArICgxMCAqIGkpO1xuICAgICAgc3BlZWQgPSAyMDtcbiAgICAgIGRpciA9IChNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiAyKSA8IDEgPyBcImxlZnRcIiA6IFwicmlnaHRcIik7XG4gICAgICB0aGlzLiRlbC5hcHBlbmQodGhpcy5jbG91ZFRlbXBsYXRlKHtcbiAgICAgICAgYnA6IGFueXlvbGsuYnAsXG4gICAgICAgIGRlbGF5OiBkZWxheSxcbiAgICAgICAgZGlyZWN0aW9uOiBkaXIsXG4gICAgICAgIGR1cmF0aW9uOiAkKHdpbmRvdykud2lkdGgoKSAvIHNwZWVkLFxuICAgICAgICB0b3BWYWx1ZTogdG9wXG4gICAgICB9KSk7XG4gICAgICBfcmVzdWx0cy5wdXNoKGkrKyk7XG4gICAgfVxuICAgIHJldHVybiBfcmVzdWx0cztcbiAgfTtcblxuICByZXR1cm4gU3RhZ2U7XG5cbn0pKEJhY2tib25lLlZpZXcpO1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxudmFyIGFueXlvbGs7XG5cbm1vZHVsZS5leHBvcnRzID0gYW55eW9sayA9IChmdW5jdGlvbigpIHtcbiAgZnVuY3Rpb24gYW55eW9saygpIHt9XG5cbiAgYW55eW9say5icCA9IGZ1bmN0aW9uKCkge1xuICAgIHZhciBicDtcbiAgICBicCA9IFwiXCI7XG4gICAgaWYgKCQuYnJvd3Nlci53ZWJraXQpIHtcbiAgICAgIGJwID0gXCItd2Via2l0LVwiO1xuICAgIH0gZWxzZSB7XG4gICAgICBpZiAoJC5icm93c2VyLm1vemlsbGEpIHtcbiAgICAgICAgYnAgPSBcIi1tb3otXCI7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBicDtcbiAgfTtcblxuICBhbnl5b2xrLmlzU3VwcG9ydGVkID0gZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICEoJC5icm93c2VyLm1zaWUgJiYgcGFyc2VJbnQoJC5icm93c2VyLnZlcnNpb24pIDwgMTApO1xuICB9O1xuXG4gIGFueXlvbGsubmV4dFRpY2sgPSBmdW5jdGlvbihmdW5jKSB7XG4gICAgcmV0dXJuIHNldFRpbWVvdXQoZnVuYywgMCk7XG4gIH07XG5cbiAgYW55eW9say5jbGlja1VwT3JUb3VjaCA9IGZ1bmN0aW9uKGZ1bmMpIHtcbiAgICBpZiAoXCJvbnRvdWNoc3RhcnRcIiBpbiB3aW5kb3cpIHtcbiAgICAgIHJldHVybiBcInRvdWNoc3RhcnRcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIFwibW91c2V1cFwiO1xuICAgIH1cbiAgfTtcblxuICBhbnl5b2xrLmNsaWNrRG93bk9yVG91Y2ggPSBmdW5jdGlvbihmdW5jKSB7XG4gICAgaWYgKFwib250b3VjaHN0YXJ0XCIgaW4gd2luZG93KSB7XG4gICAgICByZXR1cm4gXCJ0b3VjaHN0YXJ0XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBcIm1vdXNlZG93blwiO1xuICAgIH1cbiAgfTtcblxuICByZXR1cm4gYW55eW9saztcblxufSkoKTtcblxucmVxdWlyZSgnLi9HYW1lU3RhdGUnKTtcblxucmVxdWlyZSgnLi9FZ2dNb2RlbCcpO1xuXG5yZXF1aXJlKCcuL0VnZ1ZpZXcnKTtcblxucmVxdWlyZSgnLi9TdGFnZScpO1xuXG5yZXF1aXJlKCcuL01lbnVTY2VuZScpO1xuXG5yZXF1aXJlKCcuL0dhbWVTY2VuZScpO1xuXG5yZXF1aXJlKCcuL0dhbWVPdmVyU2NlbmUnKTtcblxucmVxdWlyZSgnLi9IaWdoc2NvcmVTY2VuZScpO1xuXG5yZXF1aXJlKCcuL0NyZWRpdHNTY2VuZScpO1xuXG4kLnByb3RvdHlwZS5zcGluID0gZnVuY3Rpb24ob3B0cykge1xuICB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgdmFyICR0aGlzLCBkYXRhO1xuICAgICR0aGlzID0gJCh0aGlzKTtcbiAgICBkYXRhID0gJHRoaXMuZGF0YSgpO1xuICAgIGlmIChkYXRhLnNwaW5uZXIpIHtcbiAgICAgIGRhdGEuc3Bpbm5lci5zdG9wKCk7XG4gICAgICBkZWxldGUgZGF0YS5zcGlubmVyO1xuICAgIH1cbiAgICBpZiAob3B0cyAhPT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBkYXRhLnNwaW5uZXIgPSBuZXcgU3Bpbm5lcigkLmV4dGVuZCh7XG4gICAgICAgIGNvbG9yOiAkdGhpcy5jc3MoXCJjb2xvclwiKVxuICAgICAgfSwgb3B0cykpLnNwaW4odGhpcyk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuIiwiLy8gR2VuZXJhdGVkIGJ5IENvZmZlZVNjcmlwdCAxLjcuMVxuUGFyc2UuaW5pdGlhbGl6ZShcIjBaVW4xVGFERjlHM2o2VWh2b05GdUlWU3pGNDV2cFNPOUswcmxvc01cIiwgXCJvVTFUb1o5TE5ab01zbHBocGd4UU5vVmpKWEVxb2k1OU0wMThaUDA4XCIpO1xuXG53aW5kb3cuZmJBc3luY0luaXQgPSBmdW5jdGlvbigpIHtcbiAgcmV0dXJuIFBhcnNlLkZhY2Vib29rVXRpbHMuaW5pdCh7XG4gICAgYXBwSWQ6IFwiMTM4MDEwMzE4MjI1MDUyMFwiLFxuICAgIGNoYW5uZWxVcmw6IFwiL2NoYW5uZWwuaHRtbFwiLFxuICAgIHN0YXR1czogdHJ1ZSxcbiAgICBjb29raWU6IHRydWUsXG4gICAgeGZibWw6IHRydWVcbiAgfSk7XG59O1xuXG4oZnVuY3Rpb24oZCwgZGVidWcpIHtcbiAgdmFyIGlkLCBqcywgcmVmO1xuICBqcyA9IHZvaWQgMDtcbiAgaWQgPSBcImZhY2Vib29rLWpzc2RrXCI7XG4gIHJlZiA9IGQuZ2V0RWxlbWVudHNCeVRhZ05hbWUoXCJzY3JpcHRcIilbMF07XG4gIGlmIChkLmdldEVsZW1lbnRCeUlkKGlkKSkge1xuICAgIHJldHVybjtcbiAgfVxuICBqcyA9IGQuY3JlYXRlRWxlbWVudChcInNjcmlwdFwiKTtcbiAganMuaWQgPSBpZDtcbiAganMuYXN5bmMgPSB0cnVlO1xuICBqcy5zcmMgPSBcIi8vY29ubmVjdC5mYWNlYm9vay5uZXQvZW5fVVMvYWxsXCIgKyAoZGVidWcgPyBcIi9kZWJ1Z1wiIDogXCJcIikgKyBcIi5qc1wiO1xuICByZXR1cm4gcmVmLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKGpzLCByZWYpO1xufSkoZG9jdW1lbnQsIGZhbHNlKTtcblxuJChmdW5jdGlvbigpIHtcbiAgdmFyIGFueXlvbGssIG1vZGVsO1xuICBhbnl5b2xrID0gcmVxdWlyZSgnLi9hbnl5b2xrJyk7XG4gIGlmIChhbnl5b2xrLmlzU3VwcG9ydGVkKCkpIHtcbiAgICBtb2RlbCA9IG5ldyBhbnl5b2xrLkdhbWVTdGF0ZSgpO1xuICAgIG5ldyBhbnl5b2xrLlN0YWdlKHtcbiAgICAgIG1vZGVsOiBtb2RlbFxuICAgIH0pLnJlbmRlcigpO1xuICAgIG5ldyBhbnl5b2xrLk1lbnVTY2VuZSh7XG4gICAgICBtb2RlbDogbW9kZWxcbiAgICB9KTtcbiAgICBuZXcgYW55eW9say5HYW1lU2NlbmUoe1xuICAgICAgbW9kZWw6IG1vZGVsXG4gICAgfSk7XG4gICAgbmV3IGFueXlvbGsuR2FtZU92ZXJTY2VuZSh7XG4gICAgICBtb2RlbDogbW9kZWxcbiAgICB9KTtcbiAgICBuZXcgYW55eW9say5IaWdoc2NvcmVTY2VuZSh7XG4gICAgICBtb2RlbDogbW9kZWxcbiAgICB9KTtcbiAgICBuZXcgYW55eW9say5DcmVkaXRzU2NlbmUoe1xuICAgICAgbW9kZWw6IG1vZGVsXG4gICAgfSk7XG4gICAgbW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICAgICQoXCIjc3RhZ2VcIikub24oXCJkcmFnc3RhcnQgc2VsZWN0c3RhcnRcIiwgXCIqXCIsIGZ1bmN0aW9uKGV2ZW50KSB7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfSk7XG4gICAgcmV0dXJuIGRvY3VtZW50Lm9udG91Y2htb3ZlID0gZnVuY3Rpb24oZSkge1xuICAgICAgcmV0dXJuIGUucHJldmVudERlZmF1bHQoKTtcbiAgICB9O1xuICB9IGVsc2Uge1xuICAgIHJldHVybiAkKFwiI3Vuc3VwcG9ydGVkXCIpLnNob3coKTtcbiAgfVxufSk7XG4iXX0=
