(function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
// Generated by CoffeeScript 1.7.1
var __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; },
  __hasProp = {}.hasOwnProperty,
  __extends = function(child, parent) { for (var key in parent) { if (__hasProp.call(parent, key)) child[key] = parent[key]; } function ctor() { this.constructor = child; } ctor.prototype = parent.prototype; child.prototype = new ctor(); child.__super__ = parent.prototype; return child; };

$(function() {
  var CreditsScene, EggModel, EggView, Game, GameOverScene, GameScene, GameState, HighscoreScene, MenuScene, Stage;
  Game = {
    initialize: function() {
      var model;
      if (Utils.isSupported()) {
        model = new GameState();
        new Stage({
          model: model
        }).render();
        new MenuScene({
          model: model
        });
        new GameScene({
          model: model
        });
        new GameOverScene({
          model: model
        });
        new HighscoreScene({
          model: model
        });
        new CreditsScene({
          model: model
        });
        model.set("scene", "menu");
        $("#stage").on("dragstart selectstart", "*", function(event) {
          return false;
        });
        return document.ontouchmove = function(e) {
          return e.preventDefault();
        };
      } else {
        return $("#unsupported").show();
      }
    }
  };

  /*
  Models ****
   */
  GameState = (function(_super) {
    __extends(GameState, _super);

    function GameState() {
      this.getScoreSubmission = __bind(this.getScoreSubmission, this);
      this.resetGameData = __bind(this.resetGameData, this);
      this.cleanUpEgg = __bind(this.cleanUpEgg, this);
      this.addEggs = __bind(this.addEggs, this);
      this.validateAlive = __bind(this.validateAlive, this);
      this.incrementLevel = __bind(this.incrementLevel, this);
      this.decrementLife = __bind(this.decrementLife, this);
      this.incrementScore = __bind(this.incrementScore, this);
      this.initialize = __bind(this.initialize, this);
      return GameState.__super__.constructor.apply(this, arguments);
    }

    GameState.DefaultGameData = {
      score: 0,
      lives: 3,
      level: 1,
      speedX: 1
    };

    GameState.prototype.defaults = {
      scene: "",
      eggCollection: null,
      speedX: 1
    };

    GameState.prototype.initialize = function() {
      var query;
      this.set("eggCollection", new Backbone.Collection());
      query = new Parse.Query("HighScore");
      query.descending("score");
      query.include("player");
      query.limit(10);
      this.set("highscoreCollection", query.collection());
      this.resetGameData();
      this.get("eggCollection").on("fly", this.incrementScore);
      this.get("eggCollection").on("break", this.decrementLife);
      this.get("eggCollection").on("fly break", this.cleanUpEgg);
      return this.get("eggCollection").on("remove", this.incrementLevel);
    };

    GameState.prototype.incrementScore = function() {
      return this.set("score", this.get("score") + 1);
    };

    GameState.prototype.decrementLife = function() {
      this.set("lives", this.get("lives") - 1);
      return this.validateAlive();
    };

    GameState.prototype.incrementLevel = function() {
      if (this.get("eggCollection").length <= 0) {
        this.set("level", this.get("level") + 1);
        this.set("speedX", this.get("speedX") + 0.25);
        return this.addEggs();
      }
    };

    GameState.prototype.validateAlive = function() {
      if (this.get("lives") <= 0) {
        return this.set("scene", "game_over");
      }
    };

    GameState.prototype.addEggs = function() {
      var i, numEggs, _results;
      numEggs = 10;
      i = 0;
      _results = [];
      while (i < numEggs) {
        this.get("eggCollection").add(new EggModel({
          collectionIndex: i
        }));
        _results.push(i++);
      }
      return _results;
    };

    GameState.prototype.cleanUpEgg = function(eggModel) {
      return this.get("eggCollection").remove(eggModel);
    };

    GameState.prototype.resetGameData = function() {
      return this.set(GameState.DefaultGameData);
    };

    GameState.prototype.getScoreSubmission = function() {
      return ((this.get("level") * 362) << 5) + "." + ((this.get("score") * 672) << 4);
    };

    return GameState;

  })(Backbone.Model);
  EggModel = (function(_super) {
    __extends(EggModel, _super);

    function EggModel() {
      this.eggHitGround = __bind(this.eggHitGround, this);
      this.isSafe = __bind(this.isSafe, this);
      this.nextSprite = __bind(this.nextSprite, this);
      return EggModel.__super__.constructor.apply(this, arguments);
    }

    EggModel.NumSprites = 5;

    EggModel.prototype.defaults = {
      spriteIndex: 1,
      collectionIndex: 0
    };

    EggModel.prototype.nextSprite = function() {
      this.set("spriteIndex", this.get("spriteIndex") + 1);
      if (this.isSafe()) {
        return this.trigger("fly", [this]);
      }
    };

    EggModel.prototype.isSafe = function() {
      return this.get("spriteIndex") >= EggModel.NumSprites;
    };

    EggModel.prototype.eggHitGround = function() {
      if (!this.isSafe()) {
        return this.trigger("break", [this]);
      }
    };

    return EggModel;

  })(Backbone.Model);

  /*
  Views ****
   */
  EggView = (function(_super) {
    __extends(EggView, _super);

    function EggView() {
      this.handleTransitionEnded = __bind(this.handleTransitionEnded, this);
      this.renderRemove = __bind(this.renderRemove, this);
      this.renderFlying = __bind(this.renderFlying, this);
      this.renderHidding = __bind(this.renderHidding, this);
      this.renderBreaking = __bind(this.renderBreaking, this);
      this.renderSprites = __bind(this.renderSprites, this);
      this.render = __bind(this.render, this);
      this.nextSprite = __bind(this.nextSprite, this);
      this.initialize = __bind(this.initialize, this);
      return EggView.__super__.constructor.apply(this, arguments);
    }

    EggView.prototype.className = "egg";

    EggView.prototype.spriteClass = ".egg_sprite_";

    EggView.prototype.eggTemplate = _.template($("#_egg").html());

    EggView.prototype.scene = null;

    EggView.prototype.events = {
      webkitTransitionEnd: "handleTransitionEnded",
      mozTransitionEnd: "handleTransitionEnded",
      transitionend: "handleTransitionEnded"
    };

    EggView.prototype.initialize = function() {
      this.scene = this.options.scene;
      this.gameState = this.options.gameState;
      this.$el.on(Utils.clickDownOrTouch(), this.nextSprite);
      this.model.on("change:spriteIndex", this.renderSprites);
      this.model.on("fly", this.renderFlying);
      return this.model.on("break", this.renderBreaking);
    };

    EggView.prototype.nextSprite = function() {
      if (!this.model.isSafe()) {
        this.model.nextSprite();
        return false;
      }
    };

    EggView.prototype.render = function() {
      var delay, intermission, left, speed, top;
      this.renderSprites();
      intermission = 3.5;
      delay = void 0;
      if (this.model.get("collectionIndex") === 1) {
        delay = intermission;
      } else {
        delay = (Math.random() * 6 + 3) / this.gameState.get("speedX") + (2 * this.model.get("collectionIndex")) + intermission;
      }
      speed = 100 * this.gameState.get("speedX") + Math.random() * 100 - 50;
      left = Math.random() * ($(window).width() - 100) + 30;
      top = $("#stage").height() - 220;
      this.$el.css(Utils.bp() + "transition-delay", delay + "s");
      this.$el.css(Utils.bp() + "transition-duration", $(window).height() / speed + "s");
      this.$el.css(Utils.bp() + "transition-property", "top opacity");
      this.$el.css(Utils.bp() + "transition-timing-function", "linear");
      this.$el.css("left", left + "px");
      this.scene.append(this.$el);
      return Utils.nextTick((function(_this) {
        return function() {
          return _this.$el.css("top", top + "px");
        };
      })(this));
    };

    EggView.prototype.renderSprites = function() {
      return this.$el.html(this.eggTemplate({
        spriteIndex: this.model.get("spriteIndex")
      }));
    };

    EggView.prototype.renderBreaking = function() {
      this.$el.addClass("cracked").addClass("disabled");
      this.$el.css(Utils.bp() + "transition-delay", "0s");
      return this.$el.css(Utils.bp() + "transition-duration", "0.2s");
    };

    EggView.prototype.renderHidding = function() {
      this.$el.addClass("broken");
      this.$el.css(Utils.bp() + "transition-delay", "1s");
      this.$el.css(Utils.bp() + "transition-duration", "0.5s");
      this.$el.css(Utils.bp() + "transition-property", "opacity");
      this.$el.css(Utils.bp() + "transition-timing-function", "linear");
      return this.$el.css("opacity", 0);
    };

    EggView.prototype.renderFlying = function() {
      this.$el.addClass("flying");
      this.$el.css(Utils.bp() + "transition-delay", "0s");
      this.$el.css(Utils.bp() + "transition-duration", "1s");
      this.$el.css(Utils.bp() + "transition-property", "top");
      return this.$el.css(Utils.bp() + "transition-timing-function", "linear");
    };

    EggView.prototype.renderRemove = function() {
      return this.remove();
    };

    EggView.prototype.handleTransitionEnded = function(e) {
      if (e.originalEvent.propertyName === "opacity") {
        this.renderRemove();
      } else if (e.originalEvent.propertyName === "top") {
        this.model.eggHitGround();
      } else {
        if (e.originalEvent.propertyName === Utils.bp() + "transform" || "transform") {
          this.renderHidding();
        }
      }
      return false;
    };

    return EggView;

  })(Backbone.View);
  Stage = (function(_super) {
    __extends(Stage, _super);

    function Stage() {
      this.renderClouds = __bind(this.renderClouds, this);
      this.renderTrees = __bind(this.renderTrees, this);
      this.renderSun = __bind(this.renderSun, this);
      this.renderTiles = __bind(this.renderTiles, this);
      this.render = __bind(this.render, this);
      return Stage.__super__.constructor.apply(this, arguments);
    }

    Stage.prototype.el = "#stage";

    Stage.prototype.tileTemplate = _.template($("#_tile_pair").html());

    Stage.prototype.treeTemplate = _.template($("#_tree").html());

    Stage.prototype.sunTemplate = _.template($("#_sun").html());

    Stage.prototype.cloudTemplate = _.template($("#_cloud").html());

    Stage.prototype.render = function() {
      this.$el.css("height", $(window).height());
      this.renderSun();
      this.renderTrees();
      this.renderTiles();
      return this.renderClouds();
    };

    Stage.prototype.renderTiles = function() {
      this.$(".tile").remove();
      return this.$el.append(this.tileTemplate());
    };

    Stage.prototype.renderSun = function() {
      this.$(".sun").remove();
      return this.$el.append(this.sunTemplate());
    };

    Stage.prototype.renderTrees = function() {
      var i, left, numTrees, _results;
      numTrees = Math.ceil($(window).width() / 200);
      this.$(".tree").remove();
      if (numTrees <= 2) {
        this.$el.append(this.treeTemplate({
          treeNum: 3,
          leftValue: -100
        }));
        return this.$el.append(this.treeTemplate({
          treeNum: 1,
          leftValue: 120
        }));
      } else {
        i = 0;
        _results = [];
        while (i < numTrees) {
          left = Math.random() * 200. + i * 200;
          this.$el.append(this.treeTemplate({
            treeNum: -1,
            leftValue: left - 300
          }));
          _results.push(i++);
        }
        return _results;
      }
    };

    Stage.prototype.renderClouds = function() {
      var delay, dir, i, numClouds, speed, top, _results;
      numClouds = Math.ceil($(window).width() / 200);
      numClouds = (numClouds < 2 ? 2 : numClouds);
      i = 0;
      _results = [];
      while (i < numClouds) {
        top = Math.random() * 50;
        delay = Math.random() * 8 - 4 + (10 * i);
        speed = 20;
        dir = (Math.floor(Math.random() * 2) < 1 ? "left" : "right");
        this.$el.append(this.cloudTemplate({
          delay: delay,
          direction: dir,
          duration: $(window).width() / speed,
          topValue: top
        }));
        _results.push(i++);
      }
      return _results;
    };

    return Stage;

  })(Backbone.View);
  MenuScene = (function(_super) {
    __extends(MenuScene, _super);

    function MenuScene() {
      this.cleanUp = __bind(this.cleanUp, this);
      this.renderRemoveScene = __bind(this.renderRemoveScene, this);
      this.render = __bind(this.render, this);
      this.renderSceneChange = __bind(this.renderSceneChange, this);
      this.handleCreditsButton = __bind(this.handleCreditsButton, this);
      this.handleHighscoreButton = __bind(this.handleHighscoreButton, this);
      this.handlePlayButton = __bind(this.handlePlayButton, this);
      this.initialize = __bind(this.initialize, this);
      return MenuScene.__super__.constructor.apply(this, arguments);
    }

    MenuScene.prototype.className = "menu_scene";

    MenuScene.prototype.events = {
      "animationend .title": "cleanUp",
      "webkitAnimationEnd .title": "cleanUp",
      "mozAnimationEnd .title": "cleanUp"
    };

    MenuScene.prototype.template = _.template($("#_menu").html());

    MenuScene.prototype.sceneName = "menu";

    MenuScene.prototype.initialize = function() {
      this.model.on("change:scene", this.renderSceneChange);
      this.$el.on(Utils.clickUpOrTouch(), "#play_button", this.handlePlayButton);
      this.$el.on(Utils.clickUpOrTouch(), "#highscore_button", this.handleHighscoreButton);
      this.$el.on(Utils.clickUpOrTouch(), "#credits_button", this.handleCreditsButton);
      return this;
    };

    MenuScene.prototype.handlePlayButton = function(e) {
      this.$(".menu_item").addClass("disabled");
      this.model.set("scene", "game");
      return false;
    };

    MenuScene.prototype.handleHighscoreButton = function(e) {
      this.$(".menu_item").addClass("disabled");
      this.model.set("scene", "highscore");
      return false;
    };

    MenuScene.prototype.handleCreditsButton = function(e) {
      this.$(".menu_item").addClass("disabled");
      this.model.set("scene", "credits");
      return false;
    };

    MenuScene.prototype.renderSceneChange = function(model, scene) {
      if (model.previous("scene") === this.sceneName) {
        this.renderRemoveScene();
      } else {
        if (scene === this.sceneName) {
          this.render();
        }
      }
      return this;
    };

    MenuScene.prototype.render = function() {
      this.$el.html(this.template());
      $("#stage").append(this.$el);
      return this;
    };

    MenuScene.prototype.renderRemoveScene = function() {
      this.$(".title").removeClass("display").addClass("removal");
      this.$(".menu_item").addClass("removal");
      this.$(".title").css(Utils.bp() + "animation-name", "raiseTitle");
      this.$(".menu_item").css(Utils.bp() + "animation-name", "raiseMenu");
      return this;
    };

    MenuScene.prototype.cleanUp = function(e) {
      if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("title")) {
        this.$el.empty();
      }
      return false;
    };

    return MenuScene;

  })(Backbone.View);
  GameScene = (function(_super) {
    __extends(GameScene, _super);

    function GameScene() {
      this.cleanUp = __bind(this.cleanUp, this);
      this.renderRemoveScene = __bind(this.renderRemoveScene, this);
      this.renderAddEgg = __bind(this.renderAddEgg, this);
      this.renderEggs = __bind(this.renderEggs, this);
      this.renderBackButton = __bind(this.renderBackButton, this);
      this.renderLives = __bind(this.renderLives, this);
      this.renderScore = __bind(this.renderScore, this);
      this.renderLevelLabel = __bind(this.renderLevelLabel, this);
      this.renderLevel = __bind(this.renderLevel, this);
      this.render = __bind(this.render, this);
      this.renderSceneChange = __bind(this.renderSceneChange, this);
      this.handleBackButton = __bind(this.handleBackButton, this);
      this.initialize = __bind(this.initialize, this);
      return GameScene.__super__.constructor.apply(this, arguments);
    }

    GameScene.prototype.className = "game_scene";

    GameScene.prototype.events = {
      animationend: "cleanUp",
      webkitAnimationEnd: "cleanUp",
      mozAnimationEnd: "cleanUp"
    };

    GameScene.prototype.scoreTemplate = _.template($("#_game_score").html());

    GameScene.prototype.levelTemplate = _.template($("#_game_level").html());

    GameScene.prototype.livesTemplate = _.template($("#_game_lives").html());

    GameScene.prototype.sceneName = "game";

    GameScene.prototype.initialize = function() {
      this.eggViews = [];
      this.$el.on(Utils.clickUpOrTouch(), ".back_button", this.handleBackButton);
      this.model.on("change:scene", this.renderSceneChange);
      this.model.get("eggCollection").on("add", this.renderAddEgg);
      this.model.on("change:score", this.renderScore);
      this.model.on("change:lives", this.renderLives);
      this.model.on("change:level", this.renderLevel);
      return this.model.on("change:level", this.renderLevelLabel);
    };

    GameScene.prototype.handleBackButton = function(e) {
      this.$(".back_button").addClass("disabled");
      return this.model.set("scene", "menu");
    };

    GameScene.prototype.renderSceneChange = function(model, scene) {
      if (model.previous("scene") === this.sceneName) {
        this.renderRemoveScene();
      } else {
        if (scene === this.sceneName) {
          this.render();
        }
      }
      return this;
    };

    GameScene.prototype.render = function() {
      this.model.resetGameData();
      this.$("#hud").remove();
      this.$el.append("<div id='hud'></div>");
      this.renderLevel();
      setTimeout(((function(_this) {
        return function() {
          return _this.renderLevelLabel();
        };
      })(this)), 1200);
      this.renderScore();
      this.renderLives();
      this.renderBackButton();
      this.renderEggs();
      if ($("#stage ." + this.className).length <= 0) {
        $("#stage").append(this.$el);
      }
      return this;
    };

    GameScene.prototype.renderLevel = function() {
      if (this.$("#game_level").length > 0) {
        this.$("#game_level").replaceWith(this.levelTemplate({
          level: this.model.get("level")
        }));
      } else {
        this.$("#hud").append(this.levelTemplate({
          level: this.model.get("level")
        }));
      }
      return this;
    };

    GameScene.prototype.renderLevelLabel = function() {
      this.$el.append("<p class='level_label'>LEVEL " + this.model.get("level") + "<br>GET READY!</p>");
      setTimeout(((function(_this) {
        return function() {
          return _this.$(".level_label").addClass("removal");
        };
      })(this)), 3000);
      setTimeout(((function(_this) {
        return function() {
          return _this.$(".level_label").remove();
        };
      })(this)), 3300);
      return this;
    };

    GameScene.prototype.renderScore = function() {
      if (this.$("#game_score").length > 0) {
        this.$("#game_score").replaceWith(this.scoreTemplate({
          score: this.model.get("score")
        }));
      } else {
        this.$("#hud").append(this.scoreTemplate({
          score: this.model.get("score")
        }));
      }
      return this;
    };

    GameScene.prototype.renderLives = function() {
      if (this.$("#game_lives").length > 0) {
        this.$("#game_lives").replaceWith(this.livesTemplate({
          lives: this.model.get("lives")
        }));
      } else {
        this.$("#hud").append(this.livesTemplate({
          lives: this.model.get("lives")
        }));
      }
      return this;
    };

    GameScene.prototype.renderBackButton = function() {
      if (this.$(".back_button").length > 0) {
        this.$(".back_button").replaceWith("<div class='back_button'>X</div>");
      } else {
        this.$el.append("<div class='back_button'>X</div>");
      }
      return this;
    };

    GameScene.prototype.renderEggs = function() {
      this.model.addEggs();
      return this;
    };

    GameScene.prototype.renderAddEgg = function(eggModel, collection, options) {
      var eggView;
      eggView = new EggView({
        model: eggModel,
        gameState: this.model,
        scene: this.$el
      });
      eggView.render();
      this.eggViews.push(eggView);
      return this;
    };

    GameScene.prototype.renderRemoveScene = function() {
      this.$(".back_button").css(Utils.bp() + "animation-name", "xRaise");
      this.$("#hud p").css(Utils.bp() + "animation-name", "removeHUD");
      this.$(".egg").css(Utils.bp() + "transition-duration", "0.3s");
      _.each(this.eggViews, (function(_this) {
        return function(eggView) {
          return eggView.renderRemove();
        };
      })(this));
      this.model.get("eggCollection").reset();
      return this;
    };

    GameScene.prototype.cleanUp = function(e) {
      if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("back_button")) {
        this.$el.empty();
      }
      return false;
    };

    return GameScene;

  })(Backbone.View);
  GameOverScene = (function(_super) {
    __extends(GameOverScene, _super);

    function GameOverScene() {
      this.cleanUp = __bind(this.cleanUp, this);
      this.renderRemoveScene = __bind(this.renderRemoveScene, this);
      this.render = __bind(this.render, this);
      this.renderSceneChange = __bind(this.renderSceneChange, this);
      this.saveHighScore = __bind(this.saveHighScore, this);
      this.handleFacebookButton = __bind(this.handleFacebookButton, this);
      this.handleReplayButton = __bind(this.handleReplayButton, this);
      this.handleMenuButton = __bind(this.handleMenuButton, this);
      this.initialize = __bind(this.initialize, this);
      return GameOverScene.__super__.constructor.apply(this, arguments);
    }

    GameOverScene.Congrats = ["Not bad", "Good", "Great", "Fantastic", "Smashing!", "Amazing!", "Flying High", "Ridiculous!", "Extraordinary!", "Monstrous!!"];

    GameOverScene.prototype.className = "game_over_scene";

    GameOverScene.prototype.events = {
      animationend: "cleanUp",
      webkitAnimationEnd: "cleanUp",
      mozAnimationEnd: "cleanUp"
    };

    GameOverScene.prototype.template = _.template($("#_game_over").html());

    GameOverScene.prototype.sceneName = "game_over";

    GameOverScene.prototype.submitted = false;

    GameOverScene.prototype.initialize = function() {
      this.model.on("change:scene", this.renderSceneChange);
      this.$el.on(Utils.clickUpOrTouch(), ".menu_button", this.handleMenuButton);
      this.$el.on(Utils.clickUpOrTouch(), ".replay_button", this.handleReplayButton);
      return this.$el.on(Utils.clickUpOrTouch(), ".facebook_button", this.handleFacebookButton);
    };

    GameOverScene.prototype.handleMenuButton = function(e) {
      this.$(".menu_item").addClass("disabled");
      return this.model.set("scene", "menu");
    };

    GameOverScene.prototype.handleReplayButton = function(e) {
      this.$(".menu_item").addClass("disabled");
      return this.model.set("scene", "game");
    };

    GameOverScene.prototype.handleFacebookButton = function(e) {
      $(".fb_content").hide();
      $(".facebook_button").addClass("disabled").empty().spin({
        length: 5,
        radius: 5,
        lines: 8,
        width: 3,
        color: "#fff"
      });
      if (Parse.User.current()) {
        return this.saveHighScore();
      } else {
        return Parse.FacebookUtils.logIn(null, {
          success: (function(_this) {
            return function(user) {
              if (!user.existed()) {
                return FB.api("/me", function(response) {
                  if (!response.error) {
                    user.set("displayName", response.name);
                    return user.save(null, {
                      success: function(user) {
                        return _this.saveHighScore();
                      },
                      error: function(user, error) {
                        return console.log("Oops, something went wrong saving your name.");
                      }
                    });
                  } else {
                    return console.log("Oops something went wrong with facebook.");
                  }
                });
              } else {
                return _this.saveHighScore();
              }
            };
          })(this),
          error: (function(_this) {
            return function(user, error) {
              return console.log("Oops, something went wrong.");
            };
          })(this)
        });
      }
    };

    GameOverScene.prototype.saveHighScore = function() {
      var submission;
      submission = {
        score: this.model.getScoreSubmission()
      };
      return Parse.Cloud.run("submitHighscore", submission, {
        success: (function(_this) {
          return function(result) {
            _this.submitted = true;
            return _this.$(".facebook_button").html("Submitted!");
          };
        })(this),
        error: (function(_this) {
          return function(error) {
            _this.submitted = true;
            return _this.$(".facebook_button").html(" X Try Again...").removeClass("disabled");
          };
        })(this)
      });
    };

    GameOverScene.prototype.renderSceneChange = function(model, scene) {
      if (model.previous("scene") === this.sceneName) {
        this.renderRemoveScene();
      } else {
        if (scene === this.sceneName) {
          this.render();
        }
      }
      return this;
    };

    GameOverScene.prototype.render = function() {
      var congratsIndex;
      congratsIndex = (this.model.get("level") > GameOverScene.Congrats.length ? GameOverScene.Congrats.length - 1 : this.model.get("level") - 1);
      this.$el.html(this.template({
        score: this.model.get("score"),
        congrats: GameOverScene.Congrats[congratsIndex]
      }));
      return $("#stage").append(this.$el);
    };

    GameOverScene.prototype.renderRemoveScene = function() {
      this.$(".menu_item").addClass("removal");
      this.$(".summary").addClass("removal");
      this.$(".menu_item").css(Utils.bp() + "animation-name", "raiseMenu");
      return this.$(".summary").css(Utils.bp() + "animation-name", "raiseScores");
    };

    GameOverScene.prototype.cleanUp = function(e) {
      if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("summary")) {
        return this.$el.empty();
      }
    };

    return GameOverScene;

  })(Backbone.View);
  HighscoreScene = (function(_super) {
    __extends(HighscoreScene, _super);

    function HighscoreScene() {
      this.cleanUp = __bind(this.cleanUp, this);
      this.renderRemoveScene = __bind(this.renderRemoveScene, this);
      this.renderScore = __bind(this.renderScore, this);
      this.renderScoreCollection = __bind(this.renderScoreCollection, this);
      this.render = __bind(this.render, this);
      this.renderSceneChange = __bind(this.renderSceneChange, this);
      this.handleBackButton = __bind(this.handleBackButton, this);
      this.initialize = __bind(this.initialize, this);
      return HighscoreScene.__super__.constructor.apply(this, arguments);
    }

    HighscoreScene.prototype.className = "highscore_scene";

    HighscoreScene.prototype.events = {
      animationend: "cleanUp",
      webkitAnimationEnd: "cleanUp",
      mozAnimationEnd: "cleanUp"
    };

    HighscoreScene.prototype.template = _.template($("#_highscore").html());

    HighscoreScene.prototype.scoreTemplate = _.template($("#_score").html());

    HighscoreScene.prototype.sceneName = "highscore";

    HighscoreScene.prototype.initialize = function() {
      this.model.on("change:scene", this.renderSceneChange);
      this.model.get("highscoreCollection").on("reset", this.renderScoreCollection);
      this.$el.on(Utils.clickUpOrTouch(), ".back_button", this.handleBackButton);
      if (this.model.get("currentScene") === this.sceneName) {
        return this.render();
      }
    };

    HighscoreScene.prototype.handleBackButton = function(e) {
      this.$(".back_button").addClass("disabled");
      this.model.set("scene", "menu");
      return false;
    };

    HighscoreScene.prototype.renderSceneChange = function(model, scene) {
      if (model.previous("scene") === this.sceneName) {
        this.renderRemoveScene();
      } else {
        if (scene === this.sceneName) {
          this.render();
        }
      }
      return this;
    };

    HighscoreScene.prototype.render = function() {
      this.$el.html(this.template());
      this.model.get("highscoreCollection").fetch();
      this.$(".highscore").spin({
        length: 9,
        radius: 10,
        lines: 12,
        width: 4,
        color: "#fff"
      });
      $("#stage").append(this.$el);
      return this;
    };

    HighscoreScene.prototype.renderScoreCollection = function() {
      this.model.get("highscoreCollection").each((function(_this) {
        return function(score, index) {
          return _this.renderScore(score, index);
        };
      })(this));
      $(".highscore .spinner").remove();
      return this;
    };

    HighscoreScene.prototype.renderScore = function(score, index) {
      return this.$("#score_table tbody").append(this.scoreTemplate({
        score: score,
        index: index
      }));
    };

    HighscoreScene.prototype.renderRemoveScene = function() {
      this.$(".menu_item").addClass("removal");
      this.$(".highscore").addClass("removal");
      this.$(".menu_item").css(Utils.bp() + "animation-name", "raiseMenu");
      return this.$(".highscore").css(Utils.bp() + "animation-name", "raiseScores");
    };

    HighscoreScene.prototype.cleanUp = function(e) {
      if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("highscore")) {
        return this.$el.empty();
      }
    };

    return HighscoreScene;

  })(Backbone.View);
  CreditsScene = (function(_super) {
    __extends(CreditsScene, _super);

    function CreditsScene() {
      this.cleanUp = __bind(this.cleanUp, this);
      this.renderRemoveScene = __bind(this.renderRemoveScene, this);
      this.render = __bind(this.render, this);
      this.renderSceneChange = __bind(this.renderSceneChange, this);
      this.handleBackButton = __bind(this.handleBackButton, this);
      this.initialize = __bind(this.initialize, this);
      return CreditsScene.__super__.constructor.apply(this, arguments);
    }

    CreditsScene.prototype.className = "credits_scene";

    CreditsScene.prototype.template = _.template($("#_credits").html());

    CreditsScene.prototype.sceneName = "credits";

    CreditsScene.prototype.events = {
      animationend: "cleanUp",
      webkitAnimationEnd: "cleanUp",
      mozAnimationEnd: "cleanUp"
    };

    CreditsScene.prototype.initialize = function() {
      this.model.on("change:scene", this.renderSceneChange);
      return this.$el.on(Utils.clickUpOrTouch(), ".back_button", this.handleBackButton);
    };

    CreditsScene.prototype.handleBackButton = function(e) {
      this.$(".back_button").addClass("disabled");
      this.model.set("scene", "menu");
      return false;
    };

    CreditsScene.prototype.renderSceneChange = function(model, scene) {
      if (model.previous("scene") === this.sceneName) {
        this.renderRemoveScene();
      } else {
        if (scene === this.sceneName) {
          this.render();
        }
      }
      return this;
    };

    CreditsScene.prototype.render = function() {
      this.$el.html(this.template());
      $("#stage").append(this.$el);
      return this;
    };

    CreditsScene.prototype.renderRemoveScene = function() {
      this.$(".credits").addClass("removal");
      this.$(".back_button").addClass("removal");
      this.$(".credits").css(Utils.bp() + "animation-name", "raiseMenu");
      return this.$(".back_button").css(Utils.bp() + "animation-name", "raiseMenu");
    };

    CreditsScene.prototype.cleanUp = function(e) {
      if (this.model.get("scene") !== this.sceneName && $(e.target).hasClass("credits")) {
        return this.$el.empty();
      }
    };

    return CreditsScene;

  })(Backbone.View);
  return Game.initialize();
});

window.Utils = {
  bp: function() {
    var bp;
    bp = "";
    if ($.browser.webkit) {
      bp = "-webkit-";
    } else {
      if ($.browser.mozilla) {
        bp = "-moz-";
      }
    }
    return bp;
  },
  isSupported: function() {
    return !($.browser.msie && parseInt($.browser.version) < 10);
  },
  nextTick: function(func) {
    return setTimeout(func, 0);
  },
  clickUpOrTouch: function(func) {
    if ("ontouchstart" in window) {
      return "touchstart";
    } else {
      return "mouseup";
    }
  },
  clickDownOrTouch: function(func) {
    if ("ontouchstart" in window) {
      return "touchstart";
    } else {
      return "mousedown";
    }
  }
};

$.fn.spin = function(opts) {
  this.each(function() {
    var $this, data;
    $this = $(this);
    data = $this.data();
    if (data.spinner) {
      data.spinner.stop();
      delete data.spinner;
    }
    if (opts !== false) {
      return data.spinner = new Spinner($.extend({
        color: $this.css("color")
      }, opts)).spin(this);
    }
  });
  return this;
};

Parse.initialize("0ZUn1TaDF9G3j6UhvoNFuIVSzF45vpSO9K0rlosM", "oU1ToZ9LNZoMslphpgxQNoVjJXEqoi59M018ZP08");

window.fbAsyncInit = function() {
  return Parse.FacebookUtils.init({
    appId: "1380103182250520",
    channelUrl: "/channel.html",
    status: true,
    cookie: true,
    xfbml: true
  });
};

(function(d, debug) {
  var id, js, ref;
  js = void 0;
  id = "facebook-jssdk";
  ref = d.getElementsByTagName("script")[0];
  if (d.getElementById(id)) {
    return;
  }
  js = d.createElement("script");
  js.id = id;
  js.async = true;
  js.src = "//connect.facebook.net/en_US/all" + (debug ? "/debug" : "") + ".js";
  return ref.parentNode.insertBefore(js, ref);
})(document, false);

},{}]},{},[1])
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi91c3IvbG9jYWwvbGliL25vZGVfbW9kdWxlcy9icm93c2VyaWZ5L25vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCIvaG9tZS9icnVjZS9HaXQvQW55WW9say90bXAvbWFpbi5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uIGUodCxuLHIpe2Z1bmN0aW9uIHMobyx1KXtpZighbltvXSl7aWYoIXRbb10pe3ZhciBhPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7aWYoIXUmJmEpcmV0dXJuIGEobywhMCk7aWYoaSlyZXR1cm4gaShvLCEwKTt2YXIgZj1uZXcgRXJyb3IoXCJDYW5ub3QgZmluZCBtb2R1bGUgJ1wiK28rXCInXCIpO3Rocm93IGYuY29kZT1cIk1PRFVMRV9OT1RfRk9VTkRcIixmfXZhciBsPW5bb109e2V4cG9ydHM6e319O3Rbb11bMF0uY2FsbChsLmV4cG9ydHMsZnVuY3Rpb24oZSl7dmFyIG49dFtvXVsxXVtlXTtyZXR1cm4gcyhuP246ZSl9LGwsbC5leHBvcnRzLGUsdCxuLHIpfXJldHVybiBuW29dLmV4cG9ydHN9dmFyIGk9dHlwZW9mIHJlcXVpcmU9PVwiZnVuY3Rpb25cIiYmcmVxdWlyZTtmb3IodmFyIG89MDtvPHIubGVuZ3RoO28rKylzKHJbb10pO3JldHVybiBzfSkiLCIvLyBHZW5lcmF0ZWQgYnkgQ29mZmVlU2NyaXB0IDEuNy4xXG52YXIgX19iaW5kID0gZnVuY3Rpb24oZm4sIG1lKXsgcmV0dXJuIGZ1bmN0aW9uKCl7IHJldHVybiBmbi5hcHBseShtZSwgYXJndW1lbnRzKTsgfTsgfSxcbiAgX19oYXNQcm9wID0ge30uaGFzT3duUHJvcGVydHksXG4gIF9fZXh0ZW5kcyA9IGZ1bmN0aW9uKGNoaWxkLCBwYXJlbnQpIHsgZm9yICh2YXIga2V5IGluIHBhcmVudCkgeyBpZiAoX19oYXNQcm9wLmNhbGwocGFyZW50LCBrZXkpKSBjaGlsZFtrZXldID0gcGFyZW50W2tleV07IH0gZnVuY3Rpb24gY3RvcigpIHsgdGhpcy5jb25zdHJ1Y3RvciA9IGNoaWxkOyB9IGN0b3IucHJvdG90eXBlID0gcGFyZW50LnByb3RvdHlwZTsgY2hpbGQucHJvdG90eXBlID0gbmV3IGN0b3IoKTsgY2hpbGQuX19zdXBlcl9fID0gcGFyZW50LnByb3RvdHlwZTsgcmV0dXJuIGNoaWxkOyB9O1xuXG4kKGZ1bmN0aW9uKCkge1xuICB2YXIgQ3JlZGl0c1NjZW5lLCBFZ2dNb2RlbCwgRWdnVmlldywgR2FtZSwgR2FtZU92ZXJTY2VuZSwgR2FtZVNjZW5lLCBHYW1lU3RhdGUsIEhpZ2hzY29yZVNjZW5lLCBNZW51U2NlbmUsIFN0YWdlO1xuICBHYW1lID0ge1xuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIG1vZGVsO1xuICAgICAgaWYgKFV0aWxzLmlzU3VwcG9ydGVkKCkpIHtcbiAgICAgICAgbW9kZWwgPSBuZXcgR2FtZVN0YXRlKCk7XG4gICAgICAgIG5ldyBTdGFnZSh7XG4gICAgICAgICAgbW9kZWw6IG1vZGVsXG4gICAgICAgIH0pLnJlbmRlcigpO1xuICAgICAgICBuZXcgTWVudVNjZW5lKHtcbiAgICAgICAgICBtb2RlbDogbW9kZWxcbiAgICAgICAgfSk7XG4gICAgICAgIG5ldyBHYW1lU2NlbmUoe1xuICAgICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgICB9KTtcbiAgICAgICAgbmV3IEdhbWVPdmVyU2NlbmUoe1xuICAgICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgICB9KTtcbiAgICAgICAgbmV3IEhpZ2hzY29yZVNjZW5lKHtcbiAgICAgICAgICBtb2RlbDogbW9kZWxcbiAgICAgICAgfSk7XG4gICAgICAgIG5ldyBDcmVkaXRzU2NlbmUoe1xuICAgICAgICAgIG1vZGVsOiBtb2RlbFxuICAgICAgICB9KTtcbiAgICAgICAgbW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICAgICAgICAkKFwiI3N0YWdlXCIpLm9uKFwiZHJhZ3N0YXJ0IHNlbGVjdHN0YXJ0XCIsIFwiKlwiLCBmdW5jdGlvbihldmVudCkge1xuICAgICAgICAgIHJldHVybiBmYWxzZTtcbiAgICAgICAgfSk7XG4gICAgICAgIHJldHVybiBkb2N1bWVudC5vbnRvdWNobW92ZSA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgICAgICByZXR1cm4gZS5wcmV2ZW50RGVmYXVsdCgpO1xuICAgICAgICB9O1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgcmV0dXJuICQoXCIjdW5zdXBwb3J0ZWRcIikuc2hvdygpO1xuICAgICAgfVxuICAgIH1cbiAgfTtcblxuICAvKlxuICBNb2RlbHMgKioqKlxuICAgKi9cbiAgR2FtZVN0YXRlID0gKGZ1bmN0aW9uKF9zdXBlcikge1xuICAgIF9fZXh0ZW5kcyhHYW1lU3RhdGUsIF9zdXBlcik7XG5cbiAgICBmdW5jdGlvbiBHYW1lU3RhdGUoKSB7XG4gICAgICB0aGlzLmdldFNjb3JlU3VibWlzc2lvbiA9IF9fYmluZCh0aGlzLmdldFNjb3JlU3VibWlzc2lvbiwgdGhpcyk7XG4gICAgICB0aGlzLnJlc2V0R2FtZURhdGEgPSBfX2JpbmQodGhpcy5yZXNldEdhbWVEYXRhLCB0aGlzKTtcbiAgICAgIHRoaXMuY2xlYW5VcEVnZyA9IF9fYmluZCh0aGlzLmNsZWFuVXBFZ2csIHRoaXMpO1xuICAgICAgdGhpcy5hZGRFZ2dzID0gX19iaW5kKHRoaXMuYWRkRWdncywgdGhpcyk7XG4gICAgICB0aGlzLnZhbGlkYXRlQWxpdmUgPSBfX2JpbmQodGhpcy52YWxpZGF0ZUFsaXZlLCB0aGlzKTtcbiAgICAgIHRoaXMuaW5jcmVtZW50TGV2ZWwgPSBfX2JpbmQodGhpcy5pbmNyZW1lbnRMZXZlbCwgdGhpcyk7XG4gICAgICB0aGlzLmRlY3JlbWVudExpZmUgPSBfX2JpbmQodGhpcy5kZWNyZW1lbnRMaWZlLCB0aGlzKTtcbiAgICAgIHRoaXMuaW5jcmVtZW50U2NvcmUgPSBfX2JpbmQodGhpcy5pbmNyZW1lbnRTY29yZSwgdGhpcyk7XG4gICAgICB0aGlzLmluaXRpYWxpemUgPSBfX2JpbmQodGhpcy5pbml0aWFsaXplLCB0aGlzKTtcbiAgICAgIHJldHVybiBHYW1lU3RhdGUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgR2FtZVN0YXRlLkRlZmF1bHRHYW1lRGF0YSA9IHtcbiAgICAgIHNjb3JlOiAwLFxuICAgICAgbGl2ZXM6IDMsXG4gICAgICBsZXZlbDogMSxcbiAgICAgIHNwZWVkWDogMVxuICAgIH07XG5cbiAgICBHYW1lU3RhdGUucHJvdG90eXBlLmRlZmF1bHRzID0ge1xuICAgICAgc2NlbmU6IFwiXCIsXG4gICAgICBlZ2dDb2xsZWN0aW9uOiBudWxsLFxuICAgICAgc3BlZWRYOiAxXG4gICAgfTtcblxuICAgIEdhbWVTdGF0ZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIHF1ZXJ5O1xuICAgICAgdGhpcy5zZXQoXCJlZ2dDb2xsZWN0aW9uXCIsIG5ldyBCYWNrYm9uZS5Db2xsZWN0aW9uKCkpO1xuICAgICAgcXVlcnkgPSBuZXcgUGFyc2UuUXVlcnkoXCJIaWdoU2NvcmVcIik7XG4gICAgICBxdWVyeS5kZXNjZW5kaW5nKFwic2NvcmVcIik7XG4gICAgICBxdWVyeS5pbmNsdWRlKFwicGxheWVyXCIpO1xuICAgICAgcXVlcnkubGltaXQoMTApO1xuICAgICAgdGhpcy5zZXQoXCJoaWdoc2NvcmVDb2xsZWN0aW9uXCIsIHF1ZXJ5LmNvbGxlY3Rpb24oKSk7XG4gICAgICB0aGlzLnJlc2V0R2FtZURhdGEoKTtcbiAgICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcImZseVwiLCB0aGlzLmluY3JlbWVudFNjb3JlKTtcbiAgICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5vbihcImJyZWFrXCIsIHRoaXMuZGVjcmVtZW50TGlmZSk7XG4gICAgICB0aGlzLmdldChcImVnZ0NvbGxlY3Rpb25cIikub24oXCJmbHkgYnJlYWtcIiwgdGhpcy5jbGVhblVwRWdnKTtcbiAgICAgIHJldHVybiB0aGlzLmdldChcImVnZ0NvbGxlY3Rpb25cIikub24oXCJyZW1vdmVcIiwgdGhpcy5pbmNyZW1lbnRMZXZlbCk7XG4gICAgfTtcblxuICAgIEdhbWVTdGF0ZS5wcm90b3R5cGUuaW5jcmVtZW50U2NvcmUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLnNldChcInNjb3JlXCIsIHRoaXMuZ2V0KFwic2NvcmVcIikgKyAxKTtcbiAgICB9O1xuXG4gICAgR2FtZVN0YXRlLnByb3RvdHlwZS5kZWNyZW1lbnRMaWZlID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLnNldChcImxpdmVzXCIsIHRoaXMuZ2V0KFwibGl2ZXNcIikgLSAxKTtcbiAgICAgIHJldHVybiB0aGlzLnZhbGlkYXRlQWxpdmUoKTtcbiAgICB9O1xuXG4gICAgR2FtZVN0YXRlLnByb3RvdHlwZS5pbmNyZW1lbnRMZXZlbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5sZW5ndGggPD0gMCkge1xuICAgICAgICB0aGlzLnNldChcImxldmVsXCIsIHRoaXMuZ2V0KFwibGV2ZWxcIikgKyAxKTtcbiAgICAgICAgdGhpcy5zZXQoXCJzcGVlZFhcIiwgdGhpcy5nZXQoXCJzcGVlZFhcIikgKyAwLjI1KTtcbiAgICAgICAgcmV0dXJuIHRoaXMuYWRkRWdncygpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBHYW1lU3RhdGUucHJvdG90eXBlLnZhbGlkYXRlQWxpdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLmdldChcImxpdmVzXCIpIDw9IDApIHtcbiAgICAgICAgcmV0dXJuIHRoaXMuc2V0KFwic2NlbmVcIiwgXCJnYW1lX292ZXJcIik7XG4gICAgICB9XG4gICAgfTtcblxuICAgIEdhbWVTdGF0ZS5wcm90b3R5cGUuYWRkRWdncyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGksIG51bUVnZ3MsIF9yZXN1bHRzO1xuICAgICAgbnVtRWdncyA9IDEwO1xuICAgICAgaSA9IDA7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgd2hpbGUgKGkgPCBudW1FZ2dzKSB7XG4gICAgICAgIHRoaXMuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5hZGQobmV3IEVnZ01vZGVsKHtcbiAgICAgICAgICBjb2xsZWN0aW9uSW5kZXg6IGlcbiAgICAgICAgfSkpO1xuICAgICAgICBfcmVzdWx0cy5wdXNoKGkrKyk7XG4gICAgICB9XG4gICAgICByZXR1cm4gX3Jlc3VsdHM7XG4gICAgfTtcblxuICAgIEdhbWVTdGF0ZS5wcm90b3R5cGUuY2xlYW5VcEVnZyA9IGZ1bmN0aW9uKGVnZ01vZGVsKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXQoXCJlZ2dDb2xsZWN0aW9uXCIpLnJlbW92ZShlZ2dNb2RlbCk7XG4gICAgfTtcblxuICAgIEdhbWVTdGF0ZS5wcm90b3R5cGUucmVzZXRHYW1lRGF0YSA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuc2V0KEdhbWVTdGF0ZS5EZWZhdWx0R2FtZURhdGEpO1xuICAgIH07XG5cbiAgICBHYW1lU3RhdGUucHJvdG90eXBlLmdldFNjb3JlU3VibWlzc2lvbiA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuICgodGhpcy5nZXQoXCJsZXZlbFwiKSAqIDM2MikgPDwgNSkgKyBcIi5cIiArICgodGhpcy5nZXQoXCJzY29yZVwiKSAqIDY3MikgPDwgNCk7XG4gICAgfTtcblxuICAgIHJldHVybiBHYW1lU3RhdGU7XG5cbiAgfSkoQmFja2JvbmUuTW9kZWwpO1xuICBFZ2dNb2RlbCA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRWdnTW9kZWwsIF9zdXBlcik7XG5cbiAgICBmdW5jdGlvbiBFZ2dNb2RlbCgpIHtcbiAgICAgIHRoaXMuZWdnSGl0R3JvdW5kID0gX19iaW5kKHRoaXMuZWdnSGl0R3JvdW5kLCB0aGlzKTtcbiAgICAgIHRoaXMuaXNTYWZlID0gX19iaW5kKHRoaXMuaXNTYWZlLCB0aGlzKTtcbiAgICAgIHRoaXMubmV4dFNwcml0ZSA9IF9fYmluZCh0aGlzLm5leHRTcHJpdGUsIHRoaXMpO1xuICAgICAgcmV0dXJuIEVnZ01vZGVsLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIEVnZ01vZGVsLk51bVNwcml0ZXMgPSA1O1xuXG4gICAgRWdnTW9kZWwucHJvdG90eXBlLmRlZmF1bHRzID0ge1xuICAgICAgc3ByaXRlSW5kZXg6IDEsXG4gICAgICBjb2xsZWN0aW9uSW5kZXg6IDBcbiAgICB9O1xuXG4gICAgRWdnTW9kZWwucHJvdG90eXBlLm5leHRTcHJpdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc2V0KFwic3ByaXRlSW5kZXhcIiwgdGhpcy5nZXQoXCJzcHJpdGVJbmRleFwiKSArIDEpO1xuICAgICAgaWYgKHRoaXMuaXNTYWZlKCkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcihcImZseVwiLCBbdGhpc10pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBFZ2dNb2RlbC5wcm90b3R5cGUuaXNTYWZlID0gZnVuY3Rpb24oKSB7XG4gICAgICByZXR1cm4gdGhpcy5nZXQoXCJzcHJpdGVJbmRleFwiKSA+PSBFZ2dNb2RlbC5OdW1TcHJpdGVzO1xuICAgIH07XG5cbiAgICBFZ2dNb2RlbC5wcm90b3R5cGUuZWdnSGl0R3JvdW5kID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAoIXRoaXMuaXNTYWZlKCkpIHtcbiAgICAgICAgcmV0dXJuIHRoaXMudHJpZ2dlcihcImJyZWFrXCIsIFt0aGlzXSk7XG4gICAgICB9XG4gICAgfTtcblxuICAgIHJldHVybiBFZ2dNb2RlbDtcblxuICB9KShCYWNrYm9uZS5Nb2RlbCk7XG5cbiAgLypcbiAgVmlld3MgKioqKlxuICAgKi9cbiAgRWdnVmlldyA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoRWdnVmlldywgX3N1cGVyKTtcblxuICAgIGZ1bmN0aW9uIEVnZ1ZpZXcoKSB7XG4gICAgICB0aGlzLmhhbmRsZVRyYW5zaXRpb25FbmRlZCA9IF9fYmluZCh0aGlzLmhhbmRsZVRyYW5zaXRpb25FbmRlZCwgdGhpcyk7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZSA9IF9fYmluZCh0aGlzLnJlbmRlclJlbW92ZSwgdGhpcyk7XG4gICAgICB0aGlzLnJlbmRlckZseWluZyA9IF9fYmluZCh0aGlzLnJlbmRlckZseWluZywgdGhpcyk7XG4gICAgICB0aGlzLnJlbmRlckhpZGRpbmcgPSBfX2JpbmQodGhpcy5yZW5kZXJIaWRkaW5nLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyQnJlYWtpbmcgPSBfX2JpbmQodGhpcy5yZW5kZXJCcmVha2luZywgdGhpcyk7XG4gICAgICB0aGlzLnJlbmRlclNwcml0ZXMgPSBfX2JpbmQodGhpcy5yZW5kZXJTcHJpdGVzLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICAgIHRoaXMubmV4dFNwcml0ZSA9IF9fYmluZCh0aGlzLm5leHRTcHJpdGUsIHRoaXMpO1xuICAgICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgICByZXR1cm4gRWdnVmlldy5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICBFZ2dWaWV3LnByb3RvdHlwZS5jbGFzc05hbWUgPSBcImVnZ1wiO1xuXG4gICAgRWdnVmlldy5wcm90b3R5cGUuc3ByaXRlQ2xhc3MgPSBcIi5lZ2dfc3ByaXRlX1wiO1xuXG4gICAgRWdnVmlldy5wcm90b3R5cGUuZWdnVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2VnZ1wiKS5odG1sKCkpO1xuXG4gICAgRWdnVmlldy5wcm90b3R5cGUuc2NlbmUgPSBudWxsO1xuXG4gICAgRWdnVmlldy5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgICAgd2Via2l0VHJhbnNpdGlvbkVuZDogXCJoYW5kbGVUcmFuc2l0aW9uRW5kZWRcIixcbiAgICAgIG1velRyYW5zaXRpb25FbmQ6IFwiaGFuZGxlVHJhbnNpdGlvbkVuZGVkXCIsXG4gICAgICB0cmFuc2l0aW9uZW5kOiBcImhhbmRsZVRyYW5zaXRpb25FbmRlZFwiXG4gICAgfTtcblxuICAgIEVnZ1ZpZXcucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuc2NlbmUgPSB0aGlzLm9wdGlvbnMuc2NlbmU7XG4gICAgICB0aGlzLmdhbWVTdGF0ZSA9IHRoaXMub3B0aW9ucy5nYW1lU3RhdGU7XG4gICAgICB0aGlzLiRlbC5vbihVdGlscy5jbGlja0Rvd25PclRvdWNoKCksIHRoaXMubmV4dFNwcml0ZSk7XG4gICAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNwcml0ZUluZGV4XCIsIHRoaXMucmVuZGVyU3ByaXRlcyk7XG4gICAgICB0aGlzLm1vZGVsLm9uKFwiZmx5XCIsIHRoaXMucmVuZGVyRmx5aW5nKTtcbiAgICAgIHJldHVybiB0aGlzLm1vZGVsLm9uKFwiYnJlYWtcIiwgdGhpcy5yZW5kZXJCcmVha2luZyk7XG4gICAgfTtcblxuICAgIEVnZ1ZpZXcucHJvdG90eXBlLm5leHRTcHJpdGUgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICghdGhpcy5tb2RlbC5pc1NhZmUoKSkge1xuICAgICAgICB0aGlzLm1vZGVsLm5leHRTcHJpdGUoKTtcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBFZ2dWaWV3LnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHZhciBkZWxheSwgaW50ZXJtaXNzaW9uLCBsZWZ0LCBzcGVlZCwgdG9wO1xuICAgICAgdGhpcy5yZW5kZXJTcHJpdGVzKCk7XG4gICAgICBpbnRlcm1pc3Npb24gPSAzLjU7XG4gICAgICBkZWxheSA9IHZvaWQgMDtcbiAgICAgIGlmICh0aGlzLm1vZGVsLmdldChcImNvbGxlY3Rpb25JbmRleFwiKSA9PT0gMSkge1xuICAgICAgICBkZWxheSA9IGludGVybWlzc2lvbjtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGRlbGF5ID0gKE1hdGgucmFuZG9tKCkgKiA2ICsgMykgLyB0aGlzLmdhbWVTdGF0ZS5nZXQoXCJzcGVlZFhcIikgKyAoMiAqIHRoaXMubW9kZWwuZ2V0KFwiY29sbGVjdGlvbkluZGV4XCIpKSArIGludGVybWlzc2lvbjtcbiAgICAgIH1cbiAgICAgIHNwZWVkID0gMTAwICogdGhpcy5nYW1lU3RhdGUuZ2V0KFwic3BlZWRYXCIpICsgTWF0aC5yYW5kb20oKSAqIDEwMCAtIDUwO1xuICAgICAgbGVmdCA9IE1hdGgucmFuZG9tKCkgKiAoJCh3aW5kb3cpLndpZHRoKCkgLSAxMDApICsgMzA7XG4gICAgICB0b3AgPSAkKFwiI3N0YWdlXCIpLmhlaWdodCgpIC0gMjIwO1xuICAgICAgdGhpcy4kZWwuY3NzKFV0aWxzLmJwKCkgKyBcInRyYW5zaXRpb24tZGVsYXlcIiwgZGVsYXkgKyBcInNcIik7XG4gICAgICB0aGlzLiRlbC5jc3MoVXRpbHMuYnAoKSArIFwidHJhbnNpdGlvbi1kdXJhdGlvblwiLCAkKHdpbmRvdykuaGVpZ2h0KCkgLyBzcGVlZCArIFwic1wiKTtcbiAgICAgIHRoaXMuJGVsLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLXByb3BlcnR5XCIsIFwidG9wIG9wYWNpdHlcIik7XG4gICAgICB0aGlzLiRlbC5jc3MoVXRpbHMuYnAoKSArIFwidHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb25cIiwgXCJsaW5lYXJcIik7XG4gICAgICB0aGlzLiRlbC5jc3MoXCJsZWZ0XCIsIGxlZnQgKyBcInB4XCIpO1xuICAgICAgdGhpcy5zY2VuZS5hcHBlbmQodGhpcy4kZWwpO1xuICAgICAgcmV0dXJuIFV0aWxzLm5leHRUaWNrKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLiRlbC5jc3MoXCJ0b3BcIiwgdG9wICsgXCJweFwiKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICB9O1xuXG4gICAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVyU3ByaXRlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgcmV0dXJuIHRoaXMuJGVsLmh0bWwodGhpcy5lZ2dUZW1wbGF0ZSh7XG4gICAgICAgIHNwcml0ZUluZGV4OiB0aGlzLm1vZGVsLmdldChcInNwcml0ZUluZGV4XCIpXG4gICAgICB9KSk7XG4gICAgfTtcblxuICAgIEVnZ1ZpZXcucHJvdG90eXBlLnJlbmRlckJyZWFraW5nID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImNyYWNrZWRcIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgIHRoaXMuJGVsLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIFwiMHNcIik7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuY3NzKFV0aWxzLmJwKCkgKyBcInRyYW5zaXRpb24tZHVyYXRpb25cIiwgXCIwLjJzXCIpO1xuICAgIH07XG5cbiAgICBFZ2dWaWV3LnByb3RvdHlwZS5yZW5kZXJIaWRkaW5nID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImJyb2tlblwiKTtcbiAgICAgIHRoaXMuJGVsLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIFwiMXNcIik7XG4gICAgICB0aGlzLiRlbC5jc3MoVXRpbHMuYnAoKSArIFwidHJhbnNpdGlvbi1kdXJhdGlvblwiLCBcIjAuNXNcIik7XG4gICAgICB0aGlzLiRlbC5jc3MoVXRpbHMuYnAoKSArIFwidHJhbnNpdGlvbi1wcm9wZXJ0eVwiLCBcIm9wYWNpdHlcIik7XG4gICAgICB0aGlzLiRlbC5jc3MoVXRpbHMuYnAoKSArIFwidHJhbnNpdGlvbi10aW1pbmctZnVuY3Rpb25cIiwgXCJsaW5lYXJcIik7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuY3NzKFwib3BhY2l0eVwiLCAwKTtcbiAgICB9O1xuXG4gICAgRWdnVmlldy5wcm90b3R5cGUucmVuZGVyRmx5aW5nID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLiRlbC5hZGRDbGFzcyhcImZseWluZ1wiKTtcbiAgICAgIHRoaXMuJGVsLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLWRlbGF5XCIsIFwiMHNcIik7XG4gICAgICB0aGlzLiRlbC5jc3MoVXRpbHMuYnAoKSArIFwidHJhbnNpdGlvbi1kdXJhdGlvblwiLCBcIjFzXCIpO1xuICAgICAgdGhpcy4kZWwuY3NzKFV0aWxzLmJwKCkgKyBcInRyYW5zaXRpb24tcHJvcGVydHlcIiwgXCJ0b3BcIik7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuY3NzKFV0aWxzLmJwKCkgKyBcInRyYW5zaXRpb24tdGltaW5nLWZ1bmN0aW9uXCIsIFwibGluZWFyXCIpO1xuICAgIH07XG5cbiAgICBFZ2dWaWV3LnByb3RvdHlwZS5yZW5kZXJSZW1vdmUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHJldHVybiB0aGlzLnJlbW92ZSgpO1xuICAgIH07XG5cbiAgICBFZ2dWaWV3LnByb3RvdHlwZS5oYW5kbGVUcmFuc2l0aW9uRW5kZWQgPSBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAoZS5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZSA9PT0gXCJvcGFjaXR5XCIpIHtcbiAgICAgICAgdGhpcy5yZW5kZXJSZW1vdmUoKTtcbiAgICAgIH0gZWxzZSBpZiAoZS5vcmlnaW5hbEV2ZW50LnByb3BlcnR5TmFtZSA9PT0gXCJ0b3BcIikge1xuICAgICAgICB0aGlzLm1vZGVsLmVnZ0hpdEdyb3VuZCgpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKGUub3JpZ2luYWxFdmVudC5wcm9wZXJ0eU5hbWUgPT09IFV0aWxzLmJwKCkgKyBcInRyYW5zZm9ybVwiIHx8IFwidHJhbnNmb3JtXCIpIHtcbiAgICAgICAgICB0aGlzLnJlbmRlckhpZGRpbmcoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICByZXR1cm4gRWdnVmlldztcblxuICB9KShCYWNrYm9uZS5WaWV3KTtcbiAgU3RhZ2UgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKFN0YWdlLCBfc3VwZXIpO1xuXG4gICAgZnVuY3Rpb24gU3RhZ2UoKSB7XG4gICAgICB0aGlzLnJlbmRlckNsb3VkcyA9IF9fYmluZCh0aGlzLnJlbmRlckNsb3VkcywgdGhpcyk7XG4gICAgICB0aGlzLnJlbmRlclRyZWVzID0gX19iaW5kKHRoaXMucmVuZGVyVHJlZXMsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJTdW4gPSBfX2JpbmQodGhpcy5yZW5kZXJTdW4sIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJUaWxlcyA9IF9fYmluZCh0aGlzLnJlbmRlclRpbGVzLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICAgIHJldHVybiBTdGFnZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICBTdGFnZS5wcm90b3R5cGUuZWwgPSBcIiNzdGFnZVwiO1xuXG4gICAgU3RhZ2UucHJvdG90eXBlLnRpbGVUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfdGlsZV9wYWlyXCIpLmh0bWwoKSk7XG5cbiAgICBTdGFnZS5wcm90b3R5cGUudHJlZVRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKFwiI190cmVlXCIpLmh0bWwoKSk7XG5cbiAgICBTdGFnZS5wcm90b3R5cGUuc3VuVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX3N1blwiKS5odG1sKCkpO1xuXG4gICAgU3RhZ2UucHJvdG90eXBlLmNsb3VkVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2Nsb3VkXCIpLmh0bWwoKSk7XG5cbiAgICBTdGFnZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLiRlbC5jc3MoXCJoZWlnaHRcIiwgJCh3aW5kb3cpLmhlaWdodCgpKTtcbiAgICAgIHRoaXMucmVuZGVyU3VuKCk7XG4gICAgICB0aGlzLnJlbmRlclRyZWVzKCk7XG4gICAgICB0aGlzLnJlbmRlclRpbGVzKCk7XG4gICAgICByZXR1cm4gdGhpcy5yZW5kZXJDbG91ZHMoKTtcbiAgICB9O1xuXG4gICAgU3RhZ2UucHJvdG90eXBlLnJlbmRlclRpbGVzID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLiQoXCIudGlsZVwiKS5yZW1vdmUoKTtcbiAgICAgIHJldHVybiB0aGlzLiRlbC5hcHBlbmQodGhpcy50aWxlVGVtcGxhdGUoKSk7XG4gICAgfTtcblxuICAgIFN0YWdlLnByb3RvdHlwZS5yZW5kZXJTdW4gPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJChcIi5zdW5cIikucmVtb3ZlKCk7XG4gICAgICByZXR1cm4gdGhpcy4kZWwuYXBwZW5kKHRoaXMuc3VuVGVtcGxhdGUoKSk7XG4gICAgfTtcblxuICAgIFN0YWdlLnByb3RvdHlwZS5yZW5kZXJUcmVlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGksIGxlZnQsIG51bVRyZWVzLCBfcmVzdWx0cztcbiAgICAgIG51bVRyZWVzID0gTWF0aC5jZWlsKCQod2luZG93KS53aWR0aCgpIC8gMjAwKTtcbiAgICAgIHRoaXMuJChcIi50cmVlXCIpLnJlbW92ZSgpO1xuICAgICAgaWYgKG51bVRyZWVzIDw9IDIpIHtcbiAgICAgICAgdGhpcy4kZWwuYXBwZW5kKHRoaXMudHJlZVRlbXBsYXRlKHtcbiAgICAgICAgICB0cmVlTnVtOiAzLFxuICAgICAgICAgIGxlZnRWYWx1ZTogLTEwMFxuICAgICAgICB9KSk7XG4gICAgICAgIHJldHVybiB0aGlzLiRlbC5hcHBlbmQodGhpcy50cmVlVGVtcGxhdGUoe1xuICAgICAgICAgIHRyZWVOdW06IDEsXG4gICAgICAgICAgbGVmdFZhbHVlOiAxMjBcbiAgICAgICAgfSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaSA9IDA7XG4gICAgICAgIF9yZXN1bHRzID0gW107XG4gICAgICAgIHdoaWxlIChpIDwgbnVtVHJlZXMpIHtcbiAgICAgICAgICBsZWZ0ID0gTWF0aC5yYW5kb20oKSAqIDIwMC4gKyBpICogMjAwO1xuICAgICAgICAgIHRoaXMuJGVsLmFwcGVuZCh0aGlzLnRyZWVUZW1wbGF0ZSh7XG4gICAgICAgICAgICB0cmVlTnVtOiAtMSxcbiAgICAgICAgICAgIGxlZnRWYWx1ZTogbGVmdCAtIDMwMFxuICAgICAgICAgIH0pKTtcbiAgICAgICAgICBfcmVzdWx0cy5wdXNoKGkrKyk7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIF9yZXN1bHRzO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBTdGFnZS5wcm90b3R5cGUucmVuZGVyQ2xvdWRzID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgZGVsYXksIGRpciwgaSwgbnVtQ2xvdWRzLCBzcGVlZCwgdG9wLCBfcmVzdWx0cztcbiAgICAgIG51bUNsb3VkcyA9IE1hdGguY2VpbCgkKHdpbmRvdykud2lkdGgoKSAvIDIwMCk7XG4gICAgICBudW1DbG91ZHMgPSAobnVtQ2xvdWRzIDwgMiA/IDIgOiBudW1DbG91ZHMpO1xuICAgICAgaSA9IDA7XG4gICAgICBfcmVzdWx0cyA9IFtdO1xuICAgICAgd2hpbGUgKGkgPCBudW1DbG91ZHMpIHtcbiAgICAgICAgdG9wID0gTWF0aC5yYW5kb20oKSAqIDUwO1xuICAgICAgICBkZWxheSA9IE1hdGgucmFuZG9tKCkgKiA4IC0gNCArICgxMCAqIGkpO1xuICAgICAgICBzcGVlZCA9IDIwO1xuICAgICAgICBkaXIgPSAoTWF0aC5mbG9vcihNYXRoLnJhbmRvbSgpICogMikgPCAxID8gXCJsZWZ0XCIgOiBcInJpZ2h0XCIpO1xuICAgICAgICB0aGlzLiRlbC5hcHBlbmQodGhpcy5jbG91ZFRlbXBsYXRlKHtcbiAgICAgICAgICBkZWxheTogZGVsYXksXG4gICAgICAgICAgZGlyZWN0aW9uOiBkaXIsXG4gICAgICAgICAgZHVyYXRpb246ICQod2luZG93KS53aWR0aCgpIC8gc3BlZWQsXG4gICAgICAgICAgdG9wVmFsdWU6IHRvcFxuICAgICAgICB9KSk7XG4gICAgICAgIF9yZXN1bHRzLnB1c2goaSsrKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiBfcmVzdWx0cztcbiAgICB9O1xuXG4gICAgcmV0dXJuIFN0YWdlO1xuXG4gIH0pKEJhY2tib25lLlZpZXcpO1xuICBNZW51U2NlbmUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKE1lbnVTY2VuZSwgX3N1cGVyKTtcblxuICAgIGZ1bmN0aW9uIE1lbnVTY2VuZSgpIHtcbiAgICAgIHRoaXMuY2xlYW5VcCA9IF9fYmluZCh0aGlzLmNsZWFuVXAsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSA9IF9fYmluZCh0aGlzLnJlbmRlclJlbW92ZVNjZW5lLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UgPSBfX2JpbmQodGhpcy5yZW5kZXJTY2VuZUNoYW5nZSwgdGhpcyk7XG4gICAgICB0aGlzLmhhbmRsZUNyZWRpdHNCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVDcmVkaXRzQnV0dG9uLCB0aGlzKTtcbiAgICAgIHRoaXMuaGFuZGxlSGlnaHNjb3JlQnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlSGlnaHNjb3JlQnV0dG9uLCB0aGlzKTtcbiAgICAgIHRoaXMuaGFuZGxlUGxheUJ1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZVBsYXlCdXR0b24sIHRoaXMpO1xuICAgICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgICByZXR1cm4gTWVudVNjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIE1lbnVTY2VuZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJtZW51X3NjZW5lXCI7XG5cbiAgICBNZW51U2NlbmUucHJvdG90eXBlLmV2ZW50cyA9IHtcbiAgICAgIFwiYW5pbWF0aW9uZW5kIC50aXRsZVwiOiBcImNsZWFuVXBcIixcbiAgICAgIFwid2Via2l0QW5pbWF0aW9uRW5kIC50aXRsZVwiOiBcImNsZWFuVXBcIixcbiAgICAgIFwibW96QW5pbWF0aW9uRW5kIC50aXRsZVwiOiBcImNsZWFuVXBcIlxuICAgIH07XG5cbiAgICBNZW51U2NlbmUucHJvdG90eXBlLnRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKFwiI19tZW51XCIpLmh0bWwoKSk7XG5cbiAgICBNZW51U2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwibWVudVwiO1xuXG4gICAgTWVudVNjZW5lLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNjZW5lXCIsIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UpO1xuICAgICAgdGhpcy4kZWwub24oVXRpbHMuY2xpY2tVcE9yVG91Y2goKSwgXCIjcGxheV9idXR0b25cIiwgdGhpcy5oYW5kbGVQbGF5QnV0dG9uKTtcbiAgICAgIHRoaXMuJGVsLm9uKFV0aWxzLmNsaWNrVXBPclRvdWNoKCksIFwiI2hpZ2hzY29yZV9idXR0b25cIiwgdGhpcy5oYW5kbGVIaWdoc2NvcmVCdXR0b24pO1xuICAgICAgdGhpcy4kZWwub24oVXRpbHMuY2xpY2tVcE9yVG91Y2goKSwgXCIjY3JlZGl0c19idXR0b25cIiwgdGhpcy5oYW5kbGVDcmVkaXRzQnV0dG9uKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBNZW51U2NlbmUucHJvdG90eXBlLmhhbmRsZVBsYXlCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwiZ2FtZVwiKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgTWVudVNjZW5lLnByb3RvdHlwZS5oYW5kbGVIaWdoc2NvcmVCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwiaGlnaHNjb3JlXCIpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICBNZW51U2NlbmUucHJvdG90eXBlLmhhbmRsZUNyZWRpdHNCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICB0aGlzLm1vZGVsLnNldChcInNjZW5lXCIsIFwiY3JlZGl0c1wiKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9O1xuXG4gICAgTWVudVNjZW5lLnByb3RvdHlwZS5yZW5kZXJTY2VuZUNoYW5nZSA9IGZ1bmN0aW9uKG1vZGVsLCBzY2VuZSkge1xuICAgICAgaWYgKG1vZGVsLnByZXZpb3VzKFwic2NlbmVcIikgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUoKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChzY2VuZSA9PT0gdGhpcy5zY2VuZU5hbWUpIHtcbiAgICAgICAgICB0aGlzLnJlbmRlcigpO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgTWVudVNjZW5lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSgpKTtcbiAgICAgICQoXCIjc3RhZ2VcIikuYXBwZW5kKHRoaXMuJGVsKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBNZW51U2NlbmUucHJvdG90eXBlLnJlbmRlclJlbW92ZVNjZW5lID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLiQoXCIudGl0bGVcIikucmVtb3ZlQ2xhc3MoXCJkaXNwbGF5XCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgICAgdGhpcy4kKFwiLnRpdGxlXCIpLmNzcyhVdGlscy5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlVGl0bGVcIik7XG4gICAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmNzcyhVdGlscy5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlTWVudVwiKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBNZW51U2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJzY2VuZVwiKSAhPT0gdGhpcy5zY2VuZU5hbWUgJiYgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJ0aXRsZVwiKSkge1xuICAgICAgICB0aGlzLiRlbC5lbXB0eSgpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICByZXR1cm4gTWVudVNjZW5lO1xuXG4gIH0pKEJhY2tib25lLlZpZXcpO1xuICBHYW1lU2NlbmUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEdhbWVTY2VuZSwgX3N1cGVyKTtcblxuICAgIGZ1bmN0aW9uIEdhbWVTY2VuZSgpIHtcbiAgICAgIHRoaXMuY2xlYW5VcCA9IF9fYmluZCh0aGlzLmNsZWFuVXAsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJSZW1vdmVTY2VuZSA9IF9fYmluZCh0aGlzLnJlbmRlclJlbW92ZVNjZW5lLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyQWRkRWdnID0gX19iaW5kKHRoaXMucmVuZGVyQWRkRWdnLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyRWdncyA9IF9fYmluZCh0aGlzLnJlbmRlckVnZ3MsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJCYWNrQnV0dG9uID0gX19iaW5kKHRoaXMucmVuZGVyQmFja0J1dHRvbiwgdGhpcyk7XG4gICAgICB0aGlzLnJlbmRlckxpdmVzID0gX19iaW5kKHRoaXMucmVuZGVyTGl2ZXMsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJTY29yZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjb3JlLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyTGV2ZWxMYWJlbCA9IF9fYmluZCh0aGlzLnJlbmRlckxldmVsTGFiZWwsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJMZXZlbCA9IF9fYmluZCh0aGlzLnJlbmRlckxldmVsLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyID0gX19iaW5kKHRoaXMucmVuZGVyLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UgPSBfX2JpbmQodGhpcy5yZW5kZXJTY2VuZUNoYW5nZSwgdGhpcyk7XG4gICAgICB0aGlzLmhhbmRsZUJhY2tCdXR0b24gPSBfX2JpbmQodGhpcy5oYW5kbGVCYWNrQnV0dG9uLCB0aGlzKTtcbiAgICAgIHRoaXMuaW5pdGlhbGl6ZSA9IF9fYmluZCh0aGlzLmluaXRpYWxpemUsIHRoaXMpO1xuICAgICAgcmV0dXJuIEdhbWVTY2VuZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICBHYW1lU2NlbmUucHJvdG90eXBlLmNsYXNzTmFtZSA9IFwiZ2FtZV9zY2VuZVwiO1xuXG4gICAgR2FtZVNjZW5lLnByb3RvdHlwZS5ldmVudHMgPSB7XG4gICAgICBhbmltYXRpb25lbmQ6IFwiY2xlYW5VcFwiLFxuICAgICAgd2Via2l0QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIixcbiAgICAgIG1vekFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCJcbiAgICB9O1xuXG4gICAgR2FtZVNjZW5lLnByb3RvdHlwZS5zY29yZVRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKFwiI19nYW1lX3Njb3JlXCIpLmh0bWwoKSk7XG5cbiAgICBHYW1lU2NlbmUucHJvdG90eXBlLmxldmVsVGVtcGxhdGUgPSBfLnRlbXBsYXRlKCQoXCIjX2dhbWVfbGV2ZWxcIikuaHRtbCgpKTtcblxuICAgIEdhbWVTY2VuZS5wcm90b3R5cGUubGl2ZXNUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfZ2FtZV9saXZlc1wiKS5odG1sKCkpO1xuXG4gICAgR2FtZVNjZW5lLnByb3RvdHlwZS5zY2VuZU5hbWUgPSBcImdhbWVcIjtcblxuICAgIEdhbWVTY2VuZS5wcm90b3R5cGUuaW5pdGlhbGl6ZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5lZ2dWaWV3cyA9IFtdO1xuICAgICAgdGhpcy4kZWwub24oVXRpbHMuY2xpY2tVcE9yVG91Y2goKSwgXCIuYmFja19idXR0b25cIiwgdGhpcy5oYW5kbGVCYWNrQnV0dG9uKTtcbiAgICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c2NlbmVcIiwgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSk7XG4gICAgICB0aGlzLm1vZGVsLmdldChcImVnZ0NvbGxlY3Rpb25cIikub24oXCJhZGRcIiwgdGhpcy5yZW5kZXJBZGRFZ2cpO1xuICAgICAgdGhpcy5tb2RlbC5vbihcImNoYW5nZTpzY29yZVwiLCB0aGlzLnJlbmRlclNjb3JlKTtcbiAgICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6bGl2ZXNcIiwgdGhpcy5yZW5kZXJMaXZlcyk7XG4gICAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOmxldmVsXCIsIHRoaXMucmVuZGVyTGV2ZWwpO1xuICAgICAgcmV0dXJuIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6bGV2ZWxcIiwgdGhpcy5yZW5kZXJMZXZlbExhYmVsKTtcbiAgICB9O1xuXG4gICAgR2FtZVNjZW5lLnByb3RvdHlwZS5oYW5kbGVCYWNrQnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICByZXR1cm4gdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcIm1lbnVcIik7XG4gICAgfTtcblxuICAgIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICAgIGlmIChtb2RlbC5wcmV2aW91cyhcInNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc2NlbmUgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLm1vZGVsLnJlc2V0R2FtZURhdGEoKTtcbiAgICAgIHRoaXMuJChcIiNodWRcIikucmVtb3ZlKCk7XG4gICAgICB0aGlzLiRlbC5hcHBlbmQoXCI8ZGl2IGlkPSdodWQnPjwvZGl2PlwiKTtcbiAgICAgIHRoaXMucmVuZGVyTGV2ZWwoKTtcbiAgICAgIHNldFRpbWVvdXQoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLnJlbmRlckxldmVsTGFiZWwoKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKSwgMTIwMCk7XG4gICAgICB0aGlzLnJlbmRlclNjb3JlKCk7XG4gICAgICB0aGlzLnJlbmRlckxpdmVzKCk7XG4gICAgICB0aGlzLnJlbmRlckJhY2tCdXR0b24oKTtcbiAgICAgIHRoaXMucmVuZGVyRWdncygpO1xuICAgICAgaWYgKCQoXCIjc3RhZ2UgLlwiICsgdGhpcy5jbGFzc05hbWUpLmxlbmd0aCA8PSAwKSB7XG4gICAgICAgICQoXCIjc3RhZ2VcIikuYXBwZW5kKHRoaXMuJGVsKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckxldmVsID0gZnVuY3Rpb24oKSB7XG4gICAgICBpZiAodGhpcy4kKFwiI2dhbWVfbGV2ZWxcIikubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLiQoXCIjZ2FtZV9sZXZlbFwiKS5yZXBsYWNlV2l0aCh0aGlzLmxldmVsVGVtcGxhdGUoe1xuICAgICAgICAgIGxldmVsOiB0aGlzLm1vZGVsLmdldChcImxldmVsXCIpXG4gICAgICAgIH0pKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuJChcIiNodWRcIikuYXBwZW5kKHRoaXMubGV2ZWxUZW1wbGF0ZSh7XG4gICAgICAgICAgbGV2ZWw6IHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIilcbiAgICAgICAgfSkpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyTGV2ZWxMYWJlbCA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy4kZWwuYXBwZW5kKFwiPHAgY2xhc3M9J2xldmVsX2xhYmVsJz5MRVZFTCBcIiArIHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIikgKyBcIjxicj5HRVQgUkVBRFkhPC9wPlwiKTtcbiAgICAgIHNldFRpbWVvdXQoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLiQoXCIubGV2ZWxfbGFiZWxcIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgICAgICB9O1xuICAgICAgfSkodGhpcykpLCAzMDAwKTtcbiAgICAgIHNldFRpbWVvdXQoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oKSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLiQoXCIubGV2ZWxfbGFiZWxcIikucmVtb3ZlKCk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSksIDMzMDApO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NvcmUgPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLiQoXCIjZ2FtZV9zY29yZVwiKS5sZW5ndGggPiAwKSB7XG4gICAgICAgIHRoaXMuJChcIiNnYW1lX3Njb3JlXCIpLnJlcGxhY2VXaXRoKHRoaXMuc2NvcmVUZW1wbGF0ZSh7XG4gICAgICAgICAgc2NvcmU6IHRoaXMubW9kZWwuZ2V0KFwic2NvcmVcIilcbiAgICAgICAgfSkpO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgdGhpcy4kKFwiI2h1ZFwiKS5hcHBlbmQodGhpcy5zY29yZVRlbXBsYXRlKHtcbiAgICAgICAgICBzY29yZTogdGhpcy5tb2RlbC5nZXQoXCJzY29yZVwiKVxuICAgICAgICB9KSk7XG4gICAgICB9XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJMaXZlcyA9IGZ1bmN0aW9uKCkge1xuICAgICAgaWYgKHRoaXMuJChcIiNnYW1lX2xpdmVzXCIpLmxlbmd0aCA+IDApIHtcbiAgICAgICAgdGhpcy4kKFwiI2dhbWVfbGl2ZXNcIikucmVwbGFjZVdpdGgodGhpcy5saXZlc1RlbXBsYXRlKHtcbiAgICAgICAgICBsaXZlczogdGhpcy5tb2RlbC5nZXQoXCJsaXZlc1wiKVxuICAgICAgICB9KSk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICB0aGlzLiQoXCIjaHVkXCIpLmFwcGVuZCh0aGlzLmxpdmVzVGVtcGxhdGUoe1xuICAgICAgICAgIGxpdmVzOiB0aGlzLm1vZGVsLmdldChcImxpdmVzXCIpXG4gICAgICAgIH0pKTtcbiAgICAgIH1cbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBHYW1lU2NlbmUucHJvdG90eXBlLnJlbmRlckJhY2tCdXR0b24gPSBmdW5jdGlvbigpIHtcbiAgICAgIGlmICh0aGlzLiQoXCIuYmFja19idXR0b25cIikubGVuZ3RoID4gMCkge1xuICAgICAgICB0aGlzLiQoXCIuYmFja19idXR0b25cIikucmVwbGFjZVdpdGgoXCI8ZGl2IGNsYXNzPSdiYWNrX2J1dHRvbic+WDwvZGl2PlwiKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuJGVsLmFwcGVuZChcIjxkaXYgY2xhc3M9J2JhY2tfYnV0dG9uJz5YPC9kaXY+XCIpO1xuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIEdhbWVTY2VuZS5wcm90b3R5cGUucmVuZGVyRWdncyA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy5tb2RlbC5hZGRFZ2dzKCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJBZGRFZ2cgPSBmdW5jdGlvbihlZ2dNb2RlbCwgY29sbGVjdGlvbiwgb3B0aW9ucykge1xuICAgICAgdmFyIGVnZ1ZpZXc7XG4gICAgICBlZ2dWaWV3ID0gbmV3IEVnZ1ZpZXcoe1xuICAgICAgICBtb2RlbDogZWdnTW9kZWwsXG4gICAgICAgIGdhbWVTdGF0ZTogdGhpcy5tb2RlbCxcbiAgICAgICAgc2NlbmU6IHRoaXMuJGVsXG4gICAgICB9KTtcbiAgICAgIGVnZ1ZpZXcucmVuZGVyKCk7XG4gICAgICB0aGlzLmVnZ1ZpZXdzLnB1c2goZWdnVmlldyk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgR2FtZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmNzcyhVdGlscy5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInhSYWlzZVwiKTtcbiAgICAgIHRoaXMuJChcIiNodWQgcFwiKS5jc3MoVXRpbHMuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyZW1vdmVIVURcIik7XG4gICAgICB0aGlzLiQoXCIuZWdnXCIpLmNzcyhVdGlscy5icCgpICsgXCJ0cmFuc2l0aW9uLWR1cmF0aW9uXCIsIFwiMC4zc1wiKTtcbiAgICAgIF8uZWFjaCh0aGlzLmVnZ1ZpZXdzLCAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgcmV0dXJuIGZ1bmN0aW9uKGVnZ1ZpZXcpIHtcbiAgICAgICAgICByZXR1cm4gZWdnVmlldy5yZW5kZXJSZW1vdmUoKTtcbiAgICAgICAgfTtcbiAgICAgIH0pKHRoaXMpKTtcbiAgICAgIHRoaXMubW9kZWwuZ2V0KFwiZWdnQ29sbGVjdGlvblwiKS5yZXNldCgpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIEdhbWVTY2VuZS5wcm90b3R5cGUuY2xlYW5VcCA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgIGlmICh0aGlzLm1vZGVsLmdldChcInNjZW5lXCIpICE9PSB0aGlzLnNjZW5lTmFtZSAmJiAkKGUudGFyZ2V0KS5oYXNDbGFzcyhcImJhY2tfYnV0dG9uXCIpKSB7XG4gICAgICAgIHRoaXMuJGVsLmVtcHR5KCk7XG4gICAgICB9XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAgIHJldHVybiBHYW1lU2NlbmU7XG5cbiAgfSkoQmFja2JvbmUuVmlldyk7XG4gIEdhbWVPdmVyU2NlbmUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEdhbWVPdmVyU2NlbmUsIF9zdXBlcik7XG5cbiAgICBmdW5jdGlvbiBHYW1lT3ZlclNjZW5lKCkge1xuICAgICAgdGhpcy5jbGVhblVwID0gX19iaW5kKHRoaXMuY2xlYW5VcCwgdGhpcyk7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjZW5lQ2hhbmdlLCB0aGlzKTtcbiAgICAgIHRoaXMuc2F2ZUhpZ2hTY29yZSA9IF9fYmluZCh0aGlzLnNhdmVIaWdoU2NvcmUsIHRoaXMpO1xuICAgICAgdGhpcy5oYW5kbGVGYWNlYm9va0J1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZUZhY2Vib29rQnV0dG9uLCB0aGlzKTtcbiAgICAgIHRoaXMuaGFuZGxlUmVwbGF5QnV0dG9uID0gX19iaW5kKHRoaXMuaGFuZGxlUmVwbGF5QnV0dG9uLCB0aGlzKTtcbiAgICAgIHRoaXMuaGFuZGxlTWVudUJ1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZU1lbnVCdXR0b24sIHRoaXMpO1xuICAgICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgICByZXR1cm4gR2FtZU92ZXJTY2VuZS5fX3N1cGVyX18uY29uc3RydWN0b3IuYXBwbHkodGhpcywgYXJndW1lbnRzKTtcbiAgICB9XG5cbiAgICBHYW1lT3ZlclNjZW5lLkNvbmdyYXRzID0gW1wiTm90IGJhZFwiLCBcIkdvb2RcIiwgXCJHcmVhdFwiLCBcIkZhbnRhc3RpY1wiLCBcIlNtYXNoaW5nIVwiLCBcIkFtYXppbmchXCIsIFwiRmx5aW5nIEhpZ2hcIiwgXCJSaWRpY3Vsb3VzIVwiLCBcIkV4dHJhb3JkaW5hcnkhXCIsIFwiTW9uc3Ryb3VzISFcIl07XG5cbiAgICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5jbGFzc05hbWUgPSBcImdhbWVfb3Zlcl9zY2VuZVwiO1xuXG4gICAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgICAgYW5pbWF0aW9uZW5kOiBcImNsZWFuVXBcIixcbiAgICAgIHdlYmtpdEFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCIsXG4gICAgICBtb3pBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiXG4gICAgfTtcblxuICAgIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLnRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKFwiI19nYW1lX292ZXJcIikuaHRtbCgpKTtcblxuICAgIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwiZ2FtZV9vdmVyXCI7XG5cbiAgICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5zdWJtaXR0ZWQgPSBmYWxzZTtcblxuICAgIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c2NlbmVcIiwgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSk7XG4gICAgICB0aGlzLiRlbC5vbihVdGlscy5jbGlja1VwT3JUb3VjaCgpLCBcIi5tZW51X2J1dHRvblwiLCB0aGlzLmhhbmRsZU1lbnVCdXR0b24pO1xuICAgICAgdGhpcy4kZWwub24oVXRpbHMuY2xpY2tVcE9yVG91Y2goKSwgXCIucmVwbGF5X2J1dHRvblwiLCB0aGlzLmhhbmRsZVJlcGxheUJ1dHRvbik7XG4gICAgICByZXR1cm4gdGhpcy4kZWwub24oVXRpbHMuY2xpY2tVcE9yVG91Y2goKSwgXCIuZmFjZWJvb2tfYnV0dG9uXCIsIHRoaXMuaGFuZGxlRmFjZWJvb2tCdXR0b24pO1xuICAgIH07XG5cbiAgICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5oYW5kbGVNZW51QnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgcmV0dXJuIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICAgIH07XG5cbiAgICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5oYW5kbGVSZXBsYXlCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgICB0aGlzLiQoXCIubWVudV9pdGVtXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIik7XG4gICAgICByZXR1cm4gdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcImdhbWVcIik7XG4gICAgfTtcblxuICAgIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmhhbmRsZUZhY2Vib29rQnV0dG9uID0gZnVuY3Rpb24oZSkge1xuICAgICAgJChcIi5mYl9jb250ZW50XCIpLmhpZGUoKTtcbiAgICAgICQoXCIuZmFjZWJvb2tfYnV0dG9uXCIpLmFkZENsYXNzKFwiZGlzYWJsZWRcIikuZW1wdHkoKS5zcGluKHtcbiAgICAgICAgbGVuZ3RoOiA1LFxuICAgICAgICByYWRpdXM6IDUsXG4gICAgICAgIGxpbmVzOiA4LFxuICAgICAgICB3aWR0aDogMyxcbiAgICAgICAgY29sb3I6IFwiI2ZmZlwiXG4gICAgICB9KTtcbiAgICAgIGlmIChQYXJzZS5Vc2VyLmN1cnJlbnQoKSkge1xuICAgICAgICByZXR1cm4gdGhpcy5zYXZlSGlnaFNjb3JlKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gUGFyc2UuRmFjZWJvb2tVdGlscy5sb2dJbihudWxsLCB7XG4gICAgICAgICAgc3VjY2VzczogKGZ1bmN0aW9uKF90aGlzKSB7XG4gICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24odXNlcikge1xuICAgICAgICAgICAgICBpZiAoIXVzZXIuZXhpc3RlZCgpKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuIEZCLmFwaShcIi9tZVwiLCBmdW5jdGlvbihyZXNwb25zZSkge1xuICAgICAgICAgICAgICAgICAgaWYgKCFyZXNwb25zZS5lcnJvcikge1xuICAgICAgICAgICAgICAgICAgICB1c2VyLnNldChcImRpc3BsYXlOYW1lXCIsIHJlc3BvbnNlLm5hbWUpO1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gdXNlci5zYXZlKG51bGwsIHtcbiAgICAgICAgICAgICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbih1c2VyKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc2F2ZUhpZ2hTY29yZSgpO1xuICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgZXJyb3I6IGZ1bmN0aW9uKHVzZXIsIGVycm9yKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gY29uc29sZS5sb2coXCJPb3BzLCBzb21ldGhpbmcgd2VudCB3cm9uZyBzYXZpbmcgeW91ciBuYW1lLlwiKTtcbiAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIGNvbnNvbGUubG9nKFwiT29wcyBzb21ldGhpbmcgd2VudCB3cm9uZyB3aXRoIGZhY2Vib29rLlwiKTtcbiAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gX3RoaXMuc2F2ZUhpZ2hTY29yZSgpO1xuICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pKHRoaXMpLFxuICAgICAgICAgIGVycm9yOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICAgIHJldHVybiBmdW5jdGlvbih1c2VyLCBlcnJvcikge1xuICAgICAgICAgICAgICByZXR1cm4gY29uc29sZS5sb2coXCJPb3BzLCBzb21ldGhpbmcgd2VudCB3cm9uZy5cIik7XG4gICAgICAgICAgICB9O1xuICAgICAgICAgIH0pKHRoaXMpXG4gICAgICAgIH0pO1xuICAgICAgfVxuICAgIH07XG5cbiAgICBHYW1lT3ZlclNjZW5lLnByb3RvdHlwZS5zYXZlSGlnaFNjb3JlID0gZnVuY3Rpb24oKSB7XG4gICAgICB2YXIgc3VibWlzc2lvbjtcbiAgICAgIHN1Ym1pc3Npb24gPSB7XG4gICAgICAgIHNjb3JlOiB0aGlzLm1vZGVsLmdldFNjb3JlU3VibWlzc2lvbigpXG4gICAgICB9O1xuICAgICAgcmV0dXJuIFBhcnNlLkNsb3VkLnJ1bihcInN1Ym1pdEhpZ2hzY29yZVwiLCBzdWJtaXNzaW9uLCB7XG4gICAgICAgIHN1Y2Nlc3M6IChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICAgIHJldHVybiBmdW5jdGlvbihyZXN1bHQpIHtcbiAgICAgICAgICAgIF90aGlzLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuJChcIi5mYWNlYm9va19idXR0b25cIikuaHRtbChcIlN1Ym1pdHRlZCFcIik7XG4gICAgICAgICAgfTtcbiAgICAgICAgfSkodGhpcyksXG4gICAgICAgIGVycm9yOiAoZnVuY3Rpb24oX3RoaXMpIHtcbiAgICAgICAgICByZXR1cm4gZnVuY3Rpb24oZXJyb3IpIHtcbiAgICAgICAgICAgIF90aGlzLnN1Ym1pdHRlZCA9IHRydWU7XG4gICAgICAgICAgICByZXR1cm4gX3RoaXMuJChcIi5mYWNlYm9va19idXR0b25cIikuaHRtbChcIiBYIFRyeSBBZ2Fpbi4uLlwiKS5yZW1vdmVDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgICAgIH07XG4gICAgICAgIH0pKHRoaXMpXG4gICAgICB9KTtcbiAgICB9O1xuXG4gICAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICAgIGlmIChtb2RlbC5wcmV2aW91cyhcInNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc2NlbmUgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLnJlbmRlciA9IGZ1bmN0aW9uKCkge1xuICAgICAgdmFyIGNvbmdyYXRzSW5kZXg7XG4gICAgICBjb25ncmF0c0luZGV4ID0gKHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIikgPiBHYW1lT3ZlclNjZW5lLkNvbmdyYXRzLmxlbmd0aCA/IEdhbWVPdmVyU2NlbmUuQ29uZ3JhdHMubGVuZ3RoIC0gMSA6IHRoaXMubW9kZWwuZ2V0KFwibGV2ZWxcIikgLSAxKTtcbiAgICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSh7XG4gICAgICAgIHNjb3JlOiB0aGlzLm1vZGVsLmdldChcInNjb3JlXCIpLFxuICAgICAgICBjb25ncmF0czogR2FtZU92ZXJTY2VuZS5Db25ncmF0c1tjb25ncmF0c0luZGV4XVxuICAgICAgfSkpO1xuICAgICAgcmV0dXJuICQoXCIjc3RhZ2VcIikuYXBwZW5kKHRoaXMuJGVsKTtcbiAgICB9O1xuXG4gICAgR2FtZU92ZXJTY2VuZS5wcm90b3R5cGUucmVuZGVyUmVtb3ZlU2NlbmUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgICAgdGhpcy4kKFwiLnN1bW1hcnlcIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5jc3MoVXRpbHMuYnAoKSArIFwiYW5pbWF0aW9uLW5hbWVcIiwgXCJyYWlzZU1lbnVcIik7XG4gICAgICByZXR1cm4gdGhpcy4kKFwiLnN1bW1hcnlcIikuY3NzKFV0aWxzLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VTY29yZXNcIik7XG4gICAgfTtcblxuICAgIEdhbWVPdmVyU2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJzY2VuZVwiKSAhPT0gdGhpcy5zY2VuZU5hbWUgJiYgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJzdW1tYXJ5XCIpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRlbC5lbXB0eSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gR2FtZU92ZXJTY2VuZTtcblxuICB9KShCYWNrYm9uZS5WaWV3KTtcbiAgSGlnaHNjb3JlU2NlbmUgPSAoZnVuY3Rpb24oX3N1cGVyKSB7XG4gICAgX19leHRlbmRzKEhpZ2hzY29yZVNjZW5lLCBfc3VwZXIpO1xuXG4gICAgZnVuY3Rpb24gSGlnaHNjb3JlU2NlbmUoKSB7XG4gICAgICB0aGlzLmNsZWFuVXAgPSBfX2JpbmQodGhpcy5jbGVhblVwLCB0aGlzKTtcbiAgICAgIHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUgPSBfX2JpbmQodGhpcy5yZW5kZXJSZW1vdmVTY2VuZSwgdGhpcyk7XG4gICAgICB0aGlzLnJlbmRlclNjb3JlID0gX19iaW5kKHRoaXMucmVuZGVyU2NvcmUsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJTY29yZUNvbGxlY3Rpb24gPSBfX2JpbmQodGhpcy5yZW5kZXJTY29yZUNvbGxlY3Rpb24sIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjZW5lQ2hhbmdlLCB0aGlzKTtcbiAgICAgIHRoaXMuaGFuZGxlQmFja0J1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZUJhY2tCdXR0b24sIHRoaXMpO1xuICAgICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgICByZXR1cm4gSGlnaHNjb3JlU2NlbmUuX19zdXBlcl9fLmNvbnN0cnVjdG9yLmFwcGx5KHRoaXMsIGFyZ3VtZW50cyk7XG4gICAgfVxuXG4gICAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmNsYXNzTmFtZSA9IFwiaGlnaHNjb3JlX3NjZW5lXCI7XG5cbiAgICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUuZXZlbnRzID0ge1xuICAgICAgYW5pbWF0aW9uZW5kOiBcImNsZWFuVXBcIixcbiAgICAgIHdlYmtpdEFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCIsXG4gICAgICBtb3pBbmltYXRpb25FbmQ6IFwiY2xlYW5VcFwiXG4gICAgfTtcblxuICAgIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS50ZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfaGlnaHNjb3JlXCIpLmh0bWwoKSk7XG5cbiAgICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUuc2NvcmVUZW1wbGF0ZSA9IF8udGVtcGxhdGUoJChcIiNfc2NvcmVcIikuaHRtbCgpKTtcblxuICAgIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5zY2VuZU5hbWUgPSBcImhpZ2hzY29yZVwiO1xuXG4gICAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMubW9kZWwub24oXCJjaGFuZ2U6c2NlbmVcIiwgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSk7XG4gICAgICB0aGlzLm1vZGVsLmdldChcImhpZ2hzY29yZUNvbGxlY3Rpb25cIikub24oXCJyZXNldFwiLCB0aGlzLnJlbmRlclNjb3JlQ29sbGVjdGlvbik7XG4gICAgICB0aGlzLiRlbC5vbihVdGlscy5jbGlja1VwT3JUb3VjaCgpLCBcIi5iYWNrX2J1dHRvblwiLCB0aGlzLmhhbmRsZUJhY2tCdXR0b24pO1xuICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwiY3VycmVudFNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICByZXR1cm4gdGhpcy5yZW5kZXIoKTtcbiAgICAgIH1cbiAgICB9O1xuXG4gICAgSGlnaHNjb3JlU2NlbmUucHJvdG90eXBlLmhhbmRsZUJhY2tCdXR0b24gPSBmdW5jdGlvbihlKSB7XG4gICAgICB0aGlzLiQoXCIuYmFja19idXR0b25cIikuYWRkQ2xhc3MoXCJkaXNhYmxlZFwiKTtcbiAgICAgIHRoaXMubW9kZWwuc2V0KFwic2NlbmVcIiwgXCJtZW51XCIpO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH07XG5cbiAgICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICAgIGlmIChtb2RlbC5wcmV2aW91cyhcInNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc2NlbmUgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5yZW5kZXIgPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMuJGVsLmh0bWwodGhpcy50ZW1wbGF0ZSgpKTtcbiAgICAgIHRoaXMubW9kZWwuZ2V0KFwiaGlnaHNjb3JlQ29sbGVjdGlvblwiKS5mZXRjaCgpO1xuICAgICAgdGhpcy4kKFwiLmhpZ2hzY29yZVwiKS5zcGluKHtcbiAgICAgICAgbGVuZ3RoOiA5LFxuICAgICAgICByYWRpdXM6IDEwLFxuICAgICAgICBsaW5lczogMTIsXG4gICAgICAgIHdpZHRoOiA0LFxuICAgICAgICBjb2xvcjogXCIjZmZmXCJcbiAgICAgIH0pO1xuICAgICAgJChcIiNzdGFnZVwiKS5hcHBlbmQodGhpcy4kZWwpO1xuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJTY29yZUNvbGxlY3Rpb24gPSBmdW5jdGlvbigpIHtcbiAgICAgIHRoaXMubW9kZWwuZ2V0KFwiaGlnaHNjb3JlQ29sbGVjdGlvblwiKS5lYWNoKChmdW5jdGlvbihfdGhpcykge1xuICAgICAgICByZXR1cm4gZnVuY3Rpb24oc2NvcmUsIGluZGV4KSB7XG4gICAgICAgICAgcmV0dXJuIF90aGlzLnJlbmRlclNjb3JlKHNjb3JlLCBpbmRleCk7XG4gICAgICAgIH07XG4gICAgICB9KSh0aGlzKSk7XG4gICAgICAkKFwiLmhpZ2hzY29yZSAuc3Bpbm5lclwiKS5yZW1vdmUoKTtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH07XG5cbiAgICBIaWdoc2NvcmVTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NvcmUgPSBmdW5jdGlvbihzY29yZSwgaW5kZXgpIHtcbiAgICAgIHJldHVybiB0aGlzLiQoXCIjc2NvcmVfdGFibGUgdGJvZHlcIikuYXBwZW5kKHRoaXMuc2NvcmVUZW1wbGF0ZSh7XG4gICAgICAgIHNjb3JlOiBzY29yZSxcbiAgICAgICAgaW5kZXg6IGluZGV4XG4gICAgICB9KSk7XG4gICAgfTtcblxuICAgIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy4kKFwiLm1lbnVfaXRlbVwiKS5hZGRDbGFzcyhcInJlbW92YWxcIik7XG4gICAgICB0aGlzLiQoXCIuaGlnaHNjb3JlXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICAgIHRoaXMuJChcIi5tZW51X2l0ZW1cIikuY3NzKFV0aWxzLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VNZW51XCIpO1xuICAgICAgcmV0dXJuIHRoaXMuJChcIi5oaWdoc2NvcmVcIikuY3NzKFV0aWxzLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VTY29yZXNcIik7XG4gICAgfTtcblxuICAgIEhpZ2hzY29yZVNjZW5lLnByb3RvdHlwZS5jbGVhblVwID0gZnVuY3Rpb24oZSkge1xuICAgICAgaWYgKHRoaXMubW9kZWwuZ2V0KFwic2NlbmVcIikgIT09IHRoaXMuc2NlbmVOYW1lICYmICQoZS50YXJnZXQpLmhhc0NsYXNzKFwiaGlnaHNjb3JlXCIpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRlbC5lbXB0eSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gSGlnaHNjb3JlU2NlbmU7XG5cbiAgfSkoQmFja2JvbmUuVmlldyk7XG4gIENyZWRpdHNTY2VuZSA9IChmdW5jdGlvbihfc3VwZXIpIHtcbiAgICBfX2V4dGVuZHMoQ3JlZGl0c1NjZW5lLCBfc3VwZXIpO1xuXG4gICAgZnVuY3Rpb24gQ3JlZGl0c1NjZW5lKCkge1xuICAgICAgdGhpcy5jbGVhblVwID0gX19iaW5kKHRoaXMuY2xlYW5VcCwgdGhpcyk7XG4gICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lID0gX19iaW5kKHRoaXMucmVuZGVyUmVtb3ZlU2NlbmUsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXIgPSBfX2JpbmQodGhpcy5yZW5kZXIsIHRoaXMpO1xuICAgICAgdGhpcy5yZW5kZXJTY2VuZUNoYW5nZSA9IF9fYmluZCh0aGlzLnJlbmRlclNjZW5lQ2hhbmdlLCB0aGlzKTtcbiAgICAgIHRoaXMuaGFuZGxlQmFja0J1dHRvbiA9IF9fYmluZCh0aGlzLmhhbmRsZUJhY2tCdXR0b24sIHRoaXMpO1xuICAgICAgdGhpcy5pbml0aWFsaXplID0gX19iaW5kKHRoaXMuaW5pdGlhbGl6ZSwgdGhpcyk7XG4gICAgICByZXR1cm4gQ3JlZGl0c1NjZW5lLl9fc3VwZXJfXy5jb25zdHJ1Y3Rvci5hcHBseSh0aGlzLCBhcmd1bWVudHMpO1xuICAgIH1cblxuICAgIENyZWRpdHNTY2VuZS5wcm90b3R5cGUuY2xhc3NOYW1lID0gXCJjcmVkaXRzX3NjZW5lXCI7XG5cbiAgICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLnRlbXBsYXRlID0gXy50ZW1wbGF0ZSgkKFwiI19jcmVkaXRzXCIpLmh0bWwoKSk7XG5cbiAgICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLnNjZW5lTmFtZSA9IFwiY3JlZGl0c1wiO1xuXG4gICAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5ldmVudHMgPSB7XG4gICAgICBhbmltYXRpb25lbmQ6IFwiY2xlYW5VcFwiLFxuICAgICAgd2Via2l0QW5pbWF0aW9uRW5kOiBcImNsZWFuVXBcIixcbiAgICAgIG1vekFuaW1hdGlvbkVuZDogXCJjbGVhblVwXCJcbiAgICB9O1xuXG4gICAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5pbml0aWFsaXplID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLm1vZGVsLm9uKFwiY2hhbmdlOnNjZW5lXCIsIHRoaXMucmVuZGVyU2NlbmVDaGFuZ2UpO1xuICAgICAgcmV0dXJuIHRoaXMuJGVsLm9uKFV0aWxzLmNsaWNrVXBPclRvdWNoKCksIFwiLmJhY2tfYnV0dG9uXCIsIHRoaXMuaGFuZGxlQmFja0J1dHRvbik7XG4gICAgfTtcblxuICAgIENyZWRpdHNTY2VuZS5wcm90b3R5cGUuaGFuZGxlQmFja0J1dHRvbiA9IGZ1bmN0aW9uKGUpIHtcbiAgICAgIHRoaXMuJChcIi5iYWNrX2J1dHRvblwiKS5hZGRDbGFzcyhcImRpc2FibGVkXCIpO1xuICAgICAgdGhpcy5tb2RlbC5zZXQoXCJzY2VuZVwiLCBcIm1lbnVcIik7XG4gICAgICByZXR1cm4gZmFsc2U7XG4gICAgfTtcblxuICAgIENyZWRpdHNTY2VuZS5wcm90b3R5cGUucmVuZGVyU2NlbmVDaGFuZ2UgPSBmdW5jdGlvbihtb2RlbCwgc2NlbmUpIHtcbiAgICAgIGlmIChtb2RlbC5wcmV2aW91cyhcInNjZW5lXCIpID09PSB0aGlzLnNjZW5lTmFtZSkge1xuICAgICAgICB0aGlzLnJlbmRlclJlbW92ZVNjZW5lKCk7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBpZiAoc2NlbmUgPT09IHRoaXMuc2NlbmVOYW1lKSB7XG4gICAgICAgICAgdGhpcy5yZW5kZXIoKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgcmV0dXJuIHRoaXM7XG4gICAgfTtcblxuICAgIENyZWRpdHNTY2VuZS5wcm90b3R5cGUucmVuZGVyID0gZnVuY3Rpb24oKSB7XG4gICAgICB0aGlzLiRlbC5odG1sKHRoaXMudGVtcGxhdGUoKSk7XG4gICAgICAkKFwiI3N0YWdlXCIpLmFwcGVuZCh0aGlzLiRlbCk7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9O1xuXG4gICAgQ3JlZGl0c1NjZW5lLnByb3RvdHlwZS5yZW5kZXJSZW1vdmVTY2VuZSA9IGZ1bmN0aW9uKCkge1xuICAgICAgdGhpcy4kKFwiLmNyZWRpdHNcIikuYWRkQ2xhc3MoXCJyZW1vdmFsXCIpO1xuICAgICAgdGhpcy4kKFwiLmJhY2tfYnV0dG9uXCIpLmFkZENsYXNzKFwicmVtb3ZhbFwiKTtcbiAgICAgIHRoaXMuJChcIi5jcmVkaXRzXCIpLmNzcyhVdGlscy5icCgpICsgXCJhbmltYXRpb24tbmFtZVwiLCBcInJhaXNlTWVudVwiKTtcbiAgICAgIHJldHVybiB0aGlzLiQoXCIuYmFja19idXR0b25cIikuY3NzKFV0aWxzLmJwKCkgKyBcImFuaW1hdGlvbi1uYW1lXCIsIFwicmFpc2VNZW51XCIpO1xuICAgIH07XG5cbiAgICBDcmVkaXRzU2NlbmUucHJvdG90eXBlLmNsZWFuVXAgPSBmdW5jdGlvbihlKSB7XG4gICAgICBpZiAodGhpcy5tb2RlbC5nZXQoXCJzY2VuZVwiKSAhPT0gdGhpcy5zY2VuZU5hbWUgJiYgJChlLnRhcmdldCkuaGFzQ2xhc3MoXCJjcmVkaXRzXCIpKSB7XG4gICAgICAgIHJldHVybiB0aGlzLiRlbC5lbXB0eSgpO1xuICAgICAgfVxuICAgIH07XG5cbiAgICByZXR1cm4gQ3JlZGl0c1NjZW5lO1xuXG4gIH0pKEJhY2tib25lLlZpZXcpO1xuICByZXR1cm4gR2FtZS5pbml0aWFsaXplKCk7XG59KTtcblxud2luZG93LlV0aWxzID0ge1xuICBicDogZnVuY3Rpb24oKSB7XG4gICAgdmFyIGJwO1xuICAgIGJwID0gXCJcIjtcbiAgICBpZiAoJC5icm93c2VyLndlYmtpdCkge1xuICAgICAgYnAgPSBcIi13ZWJraXQtXCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGlmICgkLmJyb3dzZXIubW96aWxsYSkge1xuICAgICAgICBicCA9IFwiLW1vei1cIjtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGJwO1xuICB9LFxuICBpc1N1cHBvcnRlZDogZnVuY3Rpb24oKSB7XG4gICAgcmV0dXJuICEoJC5icm93c2VyLm1zaWUgJiYgcGFyc2VJbnQoJC5icm93c2VyLnZlcnNpb24pIDwgMTApO1xuICB9LFxuICBuZXh0VGljazogZnVuY3Rpb24oZnVuYykge1xuICAgIHJldHVybiBzZXRUaW1lb3V0KGZ1bmMsIDApO1xuICB9LFxuICBjbGlja1VwT3JUb3VjaDogZnVuY3Rpb24oZnVuYykge1xuICAgIGlmIChcIm9udG91Y2hzdGFydFwiIGluIHdpbmRvdykge1xuICAgICAgcmV0dXJuIFwidG91Y2hzdGFydFwiO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gXCJtb3VzZXVwXCI7XG4gICAgfVxuICB9LFxuICBjbGlja0Rvd25PclRvdWNoOiBmdW5jdGlvbihmdW5jKSB7XG4gICAgaWYgKFwib250b3VjaHN0YXJ0XCIgaW4gd2luZG93KSB7XG4gICAgICByZXR1cm4gXCJ0b3VjaHN0YXJ0XCI7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiBcIm1vdXNlZG93blwiO1xuICAgIH1cbiAgfVxufTtcblxuJC5mbi5zcGluID0gZnVuY3Rpb24ob3B0cykge1xuICB0aGlzLmVhY2goZnVuY3Rpb24oKSB7XG4gICAgdmFyICR0aGlzLCBkYXRhO1xuICAgICR0aGlzID0gJCh0aGlzKTtcbiAgICBkYXRhID0gJHRoaXMuZGF0YSgpO1xuICAgIGlmIChkYXRhLnNwaW5uZXIpIHtcbiAgICAgIGRhdGEuc3Bpbm5lci5zdG9wKCk7XG4gICAgICBkZWxldGUgZGF0YS5zcGlubmVyO1xuICAgIH1cbiAgICBpZiAob3B0cyAhPT0gZmFsc2UpIHtcbiAgICAgIHJldHVybiBkYXRhLnNwaW5uZXIgPSBuZXcgU3Bpbm5lcigkLmV4dGVuZCh7XG4gICAgICAgIGNvbG9yOiAkdGhpcy5jc3MoXCJjb2xvclwiKVxuICAgICAgfSwgb3B0cykpLnNwaW4odGhpcyk7XG4gICAgfVxuICB9KTtcbiAgcmV0dXJuIHRoaXM7XG59O1xuXG5QYXJzZS5pbml0aWFsaXplKFwiMFpVbjFUYURGOUczajZVaHZvTkZ1SVZTekY0NXZwU085SzBybG9zTVwiLCBcIm9VMVRvWjlMTlpvTXNscGhwZ3hRTm9WakpYRXFvaTU5TTAxOFpQMDhcIik7XG5cbndpbmRvdy5mYkFzeW5jSW5pdCA9IGZ1bmN0aW9uKCkge1xuICByZXR1cm4gUGFyc2UuRmFjZWJvb2tVdGlscy5pbml0KHtcbiAgICBhcHBJZDogXCIxMzgwMTAzMTgyMjUwNTIwXCIsXG4gICAgY2hhbm5lbFVybDogXCIvY2hhbm5lbC5odG1sXCIsXG4gICAgc3RhdHVzOiB0cnVlLFxuICAgIGNvb2tpZTogdHJ1ZSxcbiAgICB4ZmJtbDogdHJ1ZVxuICB9KTtcbn07XG5cbihmdW5jdGlvbihkLCBkZWJ1Zykge1xuICB2YXIgaWQsIGpzLCByZWY7XG4gIGpzID0gdm9pZCAwO1xuICBpZCA9IFwiZmFjZWJvb2stanNzZGtcIjtcbiAgcmVmID0gZC5nZXRFbGVtZW50c0J5VGFnTmFtZShcInNjcmlwdFwiKVswXTtcbiAgaWYgKGQuZ2V0RWxlbWVudEJ5SWQoaWQpKSB7XG4gICAgcmV0dXJuO1xuICB9XG4gIGpzID0gZC5jcmVhdGVFbGVtZW50KFwic2NyaXB0XCIpO1xuICBqcy5pZCA9IGlkO1xuICBqcy5hc3luYyA9IHRydWU7XG4gIGpzLnNyYyA9IFwiLy9jb25uZWN0LmZhY2Vib29rLm5ldC9lbl9VUy9hbGxcIiArIChkZWJ1ZyA/IFwiL2RlYnVnXCIgOiBcIlwiKSArIFwiLmpzXCI7XG4gIHJldHVybiByZWYucGFyZW50Tm9kZS5pbnNlcnRCZWZvcmUoanMsIHJlZik7XG59KShkb2N1bWVudCwgZmFsc2UpO1xuIl19
